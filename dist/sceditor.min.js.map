{"version":3,"file":"sceditor.min.js","sources":["sceditor.min.js","../src/formats/bbcode.js","../src/icons/fontawesome.js","../src/plugins/dragdrop.js","../src/plugins/undo.js","../src/plugins/plaintext.js","../src/plugins/mentions.js"],"sourcesContent":["(function () {\n\t'use strict';\n\n\t/**\n\t * Check if the passed argument is the\n\t * the passed type.\n\t *\n\t * @param {string} type\n\t * @param {*} arg\n\t * @returns {boolean}\n\t */\n\tfunction isTypeof(type, arg) {\n\t\treturn typeof arg === type;\n\t}\n\n\t/**\n\t * @type {function(*): boolean}\n\t */\n\tvar isString = isTypeof.bind(null, 'string');\n\n\t/**\n\t * @type {function(*): boolean}\n\t */\n\tvar isUndefined = isTypeof.bind(null, 'undefined');\n\n\t/**\n\t * @type {function(*): boolean}\n\t */\n\tvar isFunction = isTypeof.bind(null, 'function');\n\n\t/**\n\t * @type {function(*): boolean}\n\t */\n\tvar isNumber = isTypeof.bind(null, 'number');\n\n\n\t/**\n\t * Returns true if an object has no keys\n\t *\n\t * @param {!Object} obj\n\t * @returns {boolean}\n\t */\n\tfunction isEmptyObject(obj) {\n\t\treturn !Object.keys(obj).length;\n\t}\n\n\t/**\n\t * Extends the first object with any extra objects passed\n\t *\n\t * If the first argument is boolean and set to true\n\t * it will extend child arrays and objects recursively.\n\t *\n\t * @param {!Object|boolean} targetArg\n\t * @param {...Object} source\n\t * @return {Object}\n\t */\n\tfunction extend(targetArg, sourceArg) {\n\t\tconst isTargetBoolean = targetArg === !!targetArg;\n\t\tvar i = isTargetBoolean ? 2 : 1;\n\t\tconst target = isTargetBoolean ? sourceArg : targetArg;\n\t\tconst isDeep = isTargetBoolean ? targetArg : false;\n\n\t\tfunction isObject(value) {\n\t\t\treturn value !== null &&\n\t\t\t\ttypeof value === 'object' &&\n\t\t\t\tObject.getPrototypeOf(value) === Object.prototype;\n\t\t}\n\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tconst source = arguments[i];\n\n\t\t\t// Copy all properties for jQuery compatibility\n\t\t\t/* eslint guard-for-in: off */\n\t\t\tfor (let key in source) {\n\t\t\t\tconst targetValue = target[key];\n\t\t\t\tconst value = source[key];\n\n\t\t\t\t// Skip undefined values to match jQuery\n\t\t\t\tif (isUndefined(value)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Skip special keys to prevent prototype pollution\n\t\t\t\tif (key === '__proto__' || key === 'constructor') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst isValueObject = isObject(value);\n\t\t\t\tconst isValueArray = Array.isArray(value);\n\n\t\t\t\tif (isDeep && (isValueObject || isValueArray)) {\n\t\t\t\t\t// Can only merge if target type matches otherwise create\n\t\t\t\t\t// new target to merge into\n\t\t\t\t\tconst isSameType = isObject(targetValue) === isValueObject &&\n\t\t\t\t\t\tArray.isArray(targetValue) === isValueArray;\n\n\t\t\t\t\ttarget[key] = extend(\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\tisSameType ? targetValue : (isValueArray ? [] : {}),\n\t\t\t\t\t\tvalue\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\ttarget[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Removes an item from the passed array\n\t *\n\t * @param {!Array} arr\n\t * @param {*} item\n\t */\n\tfunction arrayRemove(arr, item) {\n\t\tconst i = arr.indexOf(item);\n\n\t\tif (i > -1) {\n\t\t\tarr.splice(i, 1);\n\t\t}\n\t}\n\n\t/**\n\t * Iterates over an array or object\n\t *\n\t * @param {!Object|Array} obj\n\t * @param {function(*, *)} fn\n\t */\n\tfunction each(obj, fn) {\n\t\tif (Array.isArray(obj) || 'length' in obj && isNumber(obj.length)) {\n\t\t\tfor (let i = 0; i < obj.length; i++) {\n\t\t\t\tfn(i, obj[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tObject.keys(obj).forEach(function (key) {\n\t\t\t\tfn(key, obj[key]);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Cache of camelCase CSS property names\n\t * @type {Object<string, string>}\n\t */\n\tvar cssPropertyNameCache = {};\n\n\t/**\n\t * Node type constant for element nodes\n\t *\n\t * @type {number}\n\t */\n\tvar ELEMENT_NODE = 1;\n\n\t/**\n\t * Node type constant for text nodes\n\t *\n\t * @type {number}\n\t */\n\tvar TEXT_NODE = 3;\n\n\t/**\n\t * Node type constant for comment nodes\n\t *\n\t * @type {number}\n\t */\n\tvar COMMENT_NODE = 8;\n\n\tfunction toFloat(value) {\n\t\tvalue = parseFloat(value);\n\n\t\treturn isFinite(value) ? value : 0;\n\t}\n\n\t/**\n\t * Creates an element with the specified attributes\n\t *\n\t * Will create it in the current document unless context\n\t * is specified.\n\t *\n\t * @param {!string} tag\n\t * @param {!Object<string, string>} [attributes]\n\t * @param {!Document} [context]\n\t * @returns {!HTMLElement}\n\t */\n\tfunction createElement(tag, attributes, context) {\n\t\tvar node = (context || document).createElement(tag);\n\n\t\teach(attributes || {}, function (key, value) {\n\t\t\tif (key === 'style') {\n\t\t\t\tnode.style.cssText = value;\n\n\t\t\t} else if (key in node) {\n\t\t\t\tnode[key] = value;\n\t\t\t} else {\n\t\t\t\tnode.setAttribute(key, value);\n\t\t\t}\n\t\t});\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Gets the first parent node that matches the selector\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!string} [selector]\n\t * @returns {HTMLElement|undefined}\n\t */\n\tfunction parent(node, selector) {\n\t\tvar parent = node || {};\n\n\t\twhile ((parent = parent.parentNode) && !/(9|11)/.test(parent.nodeType)) {\n\t\t\tif (!selector || is(parent, selector)) {\n\t\t\t\treturn parent;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Checks the passed node and all parents and\n\t * returns the first matching node if any.\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!string} selector\n\t * @returns {HTMLElement|undefined}\n\t */\n\tfunction closest(node, selector) {\n\t\treturn is(node, selector) ? node : parent(node, selector);\n\t}\n\n\t/**\n\t * Removes the node from the DOM\n\t *\n\t * @param {!HTMLElement} node\n\t */\n\tfunction remove(node) {\n\t\tif (node.parentNode) {\n\t\t\tnode.parentNode.removeChild(node);\n\t\t}\n\t}\n\n\t/**\n\t * Appends child to parent node\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!HTMLElement} child\n\t */\n\tfunction appendChild(node, child) {\n\t\tnode.appendChild(child);\n\t}\n\n\t/**\n\t * Finds any child nodes that match the selector\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!string} selector\n\t * @returns {NodeList}\n\t */\n\tfunction find(node, selector) {\n\t\treturn node.querySelectorAll(selector);\n\t}\n\n\t/**\n\t * For on() and off() if to add/remove the event\n\t * to the capture phase\n\t *\n\t * @type {boolean}\n\t */\n\tvar EVENT_CAPTURE = true;\n\n\t/**\n\t * Adds an event listener for the specified events.\n\t *\n\t * Events should be a space separated list of events.\n\t *\n\t * If selector is specified the handler will only be\n\t * called when the event target matches the selector.\n\t *\n\t * @param {!Node} node\n\t * @param {string} events\n\t * @param {string} [selector]\n\t * @param {function(Object)} fn\n\t * @param {boolean} [capture=false]\n\t * @see off()\n\t */\n\t// eslint-disable-next-line max-params\n\tfunction on(node, events, selector, fn, capture) {\n\t\tevents.split(' ').forEach(function (event) {\n\t\t\tvar handler;\n\n\t\t\tif (isString(selector)) {\n\t\t\t\thandler = fn[`_sce-event-${event}${selector}`] || function (e) {\n\t\t\t\t\tvar target = e.target;\n\t\t\t\t\twhile (target && target !== node) {\n\t\t\t\t\t\tif (is(target, selector)) {\n\t\t\t\t\t\t\tfn.call(target, e);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttarget = target.parentNode;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tfn[`_sce-event-${event}${selector}`] = handler;\n\t\t\t} else {\n\t\t\t\thandler = selector;\n\t\t\t\tcapture = fn;\n\t\t\t}\n\n\t\t\tnode.addEventListener(event, handler, capture || false);\n\t\t});\n\t}\n\n\t/**\n\t * Removes an event listener for the specified events.\n\t *\n\t * @param {!Node} node\n\t * @param {string} events\n\t * @param {string} [selector]\n\t * @param {function(Object)} fn\n\t * @param {boolean} [capture=false]\n\t * @see on()\n\t */\n\t// eslint-disable-next-line max-params\n\tfunction off(node, events, selector, fn, capture) {\n\t\tevents.split(' ').forEach(function (event) {\n\t\t\tvar handler;\n\n\t\t\tif (isString(selector)) {\n\t\t\t\thandler = fn[`_sce-event-${event}${selector}`];\n\t\t\t} else {\n\t\t\t\thandler = selector;\n\t\t\t\tcapture = fn;\n\t\t\t}\n\n\t\t\tnode.removeEventListener(event, handler, capture || false);\n\t\t});\n\t}\n\n\t/**\n\t * If only attr param is specified it will get\n\t * the value of the attr param.\n\t *\n\t * If value is specified but null the attribute\n\t * will be removed otherwise the attr value will\n\t * be set to the passed value.\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!string} attr\n\t * @param {?string} [value]\n\t */\n\tfunction attr(node, attr, value) {\n\t\tif (arguments.length < 3) {\n\t\t\treturn node.getAttribute(attr);\n\t\t}\n\n\t\t// eslint-disable-next-line eqeqeq, no-eq-null\n\t\tif (value == null) {\n\t\t\tremoveAttr(node, attr);\n\t\t} else {\n\t\t\tnode.setAttribute(attr, value);\n\t\t}\n\t}\n\n\t/**\n\t * Removes the specified attribute\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!string} attr\n\t */\n\tfunction removeAttr(node, attr) {\n\t\tnode.removeAttribute(attr);\n\t}\n\n\t/**\n\t * Sets the passed elements display to none\n\t *\n\t * @param {!HTMLElement} node\n\t */\n\tfunction hide(node) {\n\t\tcss(node, 'display', 'none');\n\t}\n\n\t/**\n\t * Sets the passed elements display to default\n\t *\n\t * @param {!HTMLElement} node\n\t */\n\tfunction show(node) {\n\t\tcss(node, 'display', '');\n\t}\n\n\t/**\n\t * Toggles an elements visibility\n\t *\n\t * @param {!HTMLElement} node\n\t */\n\tfunction toggle(node) {\n\t\tif (isVisible(node)) {\n\t\t\thide(node);\n\t\t} else {\n\t\t\tshow(node);\n\t\t}\n\t}\n\n\t/**\n\t * Gets a computed CSS values or sets an inline CSS value\n\t *\n\t * Rules should be in camelCase format and not\n\t * hyphenated like CSS properties.\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!Object|string} rule\n\t * @param {string|number} [value]\n\t * @return {string|number|undefined}\n\t */\n\tfunction css(node, rule, value) {\n\t\tif (arguments.length < 3) {\n\t\t\tif (isString(rule)) {\n\t\t\t\treturn node.nodeType === 1 ? getComputedStyle(node)[rule] : null;\n\t\t\t}\n\n\t\t\teach(rule,\n\t\t\t\tfunction (key, value) {\n\t\t\t\t\tcss(node, key, value);\n\t\t\t\t});\n\t\t} else {\n\t\t\t// isNaN returns false for null, false and empty strings\n\t\t\t// so need to check it's truthy or 0\n\t\t\tconst isNumeric = (value || value === 0) && !isNaN(value);\n\t\t\tnode.style[rule] = isNumeric ? value + 'px' : value;\n\t\t}\n\t}\n\n\n\t/**\n\t * Gets or sets the data attributes on a node\n\t *\n\t * Unlike the jQuery version this only stores data\n\t * in the DOM attributes which means only strings\n\t * can be stored.\n\t *\n\t * @param {Node} node\n\t * @param {string} [key]\n\t * @param {string} [value]\n\t * @return {Object|undefined}\n\t */\n\tfunction data(node, key, value) {\n\t\tconst argsLength = arguments.length;\n\t\tvar data = {};\n\n\t\tif (node.nodeType === ELEMENT_NODE) {\n\t\t\tif (argsLength === 1) {\n\t\t\t\teach(node.attributes,\n\t\t\t\t\tfunction (_, attr) {\n\t\t\t\t\t\tif (/^data\\-/i.test(attr.name)) {\n\t\t\t\t\t\t\tdata[attr.name.substr(5)] = attr.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\treturn data;\n\t\t\t}\n\n\t\t\tif (argsLength === 2) {\n\t\t\t\treturn attr(node, `data-${key}`);\n\t\t\t}\n\n\t\t\tattr(node, `data-${key}`, String(value));\n\t\t}\n\t}\n\n\t/**\n\t * Checks if node matches the given selector.\n\t *\n\t * @param {?HTMLElement} node\n\t * @param {string} selector\n\t * @returns {boolean}\n\t */\n\tfunction is(node, selector) {\n\t\tvar result = false;\n\n\t\tif (node && node.nodeType === ELEMENT_NODE) {\n\t\t\tresult = (node.matches ||\n\t\t\t\tnode.msMatchesSelector ||\n\t\t\t\tnode.webkitMatchesSelector).call(node, selector);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\n\t/**\n\t * Returns true if node contains child otherwise false.\n\t *\n\t * This differs from the DOM contains() method in that\n\t * if node and child are equal this will return false.\n\t *\n\t * @param {!Node} node\n\t * @param {HTMLElement} child\n\t * @returns {boolean}\n\t */\n\tfunction contains(node, child) {\n\t\treturn node !== child && node.contains && node.contains(child);\n\t}\n\n\t/**\n\t * @param {Node} node\n\t * @param {string} [selector]\n\t * @returns {?HTMLElement}\n\t */\n\tfunction previousElementSibling(node, selector) {\n\t\tconst prev = node.previousElementSibling;\n\n\t\tif (selector && prev) {\n\t\t\treturn is(prev, selector) ? prev : null;\n\t\t}\n\n\t\treturn prev;\n\t}\n\n\t/**\n\t * @param {!Node} node\n\t * @param {!Node} refNode\n\t * @returns {Node}\n\t */\n\tfunction insertBefore(node, refNode) {\n\t\treturn refNode.parentNode.insertBefore(node, refNode);\n\t}\n\n\t/**\n\t * @param {?HTMLElement} node\n\t * @returns {!Array.<string>}\n\t */\n\tfunction classes(node) {\n\t\treturn node.className.trim().split(/\\s+/);\n\t}\n\n\t/**\n\t * @param {?HTMLElement} node\n\t * @param {string} className\n\t * @returns {boolean}\n\t */\n\tfunction hasClass(node, className) {\n\t\treturn is(node, `.${className}`);\n\t}\n\n\t/**\n\t * @param {!HTMLElement} node\n\t * @param {string} className\n\t */\n\tfunction addClass(node, className) {\n\t\tconst classList = classes(node);\n\n\t\tif (classList.indexOf(className) < 0) {\n\t\t\tclassList.push(className);\n\t\t}\n\n\t\tnode.className = classList.join(' ');\n\t}\n\n\t/**\n\t * @param {!HTMLElement} node\n\t * @param {string} className\n\t */\n\tfunction removeClass(node, className) {\n\t\tconst classList = classes(node);\n\n\t\tarrayRemove(classList, className);\n\n\t\tnode.className = classList.join(' ');\n\t}\n\n\t/**\n\t * Toggles a class on node.\n\t *\n\t * If state is specified and is truthy it will add\n\t * the class.\n\t *\n\t * If state is specified and is falsey it will remove\n\t * the class.\n\t *\n\t * @param {HTMLElement} node\n\t * @param {string} className\n\t * @param {boolean} [state]\n\t */\n\tfunction toggleClass(node, className, state) {\n\t\tstate = isUndefined(state) ? !hasClass(node, className) : state;\n\n\t\tif (state) {\n\t\t\taddClass(node, className);\n\t\t} else {\n\t\t\tremoveClass(node, className);\n\t\t}\n\t}\n\n\t/**\n\t * Gets or sets the width of the passed node.\n\t *\n\t * @param {HTMLElement} node\n\t * @param {number|string} [value]\n\t * @returns {number|undefined}\n\t */\n\tfunction width(node, value) {\n\t\tif (isUndefined(value)) {\n\t\t\tconst cs = getComputedStyle(node);\n\t\t\tconst padding = toFloat(cs.paddingLeft) + toFloat(cs.paddingRight);\n\t\t\tconst border = toFloat(cs.borderLeftWidth) + toFloat(cs.borderRightWidth);\n\n\t\t\treturn node.offsetWidth - padding - border;\n\t\t}\n\n\t\tcss(node, 'width', value);\n\t}\n\n\t/**\n\t * Gets or sets the height of the passed node.\n\t *\n\t * @param {HTMLElement} node\n\t * @param {number|string} [value]\n\t * @returns {number|undefined}\n\t */\n\tfunction height(node, value) {\n\t\tif (isUndefined(value)) {\n\t\t\tconst cs = getComputedStyle(node);\n\t\t\tconst padding = toFloat(cs.paddingTop) + toFloat(cs.paddingBottom);\n\t\t\tconst border = toFloat(cs.borderTopWidth) + toFloat(cs.borderBottomWidth);\n\n\t\t\treturn node.offsetHeight - padding - border;\n\t\t}\n\n\t\tcss(node, 'height', value);\n\t}\n\n\t/**\n\t * Triggers a custom event with the specified name and\n\t * sets the detail property to the data object passed.\n\t *\n\t * @param {HTMLElement} node\n\t * @param {string} eventName\n\t * @param {Object} [data]\n\t */\n\tfunction trigger(node, eventName, data) {\n\t\tvar event;\n\n\t\tif (isFunction(window.CustomEvent)) {\n\t\t\tevent = new CustomEvent(eventName, {\n\t\t\t\tbubbles: true,\n\t\t\t\tcancelable: true,\n\t\t\t\tdetail: data\n\t\t\t});\n\t\t} else {\n\t\t\tevent = node.ownerDocument.createEvent('CustomEvent');\n\t\t\tevent.initCustomEvent(eventName, true, true, data);\n\t\t}\n\n\t\tnode.dispatchEvent(event);\n\t}\n\n\t/**\n\t * Returns if a node is visible.\n\t *\n\t * @param {HTMLElement}\n\t * @returns {boolean}\n\t */\n\tfunction isVisible(node) {\n\t\treturn !!node.getClientRects().length;\n\t}\n\n\t/**\n\t * Convert CSS property names into camel case\n\t *\n\t * @param {string} string\n\t * @returns {string}\n\t */\n\tfunction camelCase(string) {\n\t\treturn string\n\t\t\t.replace(/^-ms-/, 'ms-')\n\t\t\t.replace(/-(\\w)/g, function (match, char) {\n\t\t\t\treturn char.toUpperCase();\n\t\t\t});\n\t}\n\n\n\t/**\n\t * Loop all child nodes of the passed node\n\t *\n\t * The function should accept 1 parameter being the node.\n\t * If the function returns false the loop will be exited.\n\t *\n\t * @param  {HTMLElement} node\n\t * @param  {function} func           Callback which is called with every\n\t *                                   child node as the first argument.\n\t * @param  {boolean} innermostFirst  If the innermost node should be passed\n\t *                                   to the function before it's parents.\n\t * @param  {boolean} siblingsOnly    If to only traverse the nodes siblings\n\t * @param  {boolean} [reverse=false] If to traverse the nodes in reverse\n\t */\n\t// eslint-disable-next-line max-params\n\tfunction traverse(node, func, innermostFirst, siblingsOnly, reverse) {\n\t\tnode = reverse ? node.lastChild : node.firstChild;\n\n\t\twhile (node) {\n\t\t\tconst next = reverse ? node.previousSibling : node.nextSibling;\n\n\t\t\tif (\n\t\t\t\t(!innermostFirst && func(node) === false) ||\n\t\t\t\t(!siblingsOnly && traverse(\n\t\t\t\t\tnode, func, innermostFirst, siblingsOnly, reverse\n\t\t\t\t) === false) ||\n\t\t\t\t(innermostFirst && func(node) === false)\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tnode = next;\n\t\t}\n\t}\n\n\t/**\n\t * Like traverse but loops in reverse\n\t * @see traverse\n\t */\n\tfunction rTraverse(node, func, innermostFirst, siblingsOnly) {\n\t\ttraverse(node, func, innermostFirst, siblingsOnly, true);\n\t}\n\n\t/**\n\t * Parses HTML into a document fragment\n\t *\n\t * @param {string} html\n\t * @param {Document} [context]\n\t * @since 1.4.4\n\t * @return {DocumentFragment}\n\t */\n\tfunction parseHTML(html, context) {\n\t\tcontext = context || document;\n\n\t\tconst ret = context.createDocumentFragment();\n\t\tconst tmp = createElement('div', {}, context);\n\n\t\ttmp.innerHTML = html;\n\n\t\twhile (tmp.firstChild) {\n\t\t\tappendChild(ret, tmp.firstChild);\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Checks if an element has any styling.\n\t *\n\t * It has styling if it is not a plain <div> or <p> or\n\t * if it has a class, style attribute or data.\n\t *\n\t * @param  {HTMLElement} elm\n\t * @return {boolean}\n\t * @since 1.4.4\n\t */\n\tfunction hasStyling(node) {\n\t\treturn node && (!is(node, 'p,div') || node.className ||\n\t\t\tattr(node, 'style') || !isEmptyObject(data(node)));\n\t}\n\n\t/**\n\t * Converts an element from one type to another.\n\t *\n\t * For example it can convert the element <b> to <strong>\n\t *\n\t * @param  {HTMLElement} element\n\t * @param  {string}      toTagName\n\t * @return {HTMLElement}\n\t * @since 1.4.4\n\t */\n\tfunction convertElement(element, toTagName) {\n\t\tvar newElement = createElement(toTagName, {}, element.ownerDocument);\n\n\t\teach(element.attributes, function (_, attribute) {\n\t\t\t// Some browsers parse invalid attributes names like\n\t\t\t// 'size\"2' which throw an exception when set, just\n\t\t\t// ignore these.\n\t\t\ttry {\n\t\t\t\tattr(newElement, attribute.name, attribute.value);\n\t\t\t} catch (_) {}\n\t\t});\n\n\t\twhile (element.firstChild) {\n\t\t\tappendChild(newElement, element.firstChild);\n\t\t}\n\n\t\telement.parentNode.replaceChild(newElement, element);\n\n\t\treturn newElement;\n\t}\n\n\t/**\n\t * List of block level elements separated by bars (|)\n\t *\n\t * @type {string}\n\t */\n\tvar blockLevelList = '|body|hr|p|div|h1|h2|h3|h4|h5|h6|address|pre|' +\n\t\t'form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|blockquote|center|' +\n\t\t'details|section|article|aside|nav|main|header|hgroup|footer|fieldset|' +\n\t\t'dl|dt|dd|figure|figcaption|';\n\n\t/**\n\t * List of elements that do not allow children separated by bars (|)\n\t *\n\t * @param {Node} node\n\t * @return {boolean}\n\t * @since  1.4.5\n\t */\n\tfunction canHaveChildren(node) {\n\t\t// 1  = Element\n\t\t// 9  = Document\n\t\t// 11 = Document Fragment\n\t\tif (!/11?|9/.test(node.nodeType)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// List of empty HTML tags separated by bar (|) character.\n\t\t// Source: http://www.w3.org/TR/html4/index/elements.html\n\t\t// Source: http://www.w3.org/TR/html5/syntax.html#void-elements\n\t\treturn ('|iframe|area|base|basefont|br|col|frame|hr|img|input|wbr' +\n\t\t\t'|isindex|link|meta|param|command|embed|keygen|source|track|' +\n\t\t\t'object|').indexOf(`|${node.nodeName.toLowerCase()}|`) < 0;\n\t}\n\n\t/**\n\t * Checks if an element is inline\n\t *\n\t * @param {HTMLElement} elm\n\t * @param {boolean} [includeCodeAsBlock=false]\n\t * @return {boolean}\n\t */\n\tfunction isInline(elm, includeCodeAsBlock) {\n\t\tvar tagName;\n\t\tconst nodeType = (elm || {}).nodeType || TEXT_NODE;\n\n\t\tif (nodeType !== ELEMENT_NODE) {\n\t\t\treturn nodeType === TEXT_NODE;\n\t\t}\n\n\t\ttagName = elm.tagName.toLowerCase();\n\n\t\tif (tagName === 'code') {\n\t\t\treturn !includeCodeAsBlock;\n\t\t}\n\n\t\treturn blockLevelList.indexOf(`|${tagName}|`) < 0;\n\t}\n\n\t/**\n\t * Copy the CSS from 1 node to another.\n\t *\n\t * Only copies CSS defined on the element e.g. style attr.\n\t *\n\t * @param {HTMLElement} from\n\t * @param {HTMLElement} to\n\t * @deprecated since v3.1.0\n\t */\n\tfunction copyCSS(from, to) {\n\t\tif (to.style && from.style) {\n\t\t\tto.style.cssText = from.style.cssText + to.style.cssText;\n\t\t}\n\t}\n\n\t/**\n\t * Checks if a DOM node is empty\n\t *\n\t * @param {Node} node\n\t * @returns {boolean}\n\t */\n\tfunction isEmpty(node) {\n\t\tif (node.lastChild && isEmpty(node.lastChild)) {\n\t\t\tremove(node.lastChild);\n\t\t}\n\n\t\treturn node.nodeType === 3 ? !node.nodeValue :\n\t\t\t(canHaveChildren(node) && !node.childNodes.length);\n\t}\n\n\t/**\n\t * Fixes block level elements inside in inline elements.\n\t *\n\t * Also fixes invalid list nesting by placing nested lists\n\t * inside the previous li tag or wrapping them in an li tag.\n\t *\n\t * @param {HTMLElement} node\n\t */\n\tfunction fixNesting(node) {\n\t\ttraverse(node, function (node) {\n\t\t\tconst list = 'ul,ol';\n\t\t\tconst isBlock = !isInline(node, true) && node.nodeType !== COMMENT_NODE;\n\t\t\tvar parent = node.parentNode;\n\n\t\t\t// Any blocklevel element inside an inline element needs fixing.\n\t\t\t// Also <p> tags that contain blocks should be fixed\n\t\t\tif (isBlock && (isInline(parent, true) || parent.tagName === 'P')) {\n\t\t\t\t// Find the last inline parent node\n\t\t\t\tlet lastInlineParent = node;\n\t\t\t\twhile (isInline(lastInlineParent.parentNode, true) ||\n\t\t\t\t\tlastInlineParent.parentNode.tagName === 'P') {\n\t\t\t\t\tlastInlineParent = lastInlineParent.parentNode;\n\t\t\t\t}\n\n\t\t\t\tconst before = extractContents(lastInlineParent, node);\n\t\t\t\tconst middle = node;\n\n\t\t\t\t// Clone inline styling and apply it to the blocks children\n\t\t\t\twhile (parent && isInline(parent, true)) {\n\t\t\t\t\tif (parent.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\tconst clone = parent.cloneNode();\n\t\t\t\t\t\twhile (middle.firstChild) {\n\t\t\t\t\t\t\tappendChild(clone, middle.firstChild);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tappendChild(middle, clone);\n\t\t\t\t\t}\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\tinsertBefore(middle, lastInlineParent);\n\t\t\t\tif (!isEmpty(before)) {\n\t\t\t\t\tinsertBefore(before, middle);\n\t\t\t\t}\n\t\t\t\tif (isEmpty(lastInlineParent)) {\n\t\t\t\t\tremove(lastInlineParent);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fix invalid nested lists which should be wrapped in an li tag\n\t\t\tif (isBlock && is(node, list) && is(node.parentNode, list)) {\n\t\t\t\tlet li = previousElementSibling(node, 'li');\n\n\t\t\t\tif (!li) {\n\t\t\t\t\tli = createElement('li');\n\t\t\t\t\tinsertBefore(li, node);\n\t\t\t\t}\n\n\t\t\t\tappendChild(li, node);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Finds the common parent of two nodes\n\t *\n\t * @param {!HTMLElement} node1\n\t * @param {!HTMLElement} node2\n\t * @return {?HTMLElement}\n\t */\n\tfunction findCommonAncestor(node1, node2) {\n\t\twhile ((node1 = node1.parentNode)) {\n\t\t\tif (contains(node1, node2)) {\n\t\t\t\treturn node1;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @param {?Node}\n\t * @param {boolean} [previous=false]\n\t * @returns {?Node}\n\t */\n\tfunction getSibling(node, previous) {\n\t\tif (!node) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn (previous ? node.previousSibling : node.nextSibling) ||\n\t\t\tgetSibling(node.parentNode, previous);\n\t}\n\n\t/**\n\t * Removes unused whitespace from the root and all it's children.\n\t *\n\t * @param {!HTMLElement} root\n\t * @since 1.4.3\n\t */\n\tfunction removeWhiteSpace(root) {\n\t\tvar\tnodeValue, nodeType, next, previous, previousSibling,\n\t\t\tnextNode, trimStart\n\t        // Preserve newlines if is pre-line\n\t        ;\n\t\tconst cssWhiteSpace = css(root, 'whiteSpace');\n\t\tconst preserveNewLines = /line$/i.test(cssWhiteSpace);\n\t\tvar node = root.firstChild;\n\n\t\t// Skip pre & pre-wrap with any vendor prefix\n\t\tif (/pre(\\-wrap)?$/i.test(cssWhiteSpace)) {\n\t\t\treturn;\n\t\t}\n\n\t\twhile (node) {\n\t\t\tnextNode  = node.nextSibling;\n\t\t\tnodeValue = node.nodeValue;\n\t\t\tnodeType  = node.nodeType;\n\n\t\t\tif (nodeType === ELEMENT_NODE && node.firstChild) {\n\t\t\t\tremoveWhiteSpace(node);\n\t\t\t}\n\n\t\t\tif (nodeType === TEXT_NODE) {\n\t\t\t\tnext      = getSibling(node);\n\t\t\t\tprevious  = getSibling(node, true);\n\t\t\t\ttrimStart = false;\n\n\t\t\t\twhile (hasClass(previous, 'sceditor-ignore')) {\n\t\t\t\t\tprevious = getSibling(previous, true);\n\t\t\t\t}\n\n\t\t\t\t// If previous sibling isn't inline or is a textnode that\n\t\t\t\t// ends in whitespace, time the start whitespace\n\t\t\t\tif (isInline(node) && previous) {\n\t\t\t\t\tpreviousSibling = previous;\n\n\t\t\t\t\twhile (previousSibling.lastChild) {\n\t\t\t\t\t\tpreviousSibling = previousSibling.lastChild;\n\n\t\t\t\t\t\t// eslint-disable-next-line max-depth\n\t\t\t\t\t\twhile (hasClass(previousSibling, 'sceditor-ignore')) {\n\t\t\t\t\t\t\tpreviousSibling = getSibling(previousSibling, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ttrimStart = previousSibling.nodeType === TEXT_NODE ?\n\t\t\t\t\t\t/[\\t\\n\\r ]$/.test(previousSibling.nodeValue) :\n\t\t\t\t\t\t!isInline(previousSibling);\n\t\t\t\t}\n\n\t\t\t\t// Clear zero width spaces\n\t\t\t\tnodeValue = nodeValue.replace(/\\u200B/g, '');\n\n\t\t\t\t// Strip leading whitespace\n\t\t\t\tif (!previous || !isInline(previous) || trimStart) {\n\t\t\t\t\tnodeValue = nodeValue.replace(\n\t\t\t\t\t\tpreserveNewLines ? /^[\\t ]+/ : /^[\\t\\n\\r ]+/,\n\t\t\t\t\t\t''\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Strip trailing whitespace\n\t\t\t\tif (!next || !isInline(next)) {\n\t\t\t\t\tnodeValue = nodeValue.replace(\n\t\t\t\t\t\tpreserveNewLines ? /[\\t ]+$/ : /[\\t\\n\\r ]+$/,\n\t\t\t\t\t\t''\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Remove empty text nodes\n\t\t\t\tif (!nodeValue.length) {\n\t\t\t\t\tremove(node);\n\t\t\t\t} else {\n\t\t\t\t\tnode.nodeValue = nodeValue.replace(\n\t\t\t\t\t\tpreserveNewLines ? /[\\t ]+/g : /[\\t\\n\\r ]+/g,\n\t\t\t\t\t\t' '\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnode = nextNode;\n\t\t}\n\t}\n\n\t/**\n\t * Extracts all the nodes between the start and end nodes\n\t *\n\t * @param {HTMLElement} startNode\tThe node to start extracting at\n\t * @param {HTMLElement} endNode\t\tThe node to stop extracting at\n\t * @return {DocumentFragment}\n\t */\n\tfunction extractContents(startNode, endNode) {\n\t\tconst range = startNode.ownerDocument.createRange();\n\n\t\trange.setStartBefore(startNode);\n\t\trange.setEndAfter(endNode);\n\n\t\treturn range.extractContents();\n\t}\n\n\t/**\n\t * Gets the offset position of an element\n\t *\n\t * @param  {HTMLElement} node\n\t * @return {Object} An object with left and top properties\n\t */\n\tfunction getOffset(node) {\n\t\tvar\tleft = 0,\n\t\t\ttop = 0;\n\n\t\twhile (node) {\n\t\t\tleft += node.offsetLeft;\n\t\t\ttop  += node.offsetTop;\n\t\t\tnode  = node.offsetParent;\n\t\t}\n\n\t\treturn {\n\t\t\tleft: left,\n\t\t\ttop: top\n\t\t};\n\t}\n\n\t/**\n\t * Gets the value of a CSS property from the elements style attribute\n\t *\n\t * @param  {HTMLElement} elm\n\t * @param  {string} property\n\t * @return {string}\n\t */\n\tfunction getStyle(elm, property) {\n\t\tvar\tstyleValue;\n\t\tconst elmStyle = elm.style;\n\n\t\tif (!cssPropertyNameCache[property]) {\n\t\t\tcssPropertyNameCache[property] = camelCase(property);\n\t\t}\n\n\t\tproperty   = cssPropertyNameCache[property];\n\t\tstyleValue = elmStyle[property];\n\n\t\t// Add an exception for text-align\n\t\tif ('textAlign' === property) {\n\t\t\tstyleValue = styleValue || css(elm, property);\n\n\t\t\tif (css(elm.parentNode, property) === styleValue ||\n\t\t\t\tcss(elm, 'display') !== 'block' || is(elm, 'hr,th')) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\n\t\treturn styleValue;\n\t}\n\n\t/**\n\t * Tests if an element has a style.\n\t *\n\t * If values are specified it will check that the styles value\n\t * matches one of the values\n\t *\n\t * @param  {HTMLElement} elm\n\t * @param  {string} property\n\t * @param  {string|array} [values]\n\t * @return {boolean}\n\t */\n\tfunction hasStyle(elm, property, values) {\n\t\tconst styleValue = getStyle(elm, property);\n\n\t\tif (!styleValue) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !values || styleValue === values ||\n\t\t\t(Array.isArray(values) && values.indexOf(styleValue) > -1);\n\t}\n\n\t/**\n\t * Returns true if both nodes have the same number of inline styles and all the\n\t * inline styles have matching values\n\t *\n\t * @param {HTMLElement} nodeA\n\t * @param {HTMLElement} nodeB\n\t * @returns {boolean}\n\t */\n\tfunction stylesMatch(nodeA, nodeB) {\n\t\tvar i = nodeA.style.length;\n\t\tif (i !== nodeB.style.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\twhile (i--) {\n\t\t\tconst prop = nodeA.style[i];\n\t\t\tif (nodeA.style[prop] !== nodeB.style[prop]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if both nodes have the same number of attributes and all the\n\t * attribute values match\n\t *\n\t * @param {HTMLElement} nodeA\n\t * @param {HTMLElement} nodeB\n\t * @returns {boolean}\n\t */\n\tfunction attributesMatch(nodeA, nodeB) {\n\t\tvar i = nodeA.attributes.length;\n\t\tif (i !== nodeB.attributes.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\twhile (i--) {\n\t\t\tconst prop = nodeA.attributes[i];\n\t\t\tconst notMatches = prop.name === 'style' ?\n\t\t\t\t!stylesMatch(nodeA, nodeB) :\n\t\t\t\tprop.value !== attr(nodeB, prop.name);\n\n\t\t\tif (notMatches) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Removes an element placing its children in its place\n\t *\n\t * @param {HTMLElement} node\n\t */\n\tfunction removeKeepChildren(node) {\n\t\twhile (node.firstChild) {\n\t\t\tinsertBefore(node.firstChild, node);\n\t\t}\n\n\t\tremove(node);\n\t}\n\n\t/**\n\t * Merges inline styles and tags with parents where possible\n\t *\n\t * @param {Node} node\n\t * @since 3.1.0\n\t */\n\tfunction merge(node) {\n\t\tif (node.nodeType !== ELEMENT_NODE) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar parent = node.parentNode;\n\t\tvar tagName = node.tagName;\n\t\tvar mergeTags = /B|STRONG|EM|SPAN|FONT/;\n\n\t\t// Merge children (in reverse as children can be removed)\n\t\tvar i = node.childNodes.length;\n\t\twhile (i--) {\n\t\t\tmerge(node.childNodes[i]);\n\t\t}\n\n\t\t// Should only merge inline tags and should not merge <br> tags\n\t\tif (!isInline(node) || tagName === 'BR') {\n\t\t\treturn;\n\t\t}\n\n\t\t// Remove any inline styles that match the parent style\n\t\ti = node.style.length;\n\t\twhile (i--) {\n\t\t\tvar prop = node.style[i];\n\t\t\tif (css(parent, prop) === css(node, prop)) {\n\t\t\t\tnode.style.removeProperty(prop);\n\t\t\t}\n\t\t}\n\n\t\t// Can only remove / merge tags if no inline styling left.\n\t\t// If there is any inline style left then it means it at least partially\n\t\t// doesn't match the parent style so must stay\n\t\tif (!node.style.length) {\n\t\t\tremoveAttr(node, 'style');\n\n\t\t\t// Remove font attributes if match parent\n\t\t\tif (tagName === 'FONT') {\n\t\t\t\tif (css(node, 'fontFamily').toLowerCase() ===\n\t\t\t\t\tcss(parent, 'fontFamily').toLowerCase()) {\n\t\t\t\t\tremoveAttr(node, 'face');\n\t\t\t\t}\n\n\t\t\t\tif (css(node, 'color') === css(parent, 'color')) {\n\t\t\t\t\tremoveAttr(node, 'color');\n\t\t\t\t}\n\n\t\t\t\tif (css(node, 'fontSize') === css(parent, 'fontSize')) {\n\t\t\t\t\tremoveAttr(node, 'size');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Spans and font tags with no attributes can be safely removed\n\t\t\tif (!node.attributes.length && /SPAN|FONT/.test(tagName)) {\n\t\t\t\tremoveKeepChildren(node);\n\t\t\t} else if (mergeTags.test(tagName)) {\n\t\t\t\tvar isBold = /B|STRONG/.test(tagName);\n\t\t\t\tvar isItalic = tagName === 'EM';\n\n\t\t\t\twhile (parent &&\n\t\t\t\t\tisInline(parent) &&\n\t\t\t\t\t(!isBold || /bold|700/i.test(css(parent, 'fontWeight'))) &&\n\t\t\t\t\t(!isItalic || css(parent, 'fontStyle') === 'italic')) {\n\n\t\t\t\t\t// Remove if parent match\n\t\t\t\t\tif ((parent.tagName === tagName ||\n\t\t\t\t\t\t\t(isBold && /B|STRONG/.test(parent.tagName))) &&\n\t\t\t\t\t\tattributesMatch(parent, node)) {\n\t\t\t\t\t\tremoveKeepChildren(node);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Merge siblings if attributes, including inline styles, match\n\t\tvar next = node.nextSibling;\n\t\tif (next && next.tagName === tagName && attributesMatch(next, node)) {\n\t\t\tappendChild(node, next);\n\t\t\tremoveKeepChildren(next);\n\t\t}\n\t}\n\n\t/**\n\t * Default options for SCEditor\n\t * @type {Object}\n\t */\n\tvar defaultOptions = {\n\t\t/** @lends sceditor.defaultOptions */\n\t\t/**\n\t\t * Toolbar buttons order and groups. Should be comma separated and\n\t\t * have a bar | to separate groups\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\ttoolbar: 'bold,italic,underline,strike|' +\n\t\t\t'font,size,color|mark|' +\n\t\t\t'email,link,unlink,quote,code|image|note|' +\n\t\t\t'bulletlist,orderedlist|left,center,right|' +\n\t\t\t'cut,copy,pastetext,removeformat|' +\n\t\t\t'undo,redo|' +\n\t\t\t'youtube,vimeo,instagram,facebook,media,extensions|source|reply',\n\n\t\t/**\n\t\t * Comma separated list of commands to excludes from the toolbar\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\ttoolbarExclude: null,\n\n\t\t/**\n\t\t * Maximum Number of allowed Characters\n\t\t *\n\t\t * @type {?number}\n\t\t*/\n\t\tmaxLength: null,\n\n\t\t/**\n\t\t * Stylesheet to include in the WYSIWYG editor. This is what will style\n\t\t * the WYSIWYG elements\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tstyles: [],\n\n\t\t/**\n\t\t * The bootstrap theme mode. This will be applied to the editor WYSIWYG mode (iframe)\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\tthemeMode: attr(document.documentElement, 'data-bs-theme') || 'light',\n\n\t\t/**\n\t\t * Comma separated list of fonts for the font selector\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\tfonts: 'Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,' +\n\t\t\t'Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana',\n\n\t\t/**\n\t\t * Default format\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\tformat: 'bbcode',\n\n\t\t/**\n\t\t * Default icon set\n\t     *\n\t     * @type {string}\n\t    */\n\t\ticons: 'fontawesome',\n\n\t\t/**\n\t\t * Comma separated list of code languages for the code block selector\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tcodeLanguages: [\n\t\t\t{ Value: 'markup', Text: 'Plain Text' },\n\t\t\t{ Value: 'bash', Text: 'Bash(shell)' },\n\t\t\t{ Value: 'c', Text: 'C' },\n\t\t\t{ Value: 'cpp', Text: 'C++' },\n\t\t\t{ Value: 'csharp', Text: 'C#' },\n\t\t\t{ Value: 'css', Text: 'CSS' },\n\t\t\t{ Value: 'scss', Text: 'SCSS' },\n\t\t\t{ Value: 'git', Text: 'Git' },\n\t\t\t{ Value: 'markup', Text: 'HTML' },\n\t\t\t{ Value: 'java', Text: 'Java' },\n\t\t\t{ Value: 'javascript', Text: 'JavaScript' },\n\t\t\t{ Value: 'json', Text: 'JSON' },\n\t\t\t{ Value: 'python', Text: 'Python' },\n\t\t\t{ Value: 'sql', Text: 'SQL' },\n\t\t\t{ Value: 'markup', Text: 'XML' },\n\t\t\t{ Value: 'vb', Text: 'Visual Basic' },\n\t\t\t{ Value: 'stacktrace', Text: 'StackTrace' }\n\t\t],\n\n\t\t/**\n\t     * Comma separated list of note types for the alerts\n\t     *\n\t     * @type {Array}\n\t     */\n\t\tnoteTypes: 'primary,secondary,success,danger,warning,info,light,dark',\n\n\t\t/**\n\t\t * Colors should be comma separated and have a bar | to signal a new\n\t\t * column.\n\t\t *\n\t\t * If null the colors will be auto generated.\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\tcolors: '#000000,#44B8FF,#1E92F7,#0074D9,#005DC2,#00369B,#b3d5f4|' +\n\t\t\t'#444444,#C3FFFF,#9DF9FF,#7FDBFF,#68C4E8,#419DC1,#d9f4ff|' +\n\t\t\t'#666666,#72FF84,#4CEA5E,#2ECC40,#17B529,#008E02,#c0f0c6|' +\n\t\t\t'#888888,#FFFF44,#FFFA1E,#FFDC00,#E8C500,#C19E00,#fff5b3|' +\n\t\t\t'#aaaaaa,#FFC95F,#FFA339,#FF851B,#E86E04,#C14700,#ffdbbb|' +\n\t\t\t'#cccccc,#FF857A,#FF5F54,#FF4136,#E82A1F,#C10300,#ffc6c3|' +\n\t\t\t'#eeeeee,#FF56FF,#FF30DC,#F012BE,#D900A7,#B20080,#fbb8ec|' +\n\t\t\t'#ffffff,#F551FF,#CF2BE7,#B10DC9,#9A00B2,#9A00B2,#e8b6ef',\n\n\t\t/**\n\t\t * The locale to use.\n\t\t * @type {string}\n\t\t */\n\t\tlocale: attr(document.documentElement, 'lang') || 'en',\n\n\t\t/**\n\t\t * The Charset to use\n\t\t * @type {string}\n\t\t */\n\t\tcharset: 'utf-8',\n\n\t\t/**\n\t\t * Width of the editor. Set to null for automatic with\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\twidth: '100%',\n\n\t\t/**\n\t\t * Height of the editor including toolbar. Set to null for automatic\n\t\t * height\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\theight: null,\n\n\t\t/**\n\t\t * If to allow the editor to be resized\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tresizeEnabled: true,\n\n\t\t/**\n\t\t * Min resize to width, set to null for half textarea width or -1 for\n\t\t * unlimited\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\tresizeMinWidth: null,\n\t\t/**\n\t\t * Min resize to height, set to null for half textarea height or -1 for\n\t\t * unlimited\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\tresizeMinHeight: null,\n\t\t/**\n\t\t * Max resize to height, set to null for double textarea height or -1\n\t\t * for unlimited\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\tresizeMaxHeight: null,\n\t\t/**\n\t\t * Max resize to width, set to null for double textarea width or -1 for\n\t\t * unlimited\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\tresizeMaxWidth: null,\n\t\t/**\n\t\t * If resizing by height is enabled\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tresizeHeight: true,\n\t\t/**\n\t\t * If resizing by width is enabled\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tresizeWidth: true,\n\n\t\t/**\n\t\t * Date format, will be overridden if locale specifies one.\n\t\t *\n\t\t * The words year, month and day will be replaced with the users current\n\t\t * year, month and day.\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\tdateFormat: 'year-month-day',\n\n\t\t/**\n\t\t * Element to inset the toolbar into.\n\t\t *\n\t\t * @type {HTMLElement}\n\t\t */\n\t\ttoolbarContainer: null,\n\n\t\t/**\n\t\t * If to enable paste filtering. This is currently experimental, please\n\t\t * report any issues.\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tenablePasteFiltering: true,\n\n\t\t/**\n\t\t * If to completely disable pasting into the editor\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tdisablePasting: false,\n\n\t\t/**\n\t\t * If the editor is read only.\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\treadOnly: false,\n\n\t\t/**\n\t\t * If to set the editor to right-to-left mode.\n\t\t *\n\t\t * If set to null the direction will be automatically detected.\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\trtl: false,\n\n\t\t/**\n\t\t * If to auto focus the editor on page load\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tautofocus: false,\n\n\t\t/**\n\t\t * If to auto focus the editor to the end of the content\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tautofocusEnd: true,\n\n\t\t/**\n\t\t * If to auto expand the editor to fix the content\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tautoExpand: false,\n\n\t\t/**\n\t\t * If to auto update original textbox on blur\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tautoUpdate: false,\n\n\t\t/**\n\t\t * If to enable the browsers built in spell checker\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tspellcheck: true,\n\n\t\t/**\n\t\t * If to run the source editor when there is no WYSIWYG support. Only\n\t\t * really applies to mobile OS's.\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\trunWithoutWysiwygSupport: false,\n\n\t\t/**\n\t\t * If to load the editor in source mode and still allow switching\n\t\t * between WYSIWYG and source mode\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tstartInSourceMode: false,\n\n\t\t/**\n\t\t * Optional ID to give the editor.\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\tid: null,\n\n\t\t/**\n\t\t * Comma separated list of plugins\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\tplugins: 'undo,dragdrop',\n\n\t\t/**\n\t\t * z-index to set the editor container to. Needed for jQuery UI dialog.\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\tzIndex: null,\n\n\t\t/**\n\t\t * If to trim the BBCode. Removes any spaces at the start and end of the\n\t\t * BBCode string.\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tbbcodeTrim: false,\n\n\t\t/**\n\t\t * If to disable removing block level elements by pressing backspace at\n\t\t * the start of them\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tdisableBlockRemove: true,\n\n\t\t/**\n\t\t * Array of allowed URL (should be either strings or regex) for iframes.\n\t\t *\n\t\t * If it's a string then iframes where the start of the src matches the\n\t\t * specified string will be allowed.\n\t\t *\n\t\t * If it's a regex then iframes where the src matches the regex will be\n\t\t * allowed.\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tallowedIframeUrls: [],\n\n\t\t/**\n\t\t * BBCode parser options, only applies if using the editor in BBCode\n\t\t * mode.\n\t\t *\n\t\t * See SCEditor.BBCodeParser.defaults for list of valid options\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tparserOptions: {},\n\n\t\t/**\n\t\t * CSS that will be added to the to dropdown menu (eg. z-index)\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tdropDownCss: {},\n\n\t\t/**\n\t\t * An array of tags that are allowed in the editor content.\n\t\t * If a tag is not listed here, it will be removed when the content is\n\t\t * sanitized.\n\t\t *\n\t\t * 1 Tag is already added by default: ['iframe']. No need to add this\n\t\t * further.\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tallowedTags: [],\n\n\t\t/**\n\t\t * An array of attributes that are allowed on tags in the editor content.\n\t\t * If an attribute is not listed here, it will be removed when the content\n\t\t * is sanitized.\n\t\t *\n\t\t * 3 Attributes are already added by default:\n\t\t * \t['allowfullscreen', 'frameborder', 'target'].\n\t\t * No need to add these further.\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tallowedAttributes: ['contenteditable'],\n\n\t\t/**\n\t\t * Url for the BBCode Extensions json\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\textensionsUrl: '',\n\n\t\t/**\n\t\t * Application root url\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\troot: '',\n\n\t\t/**\n\t\t * Attachments preview url\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\tattachmentsPreviewUrl: '',\n\n\t\t/**\n\t\t * Albums preview url\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\talbumsPreviewUrl: '',\n\n\t\t/**\n\t\t * mentions url\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\tmentionsUrl: '',\n\n\t\tonToggleMode: undefined,\n\n\t\t/**\n\t\t* Default path for the script files\n\t\t*\n\t\t* @type {string}\n\t\t*/\n\t\tbasePath: ''\n\t};\n\n\t// Regex used by DOMPurify to filter URLs. Might as well match here as otherwise\n\t// URLs will be filtered out by DOMPurify anyway\n\tvar VALID_URI_REGEX = /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i;\n\t// Safe image data URIs\n\tvar VALID_DATA_REGEX = /^data:image\\/(png|bmp|gif|p?jpe?g);/i;\n\tvar WHITESPACE_REGEX = /[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g;\n\n\t/**\n\t * Escapes a string so it's safe to use in regex\n\t *\n\t * @param {string} str\n\t * @return {string}\n\t */\n\tfunction regex(str) {\n\t\treturn str.replace(/([\\-.*+?^=!:${}()|\\[\\]\\/\\\\])/g, '\\\\$1');\n\t}\n\t/**\n\t * Escapes all HTML entities in a string\n\t *\n\t * If noQuotes is set to false, all single and double\n\t * quotes will also be escaped\n\t *\n\t * @param {string} str\n\t * @param {boolean} [noQuotes=true]\n\t * @return {string}\n\t * @since 1.4.1\n\t */\n\tfunction entities(str, noQuotes) {\n\t\tif (!str) {\n\t\t\treturn str;\n\t\t}\n\n\t\tvar replacements = {\n\t\t\t'&': '&amp;',\n\t\t\t'<': '&lt;',\n\t\t\t'>': '&gt;',\n\t\t\t'  ': '&nbsp; ',\n\t\t\t'\\r\\n': '<br />',\n\t\t\t'\\r': '<br />',\n\t\t\t'\\n': '<br />'\n\t\t};\n\n\t\tif (noQuotes !== false) {\n\t\t\treplacements['\"'] = '&#34;';\n\t\t\treplacements['\\''] = '&#39;';\n\t\t\treplacements['`'] = '&#96;';\n\t\t}\n\n\t\tstr = str.replace(/ {2}|\\r\\n|[&<>\\r\\n'\"`]/g,\n\t\t\tfunction (match) {\n\t\t\t\treturn replacements[match] || match;\n\t\t\t});\n\n\t\treturn str;\n\t}\n\t/**\n\t * Escape URI scheme.\n\t *\n\t * Appends the current URL to a url if it has a scheme that is not:\n\t *\n\t * http\n\t * https\n\t * ftps\n\t * ftp\n\t * mailto\n\t * spotify\n\t * ssh\n\t * teamspeak\n\t * tel\n\t * callto\n\t * sms\n\t * cid\n\t * xmpp\n\t * matrix\n\t * data:image/(png|jpeg|jpg|pjpeg|bmp|gif);\n\t *\n\t * **IMPORTANT**: This does not escape any HTML in a url, for\n\t * that use the escape.entities() method.\n\t *\n\t * @param  {string} url\n\t * @return {string}\n\t * @since 1.4.5\n\t */\n\tfunction uriScheme(url) {\n\t\tvar\tpath,\n\t\t\tlocation = window.location;\n\n\t\t// Match previous behaviour for empty or data: URIs\n\t\tif (!url || VALID_DATA_REGEX.test(url)) {\n\t\t\treturn url;\n\t\t}\n\n\t\t// Invalid scheme so make relative\n\t\tif (!VALID_URI_REGEX.test(url.replace(WHITESPACE_REGEX, ''))) {\n\t\t\tpath = location.pathname.split('/');\n\t\t\tpath.pop();\n\n\t\t\turl = location.protocol + '//' +\n\t\t\t\tlocation.host +\n\t\t\t\tpath.join('/') + '/' +\n\t\t\t\turl;\n\n\t\t\tif (!VALID_URI_REGEX.test(url.replace(WHITESPACE_REGEX, ''))) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\n\t\treturn url;\n\t}\n\n\t/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */\n\n\tconst {\n\t  entries,\n\t  setPrototypeOf,\n\t  isFrozen,\n\t  getPrototypeOf,\n\t  getOwnPropertyDescriptor\n\t} = Object;\n\tlet {\n\t  freeze,\n\t  seal,\n\t  create\n\t} = Object; // eslint-disable-line import/no-mutable-exports\n\tlet {\n\t  apply,\n\t  construct\n\t} = typeof Reflect !== 'undefined' && Reflect;\n\tif (!freeze) {\n\t  freeze = function freeze(x) {\n\t    return x;\n\t  };\n\t}\n\tif (!seal) {\n\t  seal = function seal(x) {\n\t    return x;\n\t  };\n\t}\n\tif (!apply) {\n\t  apply = function apply(func, thisArg) {\n\t    for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n\t      args[_key - 2] = arguments[_key];\n\t    }\n\t    return func.apply(thisArg, args);\n\t  };\n\t}\n\tif (!construct) {\n\t  construct = function construct(Func) {\n\t    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n\t      args[_key2 - 1] = arguments[_key2];\n\t    }\n\t    return new Func(...args);\n\t  };\n\t}\n\tconst arrayForEach = unapply(Array.prototype.forEach);\n\tconst arrayLastIndexOf = unapply(Array.prototype.lastIndexOf);\n\tconst arrayPop = unapply(Array.prototype.pop);\n\tconst arrayPush = unapply(Array.prototype.push);\n\tconst arraySplice = unapply(Array.prototype.splice);\n\tconst stringToLowerCase = unapply(String.prototype.toLowerCase);\n\tconst stringToString = unapply(String.prototype.toString);\n\tconst stringMatch = unapply(String.prototype.match);\n\tconst stringReplace = unapply(String.prototype.replace);\n\tconst stringIndexOf = unapply(String.prototype.indexOf);\n\tconst stringTrim = unapply(String.prototype.trim);\n\tconst objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);\n\tconst regExpTest = unapply(RegExp.prototype.test);\n\tconst typeErrorCreate = unconstruct(TypeError);\n\t/**\n\t * Creates a new function that calls the given function with a specified thisArg and arguments.\n\t *\n\t * @param func - The function to be wrapped and called.\n\t * @returns A new function that calls the given function with a specified thisArg and arguments.\n\t */\n\tfunction unapply(func) {\n\t  return function (thisArg) {\n\t    if (thisArg instanceof RegExp) {\n\t      thisArg.lastIndex = 0;\n\t    }\n\t    for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n\t      args[_key3 - 1] = arguments[_key3];\n\t    }\n\t    return apply(func, thisArg, args);\n\t  };\n\t}\n\t/**\n\t * Creates a new function that constructs an instance of the given constructor function with the provided arguments.\n\t *\n\t * @param func - The constructor function to be wrapped and called.\n\t * @returns A new function that constructs an instance of the given constructor function with the provided arguments.\n\t */\n\tfunction unconstruct(Func) {\n\t  return function () {\n\t    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n\t      args[_key4] = arguments[_key4];\n\t    }\n\t    return construct(Func, args);\n\t  };\n\t}\n\t/**\n\t * Add properties to a lookup table\n\t *\n\t * @param set - The set to which elements will be added.\n\t * @param array - The array containing elements to be added to the set.\n\t * @param transformCaseFunc - An optional function to transform the case of each element before adding to the set.\n\t * @returns The modified set with added elements.\n\t */\n\tfunction addToSet(set, array) {\n\t  let transformCaseFunc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : stringToLowerCase;\n\t  if (setPrototypeOf) {\n\t    // Make 'in' and truthy checks like Boolean(set.constructor)\n\t    // independent of any properties defined on Object.prototype.\n\t    // Prevent prototype setters from intercepting set as a this value.\n\t    setPrototypeOf(set, null);\n\t  }\n\t  let l = array.length;\n\t  while (l--) {\n\t    let element = array[l];\n\t    if (typeof element === 'string') {\n\t      const lcElement = transformCaseFunc(element);\n\t      if (lcElement !== element) {\n\t        // Config presets (e.g. tags.js, attrs.js) are immutable.\n\t        if (!isFrozen(array)) {\n\t          array[l] = lcElement;\n\t        }\n\t        element = lcElement;\n\t      }\n\t    }\n\t    set[element] = true;\n\t  }\n\t  return set;\n\t}\n\t/**\n\t * Clean up an array to harden against CSPP\n\t *\n\t * @param array - The array to be cleaned.\n\t * @returns The cleaned version of the array\n\t */\n\tfunction cleanArray(array) {\n\t  for (let index = 0; index < array.length; index++) {\n\t    const isPropertyExist = objectHasOwnProperty(array, index);\n\t    if (!isPropertyExist) {\n\t      array[index] = null;\n\t    }\n\t  }\n\t  return array;\n\t}\n\t/**\n\t * Shallow clone an object\n\t *\n\t * @param object - The object to be cloned.\n\t * @returns A new object that copies the original.\n\t */\n\tfunction clone(object) {\n\t  const newObject = create(null);\n\t  for (const [property, value] of entries(object)) {\n\t    const isPropertyExist = objectHasOwnProperty(object, property);\n\t    if (isPropertyExist) {\n\t      if (Array.isArray(value)) {\n\t        newObject[property] = cleanArray(value);\n\t      } else if (value && typeof value === 'object' && value.constructor === Object) {\n\t        newObject[property] = clone(value);\n\t      } else {\n\t        newObject[property] = value;\n\t      }\n\t    }\n\t  }\n\t  return newObject;\n\t}\n\t/**\n\t * This method automatically checks if the prop is function or getter and behaves accordingly.\n\t *\n\t * @param object - The object to look up the getter function in its prototype chain.\n\t * @param prop - The property name for which to find the getter function.\n\t * @returns The getter function found in the prototype chain or a fallback function.\n\t */\n\tfunction lookupGetter(object, prop) {\n\t  while (object !== null) {\n\t    const desc = getOwnPropertyDescriptor(object, prop);\n\t    if (desc) {\n\t      if (desc.get) {\n\t        return unapply(desc.get);\n\t      }\n\t      if (typeof desc.value === 'function') {\n\t        return unapply(desc.value);\n\t      }\n\t    }\n\t    object = getPrototypeOf(object);\n\t  }\n\t  function fallbackValue() {\n\t    return null;\n\t  }\n\t  return fallbackValue;\n\t}\n\n\tconst html$1 = freeze(['a', 'abbr', 'acronym', 'address', 'area', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'big', 'blink', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption', 'center', 'cite', 'code', 'col', 'colgroup', 'content', 'data', 'datalist', 'dd', 'decorator', 'del', 'details', 'dfn', 'dialog', 'dir', 'div', 'dl', 'dt', 'element', 'em', 'fieldset', 'figcaption', 'figure', 'font', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'img', 'input', 'ins', 'kbd', 'label', 'legend', 'li', 'main', 'map', 'mark', 'marquee', 'menu', 'menuitem', 'meter', 'nav', 'nobr', 'ol', 'optgroup', 'option', 'output', 'p', 'picture', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's', 'samp', 'search', 'section', 'select', 'shadow', 'slot', 'small', 'source', 'spacer', 'span', 'strike', 'strong', 'style', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'template', 'textarea', 'tfoot', 'th', 'thead', 'time', 'tr', 'track', 'tt', 'u', 'ul', 'var', 'video', 'wbr']);\n\tconst svg$1 = freeze(['svg', 'a', 'altglyph', 'altglyphdef', 'altglyphitem', 'animatecolor', 'animatemotion', 'animatetransform', 'circle', 'clippath', 'defs', 'desc', 'ellipse', 'enterkeyhint', 'exportparts', 'filter', 'font', 'g', 'glyph', 'glyphref', 'hkern', 'image', 'inputmode', 'line', 'lineargradient', 'marker', 'mask', 'metadata', 'mpath', 'part', 'path', 'pattern', 'polygon', 'polyline', 'radialgradient', 'rect', 'stop', 'style', 'switch', 'symbol', 'text', 'textpath', 'title', 'tref', 'tspan', 'view', 'vkern']);\n\tconst svgFilters = freeze(['feBlend', 'feColorMatrix', 'feComponentTransfer', 'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feDropShadow', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence']);\n\t// List of SVG elements that are disallowed by default.\n\t// We still need to know them so that we can do namespace\n\t// checks properly in case one wants to add them to\n\t// allow-list.\n\tconst svgDisallowed = freeze(['animate', 'color-profile', 'cursor', 'discard', 'font-face', 'font-face-format', 'font-face-name', 'font-face-src', 'font-face-uri', 'foreignobject', 'hatch', 'hatchpath', 'mesh', 'meshgradient', 'meshpatch', 'meshrow', 'missing-glyph', 'script', 'set', 'solidcolor', 'unknown', 'use']);\n\tconst mathMl$1 = freeze(['math', 'menclose', 'merror', 'mfenced', 'mfrac', 'mglyph', 'mi', 'mlabeledtr', 'mmultiscripts', 'mn', 'mo', 'mover', 'mpadded', 'mphantom', 'mroot', 'mrow', 'ms', 'mspace', 'msqrt', 'mstyle', 'msub', 'msup', 'msubsup', 'mtable', 'mtd', 'mtext', 'mtr', 'munder', 'munderover', 'mprescripts']);\n\t// Similarly to SVG, we want to know all MathML elements,\n\t// even those that we disallow by default.\n\tconst mathMlDisallowed = freeze(['maction', 'maligngroup', 'malignmark', 'mlongdiv', 'mscarries', 'mscarry', 'msgroup', 'mstack', 'msline', 'msrow', 'semantics', 'annotation', 'annotation-xml', 'mprescripts', 'none']);\n\tconst text = freeze(['#text']);\n\n\tconst html = freeze(['accept', 'action', 'align', 'alt', 'autocapitalize', 'autocomplete', 'autopictureinpicture', 'autoplay', 'background', 'bgcolor', 'border', 'capture', 'cellpadding', 'cellspacing', 'checked', 'cite', 'class', 'clear', 'color', 'cols', 'colspan', 'controls', 'controlslist', 'coords', 'crossorigin', 'datetime', 'decoding', 'default', 'dir', 'disabled', 'disablepictureinpicture', 'disableremoteplayback', 'download', 'draggable', 'enctype', 'enterkeyhint', 'exportparts', 'face', 'for', 'headers', 'height', 'hidden', 'high', 'href', 'hreflang', 'id', 'inert', 'inputmode', 'integrity', 'ismap', 'kind', 'label', 'lang', 'list', 'loading', 'loop', 'low', 'max', 'maxlength', 'media', 'method', 'min', 'minlength', 'multiple', 'muted', 'name', 'nonce', 'noshade', 'novalidate', 'nowrap', 'open', 'optimum', 'part', 'pattern', 'placeholder', 'playsinline', 'popover', 'popovertarget', 'popovertargetaction', 'poster', 'preload', 'pubdate', 'radiogroup', 'readonly', 'rel', 'required', 'rev', 'reversed', 'role', 'rows', 'rowspan', 'spellcheck', 'scope', 'selected', 'shape', 'size', 'sizes', 'slot', 'span', 'srclang', 'start', 'src', 'srcset', 'step', 'style', 'summary', 'tabindex', 'title', 'translate', 'type', 'usemap', 'valign', 'value', 'width', 'wrap', 'xmlns', 'slot']);\n\tconst svg = freeze(['accent-height', 'accumulate', 'additive', 'alignment-baseline', 'amplitude', 'ascent', 'attributename', 'attributetype', 'azimuth', 'basefrequency', 'baseline-shift', 'begin', 'bias', 'by', 'class', 'clip', 'clippathunits', 'clip-path', 'clip-rule', 'color', 'color-interpolation', 'color-interpolation-filters', 'color-profile', 'color-rendering', 'cx', 'cy', 'd', 'dx', 'dy', 'diffuseconstant', 'direction', 'display', 'divisor', 'dur', 'edgemode', 'elevation', 'end', 'exponent', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'filterunits', 'flood-color', 'flood-opacity', 'font-family', 'font-size', 'font-size-adjust', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'fx', 'fy', 'g1', 'g2', 'glyph-name', 'glyphref', 'gradientunits', 'gradienttransform', 'height', 'href', 'id', 'image-rendering', 'in', 'in2', 'intercept', 'k', 'k1', 'k2', 'k3', 'k4', 'kerning', 'keypoints', 'keysplines', 'keytimes', 'lang', 'lengthadjust', 'letter-spacing', 'kernelmatrix', 'kernelunitlength', 'lighting-color', 'local', 'marker-end', 'marker-mid', 'marker-start', 'markerheight', 'markerunits', 'markerwidth', 'maskcontentunits', 'maskunits', 'max', 'mask', 'mask-type', 'media', 'method', 'mode', 'min', 'name', 'numoctaves', 'offset', 'operator', 'opacity', 'order', 'orient', 'orientation', 'origin', 'overflow', 'paint-order', 'path', 'pathlength', 'patterncontentunits', 'patterntransform', 'patternunits', 'points', 'preservealpha', 'preserveaspectratio', 'primitiveunits', 'r', 'rx', 'ry', 'radius', 'refx', 'refy', 'repeatcount', 'repeatdur', 'restart', 'result', 'rotate', 'scale', 'seed', 'shape-rendering', 'slope', 'specularconstant', 'specularexponent', 'spreadmethod', 'startoffset', 'stddeviation', 'stitchtiles', 'stop-color', 'stop-opacity', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke', 'stroke-width', 'style', 'surfacescale', 'systemlanguage', 'tabindex', 'tablevalues', 'targetx', 'targety', 'transform', 'transform-origin', 'text-anchor', 'text-decoration', 'text-rendering', 'textlength', 'type', 'u1', 'u2', 'unicode', 'values', 'viewbox', 'visibility', 'version', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'width', 'word-spacing', 'wrap', 'writing-mode', 'xchannelselector', 'ychannelselector', 'x', 'x1', 'x2', 'xmlns', 'y', 'y1', 'y2', 'z', 'zoomandpan']);\n\tconst mathMl = freeze(['accent', 'accentunder', 'align', 'bevelled', 'close', 'columnsalign', 'columnlines', 'columnspan', 'denomalign', 'depth', 'dir', 'display', 'displaystyle', 'encoding', 'fence', 'frame', 'height', 'href', 'id', 'largeop', 'length', 'linethickness', 'lspace', 'lquote', 'mathbackground', 'mathcolor', 'mathsize', 'mathvariant', 'maxsize', 'minsize', 'movablelimits', 'notation', 'numalign', 'open', 'rowalign', 'rowlines', 'rowspacing', 'rowspan', 'rspace', 'rquote', 'scriptlevel', 'scriptminsize', 'scriptsizemultiplier', 'selection', 'separator', 'separators', 'stretchy', 'subscriptshift', 'supscriptshift', 'symmetric', 'voffset', 'width', 'xmlns']);\n\tconst xml = freeze(['xlink:href', 'xml:id', 'xlink:title', 'xml:space', 'xmlns:xlink']);\n\n\t// eslint-disable-next-line unicorn/better-regex\n\tconst MUSTACHE_EXPR = seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode\n\tconst ERB_EXPR = seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);\n\tconst TMPLIT_EXPR = seal(/\\$\\{[\\w\\W]*/gm); // eslint-disable-line unicorn/better-regex\n\tconst DATA_ATTR = seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]+$/); // eslint-disable-line no-useless-escape\n\tconst ARIA_ATTR = seal(/^aria-[\\-\\w]+$/); // eslint-disable-line no-useless-escape\n\tconst IS_ALLOWED_URI = seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i // eslint-disable-line no-useless-escape\n\t);\n\tconst IS_SCRIPT_OR_DATA = seal(/^(?:\\w+script|data):/i);\n\tconst ATTR_WHITESPACE = seal(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g // eslint-disable-line no-control-regex\n\t);\n\tconst DOCTYPE_NAME = seal(/^html$/i);\n\tconst CUSTOM_ELEMENT = seal(/^[a-z][.\\w]*(-[.\\w]+)+$/i);\n\n\tvar EXPRESSIONS = /*#__PURE__*/Object.freeze({\n\t  __proto__: null,\n\t  ARIA_ATTR: ARIA_ATTR,\n\t  ATTR_WHITESPACE: ATTR_WHITESPACE,\n\t  CUSTOM_ELEMENT: CUSTOM_ELEMENT,\n\t  DATA_ATTR: DATA_ATTR,\n\t  DOCTYPE_NAME: DOCTYPE_NAME,\n\t  ERB_EXPR: ERB_EXPR,\n\t  IS_ALLOWED_URI: IS_ALLOWED_URI,\n\t  IS_SCRIPT_OR_DATA: IS_SCRIPT_OR_DATA,\n\t  MUSTACHE_EXPR: MUSTACHE_EXPR,\n\t  TMPLIT_EXPR: TMPLIT_EXPR\n\t});\n\n\t/* eslint-disable @typescript-eslint/indent */\n\t// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\n\tconst NODE_TYPE = {\n\t  element: 1,\n\t  attribute: 2,\n\t  text: 3,\n\t  cdataSection: 4,\n\t  entityReference: 5,\n\t  // Deprecated\n\t  entityNode: 6,\n\t  // Deprecated\n\t  progressingInstruction: 7,\n\t  comment: 8,\n\t  document: 9,\n\t  documentType: 10,\n\t  documentFragment: 11,\n\t  notation: 12 // Deprecated\n\t};\n\tconst getGlobal = function getGlobal() {\n\t  return typeof window === 'undefined' ? null : window;\n\t};\n\t/**\n\t * Creates a no-op policy for internal use only.\n\t * Don't export this function outside this module!\n\t * @param trustedTypes The policy factory.\n\t * @param purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).\n\t * @return The policy created (or null, if Trusted Types\n\t * are not supported or creating the policy failed).\n\t */\n\tconst _createTrustedTypesPolicy = function _createTrustedTypesPolicy(trustedTypes, purifyHostElement) {\n\t  if (typeof trustedTypes !== 'object' || typeof trustedTypes.createPolicy !== 'function') {\n\t    return null;\n\t  }\n\t  // Allow the callers to control the unique policy name\n\t  // by adding a data-tt-policy-suffix to the script element with the DOMPurify.\n\t  // Policy creation with duplicate names throws in Trusted Types.\n\t  let suffix = null;\n\t  const ATTR_NAME = 'data-tt-policy-suffix';\n\t  if (purifyHostElement && purifyHostElement.hasAttribute(ATTR_NAME)) {\n\t    suffix = purifyHostElement.getAttribute(ATTR_NAME);\n\t  }\n\t  const policyName = 'dompurify' + (suffix ? '#' + suffix : '');\n\t  try {\n\t    return trustedTypes.createPolicy(policyName, {\n\t      createHTML(html) {\n\t        return html;\n\t      },\n\t      createScriptURL(scriptUrl) {\n\t        return scriptUrl;\n\t      }\n\t    });\n\t  } catch (_) {\n\t    // Policy creation failed (most likely another DOMPurify script has\n\t    // already run). Skip creating the policy, as this will only cause errors\n\t    // if TT are enforced.\n\t    console.warn('TrustedTypes policy ' + policyName + ' could not be created.');\n\t    return null;\n\t  }\n\t};\n\tconst _createHooksMap = function _createHooksMap() {\n\t  return {\n\t    afterSanitizeAttributes: [],\n\t    afterSanitizeElements: [],\n\t    afterSanitizeShadowDOM: [],\n\t    beforeSanitizeAttributes: [],\n\t    beforeSanitizeElements: [],\n\t    beforeSanitizeShadowDOM: [],\n\t    uponSanitizeAttribute: [],\n\t    uponSanitizeElement: [],\n\t    uponSanitizeShadowNode: []\n\t  };\n\t};\n\tfunction createDOMPurify() {\n\t  let window = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getGlobal();\n\t  const DOMPurify = root => createDOMPurify(root);\n\t  DOMPurify.version = '3.3.1';\n\t  DOMPurify.removed = [];\n\t  if (!window || !window.document || window.document.nodeType !== NODE_TYPE.document || !window.Element) {\n\t    // Not running in a browser, provide a factory function\n\t    // so that you can pass your own Window\n\t    DOMPurify.isSupported = false;\n\t    return DOMPurify;\n\t  }\n\t  let {\n\t    document\n\t  } = window;\n\t  const originalDocument = document;\n\t  const currentScript = originalDocument.currentScript;\n\t  const {\n\t    DocumentFragment,\n\t    HTMLTemplateElement,\n\t    Node,\n\t    Element,\n\t    NodeFilter,\n\t    NamedNodeMap = window.NamedNodeMap || window.MozNamedAttrMap,\n\t    HTMLFormElement,\n\t    DOMParser,\n\t    trustedTypes\n\t  } = window;\n\t  const ElementPrototype = Element.prototype;\n\t  const cloneNode = lookupGetter(ElementPrototype, 'cloneNode');\n\t  const remove = lookupGetter(ElementPrototype, 'remove');\n\t  const getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');\n\t  const getChildNodes = lookupGetter(ElementPrototype, 'childNodes');\n\t  const getParentNode = lookupGetter(ElementPrototype, 'parentNode');\n\t  // As per issue #47, the web-components registry is inherited by a\n\t  // new document created via createHTMLDocument. As per the spec\n\t  // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)\n\t  // a new empty registry is used when creating a template contents owner\n\t  // document, so we use that as our parent document to ensure nothing\n\t  // is inherited.\n\t  if (typeof HTMLTemplateElement === 'function') {\n\t    const template = document.createElement('template');\n\t    if (template.content && template.content.ownerDocument) {\n\t      document = template.content.ownerDocument;\n\t    }\n\t  }\n\t  let trustedTypesPolicy;\n\t  let emptyHTML = '';\n\t  const {\n\t    implementation,\n\t    createNodeIterator,\n\t    createDocumentFragment,\n\t    getElementsByTagName\n\t  } = document;\n\t  const {\n\t    importNode\n\t  } = originalDocument;\n\t  let hooks = _createHooksMap();\n\t  /**\n\t   * Expose whether this browser supports running the full DOMPurify.\n\t   */\n\t  DOMPurify.isSupported = typeof entries === 'function' && typeof getParentNode === 'function' && implementation && implementation.createHTMLDocument !== undefined;\n\t  const {\n\t    MUSTACHE_EXPR,\n\t    ERB_EXPR,\n\t    TMPLIT_EXPR,\n\t    DATA_ATTR,\n\t    ARIA_ATTR,\n\t    IS_SCRIPT_OR_DATA,\n\t    ATTR_WHITESPACE,\n\t    CUSTOM_ELEMENT\n\t  } = EXPRESSIONS;\n\t  let {\n\t    IS_ALLOWED_URI: IS_ALLOWED_URI$1\n\t  } = EXPRESSIONS;\n\t  /**\n\t   * We consider the elements and attributes below to be safe. Ideally\n\t   * don't add any new ones but feel free to remove unwanted ones.\n\t   */\n\t  /* allowed element names */\n\t  let ALLOWED_TAGS = null;\n\t  const DEFAULT_ALLOWED_TAGS = addToSet({}, [...html$1, ...svg$1, ...svgFilters, ...mathMl$1, ...text]);\n\t  /* Allowed attribute names */\n\t  let ALLOWED_ATTR = null;\n\t  const DEFAULT_ALLOWED_ATTR = addToSet({}, [...html, ...svg, ...mathMl, ...xml]);\n\t  /*\n\t   * Configure how DOMPurify should handle custom elements and their attributes as well as customized built-in elements.\n\t   * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)\n\t   * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)\n\t   * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.\n\t   */\n\t  let CUSTOM_ELEMENT_HANDLING = Object.seal(create(null, {\n\t    tagNameCheck: {\n\t      writable: true,\n\t      configurable: false,\n\t      enumerable: true,\n\t      value: null\n\t    },\n\t    attributeNameCheck: {\n\t      writable: true,\n\t      configurable: false,\n\t      enumerable: true,\n\t      value: null\n\t    },\n\t    allowCustomizedBuiltInElements: {\n\t      writable: true,\n\t      configurable: false,\n\t      enumerable: true,\n\t      value: false\n\t    }\n\t  }));\n\t  /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */\n\t  let FORBID_TAGS = null;\n\t  /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */\n\t  let FORBID_ATTR = null;\n\t  /* Config object to store ADD_TAGS/ADD_ATTR functions (when used as functions) */\n\t  const EXTRA_ELEMENT_HANDLING = Object.seal(create(null, {\n\t    tagCheck: {\n\t      writable: true,\n\t      configurable: false,\n\t      enumerable: true,\n\t      value: null\n\t    },\n\t    attributeCheck: {\n\t      writable: true,\n\t      configurable: false,\n\t      enumerable: true,\n\t      value: null\n\t    }\n\t  }));\n\t  /* Decide if ARIA attributes are okay */\n\t  let ALLOW_ARIA_ATTR = true;\n\t  /* Decide if custom data attributes are okay */\n\t  let ALLOW_DATA_ATTR = true;\n\t  /* Decide if unknown protocols are okay */\n\t  let ALLOW_UNKNOWN_PROTOCOLS = false;\n\t  /* Decide if self-closing tags in attributes are allowed.\n\t   * Usually removed due to a mXSS issue in jQuery 3.0 */\n\t  let ALLOW_SELF_CLOSE_IN_ATTR = true;\n\t  /* Output should be safe for common template engines.\n\t   * This means, DOMPurify removes data attributes, mustaches and ERB\n\t   */\n\t  let SAFE_FOR_TEMPLATES = false;\n\t  /* Output should be safe even for XML used within HTML and alike.\n\t   * This means, DOMPurify removes comments when containing risky content.\n\t   */\n\t  let SAFE_FOR_XML = true;\n\t  /* Decide if document with <html>... should be returned */\n\t  let WHOLE_DOCUMENT = false;\n\t  /* Track whether config is already set on this instance of DOMPurify. */\n\t  let SET_CONFIG = false;\n\t  /* Decide if all elements (e.g. style, script) must be children of\n\t   * document.body. By default, browsers might move them to document.head */\n\t  let FORCE_BODY = false;\n\t  /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html\n\t   * string (or a TrustedHTML object if Trusted Types are supported).\n\t   * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead\n\t   */\n\t  let RETURN_DOM = false;\n\t  /* Decide if a DOM `DocumentFragment` should be returned, instead of a html\n\t   * string  (or a TrustedHTML object if Trusted Types are supported) */\n\t  let RETURN_DOM_FRAGMENT = false;\n\t  /* Try to return a Trusted Type object instead of a string, return a string in\n\t   * case Trusted Types are not supported  */\n\t  let RETURN_TRUSTED_TYPE = false;\n\t  /* Output should be free from DOM clobbering attacks?\n\t   * This sanitizes markups named with colliding, clobberable built-in DOM APIs.\n\t   */\n\t  let SANITIZE_DOM = true;\n\t  /* Achieve full DOM Clobbering protection by isolating the namespace of named\n\t   * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.\n\t   *\n\t   * HTML/DOM spec rules that enable DOM Clobbering:\n\t   *   - Named Access on Window (7.3.3)\n\t   *   - DOM Tree Accessors (3.1.5)\n\t   *   - Form Element Parent-Child Relations (4.10.3)\n\t   *   - Iframe srcdoc / Nested WindowProxies (4.8.5)\n\t   *   - HTMLCollection (4.2.10.2)\n\t   *\n\t   * Namespace isolation is implemented by prefixing `id` and `name` attributes\n\t   * with a constant string, i.e., `user-content-`\n\t   */\n\t  let SANITIZE_NAMED_PROPS = false;\n\t  const SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';\n\t  /* Keep element content when removing element? */\n\t  let KEEP_CONTENT = true;\n\t  /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead\n\t   * of importing it into a new Document and returning a sanitized copy */\n\t  let IN_PLACE = false;\n\t  /* Allow usage of profiles like html, svg and mathMl */\n\t  let USE_PROFILES = {};\n\t  /* Tags to ignore content of when KEEP_CONTENT is true */\n\t  let FORBID_CONTENTS = null;\n\t  const DEFAULT_FORBID_CONTENTS = addToSet({}, ['annotation-xml', 'audio', 'colgroup', 'desc', 'foreignobject', 'head', 'iframe', 'math', 'mi', 'mn', 'mo', 'ms', 'mtext', 'noembed', 'noframes', 'noscript', 'plaintext', 'script', 'style', 'svg', 'template', 'thead', 'title', 'video', 'xmp']);\n\t  /* Tags that are safe for data: URIs */\n\t  let DATA_URI_TAGS = null;\n\t  const DEFAULT_DATA_URI_TAGS = addToSet({}, ['audio', 'video', 'img', 'source', 'image', 'track']);\n\t  /* Attributes safe for values like \"javascript:\" */\n\t  let URI_SAFE_ATTRIBUTES = null;\n\t  const DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, ['alt', 'class', 'for', 'id', 'label', 'name', 'pattern', 'placeholder', 'role', 'summary', 'title', 'value', 'style', 'xmlns']);\n\t  const MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';\n\t  const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n\t  const HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n\t  /* Document namespace */\n\t  let NAMESPACE = HTML_NAMESPACE;\n\t  let IS_EMPTY_INPUT = false;\n\t  /* Allowed XHTML+XML namespaces */\n\t  let ALLOWED_NAMESPACES = null;\n\t  const DEFAULT_ALLOWED_NAMESPACES = addToSet({}, [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE], stringToString);\n\t  let MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, ['mi', 'mo', 'mn', 'ms', 'mtext']);\n\t  let HTML_INTEGRATION_POINTS = addToSet({}, ['annotation-xml']);\n\t  // Certain elements are allowed in both SVG and HTML\n\t  // namespace. We need to specify them explicitly\n\t  // so that they don't get erroneously deleted from\n\t  // HTML namespace.\n\t  const COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, ['title', 'style', 'font', 'a', 'script']);\n\t  /* Parsing of strict XHTML documents */\n\t  let PARSER_MEDIA_TYPE = null;\n\t  const SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];\n\t  const DEFAULT_PARSER_MEDIA_TYPE = 'text/html';\n\t  let transformCaseFunc = null;\n\t  /* Keep a reference to config to pass to hooks */\n\t  let CONFIG = null;\n\t  /* Ideally, do not touch anything below this line */\n\t  /* ______________________________________________ */\n\t  const formElement = document.createElement('form');\n\t  const isRegexOrFunction = function isRegexOrFunction(testValue) {\n\t    return testValue instanceof RegExp || testValue instanceof Function;\n\t  };\n\t  /**\n\t   * _parseConfig\n\t   *\n\t   * @param cfg optional config literal\n\t   */\n\t  // eslint-disable-next-line complexity\n\t  const _parseConfig = function _parseConfig() {\n\t    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\t    if (CONFIG && CONFIG === cfg) {\n\t      return;\n\t    }\n\t    /* Shield configuration object from tampering */\n\t    if (!cfg || typeof cfg !== 'object') {\n\t      cfg = {};\n\t    }\n\t    /* Shield configuration object from prototype pollution */\n\t    cfg = clone(cfg);\n\t    PARSER_MEDIA_TYPE =\n\t    // eslint-disable-next-line unicorn/prefer-includes\n\t    SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1 ? DEFAULT_PARSER_MEDIA_TYPE : cfg.PARSER_MEDIA_TYPE;\n\t    // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.\n\t    transformCaseFunc = PARSER_MEDIA_TYPE === 'application/xhtml+xml' ? stringToString : stringToLowerCase;\n\t    /* Set configuration parameters */\n\t    ALLOWED_TAGS = objectHasOwnProperty(cfg, 'ALLOWED_TAGS') ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc) : DEFAULT_ALLOWED_TAGS;\n\t    ALLOWED_ATTR = objectHasOwnProperty(cfg, 'ALLOWED_ATTR') ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc) : DEFAULT_ALLOWED_ATTR;\n\t    ALLOWED_NAMESPACES = objectHasOwnProperty(cfg, 'ALLOWED_NAMESPACES') ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString) : DEFAULT_ALLOWED_NAMESPACES;\n\t    URI_SAFE_ATTRIBUTES = objectHasOwnProperty(cfg, 'ADD_URI_SAFE_ATTR') ? addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES), cfg.ADD_URI_SAFE_ATTR, transformCaseFunc) : DEFAULT_URI_SAFE_ATTRIBUTES;\n\t    DATA_URI_TAGS = objectHasOwnProperty(cfg, 'ADD_DATA_URI_TAGS') ? addToSet(clone(DEFAULT_DATA_URI_TAGS), cfg.ADD_DATA_URI_TAGS, transformCaseFunc) : DEFAULT_DATA_URI_TAGS;\n\t    FORBID_CONTENTS = objectHasOwnProperty(cfg, 'FORBID_CONTENTS') ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc) : DEFAULT_FORBID_CONTENTS;\n\t    FORBID_TAGS = objectHasOwnProperty(cfg, 'FORBID_TAGS') ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc) : clone({});\n\t    FORBID_ATTR = objectHasOwnProperty(cfg, 'FORBID_ATTR') ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc) : clone({});\n\t    USE_PROFILES = objectHasOwnProperty(cfg, 'USE_PROFILES') ? cfg.USE_PROFILES : false;\n\t    ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true\n\t    ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true\n\t    ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false\n\t    ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true\n\t    SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false\n\t    SAFE_FOR_XML = cfg.SAFE_FOR_XML !== false; // Default true\n\t    WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false\n\t    RETURN_DOM = cfg.RETURN_DOM || false; // Default false\n\t    RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false\n\t    RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false\n\t    FORCE_BODY = cfg.FORCE_BODY || false; // Default false\n\t    SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true\n\t    SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false\n\t    KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true\n\t    IN_PLACE = cfg.IN_PLACE || false; // Default false\n\t    IS_ALLOWED_URI$1 = cfg.ALLOWED_URI_REGEXP || IS_ALLOWED_URI;\n\t    NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;\n\t    MATHML_TEXT_INTEGRATION_POINTS = cfg.MATHML_TEXT_INTEGRATION_POINTS || MATHML_TEXT_INTEGRATION_POINTS;\n\t    HTML_INTEGRATION_POINTS = cfg.HTML_INTEGRATION_POINTS || HTML_INTEGRATION_POINTS;\n\t    CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};\n\t    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)) {\n\t      CUSTOM_ELEMENT_HANDLING.tagNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;\n\t    }\n\t    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)) {\n\t      CUSTOM_ELEMENT_HANDLING.attributeNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;\n\t    }\n\t    if (cfg.CUSTOM_ELEMENT_HANDLING && typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements === 'boolean') {\n\t      CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements = cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;\n\t    }\n\t    if (SAFE_FOR_TEMPLATES) {\n\t      ALLOW_DATA_ATTR = false;\n\t    }\n\t    if (RETURN_DOM_FRAGMENT) {\n\t      RETURN_DOM = true;\n\t    }\n\t    /* Parse profile info */\n\t    if (USE_PROFILES) {\n\t      ALLOWED_TAGS = addToSet({}, text);\n\t      ALLOWED_ATTR = [];\n\t      if (USE_PROFILES.html === true) {\n\t        addToSet(ALLOWED_TAGS, html$1);\n\t        addToSet(ALLOWED_ATTR, html);\n\t      }\n\t      if (USE_PROFILES.svg === true) {\n\t        addToSet(ALLOWED_TAGS, svg$1);\n\t        addToSet(ALLOWED_ATTR, svg);\n\t        addToSet(ALLOWED_ATTR, xml);\n\t      }\n\t      if (USE_PROFILES.svgFilters === true) {\n\t        addToSet(ALLOWED_TAGS, svgFilters);\n\t        addToSet(ALLOWED_ATTR, svg);\n\t        addToSet(ALLOWED_ATTR, xml);\n\t      }\n\t      if (USE_PROFILES.mathMl === true) {\n\t        addToSet(ALLOWED_TAGS, mathMl$1);\n\t        addToSet(ALLOWED_ATTR, mathMl);\n\t        addToSet(ALLOWED_ATTR, xml);\n\t      }\n\t    }\n\t    /* Merge configuration parameters */\n\t    if (cfg.ADD_TAGS) {\n\t      if (typeof cfg.ADD_TAGS === 'function') {\n\t        EXTRA_ELEMENT_HANDLING.tagCheck = cfg.ADD_TAGS;\n\t      } else {\n\t        if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {\n\t          ALLOWED_TAGS = clone(ALLOWED_TAGS);\n\t        }\n\t        addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);\n\t      }\n\t    }\n\t    if (cfg.ADD_ATTR) {\n\t      if (typeof cfg.ADD_ATTR === 'function') {\n\t        EXTRA_ELEMENT_HANDLING.attributeCheck = cfg.ADD_ATTR;\n\t      } else {\n\t        if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {\n\t          ALLOWED_ATTR = clone(ALLOWED_ATTR);\n\t        }\n\t        addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);\n\t      }\n\t    }\n\t    if (cfg.ADD_URI_SAFE_ATTR) {\n\t      addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);\n\t    }\n\t    if (cfg.FORBID_CONTENTS) {\n\t      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n\t        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n\t      }\n\t      addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);\n\t    }\n\t    if (cfg.ADD_FORBID_CONTENTS) {\n\t      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n\t        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n\t      }\n\t      addToSet(FORBID_CONTENTS, cfg.ADD_FORBID_CONTENTS, transformCaseFunc);\n\t    }\n\t    /* Add #text in case KEEP_CONTENT is set to true */\n\t    if (KEEP_CONTENT) {\n\t      ALLOWED_TAGS['#text'] = true;\n\t    }\n\t    /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */\n\t    if (WHOLE_DOCUMENT) {\n\t      addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);\n\t    }\n\t    /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */\n\t    if (ALLOWED_TAGS.table) {\n\t      addToSet(ALLOWED_TAGS, ['tbody']);\n\t      delete FORBID_TAGS.tbody;\n\t    }\n\t    if (cfg.TRUSTED_TYPES_POLICY) {\n\t      if (typeof cfg.TRUSTED_TYPES_POLICY.createHTML !== 'function') {\n\t        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createHTML\" hook.');\n\t      }\n\t      if (typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL !== 'function') {\n\t        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createScriptURL\" hook.');\n\t      }\n\t      // Overwrite existing TrustedTypes policy.\n\t      trustedTypesPolicy = cfg.TRUSTED_TYPES_POLICY;\n\t      // Sign local variables required by `sanitize`.\n\t      emptyHTML = trustedTypesPolicy.createHTML('');\n\t    } else {\n\t      // Uninitialized policy, attempt to initialize the internal dompurify policy.\n\t      if (trustedTypesPolicy === undefined) {\n\t        trustedTypesPolicy = _createTrustedTypesPolicy(trustedTypes, currentScript);\n\t      }\n\t      // If creating the internal policy succeeded sign internal variables.\n\t      if (trustedTypesPolicy !== null && typeof emptyHTML === 'string') {\n\t        emptyHTML = trustedTypesPolicy.createHTML('');\n\t      }\n\t    }\n\t    // Prevent further manipulation of configuration.\n\t    // Not available in IE8, Safari 5, etc.\n\t    if (freeze) {\n\t      freeze(cfg);\n\t    }\n\t    CONFIG = cfg;\n\t  };\n\t  /* Keep track of all possible SVG and MathML tags\n\t   * so that we can perform the namespace checks\n\t   * correctly. */\n\t  const ALL_SVG_TAGS = addToSet({}, [...svg$1, ...svgFilters, ...svgDisallowed]);\n\t  const ALL_MATHML_TAGS = addToSet({}, [...mathMl$1, ...mathMlDisallowed]);\n\t  /**\n\t   * @param element a DOM element whose namespace is being checked\n\t   * @returns Return false if the element has a\n\t   *  namespace that a spec-compliant parser would never\n\t   *  return. Return true otherwise.\n\t   */\n\t  const _checkValidNamespace = function _checkValidNamespace(element) {\n\t    let parent = getParentNode(element);\n\t    // In JSDOM, if we're inside shadow DOM, then parentNode\n\t    // can be null. We just simulate parent in this case.\n\t    if (!parent || !parent.tagName) {\n\t      parent = {\n\t        namespaceURI: NAMESPACE,\n\t        tagName: 'template'\n\t      };\n\t    }\n\t    const tagName = stringToLowerCase(element.tagName);\n\t    const parentTagName = stringToLowerCase(parent.tagName);\n\t    if (!ALLOWED_NAMESPACES[element.namespaceURI]) {\n\t      return false;\n\t    }\n\t    if (element.namespaceURI === SVG_NAMESPACE) {\n\t      // The only way to switch from HTML namespace to SVG\n\t      // is via <svg>. If it happens via any other tag, then\n\t      // it should be killed.\n\t      if (parent.namespaceURI === HTML_NAMESPACE) {\n\t        return tagName === 'svg';\n\t      }\n\t      // The only way to switch from MathML to SVG is via`\n\t      // svg if parent is either <annotation-xml> or MathML\n\t      // text integration points.\n\t      if (parent.namespaceURI === MATHML_NAMESPACE) {\n\t        return tagName === 'svg' && (parentTagName === 'annotation-xml' || MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);\n\t      }\n\t      // We only allow elements that are defined in SVG\n\t      // spec. All others are disallowed in SVG namespace.\n\t      return Boolean(ALL_SVG_TAGS[tagName]);\n\t    }\n\t    if (element.namespaceURI === MATHML_NAMESPACE) {\n\t      // The only way to switch from HTML namespace to MathML\n\t      // is via <math>. If it happens via any other tag, then\n\t      // it should be killed.\n\t      if (parent.namespaceURI === HTML_NAMESPACE) {\n\t        return tagName === 'math';\n\t      }\n\t      // The only way to switch from SVG to MathML is via\n\t      // <math> and HTML integration points\n\t      if (parent.namespaceURI === SVG_NAMESPACE) {\n\t        return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];\n\t      }\n\t      // We only allow elements that are defined in MathML\n\t      // spec. All others are disallowed in MathML namespace.\n\t      return Boolean(ALL_MATHML_TAGS[tagName]);\n\t    }\n\t    if (element.namespaceURI === HTML_NAMESPACE) {\n\t      // The only way to switch from SVG to HTML is via\n\t      // HTML integration points, and from MathML to HTML\n\t      // is via MathML text integration points\n\t      if (parent.namespaceURI === SVG_NAMESPACE && !HTML_INTEGRATION_POINTS[parentTagName]) {\n\t        return false;\n\t      }\n\t      if (parent.namespaceURI === MATHML_NAMESPACE && !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]) {\n\t        return false;\n\t      }\n\t      // We disallow tags that are specific for MathML\n\t      // or SVG and should never appear in HTML namespace\n\t      return !ALL_MATHML_TAGS[tagName] && (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName]);\n\t    }\n\t    // For XHTML and XML documents that support custom namespaces\n\t    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && ALLOWED_NAMESPACES[element.namespaceURI]) {\n\t      return true;\n\t    }\n\t    // The code should never reach this place (this means\n\t    // that the element somehow got namespace that is not\n\t    // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).\n\t    // Return false just in case.\n\t    return false;\n\t  };\n\t  /**\n\t   * _forceRemove\n\t   *\n\t   * @param node a DOM node\n\t   */\n\t  const _forceRemove = function _forceRemove(node) {\n\t    arrayPush(DOMPurify.removed, {\n\t      element: node\n\t    });\n\t    try {\n\t      // eslint-disable-next-line unicorn/prefer-dom-node-remove\n\t      getParentNode(node).removeChild(node);\n\t    } catch (_) {\n\t      remove(node);\n\t    }\n\t  };\n\t  /**\n\t   * _removeAttribute\n\t   *\n\t   * @param name an Attribute name\n\t   * @param element a DOM node\n\t   */\n\t  const _removeAttribute = function _removeAttribute(name, element) {\n\t    try {\n\t      arrayPush(DOMPurify.removed, {\n\t        attribute: element.getAttributeNode(name),\n\t        from: element\n\t      });\n\t    } catch (_) {\n\t      arrayPush(DOMPurify.removed, {\n\t        attribute: null,\n\t        from: element\n\t      });\n\t    }\n\t    element.removeAttribute(name);\n\t    // We void attribute values for unremovable \"is\" attributes\n\t    if (name === 'is') {\n\t      if (RETURN_DOM || RETURN_DOM_FRAGMENT) {\n\t        try {\n\t          _forceRemove(element);\n\t        } catch (_) {}\n\t      } else {\n\t        try {\n\t          element.setAttribute(name, '');\n\t        } catch (_) {}\n\t      }\n\t    }\n\t  };\n\t  /**\n\t   * _initDocument\n\t   *\n\t   * @param dirty - a string of dirty markup\n\t   * @return a DOM, filled with the dirty markup\n\t   */\n\t  const _initDocument = function _initDocument(dirty) {\n\t    /* Create a HTML document */\n\t    let doc = null;\n\t    let leadingWhitespace = null;\n\t    if (FORCE_BODY) {\n\t      dirty = '<remove></remove>' + dirty;\n\t    } else {\n\t      /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */\n\t      const matches = stringMatch(dirty, /^[\\r\\n\\t ]+/);\n\t      leadingWhitespace = matches && matches[0];\n\t    }\n\t    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && NAMESPACE === HTML_NAMESPACE) {\n\t      // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)\n\t      dirty = '<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>' + dirty + '</body></html>';\n\t    }\n\t    const dirtyPayload = trustedTypesPolicy ? trustedTypesPolicy.createHTML(dirty) : dirty;\n\t    /*\n\t     * Use the DOMParser API by default, fallback later if needs be\n\t     * DOMParser not work for svg when has multiple root element.\n\t     */\n\t    if (NAMESPACE === HTML_NAMESPACE) {\n\t      try {\n\t        doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);\n\t      } catch (_) {}\n\t    }\n\t    /* Use createHTMLDocument in case DOMParser is not available */\n\t    if (!doc || !doc.documentElement) {\n\t      doc = implementation.createDocument(NAMESPACE, 'template', null);\n\t      try {\n\t        doc.documentElement.innerHTML = IS_EMPTY_INPUT ? emptyHTML : dirtyPayload;\n\t      } catch (_) {\n\t        // Syntax error if dirtyPayload is invalid xml\n\t      }\n\t    }\n\t    const body = doc.body || doc.documentElement;\n\t    if (dirty && leadingWhitespace) {\n\t      body.insertBefore(document.createTextNode(leadingWhitespace), body.childNodes[0] || null);\n\t    }\n\t    /* Work on whole document or just its body */\n\t    if (NAMESPACE === HTML_NAMESPACE) {\n\t      return getElementsByTagName.call(doc, WHOLE_DOCUMENT ? 'html' : 'body')[0];\n\t    }\n\t    return WHOLE_DOCUMENT ? doc.documentElement : body;\n\t  };\n\t  /**\n\t   * Creates a NodeIterator object that you can use to traverse filtered lists of nodes or elements in a document.\n\t   *\n\t   * @param root The root element or node to start traversing on.\n\t   * @return The created NodeIterator\n\t   */\n\t  const _createNodeIterator = function _createNodeIterator(root) {\n\t    return createNodeIterator.call(root.ownerDocument || root, root,\n\t    // eslint-disable-next-line no-bitwise\n\t    NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT | NodeFilter.SHOW_TEXT | NodeFilter.SHOW_PROCESSING_INSTRUCTION | NodeFilter.SHOW_CDATA_SECTION, null);\n\t  };\n\t  /**\n\t   * _isClobbered\n\t   *\n\t   * @param element element to check for clobbering attacks\n\t   * @return true if clobbered, false if safe\n\t   */\n\t  const _isClobbered = function _isClobbered(element) {\n\t    return element instanceof HTMLFormElement && (typeof element.nodeName !== 'string' || typeof element.textContent !== 'string' || typeof element.removeChild !== 'function' || !(element.attributes instanceof NamedNodeMap) || typeof element.removeAttribute !== 'function' || typeof element.setAttribute !== 'function' || typeof element.namespaceURI !== 'string' || typeof element.insertBefore !== 'function' || typeof element.hasChildNodes !== 'function');\n\t  };\n\t  /**\n\t   * Checks whether the given object is a DOM node.\n\t   *\n\t   * @param value object to check whether it's a DOM node\n\t   * @return true is object is a DOM node\n\t   */\n\t  const _isNode = function _isNode(value) {\n\t    return typeof Node === 'function' && value instanceof Node;\n\t  };\n\t  function _executeHooks(hooks, currentNode, data) {\n\t    arrayForEach(hooks, hook => {\n\t      hook.call(DOMPurify, currentNode, data, CONFIG);\n\t    });\n\t  }\n\t  /**\n\t   * _sanitizeElements\n\t   *\n\t   * @protect nodeName\n\t   * @protect textContent\n\t   * @protect removeChild\n\t   * @param currentNode to check for permission to exist\n\t   * @return true if node was killed, false if left alive\n\t   */\n\t  const _sanitizeElements = function _sanitizeElements(currentNode) {\n\t    let content = null;\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.beforeSanitizeElements, currentNode, null);\n\t    /* Check if element is clobbered or can clobber */\n\t    if (_isClobbered(currentNode)) {\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Now let's check the element's type and name */\n\t    const tagName = transformCaseFunc(currentNode.nodeName);\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.uponSanitizeElement, currentNode, {\n\t      tagName,\n\t      allowedTags: ALLOWED_TAGS\n\t    });\n\t    /* Detect mXSS attempts abusing namespace confusion */\n\t    if (SAFE_FOR_XML && currentNode.hasChildNodes() && !_isNode(currentNode.firstElementChild) && regExpTest(/<[/\\w!]/g, currentNode.innerHTML) && regExpTest(/<[/\\w!]/g, currentNode.textContent)) {\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Remove any occurrence of processing instructions */\n\t    if (currentNode.nodeType === NODE_TYPE.progressingInstruction) {\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Remove any kind of possibly harmful comments */\n\t    if (SAFE_FOR_XML && currentNode.nodeType === NODE_TYPE.comment && regExpTest(/<[/\\w]/g, currentNode.data)) {\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Remove element if anything forbids its presence */\n\t    if (!(EXTRA_ELEMENT_HANDLING.tagCheck instanceof Function && EXTRA_ELEMENT_HANDLING.tagCheck(tagName)) && (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName])) {\n\t      /* Check if we have a custom element to handle */\n\t      if (!FORBID_TAGS[tagName] && _isBasicCustomElement(tagName)) {\n\t        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)) {\n\t          return false;\n\t        }\n\t        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)) {\n\t          return false;\n\t        }\n\t      }\n\t      /* Keep content except for bad-listed elements */\n\t      if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {\n\t        const parentNode = getParentNode(currentNode) || currentNode.parentNode;\n\t        const childNodes = getChildNodes(currentNode) || currentNode.childNodes;\n\t        if (childNodes && parentNode) {\n\t          const childCount = childNodes.length;\n\t          for (let i = childCount - 1; i >= 0; --i) {\n\t            const childClone = cloneNode(childNodes[i], true);\n\t            childClone.__removalCount = (currentNode.__removalCount || 0) + 1;\n\t            parentNode.insertBefore(childClone, getNextSibling(currentNode));\n\t          }\n\t        }\n\t      }\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Check whether element has a valid namespace */\n\t    if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Make sure that older browsers don't get fallback-tag mXSS */\n\t    if ((tagName === 'noscript' || tagName === 'noembed' || tagName === 'noframes') && regExpTest(/<\\/no(script|embed|frames)/i, currentNode.innerHTML)) {\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Sanitize element content to be template-safe */\n\t    if (SAFE_FOR_TEMPLATES && currentNode.nodeType === NODE_TYPE.text) {\n\t      /* Get the element's text content */\n\t      content = currentNode.textContent;\n\t      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n\t        content = stringReplace(content, expr, ' ');\n\t      });\n\t      if (currentNode.textContent !== content) {\n\t        arrayPush(DOMPurify.removed, {\n\t          element: currentNode.cloneNode()\n\t        });\n\t        currentNode.textContent = content;\n\t      }\n\t    }\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.afterSanitizeElements, currentNode, null);\n\t    return false;\n\t  };\n\t  /**\n\t   * _isValidAttribute\n\t   *\n\t   * @param lcTag Lowercase tag name of containing element.\n\t   * @param lcName Lowercase attribute name.\n\t   * @param value Attribute value.\n\t   * @return Returns true if `value` is valid, otherwise false.\n\t   */\n\t  // eslint-disable-next-line complexity\n\t  const _isValidAttribute = function _isValidAttribute(lcTag, lcName, value) {\n\t    /* Make sure attribute cannot clobber */\n\t    if (SANITIZE_DOM && (lcName === 'id' || lcName === 'name') && (value in document || value in formElement)) {\n\t      return false;\n\t    }\n\t    /* Allow valid data-* attributes: At least one character after \"-\"\n\t        (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)\n\t        XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)\n\t        We don't need to check the value; it's always URI safe. */\n\t    if (ALLOW_DATA_ATTR && !FORBID_ATTR[lcName] && regExpTest(DATA_ATTR, lcName)) ; else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR, lcName)) ; else if (EXTRA_ELEMENT_HANDLING.attributeCheck instanceof Function && EXTRA_ELEMENT_HANDLING.attributeCheck(lcName, lcTag)) ; else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {\n\t      if (\n\t      // First condition does a very basic check if a) it's basically a valid custom element tagname AND\n\t      // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n\t      // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck\n\t      _isBasicCustomElement(lcTag) && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag)) && (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName) || CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName, lcTag)) ||\n\t      // Alternative, second condition checks if it's an `is`-attribute, AND\n\t      // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n\t      lcName === 'is' && CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))) ; else {\n\t        return false;\n\t      }\n\t      /* Check value is safe. First, is attr inert? If so, is safe */\n\t    } else if (URI_SAFE_ATTRIBUTES[lcName]) ; else if (regExpTest(IS_ALLOWED_URI$1, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if ((lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') && lcTag !== 'script' && stringIndexOf(value, 'data:') === 0 && DATA_URI_TAGS[lcTag]) ; else if (ALLOW_UNKNOWN_PROTOCOLS && !regExpTest(IS_SCRIPT_OR_DATA, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if (value) {\n\t      return false;\n\t    } else ;\n\t    return true;\n\t  };\n\t  /**\n\t   * _isBasicCustomElement\n\t   * checks if at least one dash is included in tagName, and it's not the first char\n\t   * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name\n\t   *\n\t   * @param tagName name of the tag of the node to sanitize\n\t   * @returns Returns true if the tag name meets the basic criteria for a custom element, otherwise false.\n\t   */\n\t  const _isBasicCustomElement = function _isBasicCustomElement(tagName) {\n\t    return tagName !== 'annotation-xml' && stringMatch(tagName, CUSTOM_ELEMENT);\n\t  };\n\t  /**\n\t   * _sanitizeAttributes\n\t   *\n\t   * @protect attributes\n\t   * @protect nodeName\n\t   * @protect removeAttribute\n\t   * @protect setAttribute\n\t   *\n\t   * @param currentNode to sanitize\n\t   */\n\t  const _sanitizeAttributes = function _sanitizeAttributes(currentNode) {\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.beforeSanitizeAttributes, currentNode, null);\n\t    const {\n\t      attributes\n\t    } = currentNode;\n\t    /* Check if we have attributes; if not we might have a text node */\n\t    if (!attributes || _isClobbered(currentNode)) {\n\t      return;\n\t    }\n\t    const hookEvent = {\n\t      attrName: '',\n\t      attrValue: '',\n\t      keepAttr: true,\n\t      allowedAttributes: ALLOWED_ATTR,\n\t      forceKeepAttr: undefined\n\t    };\n\t    let l = attributes.length;\n\t    /* Go backwards over all attributes; safely remove bad ones */\n\t    while (l--) {\n\t      const attr = attributes[l];\n\t      const {\n\t        name,\n\t        namespaceURI,\n\t        value: attrValue\n\t      } = attr;\n\t      const lcName = transformCaseFunc(name);\n\t      const initValue = attrValue;\n\t      let value = name === 'value' ? initValue : stringTrim(initValue);\n\t      /* Execute a hook if present */\n\t      hookEvent.attrName = lcName;\n\t      hookEvent.attrValue = value;\n\t      hookEvent.keepAttr = true;\n\t      hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set\n\t      _executeHooks(hooks.uponSanitizeAttribute, currentNode, hookEvent);\n\t      value = hookEvent.attrValue;\n\t      /* Full DOM Clobbering protection via namespace isolation,\n\t       * Prefix id and name attributes with `user-content-`\n\t       */\n\t      if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {\n\t        // Remove the attribute with this value\n\t        _removeAttribute(name, currentNode);\n\t        // Prefix the value and later re-create the attribute with the sanitized value\n\t        value = SANITIZE_NAMED_PROPS_PREFIX + value;\n\t      }\n\t      /* Work around a security issue with comments inside attributes */\n\t      if (SAFE_FOR_XML && regExpTest(/((--!?|])>)|<\\/(style|title|textarea)/i, value)) {\n\t        _removeAttribute(name, currentNode);\n\t        continue;\n\t      }\n\t      /* Make sure we cannot easily use animated hrefs, even if animations are allowed */\n\t      if (lcName === 'attributename' && stringMatch(value, 'href')) {\n\t        _removeAttribute(name, currentNode);\n\t        continue;\n\t      }\n\t      /* Did the hooks approve of the attribute? */\n\t      if (hookEvent.forceKeepAttr) {\n\t        continue;\n\t      }\n\t      /* Did the hooks approve of the attribute? */\n\t      if (!hookEvent.keepAttr) {\n\t        _removeAttribute(name, currentNode);\n\t        continue;\n\t      }\n\t      /* Work around a security issue in jQuery 3.0 */\n\t      if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\\/>/i, value)) {\n\t        _removeAttribute(name, currentNode);\n\t        continue;\n\t      }\n\t      /* Sanitize attribute content to be template-safe */\n\t      if (SAFE_FOR_TEMPLATES) {\n\t        arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n\t          value = stringReplace(value, expr, ' ');\n\t        });\n\t      }\n\t      /* Is `value` valid for this attribute? */\n\t      const lcTag = transformCaseFunc(currentNode.nodeName);\n\t      if (!_isValidAttribute(lcTag, lcName, value)) {\n\t        _removeAttribute(name, currentNode);\n\t        continue;\n\t      }\n\t      /* Handle attributes that require Trusted Types */\n\t      if (trustedTypesPolicy && typeof trustedTypes === 'object' && typeof trustedTypes.getAttributeType === 'function') {\n\t        if (namespaceURI) ; else {\n\t          switch (trustedTypes.getAttributeType(lcTag, lcName)) {\n\t            case 'TrustedHTML':\n\t              {\n\t                value = trustedTypesPolicy.createHTML(value);\n\t                break;\n\t              }\n\t            case 'TrustedScriptURL':\n\t              {\n\t                value = trustedTypesPolicy.createScriptURL(value);\n\t                break;\n\t              }\n\t          }\n\t        }\n\t      }\n\t      /* Handle invalid data-* attribute set by try-catching it */\n\t      if (value !== initValue) {\n\t        try {\n\t          if (namespaceURI) {\n\t            currentNode.setAttributeNS(namespaceURI, name, value);\n\t          } else {\n\t            /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. \"x-schema\". */\n\t            currentNode.setAttribute(name, value);\n\t          }\n\t          if (_isClobbered(currentNode)) {\n\t            _forceRemove(currentNode);\n\t          } else {\n\t            arrayPop(DOMPurify.removed);\n\t          }\n\t        } catch (_) {\n\t          _removeAttribute(name, currentNode);\n\t        }\n\t      }\n\t    }\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.afterSanitizeAttributes, currentNode, null);\n\t  };\n\t  /**\n\t   * _sanitizeShadowDOM\n\t   *\n\t   * @param fragment to iterate over recursively\n\t   */\n\t  const _sanitizeShadowDOM = function _sanitizeShadowDOM(fragment) {\n\t    let shadowNode = null;\n\t    const shadowIterator = _createNodeIterator(fragment);\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.beforeSanitizeShadowDOM, fragment, null);\n\t    while (shadowNode = shadowIterator.nextNode()) {\n\t      /* Execute a hook if present */\n\t      _executeHooks(hooks.uponSanitizeShadowNode, shadowNode, null);\n\t      /* Sanitize tags and elements */\n\t      _sanitizeElements(shadowNode);\n\t      /* Check attributes next */\n\t      _sanitizeAttributes(shadowNode);\n\t      /* Deep shadow DOM detected */\n\t      if (shadowNode.content instanceof DocumentFragment) {\n\t        _sanitizeShadowDOM(shadowNode.content);\n\t      }\n\t    }\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.afterSanitizeShadowDOM, fragment, null);\n\t  };\n\t  // eslint-disable-next-line complexity\n\t  DOMPurify.sanitize = function (dirty) {\n\t    let cfg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\t    let body = null;\n\t    let importedNode = null;\n\t    let currentNode = null;\n\t    let returnNode = null;\n\t    /* Make sure we have a string to sanitize.\n\t      DO NOT return early, as this will return the wrong type if\n\t      the user has requested a DOM object rather than a string */\n\t    IS_EMPTY_INPUT = !dirty;\n\t    if (IS_EMPTY_INPUT) {\n\t      dirty = '<!-->';\n\t    }\n\t    /* Stringify, in case dirty is an object */\n\t    if (typeof dirty !== 'string' && !_isNode(dirty)) {\n\t      if (typeof dirty.toString === 'function') {\n\t        dirty = dirty.toString();\n\t        if (typeof dirty !== 'string') {\n\t          throw typeErrorCreate('dirty is not a string, aborting');\n\t        }\n\t      } else {\n\t        throw typeErrorCreate('toString is not a function');\n\t      }\n\t    }\n\t    /* Return dirty HTML if DOMPurify cannot run */\n\t    if (!DOMPurify.isSupported) {\n\t      return dirty;\n\t    }\n\t    /* Assign config vars */\n\t    if (!SET_CONFIG) {\n\t      _parseConfig(cfg);\n\t    }\n\t    /* Clean up removed elements */\n\t    DOMPurify.removed = [];\n\t    /* Check if dirty is correctly typed for IN_PLACE */\n\t    if (typeof dirty === 'string') {\n\t      IN_PLACE = false;\n\t    }\n\t    if (IN_PLACE) {\n\t      /* Do some early pre-sanitization to avoid unsafe root nodes */\n\t      if (dirty.nodeName) {\n\t        const tagName = transformCaseFunc(dirty.nodeName);\n\t        if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n\t          throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');\n\t        }\n\t      }\n\t    } else if (dirty instanceof Node) {\n\t      /* If dirty is a DOM element, append to an empty document to avoid\n\t         elements being stripped by the parser */\n\t      body = _initDocument('<!---->');\n\t      importedNode = body.ownerDocument.importNode(dirty, true);\n\t      if (importedNode.nodeType === NODE_TYPE.element && importedNode.nodeName === 'BODY') {\n\t        /* Node is already a body, use as is */\n\t        body = importedNode;\n\t      } else if (importedNode.nodeName === 'HTML') {\n\t        body = importedNode;\n\t      } else {\n\t        // eslint-disable-next-line unicorn/prefer-dom-node-append\n\t        body.appendChild(importedNode);\n\t      }\n\t    } else {\n\t      /* Exit directly if we have nothing to do */\n\t      if (!RETURN_DOM && !SAFE_FOR_TEMPLATES && !WHOLE_DOCUMENT &&\n\t      // eslint-disable-next-line unicorn/prefer-includes\n\t      dirty.indexOf('<') === -1) {\n\t        return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(dirty) : dirty;\n\t      }\n\t      /* Initialize the document to work on */\n\t      body = _initDocument(dirty);\n\t      /* Check we have a DOM node from the data */\n\t      if (!body) {\n\t        return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';\n\t      }\n\t    }\n\t    /* Remove first element node (ours) if FORCE_BODY is set */\n\t    if (body && FORCE_BODY) {\n\t      _forceRemove(body.firstChild);\n\t    }\n\t    /* Get node iterator */\n\t    const nodeIterator = _createNodeIterator(IN_PLACE ? dirty : body);\n\t    /* Now start iterating over the created document */\n\t    while (currentNode = nodeIterator.nextNode()) {\n\t      /* Sanitize tags and elements */\n\t      _sanitizeElements(currentNode);\n\t      /* Check attributes next */\n\t      _sanitizeAttributes(currentNode);\n\t      /* Shadow DOM detected, sanitize it */\n\t      if (currentNode.content instanceof DocumentFragment) {\n\t        _sanitizeShadowDOM(currentNode.content);\n\t      }\n\t    }\n\t    /* If we sanitized `dirty` in-place, return it. */\n\t    if (IN_PLACE) {\n\t      return dirty;\n\t    }\n\t    /* Return sanitized string or DOM */\n\t    if (RETURN_DOM) {\n\t      if (RETURN_DOM_FRAGMENT) {\n\t        returnNode = createDocumentFragment.call(body.ownerDocument);\n\t        while (body.firstChild) {\n\t          // eslint-disable-next-line unicorn/prefer-dom-node-append\n\t          returnNode.appendChild(body.firstChild);\n\t        }\n\t      } else {\n\t        returnNode = body;\n\t      }\n\t      if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmode) {\n\t        /*\n\t          AdoptNode() is not used because internal state is not reset\n\t          (e.g. the past names map of a HTMLFormElement), this is safe\n\t          in theory but we would rather not risk another attack vector.\n\t          The state that is cloned by importNode() is explicitly defined\n\t          by the specs.\n\t        */\n\t        returnNode = importNode.call(originalDocument, returnNode, true);\n\t      }\n\t      return returnNode;\n\t    }\n\t    let serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;\n\t    /* Serialize doctype if allowed */\n\t    if (WHOLE_DOCUMENT && ALLOWED_TAGS['!doctype'] && body.ownerDocument && body.ownerDocument.doctype && body.ownerDocument.doctype.name && regExpTest(DOCTYPE_NAME, body.ownerDocument.doctype.name)) {\n\t      serializedHTML = '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\\n' + serializedHTML;\n\t    }\n\t    /* Sanitize final string template-safe */\n\t    if (SAFE_FOR_TEMPLATES) {\n\t      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n\t        serializedHTML = stringReplace(serializedHTML, expr, ' ');\n\t      });\n\t    }\n\t    return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(serializedHTML) : serializedHTML;\n\t  };\n\t  DOMPurify.setConfig = function () {\n\t    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\t    _parseConfig(cfg);\n\t    SET_CONFIG = true;\n\t  };\n\t  DOMPurify.clearConfig = function () {\n\t    CONFIG = null;\n\t    SET_CONFIG = false;\n\t  };\n\t  DOMPurify.isValidAttribute = function (tag, attr, value) {\n\t    /* Initialize shared config vars if necessary. */\n\t    if (!CONFIG) {\n\t      _parseConfig({});\n\t    }\n\t    const lcTag = transformCaseFunc(tag);\n\t    const lcName = transformCaseFunc(attr);\n\t    return _isValidAttribute(lcTag, lcName, value);\n\t  };\n\t  DOMPurify.addHook = function (entryPoint, hookFunction) {\n\t    if (typeof hookFunction !== 'function') {\n\t      return;\n\t    }\n\t    arrayPush(hooks[entryPoint], hookFunction);\n\t  };\n\t  DOMPurify.removeHook = function (entryPoint, hookFunction) {\n\t    if (hookFunction !== undefined) {\n\t      const index = arrayLastIndexOf(hooks[entryPoint], hookFunction);\n\t      return index === -1 ? undefined : arraySplice(hooks[entryPoint], index, 1)[0];\n\t    }\n\t    return arrayPop(hooks[entryPoint]);\n\t  };\n\t  DOMPurify.removeHooks = function (entryPoint) {\n\t    hooks[entryPoint] = [];\n\t  };\n\t  DOMPurify.removeAllHooks = function () {\n\t    hooks = _createHooksMap();\n\t  };\n\t  return DOMPurify;\n\t}\n\tvar purify = createDOMPurify();\n\n\t/**\n\t * HTML templates used by the editor and default commands\n\t * @type {Object}\n\t * @private\n\t */\n\tvar _templates = {\n\t\thtml:\n\t\t\t'<!DOCTYPE html>' +\n\t\t\t\t'<html data-bs-theme=\"{themeMode}\">' +\n\t\t\t\t'<head>' +\n\t\t\t\t'<meta http-equiv=\"Content-Type\" ' +\n\t\t\t\t'content=\"text/html;charset={charset}\" />' +\n\t\t\t\t'{styles}' +\n\t\t\t\t'</head>' +\n\t\t\t\t'<body style=\"min-height:265px\" contenteditable=\"true\" {spellcheck}><p></p>' +\n\t\t\t\t'</body>' +\n\t\t\t\t'</html>',\n\n\t\tstyle: '<link rel=\"stylesheet\" type=\"text/css\" href=\"{style}\" />',\n\n\t\ttoolbarButton: '<a class=\"btn sceditor-button sceditor-button-{name}\" ' +\n\t\t\t'data-sceditor-command=\"{name}\" unselectable=\"on\">' +\n\t\t\t'<span unselectable=\"on\">  </span></a>',\n\n\t\tcodeOpt: '<a class=\"sceditor-code-option dropdown-item\" href=\"#\" ' +\n\t\t\t'data-language=\"{language}\">{languageName}</a>',\n\n\t\tnoteOpt: '<option value=\"{type}\">{type}</option>',\n\n\t\textensionOpt: '<a class=\"sceditor-extension-option dropdown-item\" href=\"#\" ' +\n\t\t\t'data-language=\"{extension}\">{extension}</a>',\n\n\t\tfontOpt: '<a class=\"sceditor-font-option dropdown-item\" href=\"#\" ' +\n\t\t\t'data-font=\"{font}\"><font face=\"{font}\">{font}</font></a>',\n\n\t\tsizeOpt: '<a class=\"sceditor-fontsize-option dropdown-item\" data-size=\"{size}\" ' +\n\t\t\t'href=\"#\"><font size=\"{size}\">{size}</font></a>',\n\n\t\talbums:\n\t\t\t'<form class=\"m-3\"><div id=\"AlbumsListBox\" class=\"content\">' +\n\t\t\t\t'<div id=\"AlbumsListPager\"></div>' +\n\t\t\t\t'<div id=\"PostAlbumsLoader\" class=\"text-center\"><div class=\"fa-3x\"><i class=\"fas fa-spinner fa-pulse\"></i>' +\n\t\t\t\t'</div></div>' +\n\t\t\t\t'<div id=\"AlbumsListBox\" class=\"content\">' +\n\t\t\t\t'<div id=\"PostAlbumsListPlaceholder\" data-url=\"{root}\" style=\"clear: both; \">' +\n\t\t\t\t'<div class=\"container\"><div class=\"AlbumsList row\"></div></div>' +\n\t\t\t\t'</div></div>' +\n\t\t\t'</div></form>',\n\n\t\tnote:\n\t\t\t'<form class=\"m-3\">' +\n\t\t\t\t'<div class=\"mb-3\"><label for=\"type\" class=\"form-label\">{labelType}</label> ' +\n\t\t\t\t'<select class=\"form-select\" id=\"type\" aria-label=\"note type\">' +\n\t\t\t\t'{values}' +\n\t\t\t\t'</select> ' +\n\t\t\t\t'</div> ' +\n\t\t\t\t'<div class=\"mb-3\"><label for=\"txt\" class=\"form-label\">{labelText}</label> ' +\n\t\t\t\t'<textarea cols=\"20\" rows=\"7\" id=\"txt\" class=\"form-control textarea-input\"></textarea></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</div></form>',\n\n\t\tpastetext:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"txt\" class=\"form-label\">{label}</label> ' +\n\t\t\t\t'<textarea cols=\"20\" rows=\"7\" id=\"txt\" class=\"form-control textarea-input\"></textarea></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</div></form>',\n\n\t\timage:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"link\" class=\"form-label\">{url}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"link\" dir=\"ltr\" placeholder=\"https://\" class=\"form-control\" /></div>' +\n\t\t\t\t'<div class=\"mb-3\"><label for=\"des\" class=\"form-label\">{desc}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"des\" class=\"form-control\" /></div>' +\n\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" /></form>',\n\n\t\temail:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"email\" class=\"form-label\">{label}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"email\" dir=\"ltr\" class=\"form-control\" /></div>' +\n\t\t\t\t'<div class=\"mb-3\"><label for=\"des\" class=\"form-label\">{desc}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"des\" class=\"form-control\" /></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</form>',\n\n\t\tlink:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"link\" class=\"form-label\">{url}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"link\" dir=\"ltr\" placeholder=\"https://\" class=\"form-control\" /></div>' +\n\t\t\t\t'<div class=\"mb-3\"><label for=\"des\" class=\"form-label\">{desc}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"des\" class=\"form-control\" /></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{ins}\" /></form>',\n\n\t\tmediaMenu:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"link\" class=\"form-label\">{label}</label> ' +\n\t\t\t\t'<input type=\"url\" id=\"link\" dir=\"ltr\" placeholder=\"https://\" class=\"form-control\" /></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</form>',\n\n\t\tyoutubeMenu:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"link\" class=\"form-label\">{label}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"link\" dir=\"ltr\" placeholder=\"https://\" class=\"form-control\" /></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</form>',\n\n\t\tinstagramMenu:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"link\" class=\"form-label\">{label}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"link\" dir=\"ltr\" placeholder=\"https://\" class=\"form-control\" /></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</form>',\n\n\t\tfacebookMenu:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"link\" class=\"form-label\">{label}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"link\" dir=\"ltr\" placeholder=\"https://\" class=\"form-control\" /></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</form>',\n\n\t\tfacebook:\n\t\t\t'<div class=\"ratio ratio-1x1 border\" data-oembed-url=\"{url}\" data-facebook-url=\"{url}\"><iframe src=\"https://www.facebook.com/plugins/post.php?href={url}\"></iframe></div>',\n\n\t\tinstagram:\n\t\t\t'<div class=\"ratio ratio-1x1 border\" data-oembed-url=\"https://www.instagram.com/p/{id}\" data-instagram-url=\"{url}\"><iframe src=\"https://www.instagram.com/p/{id}/embed/captioned/\"></iframe></div>',\n\n\t\tyoutube:\n\t\t\t'<div data-oembed-url=\"https://youtube.com/embed/{id}\" data-youtube-url=\"{url}\" class=\"ratio ratio-16x9 border\"><iframe src=\"https://youtube.com/embed/{id}?hd=1\"></iframe></div>',\n\n\t\tvimeo:\n\t\t\t'<div data-oembed-url=\"https://vimeo.com/{vimeoId}\" data-vimeo-url=\"{url}\" class=\"ratio ratio-16x9 border\"><iframe src=\"https://player.vimeo.com/video/{vimeoId}?show_title=1&show_byline=1&show_portrait=1&fullscreen=1\"></iframe></div>'\n\t};\n\n\t/**\n\t * Replaces any params in a template with the passed params.\n\t *\n\t * If createHtml is passed it will return a DocumentFragment\n\t * containing the parsed template.\n\t *\n\t * @param {string} name\n\t * @param {Object} [params]\n\t * @param {boolean} [createHtml]\n\t * @param {boolean} [sanitize=true]\n\t * @returns {string|DocumentFragment}\n\t * @private\n\t */\n\tfunction _tmpl(name, params, createHtml, sanitize) {\n\t\tvar template = _templates[name];\n\n\t\tObject.keys(params).forEach(function(name) {\n\n\t\t\tif (typeof sanitize === 'undefined') {\n\t\t\t\tsanitize = false;\n\t\t\t}\n\n\t\t\t// Default to sanitizing\n\t\t\tif (sanitize !== false) {\n\t\t\t\tparams[name] = entities(String(params[name]));\n\t\t\t}\n\n\t\t\ttemplate = template.replace(\n\t\t\t\tnew RegExp(regex(`{${name}}`), 'g'),\n\t\t\t\tparams[name]\n\t\t\t);\n\t\t});\n\n\t\t// Default to sanitizing\n\t\tif (sanitize !== false) {\n\t\t\ttemplate = purify.sanitize(template, {ADD_ATTR: ['unselectable']});\n\t\t}\n\n\t\tif (createHtml) {\n\t\t\ttemplate = parseHTML(template);\n\t\t}\n\n\t\treturn template;\n\t}\n\n\t/**\n\t * Fixes a bug in FF where it sometimes wraps\n\t * new lines in their own list item.\n\t * See issue #359\n\t */\n\tfunction fixFirefoxListBug(editor) {\n\t\t// Only apply to Firefox as will break other browsers.\n\t\tif ('mozHidden' in document) {\n\t\t\tlet node = editor.getBody();\n\t\t\tlet next;\n\n\t\t\twhile (node) {\n\t\t\t\tnext = node;\n\n\t\t\t\tif (next.firstChild) {\n\t\t\t\t\tnext = next.firstChild;\n\t\t\t\t} else {\n\n\t\t\t\t\twhile (next && !next.nextSibling) {\n\t\t\t\t\t\tnext = next.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (next) {\n\t\t\t\t\t\tnext = next.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (node.nodeType === 3 && /[\\n\\r\\t]+/.test(node.nodeValue)) {\n\t\t\t\t\t// Only remove if newlines are collapsed\n\t\t\t\t\tif (!/^pre/.test(css(node.parentNode, 'whiteSpace'))) {\n\t\t\t\t\t\tremove(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tnode = next;\n\t\t\t}\n\t\t}\n\t}\n\n\n\t/**\n\t * Map of all the commands for SCEditor\n\t * @type {Object}\n\t * @name commands\n\t * @memberOf sceditor\n\t */\n\tvar defaultCmds = {\n\n\t\t// START_COMMAND: albums\n\t\talbums: {\n\t\t\texec: function (caller) {\n\t\t\t\tconst content = createElement('div');\n\t\t\t\tconst editor = this;\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('albums',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\troot: editor.opts.root\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\teditor.createDropDown(caller, 'albums', content);\n\n\t\t\t\tconst pageSize = 6;\n\t\t\t\tconst pageNumber = 0;\n\n\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\tgetAlbumImagesData(pageSize, pageNumber, false);\n\t\t\t},\n\t\t\ttooltip: 'User Albums'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Attachments\n\t\tattachments: {\n\t\t\texec: function () {\n\t\t\t\tconst modal = new window.bootstrap.Modal('#UploadDialog');\n\n\t\t\t\tmodal.show();\n\t\t\t\tmodal._element.addEventListener('shown.bs.modal',\n\t\t\t\t\t_ => {\n\t\t\t\t\t\tconst pageSize = 6;\n\t\t\t\t\t\tconst pageNumber = 0;\n\n\t\t\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\t\t\tgetPaginationData(pageSize, pageNumber, false);\n\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'User Attachments'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Bold\n\t\tbold: {\n\t\t\texec: 'bold',\n\t\t\ttooltip: 'Bold',\n\t\t\tshortcut: 'Ctrl+B'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Italic\n\t\titalic: {\n\t\t\texec: 'italic',\n\t\t\ttooltip: 'Italic',\n\t\t\tshortcut: 'Ctrl+I'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Underline\n\t\tunderline: {\n\t\t\texec: 'underline',\n\t\t\ttooltip: 'Underline',\n\t\t\tshortcut: 'Ctrl+U'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Strikethrough\n\t\tstrike: {\n\t\t\texec: 'strikethrough',\n\t\t\ttooltip: 'Strikethrough'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Mark\n\t\tmark: {\n\t\t\texec: function () {\n\t\t\t\tthis.wysiwygEditorInsertHtml(\n\t\t\t\t\t'<mark>',\n\t\t\t\t\t'</mark>'\n\t\t\t\t);\n\t\t\t},\n\t\t\ttooltip: 'Highlight',\n\t\t\tshortcut: 'Ctrl+H'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Left\n\t\tleft: {\n\t\t\tstate: function (node) {\n\t\t\t\tif (node && node.nodeType === 3) {\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\tif (node) {\n\t\t\t\t\tconst isLtr = css(node, 'direction') === 'ltr';\n\t\t\t\t\tconst align = css(node, 'textAlign');\n\n\t\t\t\t\t// Can be -moz-left\n\t\t\t\t\treturn /left/.test(align) ||\n\t\t\t\t\t\talign === (isLtr ? 'start' : 'end');\n\t\t\t\t}\n\t\t\t},\n\t\t\texec: 'justifyleft',\n\t\t\ttooltip: 'Align left'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Centre\n\t\tcenter: {\n\t\t\texec: 'justifycenter',\n\t\t\ttooltip: 'Center'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Right\n\t\tright: {\n\t\t\tstate: function (node) {\n\t\t\t\tif (node && node.nodeType === 3) {\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\tif (node) {\n\t\t\t\t\tconst isLtr = css(node, 'direction') === 'ltr';\n\t\t\t\t\tconst align = css(node, 'textAlign');\n\n\t\t\t\t\t// Can be -moz-right\n\t\t\t\t\treturn /right/.test(align) ||\n\t\t\t\t\t\talign === (isLtr ? 'end' : 'start');\n\t\t\t\t}\n\t\t\t},\n\t\t\texec: 'justifyright',\n\t\t\ttooltip: 'Align right'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Justify\n\t\tjustify: {\n\t\t\texec: 'justifyfull',\n\t\t\ttooltip: 'Justify'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Font\n\t\tfont: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'a',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tcallback(data(this, 'font'));\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.opts.fonts.split(',').forEach(function (font) {\n\t\t\t\t\tappendChild(content,\n\t\t\t\t\t\t_tmpl('fontOpt',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfont: font\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttrue));\n\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'font-picker', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.font._dropDown(editor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (fontName) {\n\t\t\t\t\t\teditor.execCommand('fontname', fontName);\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Font Name'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Size\n\t\tsize: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tconst content = createElement('div');\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'a',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tcallback(data(this, 'size'));\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\tfor (let i = 1; i <= 7; i++) {\n\t\t\t\t\tappendChild(content,\n\t\t\t\t\t\t_tmpl('sizeOpt',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsize: i\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttrue));\n\t\t\t\t}\n\n\t\t\t\teditor.createDropDown(caller, 'fontsize-picker', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.size._dropDown(editor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (fontSize) {\n\t\t\t\t\t\teditor.execCommand('fontsize', fontSize);\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Font Size'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Colour\n\t\tcolor: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tconst content = createElement('div');\n\t\t\t\tvar html = '';\n\t\t\t\tconst cmd = defaultCmds.color;\n\n\t\t\t\tif (!cmd._htmlCache) {\n\t\t\t\t\teditor.opts.colors.split('|').forEach(function (column) {\n\t\t\t\t\t\thtml += '<div class=\"sceditor-color-column\">';\n\n\t\t\t\t\t\tcolumn.split(',').forEach(function (color) {\n\t\t\t\t\t\t\t// Only allow named, #aaa, hsl(1.1 50% / 1), etc.\n\t\t\t\t\t\t\tif (!/^[\\#a-z0-9\\-\\(\\) \\/%\\.]+$/i.test(color)) {\n\t\t\t\t\t\t\t\tcolor = '';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\thtml +=\n\t\t\t\t\t\t\t\t`<a href=\"#\" class=\"sceditor-color-option\" style=\"background-color: ${color}\" data-color=\"${\n\t\t\t\t\t\t\t\tcolor}\"></a>`;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\thtml += '</div>';\n\t\t\t\t\t});\n\n\t\t\t\t\tcmd._htmlCache = html;\n\t\t\t\t}\n\n\t\t\t\tappendChild(content, parseHTML(cmd._htmlCache));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'a',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tcallback(data(this, 'color'));\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'color-picker', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.color._dropDown(editor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (color) {\n\t\t\t\t\t\teditor.execCommand('forecolor', color);\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Font Color'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Remove Format\n\t\tremoveformat: {\n\t\t\texec: 'removeformat',\n\t\t\ttooltip: 'Remove Formatting'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Cut\n\t\tcut: {\n\t\t\texec: 'cut',\n\t\t\ttooltip: 'Cut',\n\t\t\terrorMessage: 'Your browser does not allow the cut command. ' +\n\t\t\t\t'Please use the keyboard shortcut Ctrl/Cmd-X'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Copy\n\t\tcopy: {\n\t\t\texec: 'copy',\n\t\t\ttooltip: 'Copy',\n\t\t\terrorMessage: 'Your browser does not allow the copy command. ' +\n\t\t\t\t'Please use the keyboard shortcut Ctrl/Cmd-C'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Paste\n\t\tpaste: {\n\t\t\texec: 'paste',\n\t\t\ttooltip: 'Paste',\n\t\t\terrorMessage: 'Your browser does not allow the paste command. ' +\n\t\t\t\t'Please use the keyboard shortcut Ctrl/Cmd-V'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Paste Text\n\t\tpastetext: {\n\t\t\texec: function (caller) {\n\t\t\t\tvar val,\n\t\t\t\t\tcontent = createElement('div'),\n\t\t\t\t\teditor = this;\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('pastetext',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._(\n\t\t\t\t\t\t\t\t'Paste your text inside the following box:'\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tval = find(content, '#txt')[0].value;\n\n\t\t\t\t\t\tif (val) {\n\t\t\t\t\t\t\teditor.wysiwygEditorInsertText(val);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'pastetext', content);\n\t\t\t},\n\t\t\ttooltip: 'Paste Text'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Bullet List\n\t\tbulletlist: {\n\t\t\texec: function () {\n\t\t\t\tfixFirefoxListBug(this);\n\t\t\t\tthis.execCommand('insertunorderedlist');\n\t\t\t},\n\t\t\ttooltip: 'Bullet list'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Ordered List\n\t\torderedlist: {\n\t\t\texec: function () {\n\t\t\t\tfixFirefoxListBug(this);\n\t\t\t\tthis.execCommand('insertorderedlist');\n\t\t\t},\n\t\t\ttooltip: 'Numbered list'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Table\n\t\ttable: {\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this,\n\t\t\t\t\tcontent = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('table',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trows: editor._('Rows:'),\n\t\t\t\t\t\t\tcols: editor._('Cols:'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst rows = Number(find(content, '#rows')[0].value);\n\t\t\t\t\t\tconst cols = Number(find(content, '#cols')[0].value);\n\t\t\t\t\t\tvar html = '<table class=\"table\">';\n\n\t\t\t\t\t\tif (rows > 0 && cols > 0) {\n\t\t\t\t\t\t\thtml += Array(rows + 1).join(\n\t\t\t\t\t\t\t\t'<tr>' +\n\t\t\t\t\t\t\t\tArray(cols + 1).join(\n\t\t\t\t\t\t\t\t\t'<td class=\"border\"><br /></td>'\n\t\t\t\t\t\t\t\t) +\n\t\t\t\t\t\t\t\t'</tr>'\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\thtml += '</table>';\n\n\t\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(html);\n\t\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'inserttable', content);\n\t\t\t},\n\t\t\ttooltip: 'Insert a table'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Code\n\t\tcode: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'a',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tcallback(data(this, 'language'));\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.opts.codeLanguages.forEach(function (language) {\n\t\t\t\t\tappendChild(content,\n\t\t\t\t\t\t_tmpl('codeOpt',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlanguage: language.Value,\n\t\t\t\t\t\t\t\tlanguageName: language.Text\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttrue));\n\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'codeLanguage-picker', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.code._dropDown(editor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (codeLanguageName) {\n\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(\n\t\t\t\t\t\t\t`<pre class=\"border border-danger rounded m-2 p-2\"><code class=\"lang-${codeLanguageName}\">`,\n\t\t\t\t\t\t\t'</code></pre>'\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Code'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Note\n\t\tnote: {\n\t\t\texec: function (caller) {\n\t\t\t\tvar type,\n\t\t\t\t\tval,\n\t\t\t\t\tcontent = createElement('div'),\n\t\t\t\t\teditor = this,\n\t\t\t\t\toptions = '';\n\n\t\t\t\teditor.opts.noteTypes.split(',').forEach(function (noteType) {\n\t\t\t\t\toptions +=\n\t\t\t\t\t\t_tmpl('noteOpt',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: noteType\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfalse);\n\t\t\t\t});\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('note',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabelType: editor._(\n\t\t\t\t\t\t\t\t'Select the note type:'\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tlabelText: editor._(\n\t\t\t\t\t\t\t\t'Enter the note inside the following box:'\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tinsert: editor._('Insert'),\n\t\t\t\t\t\t\tvalues: options\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tval = find(content, '#txt')[0].value;\n\t\t\t\t\t\ttype = find(content, '#type')[0].value;\n\n\t\t\t\t\t\tif (val) {\n\t\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(\n\t\t\t\t\t\t\t\t`<div class=\"alert alert-${type}\" role=\"alert\">${val}</div>`);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'pastetext', content);\n\t\t\t},\n\t\t\ttooltip: 'Note'\n\t\t},\n\t\t// END_COMMAND\n\n\n\t\t// START_COMMAND: Code\n\t\textensions: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'a',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tcallback(data(this, 'language'));\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\tfetch(editor.opts.extensionsUrl,\n\t\t\t\t\t{\n\t\t\t\t\t\tmethod: 'GET'\n\t\t\t\t\t}).then(res => res.json()).then(data => {\n\t\t\t\t\tdata.forEach(function (extension) {\n\t\t\t\t\t\tif (!extension.useToolbar) {\n\t\t\t\t\t\t\tappendChild(content,\n\t\t\t\t\t\t\t\t_tmpl('extensionOpt',\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\textension: extension.name\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttrue));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'extensions-picker', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.extensions._dropDown(editor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (extension) {\n\n\t\t\t\t\t\teditor.wysiwygEditorInsertText(\n\t\t\t\t\t\t\t`[${extension}]`,\n\t\t\t\t\t\t\t`[/${extension}]`\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\n\t\t\t},\n\t\t\ttooltip: 'More BBCode'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Image\n\t\timage: {\n\t\t\t_dropDown: function (editor, caller, cb) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('image',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\turl: editor._('URL:'),\n\t\t\t\t\t\t\tdesc: editor._('Description (optional):'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\n\t\t\t\tvar linkInput = find(content, '#link')[0];\n\n\t\t\t\tfunction insertUrl(e) {\n\t\t\t\t\tconst desc = find(content, '#des')[0].value;\n\t\t\t\t\tif (linkInput.value) {\n\t\t\t\t\t\tcb(linkInput.value, desc);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\n\t\t\t\ton(content, 'click', '.button', insertUrl);\n\t\t\t\ton(content,\n\t\t\t\t\t'keypress',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\t// 13 = enter key\n\t\t\t\t\t\tif (e.which === 13 && linkInput.value) {\n\t\t\t\t\t\t\tinsertUrl(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tEVENT_CAPTURE);\n\n\t\t\t\teditor.createDropDown(caller, 'insertimage', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.image._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url, text) {\n\t\t\t\t\t\tvar attrs = '';\n\n\t\t\t\t\t\tif (text) {\n\t\t\t\t\t\t\tattrs += ` alt=\"${entities(text)}\"`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tattrs += ` src=\"${entities(url)}\"`;\n\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(\n\t\t\t\t\t\t\t`<img${attrs} class=\"img-user-posted img-thumbnail\" />`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\ttooltip: 'Insert an image'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: E-mail\n\t\temail: {\n\t\t\t_dropDown: function (editor, caller, cb) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('email',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._('E-mail:'),\n\t\t\t\t\t\t\tdesc: editor._('Description (optional):'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst email = find(content, '#email')[0].value;\n\n\t\t\t\t\t\tif (email) {\n\t\t\t\t\t\t\tcb(email, find(content, '#des')[0].value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'insertemail', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.email._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (email, text) {\n\t\t\t\t\t\tif (!editor.getRangeHelper().selectedHtml() || text) {\n\t\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(\n\t\t\t\t\t\t\t\t`<a href=\"mailto:${entities(email)}\">${entities((text || email))}</a>`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.execCommand('createlink', `mailto:${email}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\ttooltip: 'Insert an email'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Link\n\t\tlink: {\n\t\t\t_dropDown: function (editor, caller, cb) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('link',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\turl: editor._('URL:'),\n\t\t\t\t\t\t\tdesc: editor._('Description (optional):'),\n\t\t\t\t\t\t\tins: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\tvar linkInput = find(content, '#link')[0];\n\n\t\t\t\tfunction insertUrl(e) {\n\t\t\t\t\tif (linkInput.value) {\n\t\t\t\t\t\tcb(linkInput.value, find(content, '#des')[0].value);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\n\t\t\t\ton(content, 'click', '.button', insertUrl);\n\t\t\t\ton(content,\n\t\t\t\t\t'keypress',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\t// 13 = enter key\n\t\t\t\t\t\tif (e.which === 13 && linkInput.value) {\n\t\t\t\t\t\t\tinsertUrl(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tEVENT_CAPTURE);\n\n\t\t\t\teditor.createDropDown(caller, 'insertlink', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.link._dropDown(editor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url, text) {\n\t\t\t\t\t\tif (text || !editor.getRangeHelper().selectedHtml()) {\n\t\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(\n\t\t\t\t\t\t\t\t`<a href=\"${entities(url)}\">${entities(text || url)}</a>`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.execCommand('createlink', url);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Insert a link'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Unlink\n\t\tunlink: {\n\t\t\tstate: function () {\n\t\t\t\treturn closest(this.currentNode(), 'a') ? 0 : -1;\n\t\t\t},\n\t\t\texec: function () {\n\t\t\t\tconst anchor = closest(this.currentNode(), 'a');\n\n\t\t\t\tif (anchor) {\n\t\t\t\t\twhile (anchor.firstChild) {\n\t\t\t\t\t\tinsertBefore(anchor.firstChild, anchor);\n\t\t\t\t\t}\n\n\t\t\t\t\tremove(anchor);\n\t\t\t\t}\n\t\t\t},\n\t\t\ttooltip: 'Unlink'\n\t\t},\n\t\t// END_COMMAND\n\n\n\t\t// START_COMMAND: Quote\n\t\tquote: {\n\t\t\texec: function (caller, html, author) {\n\t\t\t\tvar before =\n\t\t\t\t\t'<div class=\"border rounded mx-3 mb-3 p-3 border-secondary shadow-sm\"><span contenteditable=\"false\"><i class=\"fa fa-quote-left text-primary fs-4 me-2\"></i></span>';\n\t\t\t\tvar end = '</div>';\n\n\t\t\t\t// if there is HTML passed set end to null so any selected\n\t\t\t\t// text is replaced\n\t\t\t\tif (html) {\n\t\t\t\t\tauthor = (author\n\t\t\t\t\t\t? `<cite class=\"card-text text-end d-block text-body-secondary small\">${\n\t\t\t\t\t\tentities(author)}</cite>`\n\t\t\t\t\t\t: '');\n\t\t\t\t\tbefore = before + html + author + end;\n\t\t\t\t\tend = null;\n\t\t\t\t\t// if not add a newline to the end of the inserted quote\n\t\t\t\t} else if (this.getRangeHelper().selectedHtml() === '') ;\n\n\t\t\t\tthis.wysiwygEditorInsertHtml(before, end);\n\t\t\t},\n\t\t\ttooltip: 'Insert a Quote'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: media\n\t\tmedia: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('mediaMenu',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._('Media URL:'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst url = find(content, '#link')[0].value;\n\n\t\t\t\t\t\tif (!url.startsWith('http')) {\n\t\t\t\t\t\t\talert('Not a valid URL!');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcallback(url);\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'insertmedia', content);\n\t\t\t},\n\t\t\texec: function (btn) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.media._dropDown(editor,\n\t\t\t\t\tbtn,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(`[media]${url}[/media]`);\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Insert an embed media like a YouTube video, facebook post or twitter status.'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: vimeo\n\t\tvimeo: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('youtubeMenu',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._('Video URL:'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst url = find(content, '#link')[0].value;\n\n\t\t\t\t\t\tif (url !== '') {\n\t\t\t\t\t\t\tconst matches = url.match(/vimeo\\..*\\/(\\d+)(?:$|\\/)/);\n\n\t\t\t\t\t\t\tcallback(url, matches[1]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'insertlink', content);\n\t\t\t},\n\t\t\texec: function (btn) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.vimeo._dropDown(editor,\n\t\t\t\t\tbtn,\n\t\t\t\t\tfunction (url, id) {\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(_tmpl('vimeo',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\tvimeoId: id\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Insert a Vimeo video'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: instagram\n\t\tinstagram: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('instagramMenu',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._('Instagram Post URL:'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst url = find(content, '#link')[0].value;\n\t\t\t\t\t\tvar id = '';\n\n\t\t\t\t\t\tif (url !== '') {\n\t\t\t\t\t\t\tconst matches = url.match(/\\/(p|tv|reel)\\/(.*?)\\//);\n\n\t\t\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t\t\tid = matches[2];\n\t\t\t\t\t\t\t\tcallback(url, id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'insertlink', content);\n\t\t\t},\n\t\t\texec: function (btn) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.instagram._dropDown(editor,\n\t\t\t\t\tbtn,\n\t\t\t\t\tfunction (url, id) {\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(_tmpl('instagram',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\tid: id\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Insert an Instagram Post'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: facebook\n\t\tfacebook: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('facebookMenu',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._('Facebook post URL:'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst url = find(content, '#link')[0].value;\n\n\t\t\t\t\t\tcallback(url);\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'insertlink', content);\n\t\t\t},\n\t\t\texec: function (btn) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.facebook._dropDown(editor,\n\t\t\t\t\tbtn,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(_tmpl('facebook',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\turl: url\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Insert an Facebook Post'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: youtube\n\t\tyoutube: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('youtubeMenu',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._('Video URL:'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst url = find(content, '#link')[0].value;\n\t\t\t\t\t\tconst idMatch = url.match(/(?:v=|v\\/|embed\\/|youtu.be\\/)?([a-zA-Z0-9_-]{11})/);\n\n\n\t\t\t\t\t\tif (idMatch && /^[a-zA-Z0-9_\\-]{11}$/.test(idMatch[1])) {\n\t\t\t\t\t\t\tcallback(url, idMatch[1]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'insertlink', content);\n\t\t\t},\n\t\t\texec: function (btn) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.youtube._dropDown(editor,\n\t\t\t\t\tbtn,\n\t\t\t\t\tfunction (url, id) {\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(_tmpl('youtube',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\tid: id\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Insert a YouTube video'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Date\n\t\tdate: {\n\t\t\t_date: function (editor) {\n\t\t\t\tconst now = new Date();\n\t\t\t\tvar year = now.getYear(),\n\t\t\t\t\tmonth = now.getMonth() + 1,\n\t\t\t\t\tday = now.getDate();\n\n\t\t\t\tif (year < 2000) {\n\t\t\t\t\tyear = 1900 + year;\n\t\t\t\t}\n\n\t\t\t\tif (month < 10) {\n\t\t\t\t\tmonth = `0${month}`;\n\t\t\t\t}\n\n\t\t\t\tif (day < 10) {\n\t\t\t\t\tday = `0${day}`;\n\t\t\t\t}\n\n\t\t\t\treturn editor.opts.dateFormat\n\t\t\t\t\t.replace(/year/i, year)\n\t\t\t\t\t.replace(/month/i, month)\n\t\t\t\t\t.replace(/day/i, day);\n\t\t\t},\n\t\t\texec: function () {\n\t\t\t\tthis.insertText(defaultCmds.date._date(this));\n\t\t\t},\n\t\t\ttxtExec: function () {\n\t\t\t\tthis.insertText(defaultCmds.date._date(this));\n\t\t\t},\n\t\t\ttooltip: 'Insert current date'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Time\n\t\ttime: {\n\t\t\t_time: function () {\n\t\t\t\tconst now = new Date();\n\t\t\t\tvar hours = now.getHours(),\n\t\t\t\t\tmins = now.getMinutes(),\n\t\t\t\t\tsecs = now.getSeconds();\n\n\t\t\t\tif (hours < 10) {\n\t\t\t\t\thours = `0${hours}`;\n\t\t\t\t}\n\n\t\t\t\tif (mins < 10) {\n\t\t\t\t\tmins = `0${mins}`;\n\t\t\t\t}\n\n\t\t\t\tif (secs < 10) {\n\t\t\t\t\tsecs = `0${secs}`;\n\t\t\t\t}\n\n\t\t\t\treturn hours + ':' + mins + ':' + secs;\n\t\t\t},\n\t\t\texec: function () {\n\t\t\t\tthis.insertText(defaultCmds.time._time());\n\t\t\t},\n\t\t\ttxtExec: function () {\n\t\t\t\tthis.insertText(defaultCmds.time._time());\n\t\t\t},\n\t\t\ttooltip: 'Insert current time'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Undo\n\t\tundo: {\n\t\t\texec: 'undo',\n\t\t\ttooltip: 'Undo',\n\t\t\tshortcut: 'Ctrl+Z'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Redo\n\t\tredo: {\n\t\t\texec: 'redo',\n\t\t\ttooltip: 'Redo',\n\t\t\tshortcut: 'Ctrl+Y'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Maximize\n\t\tmaximize: {\n\t\t\tstate: function () {\n\t\t\t\treturn this.maximize();\n\t\t\t},\n\t\t\texec: function () {\n\t\t\t\tthis.maximize(!this.maximize());\n\t\t\t\tthis.focus();\n\t\t\t},\n\t\t\ttxtExec: function () {\n\t\t\t\tthis.maximize(!this.maximize());\n\t\t\t\tthis.focus();\n\t\t\t},\n\t\t\ttooltip: 'Maximize',\n\t\t\tshortcut: 'Ctrl+Shift+M'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Source\n\t\tsource: {\n\t\t\tstate: function () {\n\t\t\t\treturn this.sourceMode();\n\t\t\t},\n\t\t\texec: function () {\n\t\t\t\tthis.toggleSourceMode();\n\t\t\t\tthis.focus();\n\t\t\t},\n\t\t\ttxtExec: function () {\n\t\t\t\tthis.toggleSourceMode();\n\t\t\t\tthis.focus();\n\t\t\t},\n\t\t\ttooltip: 'View source',\n\t\t\tshortcut: 'Ctrl+Shift+S'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Reply\n\t\treply: {\n\t\t\texec: function () {\n\t\t\t\tif (document.getElementById('QuickReplyDialog') !== null) {\n\t\t\t\t\tdocument.querySelector('[data-bs-save*=\"modal\"]').click();\n\t\t\t\t} else if (document.querySelector('[formaction*=\"PostReply\"]') !== null) {\n\t\t\t\t\tdocument.querySelector('[formaction*=\"PostReply\"]').click();\n\t\t\t\t} else if (document.querySelector('[id*=\"QuickReply\"]') !== null) {\n\t\t\t\t\tdocument.querySelector('[id*=\"QuickReply\"]').click();\n\t\t\t\t} else if (document.querySelector('[id*=\"PostReply\"]') !== null) {\n\t\t\t\t\twindow.location.href = document.querySelector('[id*=\"PostReply\"]').href;\n\t\t\t\t}\n\t\t\t},\n\t\t\ttooltip: 'Post Reply',\n\t\t\tshortcut: 'Ctrl+Enter'\n\t\t},\n\t\t// END_COMMAND\n\n\n\t\t// this is here so that commands above can be removed\n\t\t// without having to remove the , after the last one.\n\t\t// Needed for IE.\n\t\tignore: {}\n\t};\n\n\tvar plugins = {};\n\n\t/**\n\t * Plugin Manager class\n\t * @class PluginManager\n\t * @name PluginManager\n\t */\n\tfunction PluginManager(thisObj) {\n\t\t/**\n\t\t * Alias of this\n\t\t *\n\t\t * @private\n\t\t * @type {Object}\n\t\t */\n\t\tvar base = this;\n\n\t\t/**\n\t\t * Array of all currently registered plugins\n\t\t *\n\t\t * @type {Array}\n\t\t * @private\n\t\t */\n\t\tvar registeredPlugins = [];\n\n\n\t\t/**\n\t\t * Changes a signals name from \"name\" into \"signalName\".\n\t\t *\n\t\t * @param  {string} signal\n\t\t * @return {string}\n\t\t * @private\n\t\t */\n\t\tvar formatSignalName = function (signal) {\n\t\t\treturn `signal${signal.charAt(0).toUpperCase()}${signal.slice(1)}`;\n\t\t};\n\n\t\t/**\n\t\t * Calls handlers for a signal\n\t\t *\n\t\t * @see call()\n\t\t * @see callOnlyFirst()\n\t\t * @param  {Array}   args\n\t\t * @param  {boolean} returnAtFirst\n\t\t * @return {*}\n\t\t * @private\n\t\t */\n\t\tvar callHandlers = function (args, returnAtFirst) {\n\t\t\targs = [].slice.call(args);\n\n\t\t\tvar\tidx, ret;\n\t\t\tconst signal = formatSignalName(args.shift());\n\n\t\t\tfor (idx = 0; idx < registeredPlugins.length; idx++) {\n\t\t\t\tif (signal in registeredPlugins[idx]) {\n\t\t\t\t\tret = registeredPlugins[idx][signal].apply(thisObj, args);\n\n\t\t\t\t\tif (returnAtFirst) {\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Calls all handlers for the passed signal\n\t\t *\n\t\t * @param  {string}    signal\n\t\t * @param  {...string} args\n\t\t * @function\n\t\t * @name call\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.call = function () {\n\t\t\tcallHandlers(arguments, false);\n\t\t};\n\n\t\t/**\n\t\t * Calls the first handler for a signal, and returns the\n\t\t *\n\t\t * @param  {string}    signal\n\t\t * @param  {...string} args\n\t\t * @return {*} The result of calling the handler\n\t\t * @function\n\t\t * @name callOnlyFirst\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.callOnlyFirst = function () {\n\t\t\treturn callHandlers(arguments, true);\n\t\t};\n\n\t\t/**\n\t\t * Checks if a signal has a handler\n\t\t *\n\t\t * @param  {string} signal\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name hasHandler\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.hasHandler = function (signal) {\n\t\t\tvar i  = registeredPlugins.length;\n\t\t\tsignal = formatSignalName(signal);\n\n\t\t\twhile (i--) {\n\t\t\t\tif (signal in registeredPlugins[i]) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Checks if the plugin exists in plugins\n\t\t *\n\t\t * @param  {string} plugin\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name exists\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.exists = function (plugin) {\n\t\t\tif (plugin in plugins) {\n\t\t\t\tplugin = plugins[plugin];\n\n\t\t\t\treturn typeof plugin === 'function' &&\n\t\t\t\t\ttypeof plugin.prototype === 'object';\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Checks if the passed plugin is currently registered.\n\t\t *\n\t\t * @param  {string} plugin\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name isRegistered\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.isRegistered = function (plugin) {\n\t\t\tif (base.exists(plugin)) {\n\t\t\t\tlet idx = registeredPlugins.length;\n\n\t\t\t\twhile (idx--) {\n\t\t\t\t\tif (registeredPlugins[idx] instanceof plugins[plugin]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Registers a plugin to receive signals\n\t\t *\n\t\t * @param  {string} plugin\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name register\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.register = function (plugin) {\n\t\t\tif (!base.exists(plugin) || base.isRegistered(plugin)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tplugin = new plugins[plugin]();\n\t\t\tregisteredPlugins.push(plugin);\n\n\t\t\tif ('init' in plugin) {\n\t\t\t\tplugin.init.call(thisObj);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * Deregisters a plugin.\n\t\t *\n\t\t * @param  {string} plugin\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name deregister\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.deregister = function (plugin) {\n\t\t\tvar\tremovedPlugin,\n\t\t\t\tpluginIdx = registeredPlugins.length,\n\t\t\t\tremoved   = false;\n\n\t\t\tif (!base.isRegistered(plugin)) {\n\t\t\t\treturn removed;\n\t\t\t}\n\n\t\t\twhile (pluginIdx--) {\n\t\t\t\tif (registeredPlugins[pluginIdx] instanceof plugins[plugin]) {\n\t\t\t\t\tremovedPlugin = registeredPlugins.splice(pluginIdx, 1)[0];\n\t\t\t\t\tremoved       = true;\n\n\t\t\t\t\tif ('destroy' in removedPlugin) {\n\t\t\t\t\t\tremovedPlugin.destroy.call(thisObj);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn removed;\n\t\t};\n\n\t\t/**\n\t\t * Clears all plugins and removes the owner reference.\n\t\t *\n\t\t * Calling any functions on this object after calling\n\t\t * destroy will cause a JS error.\n\t\t *\n\t\t * @name destroy\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.destroy = function () {\n\t\t\tvar i = registeredPlugins.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tif ('destroy' in registeredPlugins[i]) {\n\t\t\t\t\tregisteredPlugins[i].destroy.call(thisObj);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tregisteredPlugins = [];\n\t\t\tthisObj    = null;\n\t\t};\n\t}\n\tPluginManager.plugins = plugins;\n\n\t/**\n\t * Gets the text, start/end node and offset for\n\t * length chars left or right of the passed node\n\t * at the specified offset.\n\t *\n\t * @param  {Node}  node\n\t * @param  {number}  offset\n\t * @param  {boolean} isLeft\n\t * @param  {number}  length\n\t * @return {Object}\n\t * @private\n\t */\n\tvar outerText = function (range, isLeft, length) {\n\t\tvar nodeValue, remaining, start, end, node,\n\t\t\ttext = '',\n\t\t\tnext = range.startContainer,\n\t\t\toffset = range.startOffset;\n\n\t\t// Handle cases where node is a paragraph and offset\n\t\t// refers to the index of a text node.\n\t\t// 3 = text node\n\t\tif (next && next.nodeType !== 3) {\n\t\t\tnext = next.childNodes[offset];\n\t\t\toffset = 0;\n\t\t}\n\n\t\tstart = end = offset;\n\n\t\twhile (length > text.length && next && next.nodeType === 3) {\n\t\t\tnodeValue = next.nodeValue;\n\t\t\tremaining = length - text.length;\n\n\t\t\t// If not the first node, start and end should be at their\n\t\t\t// max values as will be updated when getting the text\n\t\t\tif (node) {\n\t\t\t\tend = nodeValue.length;\n\t\t\t\tstart = 0;\n\t\t\t}\n\n\t\t\tnode = next;\n\n\t\t\tif (isLeft) {\n\t\t\t\tstart = Math.max(end - remaining, 0);\n\t\t\t\toffset = start;\n\n\t\t\t\ttext = nodeValue.substr(start, end - start) + text;\n\t\t\t\tnext = node.previousSibling;\n\t\t\t} else {\n\t\t\t\tend = Math.min(remaining, nodeValue.length);\n\t\t\t\toffset = start + end;\n\n\t\t\t\ttext += nodeValue.substr(start, end);\n\t\t\t\tnext = node.nextSibling;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tnode: node || next,\n\t\t\toffset: offset,\n\t\t\ttext: text\n\t\t};\n\t};\n\n\t/**\n\t * Range helper\n\t *\n\t * @class RangeHelper\n\t * @name RangeHelper\n\t */\n\tfunction RangeHelper(win, d, sanitize) {\n\t\tvar\t_createMarker, _prepareInput,\n\t\t\tdoc          = d || win.contentDocument || win.document,\n\t\t\tstartMarker  = 'sceditor-start-marker',\n\t\t\tendMarker    = 'sceditor-end-marker',\n\t\t\tbase         = this;\n\n\t\t/**\n\t\t * Inserts HTML into the current range replacing any selected\n\t\t * text.\n\t\t *\n\t\t * If endHTML is specified the selected contents will be put between\n\t\t * html and endHTML. If there is nothing selected html and endHTML are\n\t\t * just concatenate together.\n\t\t *\n\t\t * @param {string} html\n\t\t * @param {string} [endHTML]\n\t\t * @return False on fail\n\t\t * @function\n\t\t * @name insertHTML\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.insertHTML = function (html, endHTML) {\n\t\t\tconst range = base.selectedRange();\n\n\t\t\tif (!range) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (endHTML) {\n\t\t\t\thtml += base.selectedHtml() + endHTML;\n\t\t\t}\n\n\t\t\tconst div = createElement('p', {}, doc);\n\t\t\tconst node = doc.createDocumentFragment();\n\t\t\tdiv.innerHTML = sanitize(html);\n\n\t\t\twhile (div.firstChild) {\n\t\t\t\tappendChild(node, div.firstChild);\n\t\t\t}\n\n\t\t\tbase.insertNode(node);\n\t\t};\n\n\t\t/**\n\t\t * Prepares HTML to be inserted by adding a zero width space\n\t\t * if the last child is empty and adding the range start/end\n\t\t * markers to the last child.\n\t\t *\n\t\t * @param  {Node|string} node\n\t\t * @param  {Node|string} [endNode]\n\t\t * @param  {boolean} [returnHtml]\n\t\t * @return {Node|string}\n\t\t * @private\n\t\t */\n\t\t_prepareInput = function (node, endNode, returnHtml) {\n\t\t\tvar lastChild,\n\t\t\t\tfrag = doc.createDocumentFragment();\n\n\t\t\tif (typeof node === 'string') {\n\t\t\t\tif (endNode) {\n\t\t\t\t\tnode += base.selectedHtml() + endNode;\n\t\t\t\t}\n\n\t\t\t\tfrag = parseHTML(node);\n\t\t\t} else {\n\t\t\t\tappendChild(frag, node);\n\n\t\t\t\tif (endNode) {\n\t\t\t\t\tappendChild(frag, base.selectedRange().extractContents());\n\t\t\t\t\tappendChild(frag, endNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!(lastChild = frag.lastChild)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twhile (!isInline(lastChild.lastChild, true)) {\n\t\t\t\tlastChild = lastChild.lastChild;\n\t\t\t}\n\n\t\t\tif (canHaveChildren(lastChild)) {\n\t\t\t\t// Webkit won't allow the cursor to be placed inside an\n\t\t\t\t// empty tag, so add a zero width space to it.\n\t\t\t\tif (!lastChild.lastChild) {\n\t\t\t\t\tappendChild(lastChild, document.createTextNode('\\u200B'));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlastChild = frag;\n\t\t\t}\n\n\t\t\tbase.removeMarkers();\n\n\t\t\t// Append marks to last child so when restored cursor will be in\n\t\t\t// the right place\n\t\t\tappendChild(lastChild, _createMarker(startMarker));\n\t\t\tappendChild(lastChild, _createMarker(endMarker));\n\n\t\t\tif (returnHtml) {\n\t\t\t\tconst div = createElement('div');\n\t\t\t\tappendChild(div, frag);\n\n\t\t\t\treturn div.innerHTML;\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t};\n\n\t\t/**\n\t\t * The same as insertHTML except with DOM nodes instead\n\t\t *\n\t\t * <strong>Warning:</strong> the nodes must belong to the\n\t\t * document they are being inserted into. Some browsers\n\t\t * will throw exceptions if they don't.\n\t\t *\n\t\t * Returns boolean false on fail\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} endNode\n\t\t * @return {false|undefined}\n\t\t * @function\n\t\t * @name insertNode\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.insertNode = function (node, endNode) {\n\t\t\tvar\tfirst, last;\n\t\t\tconst input = _prepareInput(node, endNode);\n\t\t\tconst range = base.selectedRange();\n\t\t\tconst parent = range.commonAncestorContainer;\n\t\t\tvar emptyNodes = [];\n\n\t\t\tif (!input) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfunction removeIfEmpty(node) {\n\t\t\t\t// Only remove empty node if it wasn't already empty\n\t\t\t\tif (node && isEmpty(node) && emptyNodes.indexOf(node) < 0) {\n\t\t\t\t\tremove(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (range.startContainer !== range.endContainer) {\n\t\t\t\teach(parent.childNodes, function (_, node) {\n\t\t\t\t\tif (isEmpty(node)) {\n\t\t\t\t\t\temptyNodes.push(node);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfirst = input.firstChild;\n\t\t\t\tlast = input.lastChild;\n\t\t\t}\n\n\t\t\trange.deleteContents();\n\n\t\t\t// FF allows <br /> to be selected but inserting a node\n\t\t\t// into <br /> will cause it not to be displayed so must\n\t\t\t// insert before the <br /> in FF.\n\t\t\t// 3 = TextNode\n\t\t\tif (parent && parent.nodeType !== 3 && !canHaveChildren(parent)) {\n\t\t\t\tinsertBefore(input, parent);\n\t\t\t} else {\n\t\t\t\trange.insertNode(input);\n\n\t\t\t\t// If a node was split or its contents deleted, remove any resulting\n\t\t\t\t// empty tags. For example:\n\t\t\t\t// <p>|test</p><div>test|</div>\n\t\t\t\t// When deleteContents could become:\n\t\t\t\t// <p></p>|<div></div>\n\t\t\t\t// So remove the empty ones\n\t\t\t\tremoveIfEmpty(first && first.previousSibling);\n\t\t\t\tremoveIfEmpty(last && last.nextSibling);\n\t\t\t}\n\n\t\t\tbase.restoreRange();\n\t\t};\n\n\t\t/**\n\t\t * Clones the selected Range\n\t\t *\n\t\t * @return {Range}\n\t\t * @function\n\t\t * @name cloneSelected\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.cloneSelected = function () {\n\t\t\tconst range = base.selectedRange();\n\n\t\t\tif (range) {\n\t\t\t\treturn range.cloneRange();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Gets the selected Range\n\t\t *\n\t\t * @return {Range}\n\t\t * @function\n\t\t * @name selectedRange\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.selectedRange = function () {\n\t\t\tvar\trange, firstChild;\n\t\t\tconst sel = win.getSelection();\n\n\t\t\tif (!sel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// When creating a new range, set the start to the first child\n\t\t\t// element of the body element to avoid errors in FF.\n\t\t\tif (sel.rangeCount <= 0) {\n\t\t\t\tfirstChild = doc.body;\n\t\t\t\twhile (firstChild.firstChild) {\n\t\t\t\t\tfirstChild = firstChild.firstChild;\n\t\t\t\t}\n\n\t\t\t\trange = doc.createRange();\n\t\t\t\t// Must be setStartBefore otherwise it can cause infinite\n\t\t\t\t// loops with lists in WebKit. See issue 442\n\t\t\t\trange.setStartBefore(firstChild);\n\n\t\t\t\tsel.addRange(range);\n\t\t\t}\n\n\t\t\tif (sel.rangeCount > 0) {\n\t\t\t\trange = sel.getRangeAt(0);\n\t\t\t}\n\n\t\t\treturn range;\n\t\t};\n\n\t\t/**\n\t\t * Gets if there is currently a selection\n\t\t *\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name hasSelection\n\t\t * @since 1.4.4\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.hasSelection = function () {\n\t\t\tconst sel = win.getSelection();\n\n\t\t\treturn sel && sel.rangeCount > 0;\n\t\t};\n\n\t\t/**\n\t\t * Gets the currently selected HTML\n\t\t *\n\t\t * @return {string}\n\t\t * @function\n\t\t * @name selectedHtml\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.selectedHtml = function () {\n\t\t\tvar\tdiv;\n\t\t\tconst range = base.selectedRange();\n\n\t\t\tif (range) {\n\t\t\t\tdiv = createElement('p', {}, doc);\n\t\t\t\tappendChild(div, range.cloneContents());\n\n\t\t\t\treturn div.innerHTML;\n\t\t\t}\n\n\t\t\treturn '';\n\t\t};\n\n\t\t/**\n\t\t * Gets the parent node of the selected contents in the range\n\t\t *\n\t\t * @return {HTMLElement}\n\t\t * @function\n\t\t * @name parentNode\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.parentNode = function () {\n\t\t\tconst range = base.selectedRange();\n\n\t\t\tif (range) {\n\t\t\t\treturn range.commonAncestorContainer;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Gets the first block level parent of the selected\n\t\t * contents of the range.\n\t\t *\n\t\t * @return {HTMLElement}\n\t\t * @function\n\t\t * @name getFirstBlockParent\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\t/**\n\t\t * Gets the first block level parent of the selected\n\t\t * contents of the range.\n\t\t *\n\t\t * @param {Node} [n] The element to get the first block level parent from\n\t\t * @return {HTMLElement}\n\t\t * @function\n\t\t * @name getFirstBlockParent^2\n\t\t * @since 1.4.1\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.getFirstBlockParent = function (node) {\n\t\t\tvar func = function (elm) {\n\t\t\t\tif (!isInline(elm, true)) {\n\t\t\t\t\treturn elm;\n\t\t\t\t}\n\n\t\t\t\telm = elm ? elm.parentNode : null;\n\n\t\t\t\treturn elm ? func(elm) : elm;\n\t\t\t};\n\n\t\t\treturn func(node || base.parentNode());\n\t\t};\n\n\t\t/**\n\t\t * Inserts a node at either the start or end of the current selection\n\t\t *\n\t\t * @param {Bool} start\n\t\t * @param {Node} node\n\t\t * @function\n\t\t * @name insertNodeAt\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.insertNodeAt = function (start, node) {\n\t\t\tconst currentRange = base.selectedRange();\n\t\t\tconst range = base.cloneSelected();\n\n\t\t\tif (!range) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\trange.collapse(start);\n\t\t\trange.insertNode(node);\n\n\t\t\t// Reselect the current range.\n\t\t\t// Fixes issue with Chrome losing the selection. Issue#82\n\t\t\tbase.selectRange(currentRange);\n\t\t};\n\n\t\t/**\n\t\t * Creates a marker node\n\t\t *\n\t\t * @param {string} id\n\t\t * @return {HTMLSpanElement}\n\t\t * @private\n\t\t */\n\t\t_createMarker = function (id) {\n\t\t\tbase.removeMarker(id);\n\n\t\t\tconst marker = createElement('span', {\n\t\t\t\tid: id,\n\t\t\t\tclassName: 'sceditor-selection sceditor-ignore',\n\t\t\t\tstyle: 'display:none;line-height:0'\n\t\t\t}, doc);\n\n\t\t\tmarker.innerHTML = ' ';\n\n\t\t\treturn marker;\n\t\t};\n\n\t\t/**\n\t\t * Inserts start/end markers for the current selection\n\t\t * which can be used by restoreRange to re-select the\n\t\t * range.\n\t\t *\n\t\t * @memberOf RangeHelper.prototype\n\t\t * @function\n\t\t * @name insertMarkers\n\t\t */\n\t\tbase.insertMarkers = function () {\n\t\t\tconst currentRange = base.selectedRange();\n\t\t\tconst startNode = _createMarker(startMarker);\n\n\t\t\tbase.removeMarkers();\n\t\t\tbase.insertNodeAt(true, startNode);\n\n\t\t\t// Fixes issue with end marker sometimes being placed before\n\t\t\t// the start marker when the range is collapsed.\n\t\t\tif (currentRange && currentRange.collapsed) {\n\t\t\t\tstartNode.parentNode.insertBefore(\n\t\t\t\t\t_createMarker(endMarker), startNode.nextSibling);\n\t\t\t} else {\n\t\t\t\tbase.insertNodeAt(false, _createMarker(endMarker));\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Gets the marker with the specified ID\n\t\t *\n\t\t * @param {string} id\n\t\t * @return {Node}\n\t\t * @function\n\t\t * @name getMarker\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.getMarker = function (id) {\n\t\t\treturn doc.getElementById(id);\n\t\t};\n\n\t\t/**\n\t\t * Removes the marker with the specified ID\n\t\t *\n\t\t * @param {string} id\n\t\t * @function\n\t\t * @name removeMarker\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.removeMarker = function (id) {\n\t\t\tconst marker = base.getMarker(id);\n\n\t\t\tif (marker) {\n\t\t\t\tremove(marker);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Removes the start/end markers\n\t\t *\n\t\t * @function\n\t\t * @name removeMarkers\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.removeMarkers = function () {\n\t\t\tbase.removeMarker(startMarker);\n\t\t\tbase.removeMarker(endMarker);\n\t\t};\n\n\t\t/**\n\t\t * Saves the current range location. Alias of insertMarkers()\n\t\t *\n\t\t * @function\n\t\t * @name saveRage\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.saveRange = function () {\n\t\t\tbase.insertMarkers();\n\t\t};\n\n\t\t/**\n\t\t * Select the specified range\n\t\t *\n\t\t * @param {Range} range\n\t\t * @function\n\t\t * @name selectRange\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.selectRange = function (range) {\n\t\t\tvar lastChild;\n\t\t\tconst sel = win.getSelection();\n\t\t\tconst container = range.endContainer;\n\n\t\t\t// Check if cursor is set after a BR when the BR is the only\n\t\t\t// child of the parent. In Firefox this causes a line break\n\t\t\t// to occur when something is typed. See issue #321\n\t\t\tif (range.collapsed && container &&\n\t\t\t\t!isInline(container, true)) {\n\n\t\t\t\tlastChild = container.lastChild;\n\t\t\t\twhile (lastChild && is(lastChild, '.sceditor-ignore')) {\n\t\t\t\t\tlastChild = lastChild.previousSibling;\n\t\t\t\t}\n\n\t\t\t\tif (is(lastChild, 'br')) {\n\t\t\t\t\tconst rng = doc.createRange();\n\t\t\t\t\trng.setEndAfter(lastChild);\n\t\t\t\t\trng.collapse(false);\n\n\t\t\t\t\tif (base.compare(range, rng)) {\n\t\t\t\t\t\trange.setStartBefore(lastChild);\n\t\t\t\t\t\trange.collapse(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (sel) {\n\t\t\t\tbase.clear();\n\t\t\t\tsel.addRange(range);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Restores the last range saved by saveRange() or insertMarkers()\n\t\t *\n\t\t * @function\n\t\t * @name restoreRange\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.restoreRange = function () {\n\t\t\tvar\tisCollapsed,\n\t\t\t\trange = base.selectedRange();\n\t\t\tconst start = base.getMarker(startMarker);\n\t\t\tconst end = base.getMarker(endMarker);\n\n\t\t\tif (!start || !end || !range) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tisCollapsed = start.nextSibling === end;\n\n\t\t\trange = doc.createRange();\n\t\t\trange.setStartBefore(start);\n\t\t\trange.setEndAfter(end);\n\n\t\t\tif (isCollapsed) {\n\t\t\t\trange.collapse(true);\n\t\t\t}\n\n\t\t\tbase.selectRange(range);\n\t\t\tbase.removeMarkers();\n\t\t};\n\n\t\t/**\n\t\t * Selects the text left and right of the current selection\n\t\t *\n\t\t * @param {number} left\n\t\t * @param {number} right\n\t\t * @since 1.4.3\n\t\t * @function\n\t\t * @name selectOuterText\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.selectOuterText = function (left, right) {\n\t\t\tvar start, end;\n\t\t\tconst range = base.cloneSelected();\n\n\t\t\tif (!range) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\trange.collapse(false);\n\n\t\t\tstart = outerText(range, true, left);\n\t\t\tend = outerText(range, false, right);\n\n\t\t\trange.setStart(start.node, start.offset);\n\t\t\trange.setEnd(end.node, end.offset);\n\n\t\t\tbase.selectRange(range);\n\t\t};\n\n\t\t/**\n\t\t * Gets the text left or right of the current selection\n\t\t *\n\t\t * @param {boolean} before\n\t\t * @param {number} length\n\t\t * @return {string}\n\t\t * @since 1.4.3\n\t\t * @function\n\t\t * @name selectOuterText\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.getOuterText = function (before, length) {\n\t\t\tconst range = base.cloneSelected();\n\n\t\t\tif (!range) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\trange.collapse(!before);\n\n\t\t\treturn outerText(range, before, length).text;\n\t\t};\n\n\t\t/**\n\t\t * Replaces keywords with values based on the current caret position\n\t\t *\n\t\t * @param {Array}   keywords\n\t\t * @param {boolean} includeAfter      If to include the text after the\n\t\t *                                    current caret position or just\n\t\t *                                    text before\n\t\t * @param {boolean} keywordsSorted    If the keywords array is pre\n\t\t *                                    sorted shortest to longest\n\t\t * @param {number}  longestKeyword    Length of the longest keyword\n\t\t * @param {boolean} requireWhitespace If the key must be surrounded\n\t\t *                                    by whitespace\n\t\t * @param {string}  keypressChar      If this is being called from\n\t\t *                                    a keypress event, this should be\n\t\t *                                    set to the pressed character\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name replaceKeyword\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\t// eslint-disable-next-line max-params\n\t\tbase.replaceKeyword = function (\n\t\t\tkeywords,\n\t\t\tincludeAfter,\n\t\t\tkeywordsSorted,\n\t\t\tlongestKeyword,\n\t\t\trequireWhitespace,\n\t\t\tkeypressChar\n\t\t) {\n\t\t\tif (!keywordsSorted) {\n\t\t\t\tkeywords.sort(function (a, b) {\n\t\t\t\t\treturn a[0].length - b[0].length;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar outerText, match, matchPos, startIndex,\n\t\t\t\tleftLen, charsLeft, keyword, keywordLen;\n\t\t\tconst whitespaceRegex = '(^|[\\\\s\\xA0\\u2002\\u2003\\u2009])';\n\t\t\tvar keywordIdx      = keywords.length;\n\t\t\tconst whitespaceLen = requireWhitespace ? 1 : 0;\n\t\t\tvar maxKeyLen       = longestKeyword ||\n\t            keywords[keywordIdx - 1][0].length;\n\n\t\t\tif (requireWhitespace) {\n\t\t\t\tmaxKeyLen++;\n\t\t\t}\n\n\t\t\tkeypressChar = keypressChar || '';\n\t\t\touterText    = base.getOuterText(true, maxKeyLen);\n\t\t\tleftLen      = outerText.length;\n\t\t\touterText   += keypressChar;\n\n\t\t\tif (includeAfter) {\n\t\t\t\touterText += base.getOuterText(false, maxKeyLen);\n\t\t\t}\n\n\t\t\twhile (keywordIdx--) {\n\t\t\t\tkeyword    = keywords[keywordIdx][0];\n\t\t\t\tkeywordLen = keyword.length;\n\t\t\t\tstartIndex = Math.max(0, leftLen - keywordLen - whitespaceLen);\n\t\t\t\tmatchPos   = -1;\n\n\t\t\t\tif (requireWhitespace) {\n\t\t\t\t\tmatch = outerText\n\t\t\t\t\t\t.substr(startIndex)\n\t\t\t\t\t\t.match(new RegExp(whitespaceRegex +\n\t\t\t\t\t\t\tregex(keyword) + whitespaceRegex));\n\n\t\t\t\t\tif (match) {\n\t\t\t\t\t\t// Add the length of the text that was removed by\n\t\t\t\t\t\t// substr() and also add 1 for the whitespace\n\t\t\t\t\t\tmatchPos = match.index + startIndex + match[1].length;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tmatchPos = outerText.indexOf(keyword, startIndex);\n\t\t\t\t}\n\n\t\t\t\tif (matchPos > -1) {\n\t\t\t\t\t// Make sure the match is between before and\n\t\t\t\t\t// after, not just entirely in one side or the other\n\t\t\t\t\tif (matchPos <= leftLen &&\n\t\t\t\t\t\tmatchPos + keywordLen + whitespaceLen >= leftLen) {\n\t\t\t\t\t\tcharsLeft = leftLen - matchPos;\n\n\t\t\t\t\t\t// If the keypress char is white space then it should\n\t\t\t\t\t\t// not be replaced, only chars that are part of the\n\t\t\t\t\t\t// key should be replaced.\n\t\t\t\t\t\tbase.selectOuterText(\n\t\t\t\t\t\t\tcharsLeft,\n\t\t\t\t\t\t\tkeywordLen - charsLeft -\n\t\t\t\t\t\t\t\t(/^\\S/.test(keypressChar) ? 1 : 0)\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tbase.insertHTML(keywords[keywordIdx][1]);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Compares two ranges.\n\t\t *\n\t\t * If rangeB is undefined it will be set to\n\t\t * the current selected range\n\t\t *\n\t\t * @param  {Range} rngA\n\t\t * @param  {Range} [rngB]\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name compare\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.compare = function (rngA, rngB) {\n\t\t\tif (!rngB) {\n\t\t\t\trngB = base.selectedRange();\n\t\t\t}\n\n\t\t\tif (!rngA || !rngB) {\n\t\t\t\treturn !rngA && !rngB;\n\t\t\t}\n\n\t\t\treturn rngA.compareBoundaryPoints(Range.END_TO_END, rngB) === 0 &&\n\t\t\t\trngA.compareBoundaryPoints(Range.START_TO_START, rngB) === 0;\n\t\t};\n\n\t\t/**\n\t\t * Removes any current selection\n\t\t *\n\t\t * @since 1.4.6\n\t\t * @function\n\t\t * @name clear\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.clear = function () {\n\t\t\tconst sel = win.getSelection();\n\n\t\t\tif (sel) {\n\t\t\t\tif (sel.removeAllRanges) {\n\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t} else if (sel.empty) {\n\t\t\t\t\tsel.empty();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tvar USER_AGENT = navigator.userAgent;\n\n\t/**\n\t * Detects if the browser is iOS\n\t *\n\t * Needed to fix iOS specific bugs\n\t *\n\t * @function\n\t * @name ios\n\t * @memberOf sceditor\n\t * @type {boolean}\n\t */\n\tvar ios = /iPhone|iPod|iPad| wosbrowser\\//i.test(USER_AGENT);\n\n\t/**\n\t * If the browser supports WYSIWYG editing (e.g. older mobile browsers).\n\t *\n\t * @function\n\t * @name isWysiwygSupported\n\t * @return {boolean}\n\t */\n\tvar isWysiwygSupported = (function () {\n\t\tvar match, isUnsupported;\n\n\t\t// IE is the only browser to support documentMode\n\t\tconst ie = !!window.document.documentMode;\n\t\tconst legacyEdge = '-ms-ime-align' in document.documentElement.style;\n\n\t\tconst div = document.createElement('div');\n\t\tdiv.contentEditable = true;\n\n\t\t// Check if the contentEditable attribute is supported\n\t\tif (!('contentEditable' in document.documentElement) ||\n\t\t\tdiv.contentEditable !== 'true') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// I think blackberry supports contentEditable or will at least\n\t\t// give a valid value for the contentEditable detection above\n\t\t// so it isn't included in the below tests.\n\n\t\t// I hate having to do UA sniffing but some mobile browsers say they\n\t\t// support contentediable when it isn't usable, i.e. you can't enter\n\t\t// text.\n\t\t// This is the only way I can think of to detect them which is also how\n\t\t// every other editor I've seen deals with this issue.\n\n\t\t// Exclude Opera mobile and mini\n\t\tisUnsupported = /Opera Mobi|Opera Mini/i.test(USER_AGENT);\n\n\t\tif (/Android/i.test(USER_AGENT)) {\n\t\t\tisUnsupported = true;\n\n\t\t\tif (/Safari/.test(USER_AGENT)) {\n\t\t\t\t// Android browser 534+ supports content editable\n\t\t\t\t// This also matches Chrome which supports content editable too\n\t\t\t\tmatch = /Safari\\/(\\d+)/.exec(USER_AGENT);\n\t\t\t\tisUnsupported = (!match || !match[1] ? true : match[1] < 534);\n\t\t\t}\n\t\t}\n\n\t\t// The current version of Amazon Silk supports it, older versions didn't\n\t\t// As it uses webkit like Android, assume it's the same and started\n\t\t// working at versions >= 534\n\t\tif (/ Silk\\//i.test(USER_AGENT)) {\n\t\t\tmatch = /AppleWebKit\\/(\\d+)/.exec(USER_AGENT);\n\t\t\tisUnsupported = (!match || !match[1] ? true : match[1] < 534);\n\t\t}\n\n\t\t// iOS 5+ supports content editable\n\t\tif (ios) {\n\t\t\t// Block any version <= 4_x(_x)\n\t\t\tisUnsupported = /OS [0-4](_\\d)+ like Mac/i.test(USER_AGENT);\n\t\t}\n\n\t\t// Firefox does support WYSIWYG on mobiles so override\n\t\t// any previous value if using FF\n\t\tif (/Firefox/i.test(USER_AGENT)) {\n\t\t\tisUnsupported = false;\n\t\t}\n\n\t\tif (/OneBrowser/i.test(USER_AGENT)) {\n\t\t\tisUnsupported = false;\n\t\t}\n\n\t\t// UCBrowser works but doesn't give a unique user agent\n\t\tif (navigator.vendor === 'UCWEB') {\n\t\t\tisUnsupported = false;\n\t\t}\n\n\t\t// IE and legacy edge are not supported any more\n\t\tif (ie || legacyEdge) {\n\t\t\tisUnsupported = true;\n\t\t}\n\n\t\treturn !isUnsupported;\n\t}());\n\n\tvar globalWin  = window;\n\tvar globalDoc  = document;\n\n\tvar IMAGE_MIME_REGEX = /^image\\/(p?jpe?g|gif|png|bmp)$/i;\n\n\t/**\n\t * Wrap inlines that are in the root in paragraphs.\n\t *\n\t * @param {HTMLBodyElement} body\n\t * @param {Document} doc\n\t * @private\n\t */\n\tfunction wrapInlines(body, doc) {\n\t\tvar wrapper;\n\n\t\ttraverse(body, function (node) {\n\t\t\tif (isInline(node, true)) {\n\t\t\t\t// Ignore text nodes unless they contain non-whitespace chars as\n\t\t\t\t// whitespace will be collapsed.\n\t\t\t\t// Ignore sceditor-ignore elements unless wrapping siblings\n\t\t\t\t// Should still wrap both if wrapping siblings.\n\t\t\t\tif (wrapper || node.nodeType === TEXT_NODE ?\n\t\t\t\t\t/\\S/.test(node.nodeValue) : !is(node, '.sceditor-ignore')) {\n\t\t\t\t\tif (!wrapper) {\n\t\t\t\t\t\twrapper = createElement('p', {}, doc);\n\t\t\t\t\t\tinsertBefore(wrapper, node);\n\t\t\t\t\t}\n\n\t\t\t\t\tappendChild(wrapper, node);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twrapper = null;\n\t\t\t}\n\t\t}, false, true);\n\t}\n\t/**\n\t * SCEditor - A lightweight WYSIWYG editor\n\t *\n\t * @param {HTMLTextAreaElement} original The textarea to be converted\n\t * @param {Object} userOptions\n\t * @class SCEditor\n\t * @name SCEditor\n\t */\n\tfunction SCEditor(original, userOptions) {\n\t\t/**\n\t\t * Alias of this\n\t\t *\n\t\t * @private\n\t\t */\n\t\tvar base = this;\n\n\t\t/**\n\t\t * Editor format like BBCode or HTML\n\t\t */\n\t\tvar format;\n\n\t\t/**\n\t\t * The div which contains the editor and toolbar\n\t\t *\n\t\t * @type {HTMLDivElement}\n\t\t * @private\n\t\t */\n\t\tvar editorContainer;\n\n\t\t/**\n\t\t * Map of events handlers bound to this instance.\n\t\t *\n\t\t * @type {Object}\n\t\t * @private\n\t\t */\n\t\tvar eventHandlers = {};\n\n\t\t/**\n\t\t * The editors toolbar\n\t\t *\n\t\t * @type {HTMLDivElement}\n\t\t * @private\n\t\t */\n\t\tvar toolbar;\n\n\t\t/**\n\t\t * The editors iframe which should be in design mode\n\t\t *\n\t\t * @type {HTMLIFrameElement}\n\t\t * @private\n\t\t */\n\t\tvar wysiwygEditor;\n\n\t\t/**\n\t\t * The editors window\n\t\t *\n\t\t * @type {Window}\n\t\t * @private\n\t\t */\n\t\tvar wysiwygWindow;\n\n\t\t/**\n\t\t * The WYSIWYG editors body element\n\t\t *\n\t\t * @type {HTMLBodyElement}\n\t\t * @private\n\t\t */\n\t\tvar wysiwygBody;\n\n\t\t/**\n\t\t * The WYSIWYG editors document\n\t\t *\n\t\t * @type {Document}\n\t\t * @private\n\t\t */\n\t\tvar wysiwygDocument;\n\n\t\t/**\n\t\t * The editors textarea for viewing source\n\t\t *\n\t\t * @type {HTMLTextAreaElement}\n\t\t * @private\n\t\t */\n\t\tvar sourceEditor;\n\n\t\tvar footer;\n\n\t\t/**\n\t\t * The current dropdown\n\t\t *\n\t\t * @type {HTMLDivElement}\n\t\t * @private\n\t\t */\n\t\tvar dropdown;\n\n\t\t/**\n\t\t * If the user is currently composing text via IME\n\t\t * @type {boolean}\n\t\t */\n\t\tvar isComposing;\n\n\t\t/**\n\t\t * Timer for valueChanged key handler\n\t\t * @type {number}\n\t\t */\n\t\tvar valueChangedKeyUpTimer;\n\n\t\t/**\n\t\t * The editors locale\n\t\t *\n\t\t * @private\n\t\t */\n\t\tvar locale;\n\n\t\t/**\n\t\t * The editors rangeHelper instance\n\t\t *\n\t\t * @type {RangeHelper}\n\t\t * @private\n\t\t */\n\t\tvar rangeHelper;\n\n\t\t/**\n\t\t * An array of button state handlers\n\t\t *\n\t\t * @type {Array.<Object>}\n\t\t * @private\n\t\t */\n\t\tvar btnStateHandlers = [];\n\n\t\t/**\n\t\t * Plugin manager instance\n\t\t *\n\t\t * @type {PluginManager}\n\t\t * @private\n\t\t */\n\t\tvar pluginManager;\n\n\t\t/**\n\t\t * The current node containing the selection/caret\n\t\t *\n\t\t * @type {Node}\n\t\t * @private\n\t\t */\n\t\tvar currentNode;\n\n\t\t/**\n\t\t * The first block level parent of the current node\n\t\t *\n\t\t * @type {node}\n\t\t * @private\n\t\t */\n\t\tvar currentBlockNode;\n\n\t\tvar backSpaceHandled;\n\n\t\t/**\n\t\t * The current node selection/caret\n\t\t *\n\t\t * @type {Object}\n\t\t * @private\n\t\t */\n\t\tvar currentSelection;\n\n\t\t/**\n\t\t * Used to make sure only 1 selection changed\n\t\t * check is called every 100ms.\n\t\t *\n\t\t * Helps improve performance as it is checked a lot.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @private\n\t\t */\n\t\tvar isSelectionCheckPending;\n\n\t\t/**\n\t\t * If content is required (equivalent to the HTML5 required attribute)\n\t\t *\n\t\t * @type {boolean}\n\t\t * @private\n\t\t */\n\t\tvar isRequired;\n\n\t\t/**\n\t\t * The inline CSS style element. Will be undefined\n\t\t * until css() is called for the first time.\n\t\t *\n\t\t * @type {HTMLStyleElement}\n\t\t * @private\n\t\t */\n\t\tvar inlineCss;\n\n\t\t/**\n\t\t * Object containing a list of shortcut handlers\n\t\t *\n\t\t * @type {Object}\n\t\t * @private\n\t\t */\n\t\tvar shortcutHandlers = {};\n\n\t\t/**\n\t\t * The min and max heights that autoExpand should stay within\n\t\t *\n\t\t * @type {Object}\n\t\t * @private\n\t\t */\n\t\tvar autoExpandBounds;\n\n\t\t/**\n\t\t * Timeout for the autoExpand function to throttle calls\n\t\t *\n\t\t * @private\n\t\t */\n\t\tvar autoExpandThrottle;\n\n\t\t/**\n\t\t * Cache of the current toolbar buttons\n\t\t *\n\t\t * @type {Object}\n\t\t * @private\n\t\t */\n\t\tvar toolbarButtons = {};\n\n\t\t/**\n\t\t * Last scroll position before maximizing so\n\t\t * it can be restored when finished.\n\t\t *\n\t\t * @type {number}\n\t\t * @private\n\t\t */\n\t\tvar maximizeScrollPosition;\n\n\t\t/**\n\t\t * Stores the contents while a paste is taking place.\n\t\t *\n\t\t * Needed to support browsers that lack clipboard API support.\n\t\t *\n\t\t * @type {?DocumentFragment}\n\t\t * @private\n\t\t */\n\t\tvar pasteContentFragment;\n\n\t\t/**\n\t\t * Current icon set if any\n\t\t *\n\t\t * @type {?Object}\n\t\t * @private\n\t\t */\n\t\tvar icons;\n\n\t\t/**\n\t\t * Private functions\n\t\t * @private\n\t\t */\n\t\tvar init,\n\t\t\thandleCommand,\n\t\t\tinitEditor,\n\t\t\tinitLocale,\n\t\t\tinitToolBar,\n\t\t\tinitOptions,\n\t\t\tinitEvents,\n\t\t\tinitResize,\n\t\t\thandlePasteEvt,\n\t\t\thandleCutCopyEvt,\n\t\t\thandlePasteData,\n\t\t\thandleKeyDown,\n\t\t\thandleBackSpace,\n\t\t\thandleKeyPress,\n\t\t\thandleFormReset,\n\t\t\thandleMouseDown,\n\t\t\thandleComposition,\n\t\t\thandleEvent,\n\t\t\thandleDocumentClick,\n\t\t\tloadScripts,\n\t\t\tupdateToolBar,\n\t\t\tupdateActiveButtons,\n\t\t\tsourceEditorSelectedText,\n\t\t\tappendNewLine,\n\t\t\tcheckSelectionChanged,\n\t\t\tcheckNodeChanged,\n\t\t\tautofocus,\n\t\t\tcurrentStyledBlockNode,\n\t\t\ttriggerValueChanged,\n\t\t\tvalueChangedBlur,\n\t\t\tvalueChangedKeyUp,\n\t\t\tautoUpdate,\n\t\t\tautoExpand;\n\n\t\t/**\n\t\t * All the commands supported by the editor\n\t\t * @name commands\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.commands = extend(true, {}, (userOptions.commands || defaultCmds));\n\n\t\t/**\n\t\t * Options for this editor instance\n\t\t * @name opts\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tvar options = base.opts = extend(\n\t\t\ttrue, {}, defaultOptions, userOptions\n\t\t);\n\n\t\tif (!Array.isArray(options.allowedIframeUrls)) {\n\t\t\toptions.allowedIframeUrls = [];\n\t\t}\n\n\t\toptions.allowedIframeUrls.push('https://youtube.com/embed/');\n\t\toptions.allowedIframeUrls.push('https://player.vimeo.com/video/');\n\t\toptions.allowedIframeUrls.push('https://www.instagram.com/p/');\n\t\toptions.allowedIframeUrls.push('https://www.facebook.com/plugins/');\n\n\t\t// Create new instance of DOMPurify for each editor instance so can\n\t\t// have different allowed iframe URLs\n\t\t// eslint-disable-next-line new-cap\n\t\tvar domPurify = purify();\n\n\t\t// Allow iframes for things like YouTube, see:\n\t\t// https://github.com/cure53/DOMPurify/issues/340#issuecomment-670758980\n\t\tdomPurify.addHook('uponSanitizeElement', function (node, data) {\n\t\t\tconst allowedUrls = options.allowedIframeUrls;\n\n\t\t\tif (data.tagName === 'iframe') {\n\t\t\t\tconst src = attr(node, 'src') || '';\n\n\t\t\t\tfor (let i = 0; i < allowedUrls.length; i++) {\n\t\t\t\t\tconst url = allowedUrls[i];\n\n\t\t\t\t\tif (isString(url) && src.substr(0, url.length) === url) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Handle regex\n\t\t\t\t\tif (url.test && url.test(src)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// No match so remove\n\t\t\t\tremove(node);\n\t\t\t}\n\t\t});\n\n\t\t// Convert target attribute into data-sce-target attributes so XHTML format\n\t\t// can allow them\n\t\tdomPurify.addHook('afterSanitizeAttributes', function (node) {\n\t\t\tif ('target' in node) {\n\t\t\t\tattr(node, 'data-sce-target', attr(node, 'target'));\n\t\t\t}\n\n\t\t\tremoveAttr(node, 'target');\n\t\t});\n\n\t\t/**\n\t\t * Sanitize HTML to avoid XSS\n\t\t *\n\t\t * @param {string} html\n\t\t * @return {string} html\n\t\t * @private\n\t\t */\n\t\tfunction sanitize(html) {\n\t\t\tconst allowedTags = ['iframe'].concat(options.allowedTags);\n\t\t\tconst allowedAttrs = ['allowfullscreen', 'frameborder', 'target']\n\t\t\t\t.concat(options.allowedAttributes);\n\n\t\t\treturn domPurify.sanitize(html, {\n\t\t\t\tADD_TAGS: allowedTags,\n\t\t\t\tADD_ATTR: allowedAttrs\n\t\t\t});\n\t\t}\n\t\t/**\n\t\t* Loads a JavaScript file and returns a Promise for when it is loaded\n\t\t*/\n\t\tconst loadScript = src => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tconst script = document.createElement('script');\n\t\t\t\tscript.type = 'text/javascript';\n\t\t\t\tscript.onload = resolve;\n\t\t\t\tscript.onerror = reject;\n\t\t\t\tscript.src = src;\n\t\t\t\tdocument.head.append(script);\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Loads all scripts\n\t\t * @private\n\t\t */\n\t\tloadScripts = function () {\n\t\t\tif (options.locale && options.locale !== 'en') {\n\t\t\t\tconst promises = [];\n\t\t\t\tpromises.push(\n\t\t\t\t\tloadScript(`../${options.basePath}languages/${options.locale}.js`));\n\n\t\t\t\tPromise.all(promises).then(() => {\n\t\t\t\t\tinit();\n\t\t\t\t}).catch(() => console.error('Something went wrong.'));\n\t\t\t} else {\n\t\t\t\tinit();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Creates the editor iframe and textarea\n\t\t * @private\n\t\t */\n\t\tinit = function () {\n\t\t\toriginal._sceditor = base;\n\n\t\t\t// Load locale\n\t\t\tif (options.locale && options.locale !== 'en') {\n\t\t\t\tinitLocale();\n\t\t\t}\n\n\t\t\teditorContainer = createElement('div', {\n\t\t\t\tclassName: 'sceditor-container card'\n\t\t\t});\n\n\t\t\tinsertBefore(editorContainer, original);\n\t\t\tcss(editorContainer, 'z-index', options.zIndex);\n\n\t\t\tisRequired = original.required;\n\t\t\toriginal.required = false;\n\n\t\t\tconst FormatCtor = SCEditor.formats[options.format];\n\t\t\tformat = FormatCtor ? new FormatCtor() : {};\n\t\t\t/*\n\t\t\t * Plugins should be initialized before the formatters since\n\t\t\t * they may wish to add or change formatting handlers and\n\t\t\t * since the bbcode format caches its handlers,\n\t\t\t * such changes must be done first.\n\t\t\t */\n\t\t\tpluginManager = new PluginManager(base);\n\t\t\t(options.plugins || '').split(',').forEach(function (plugin) {\n\t\t\t\tpluginManager.register(plugin.trim());\n\t\t\t});\n\t\t\tif ('init' in format) {\n\t\t\t\tformat.init.call(base);\n\t\t\t}\n\n\t\t\t// create the editor\n\t\t\tinitToolBar();\n\t\t\tinitEditor();\n\t\t\tinitOptions();\n\t\t\tinitEvents();\n\n\t\t\t// force into source mode if is a browser that can't handle\n\t\t\t// full editing\n\t\t\tif (!isWysiwygSupported) {\n\t\t\t\tbase.toggleSourceMode();\n\t\t\t}\n\n\t\t\tupdateActiveButtons();\n\n\t\t\tvar loaded = function () {\n\t\t\t\toff(globalWin, 'load', loaded);\n\n\t\t\t\tif (options.autofocus) {\n\t\t\t\t\tautofocus(!!options.autofocusEnd);\n\t\t\t\t}\n\n\t\t\t\tautoExpand();\n\t\t\t\tappendNewLine();\n\t\t\t\t// TODO: use editor doc and window?\n\t\t\t\tpluginManager.call('ready');\n\t\t\t\tif ('onReady' in format) {\n\t\t\t\t\tformat.onReady.call(base);\n\t\t\t\t}\n\t\t\t};\n\t\t\ton(globalWin, 'load', loaded);\n\t\t\tif (globalDoc.readyState === 'complete') {\n\t\t\t\tloaded();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Init the locale variable with the specified locale if possible\n\t\t * @private\n\t\t * @return void\n\t\t */\n\t\tinitLocale = function () {\n\t\t\tvar lang;\n\n\t\t\tlocale = SCEditor.locale[options.locale];\n\n\t\t\tif (!locale) {\n\t\t\t\tlang = options.locale.split('-');\n\t\t\t\tlocale = SCEditor.locale[lang[0]];\n\t\t\t}\n\n\t\t\t// Locale DateTime format overrides any specified in the options\n\t\t\tif (locale && locale.dateFormat) {\n\t\t\t\toptions.dateFormat = locale.dateFormat;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Creates the editor iframe and textarea\n\t\t * @private\n\t\t */\n\t\tinitEditor = function () {\n\t\t\tsourceEditor  = createElement('textarea');\n\t\t\twysiwygEditor = createElement('iframe', {\n\t\t\t\tframeborder: 0,\n\t\t\t\tallowfullscreen: true\n\t\t\t});\n\n\t\t\tattr(wysiwygEditor, 'role', 'none');\n\n\t\t\tfooter = createElement('div');\n\t\t\taddClass(footer, 'card-footer');\n\t\t\taddClass(footer, 'text-body-secondary');\n\t\t\taddClass(footer, 'text-end');\n\t\t\taddClass(footer, 'small');\n\t\t\taddClass(footer, 'p-2');\n\n\t\t\tfooter.appendChild(parseHTML(base._('Characters remaining:') + '<span id=\"editor-Counter\" class=\"badge bg-secondary ms-1\">' + '</span>'));\n\n\t\t\t/*\n\t\t\t * This needs to be done right after they are created because,\n\t\t\t * for any reason, the user may not want the value to be tinkered\n\t\t\t * by any filters.\n\t\t\t */\n\t\t\tif (options.startInSourceMode) {\n\t\t\t\taddClass(editorContainer, 'sourceMode');\n\t\t\t\thide(wysiwygEditor);\n\t\t\t} else {\n\t\t\t\taddClass(editorContainer, 'wysiwygMode');\n\t\t\t\thide(sourceEditor);\n\t\t\t}\n\n\t\t\tif (!options.spellcheck) {\n\t\t\t\tattr(editorContainer, 'spellcheck', 'false');\n\t\t\t}\n\n\t\t\tif (globalWin.location.protocol === 'https:') {\n\t\t\t\tattr(wysiwygEditor, 'src', 'about:blank');\n\t\t\t}\n\n\t\t\tattr(sourceEditor, 'title', 'source');\n\t\t\tattr(sourceEditor, 'name', 'source');\n\n\t\t\t// Add the editor to the container\n\t\t\tappendChild(editorContainer, wysiwygEditor);\n\t\t\tappendChild(editorContainer, sourceEditor);\n\t\t\tappendChild(editorContainer, footer);\n\n\t\t\t// TODO: make this optional somehow\n\t\t\tbase.dimensions(\n\t\t\t\toptions.width || width(original),\n\t\t\t\toptions.height || height(original)\n\t\t\t);\n\n\t\t\twysiwygDocument = wysiwygEditor.contentDocument;\n\t\t\twysiwygDocument.open();\n\n\t\t\tvar styles = '';\n\n\t\t\toptions.styles.forEach((style) => {\n\t\t\t\tstyles += _tmpl('style', {style: style});\n\t\t\t});\n\n\t\t\twysiwygDocument.write(_tmpl('html', {\n\t\t\t\tspellcheck: options.spellcheck ? '' : 'spellcheck=\"false\"',\n\t\t\t\tcharset: options.charset,\n\t\t\t\tthemeMode: options.themeMode,\n\t\t\t\tstyles: styles\n\t\t\t}, false, false));\n\n\t\t\twysiwygDocument.close();\n\n\t\t\twysiwygBody = wysiwygDocument.body;\n\t\t\twysiwygWindow = wysiwygEditor.contentWindow;\n\n\t\t\tbase.readOnly(!!options.readOnly);\n\n\t\t\t// iframe overflow fix for iOS\n\t\t\tif (ios) {\n\t\t\t\theight(wysiwygBody, '100%');\n\t\t\t\ton(wysiwygBody, 'touchend', base.focus);\n\t\t\t}\n\n\t\t\tvar tabIndex = attr(original, 'tabindex');\n\t\t\tattr(sourceEditor, 'tabindex', tabIndex);\n\t\t\tattr(wysiwygEditor, 'tabindex', tabIndex);\n\n\t\t\trangeHelper = new RangeHelper(wysiwygWindow, null, sanitize);\n\n\t\t\t// load any textarea value into the editor\n\t\t\thide(original);\n\t\t\tbase.val(original.value);\n\n\t\t\tvar placeholder = options.placeholder ||\n\t\t\t\tattr(original, 'placeholder');\n\n\t\t\tif (placeholder) {\n\t\t\t\tsourceEditor.placeholder = placeholder;\n\t\t\t\tattr(wysiwygBody, 'placeholder', placeholder);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Initialises options\n\t\t * @private\n\t\t */\n\t\tinitOptions = function () {\n\t\t\t// auto-update original textbox on blur if option set to true\n\t\t\tif (options.autoUpdate) {\n\t\t\t\ton(wysiwygBody, 'blur', autoUpdate);\n\t\t\t\ton(sourceEditor, 'blur', autoUpdate);\n\t\t\t}\n\n\t\t\tif (options.rtl === null) {\n\t\t\t\toptions.rtl = css(sourceEditor, 'direction') === 'rtl';\n\t\t\t}\n\n\t\t\tbase.rtl(!!options.rtl);\n\n\t\t\tif (options.autoExpand) {\n\t\t\t\t// Need to update when images (or anything else) loads\n\t\t\t\ton(wysiwygBody, 'load', autoExpand, EVENT_CAPTURE);\n\t\t\t\ton(wysiwygBody, 'input keyup', autoExpand);\n\t\t\t}\n\n\t\t\tif (options.resizeEnabled) {\n\t\t\t\tinitResize();\n\t\t\t}\n\n\t\t\tattr(editorContainer, 'id', options.id);\n\t\t};\n\n\t\t/**\n\t\t * Initialises events\n\t\t * @private\n\t\t */\n\t\tinitEvents = function () {\n\t\t\tconst form = original.form;\n\t\t\tconst compositionEvents = 'compositionstart compositionend';\n\t\t\tconst eventsToForward = 'keydown keyup keypress focus blur contextmenu input';\n\t\t\tconst checkSelectionEvents = 'onselectionchange' in wysiwygDocument ?\n\t\t\t\t'selectionchange' :\n\t\t\t\t'keyup focus blur contextmenu mouseup touchend click';\n\n\t\t\ton(globalDoc, 'click', handleDocumentClick);\n\n\t\t\tif (form) {\n\t\t\t\ton(form, 'reset', handleFormReset);\n\t\t\t\ton(form, 'submit', base.updateOriginal, EVENT_CAPTURE);\n\t\t\t}\n\n\t\t\ton(window, 'pagehide', base.updateOriginal);\n\t\t\ton(window, 'pageshow', handleFormReset);\n\t\t\ton(wysiwygBody, 'keypress', handleKeyPress);\n\t\t\ton(wysiwygBody, 'keydown', handleKeyDown);\n\t\t\ton(wysiwygBody, 'keydown', handleBackSpace);\n\t\t\ton(wysiwygBody, 'keyup', appendNewLine);\n\t\t\ton(wysiwygBody, 'blur', valueChangedBlur);\n\t\t\ton(wysiwygBody, 'keyup', valueChangedKeyUp);\n\t\t\ton(wysiwygBody, 'paste', handlePasteEvt);\n\t\t\ton(wysiwygBody, 'cut copy', handleCutCopyEvt);\n\t\t\ton(wysiwygBody, compositionEvents, handleComposition);\n\t\t\ton(wysiwygBody, checkSelectionEvents, checkSelectionChanged);\n\t\t\ton(wysiwygBody, eventsToForward, handleEvent);\n\n\t\t\ton(wysiwygBody, 'blur', function () {\n\t\t\t\tif (!base.val()) {\n\t\t\t\t\taddClass(wysiwygBody, 'sceditor-placeholder');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ton(wysiwygBody, 'focus', function () {\n\t\t\t\tremoveClass(wysiwygBody, 'sceditor-placeholder');\n\t\t\t});\n\n\t\t\ton(sourceEditor, 'blur', valueChangedBlur);\n\t\t\ton(sourceEditor, 'keyup', valueChangedKeyUp);\n\t\t\ton(sourceEditor, 'keydown', handleKeyDown);\n\t\t\ton(sourceEditor, compositionEvents, handleComposition);\n\t\t\ton(sourceEditor, eventsToForward, handleEvent);\n\n\t\t\ton(wysiwygDocument, 'mousedown', handleMouseDown);\n\t\t\ton(wysiwygDocument, checkSelectionEvents, checkSelectionChanged);\n\t\t\ton(wysiwygDocument, 'keyup', appendNewLine);\n\n\t\t\ton(editorContainer, 'selectionchanged', checkNodeChanged);\n\t\t\ton(editorContainer, 'selectionchanged', updateActiveButtons);\n\t\t\t// Custom events to forward\n\t\t\ton(\n\t\t\t\teditorContainer,\n\t\t\t\t'selectionchanged valuechanged nodechanged pasteraw paste',\n\t\t\t\thandleEvent\n\t\t\t);\n\t\t};\n\n\t\t/**\n\t\t * Creates the toolbar and appends it to the container\n\t\t * @private\n\t\t */\n\t\tinitToolBar = function () {\n\t\t\tvar\tgroup,\n\t\t\t\tcommands = base.commands,\n\t\t\t\texclude  = (options.toolbarExclude || '').split(',');\n\t\t\tconst groups = options.toolbar.split('|');\n\n\t\t\ttoolbar = createElement('div', {\n\t\t\t\tclassName: 'card-header btn-toolbar',\n\t\t\t\tunselectable: 'on'\n\t\t\t});\n\n\t\t\tif (options.icons in SCEditor.icons) {\n\t\t\t\ticons = new SCEditor.icons[options.icons]();\n\t\t\t}\n\n\t\t\teach(groups, function (_, menuItems) {\n\t\t\t\tgroup = createElement('div', {\n\t\t\t\t\tclassName: 'btn-group btn-group-sm m-1'\n\t\t\t\t});\n\n\t\t\t\teach(menuItems.split(','), function (_, commandName) {\n\t\t\t\t\tvar\tbutton, shortcut,\n\t\t\t\t\t\tcommand  = commands[commandName];\n\n\t\t\t\t\t// The commandName must be a valid command and not excluded\n\t\t\t\t\tif (!command || exclude.indexOf(commandName) > -1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tshortcut = command.shortcut;\n\t\t\t\t\tbutton   = _tmpl('toolbarButton', {\n\t\t\t\t\t\tname: commandName\n\t\t\t\t\t}, true).firstChild;\n\n\t\t\t\t\tif (commandName === 'source') {\n\t\t\t\t\t\tbutton.classList.add('btn-secondary');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbutton.classList.add('btn-primary');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (icons && icons.create) {\n\t\t\t\t\t\tconst icon = icons.create(commandName);\n\t\t\t\t\t\tif (icon) {\n\t\t\t\t\t\t\tinsertBefore(icons.create(commandName),\n\t\t\t\t\t\t\t\tbutton.firstChild);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbutton._sceTxtMode = !!command.txtExec;\n\t\t\t\t\tbutton._sceWysiwygMode = !!command.exec;\n\n\t\t\t\t\ttoggleClass(button, 'disabled', !command.exec);\n\t\t\t\t\ton(button, 'click', function (e) {\n\t\t\t\t\t\tif (!hasClass(button, 'disabled')) {\n\t\t\t\t\t\t\thandleCommand(button, command);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tupdateActiveButtons();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\t\t\t\t\t// Prevent editor losing focus when button clicked\n\t\t\t\t\ton(button, 'mousedown', function (e) {\n\t\t\t\t\t\tbase.closeDropDown();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\t\tif (command.tooltip) {\n\t\t\t\t\t\tattr(button, 'title',\n\t\t\t\t\t\t\tbase._(command.tooltip) +\n\t\t\t\t\t\t\t\t(shortcut ? ' (' + shortcut + ')' : '')\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (shortcut) {\n\t\t\t\t\t\tbase.addShortcut(shortcut, commandName);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (command.state) {\n\t\t\t\t\t\tbtnStateHandlers.push({\n\t\t\t\t\t\t\tname: commandName,\n\t\t\t\t\t\t\tstate: command.state\n\t\t\t\t\t\t});\n\t\t\t\t\t// exec string commands can be passed to queryCommandState\n\t\t\t\t\t} else if (isString(command.exec)) {\n\t\t\t\t\t\tbtnStateHandlers.push({\n\t\t\t\t\t\t\tname: commandName,\n\t\t\t\t\t\t\tstate: command.exec\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tappendChild(group, button);\n\t\t\t\t\ttoolbarButtons[commandName] = button;\n\t\t\t\t});\n\n\t\t\t\t// Exclude empty groups\n\t\t\t\tif (group.firstChild) {\n\t\t\t\t\tappendChild(toolbar, group);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Append the toolbar to the toolbarContainer option if given\n\t\t\tappendChild(options.toolbarContainer || editorContainer, toolbar);\n\t\t};\n\n\t\t/**\n\t\t * Creates the resizer.\n\t\t * @private\n\t\t */\n\t\tinitResize = function () {\n\t\t\tvar\tminHeight, maxHeight, minWidth, maxWidth,\n\t\t\t\tmouseMoveFunc, mouseUpFunc;\n\t\t\tconst grip = createElement('div', {\n\t\t\t\tclassName: 'sceditor-grip'\n\t\t\t});\n\t\t\tvar moveEvents  = 'touchmove mousemove',\n\t\t\t\tendEvents   = 'touchcancel touchend mouseup',\n\t\t\t\tstartX      = 0,\n\t\t\t\tstartY      = 0,\n\t\t\t\tnewX        = 0,\n\t\t\t\tnewY        = 0,\n\t\t\t\tstartWidth  = 0,\n\t\t\t\tstartHeight = 0;\n\t\t\tconst origWidth = width(editorContainer);\n\t\t\tconst origHeight = height(editorContainer);\n\t\t\tvar isDragging  = false,\n\t\t\t\trtl         = base.rtl();\n\n\t\t\tminHeight = options.resizeMinHeight || origHeight / 1.5;\n\t\t\tmaxHeight = options.resizeMaxHeight || origHeight * 2.5;\n\t\t\tminWidth  = options.resizeMinWidth  || origWidth  / 1.25;\n\t\t\tmaxWidth  = options.resizeMaxWidth  || origWidth  * 1.25;\n\n\t\t\tmouseMoveFunc = function (e) {\n\t\t\t\t// iOS uses window.event\n\t\t\t\tif (e.type === 'touchmove') {\n\t\t\t\t\te    = globalWin.event;\n\t\t\t\t\tnewX = e.changedTouches[0].pageX;\n\t\t\t\t\tnewY = e.changedTouches[0].pageY;\n\t\t\t\t} else {\n\t\t\t\t\tnewX = e.pageX;\n\t\t\t\t\tnewY = e.pageY;\n\t\t\t\t}\n\n\t\t\t\tvar\tnewHeight = startHeight + (newY - startY),\n\t\t\t\t\tnewWidth  = rtl ?\n\t\t\t\t\t\tstartWidth - (newX - startX) :\n\t\t\t\t\t\tstartWidth + (newX - startX);\n\n\t\t\t\tif (maxWidth > 0 && newWidth > maxWidth) {\n\t\t\t\t\tnewWidth = maxWidth;\n\t\t\t\t}\n\t\t\t\tif (minWidth > 0 && newWidth < minWidth) {\n\t\t\t\t\tnewWidth = minWidth;\n\t\t\t\t}\n\t\t\t\tif (!options.resizeWidth) {\n\t\t\t\t\tnewWidth = false;\n\t\t\t\t}\n\n\t\t\t\tif (maxHeight > 0 && newHeight > maxHeight) {\n\t\t\t\t\tnewHeight = maxHeight;\n\t\t\t\t}\n\t\t\t\tif (minHeight > 0 && newHeight < minHeight) {\n\t\t\t\t\tnewHeight = minHeight;\n\t\t\t\t}\n\t\t\t\tif (!options.resizeHeight) {\n\t\t\t\t\tnewHeight = false;\n\t\t\t\t}\n\n\t\t\t\tif (newWidth || newHeight) {\n\t\t\t\t\tbase.dimensions(newWidth, newHeight);\n\t\t\t\t}\n\n\t\t\t\te.preventDefault();\n\t\t\t};\n\n\t\t\tmouseUpFunc = function (e) {\n\t\t\t\tif (!isDragging) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tisDragging = false;\n\n\t\t\t\tremoveClass(editorContainer, 'resizing');\n\t\t\t\toff(globalDoc, moveEvents, mouseMoveFunc);\n\t\t\t\toff(globalDoc, endEvents, mouseUpFunc);\n\n\t\t\t\te.preventDefault();\n\t\t\t};\n\n\t\t\tif (icons && icons.create) {\n\t\t\t\tconst icon = icons.create('grip');\n\t\t\t\tif (icon) {\n\t\t\t\t\tappendChild(grip, icon);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tappendChild(editorContainer, footer);\n\t\t\tappendChild(editorContainer, grip);\n\n\t\t\ton(grip, 'touchstart mousedown', function (e) {\n\t\t\t\t// iOS uses window.event\n\t\t\t\tif (e.type === 'touchstart') {\n\t\t\t\t\te      = globalWin.event;\n\t\t\t\t\tstartX = e.touches[0].pageX;\n\t\t\t\t\tstartY = e.touches[0].pageY;\n\t\t\t\t} else {\n\t\t\t\t\tstartX = e.pageX;\n\t\t\t\t\tstartY = e.pageY;\n\t\t\t\t}\n\n\t\t\t\tstartWidth  = width(editorContainer);\n\t\t\t\tstartHeight = height(editorContainer);\n\t\t\t\tisDragging  = true;\n\n\t\t\t\taddClass(editorContainer, 'resizing');\n\t\t\t\ton(globalDoc, moveEvents, mouseMoveFunc);\n\t\t\t\ton(globalDoc, endEvents, mouseUpFunc);\n\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Autofocus the editor\n\t\t * @private\n\t\t */\n\t\tautofocus = function (focusEnd) {\n\t\t\tvar\trange, txtPos,\n\t\t\t\tnode = wysiwygBody.firstChild;\n\n\t\t\t// Can't focus invisible elements\n\t\t\tif (!isVisible(editorContainer)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (base.sourceMode()) {\n\t\t\t\ttxtPos = focusEnd ? sourceEditor.value.length : 0;\n\n\t\t\t\tsourceEditor.setSelectionRange(txtPos, txtPos);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tremoveWhiteSpace(wysiwygBody);\n\n\t\t\tif (focusEnd) {\n\t\t\t\tif (!(node = wysiwygBody.lastChild)) {\n\t\t\t\t\tnode = createElement('p', {}, wysiwygDocument);\n\t\t\t\t\tappendChild(wysiwygBody, node);\n\t\t\t\t}\n\n\t\t\t\twhile (node.lastChild) {\n\t\t\t\t\tnode = node.lastChild;\n\n\t\t\t\t\t// Should place the cursor before the last <br>\n\t\t\t\t\tif (is(node, 'br') && node.previousSibling) {\n\t\t\t\t\t\tnode = node.previousSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trange = wysiwygDocument.createRange();\n\n\t\t\tif (!canHaveChildren(node)) {\n\t\t\t\trange.setStartBefore(node);\n\n\t\t\t\tif (focusEnd) {\n\t\t\t\t\trange.setStartAfter(node);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trange.selectNodeContents(node);\n\t\t\t}\n\n\t\t\trange.collapse(!focusEnd);\n\t\t\trangeHelper.selectRange(range);\n\t\t\tcurrentSelection = range;\n\n\t\t\tif (focusEnd) {\n\t\t\t\twysiwygBody.scrollTop = wysiwygBody.scrollHeight;\n\t\t\t}\n\n\t\t\tbase.focus();\n\t\t};\n\n\t\t/**\n\t\t * Gets if the editor is read only\n\t\t *\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name readOnly\n\t\t * @return {boolean}\n\t\t */\n\t\t/**\n\t\t * Sets if the editor is read only\n\t\t *\n\t\t * @param {boolean} readOnly\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name readOnly^2\n\t\t * @return {this}\n\t\t */\n\t\tbase.readOnly = function (readOnly) {\n\t\t\tif (typeof readOnly !== 'boolean') {\n\t\t\t\treturn !sourceEditor.readonly;\n\t\t\t}\n\n\t\t\twysiwygBody.contentEditable = !readOnly;\n\t\t\tsourceEditor.readonly = !readOnly;\n\n\t\t\tupdateToolBar(readOnly);\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Gets if the editor is in RTL mode\n\t\t *\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name rtl\n\t\t * @return {boolean}\n\t\t */\n\t\t/**\n\t\t * Sets if the editor is in RTL mode\n\t\t *\n\t\t * @param {boolean} rtl\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name rtl^2\n\t\t * @return {this}\n\t\t */\n\t\tbase.rtl = function (rtl) {\n\t\t\tconst dir = rtl ? 'rtl' : 'ltr';\n\n\t\t\tif (typeof rtl !== 'boolean') {\n\t\t\t\treturn attr(sourceEditor, 'dir') === 'rtl';\n\t\t\t}\n\n\t\t\tattr(wysiwygBody, 'dir', dir);\n\t\t\tattr(sourceEditor, 'dir', dir);\n\n\t\t\tremoveClass(editorContainer, 'rtl');\n\t\t\tremoveClass(editorContainer, 'ltr');\n\t\t\taddClass(editorContainer, dir);\n\n\t\t\tif (icons && icons.rtl) {\n\t\t\t\ticons.rtl(rtl);\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Updates the toolbar to disable/enable the appropriate buttons\n\t\t * @private\n\t\t */\n\t\tupdateToolBar = function (disable) {\n\t\t\tvar mode = base.inSourceMode() ? '_sceTxtMode' : '_sceWysiwygMode';\n\n\t\t\teach(toolbarButtons, function (_, button) {\n\t\t\t\ttoggleClass(button, 'disabled', disable || !button[mode]);\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Gets the width of the editor in pixels\n\t\t *\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name width\n\t\t * @return {number}\n\t\t */\n\t\t/**\n\t\t * Sets the width of the editor\n\t\t *\n\t\t * @param {number} width Width in pixels\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name width^2\n\t\t * @return {this}\n\t\t */\n\t\t/**\n\t\t * Sets the width of the editor\n\t\t *\n\t\t * The saveWidth specifies if to save the width. The stored width can be\n\t\t * used for things like restoring from maximized state.\n\t\t *\n\t\t * @param {number}     width            Width in pixels\n\t\t * @param {boolean}\t[saveWidth=true] If to store the width\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name width^3\n\t\t * @return {this}\n\t\t */\n\t\tbase.width = function (width$1, saveWidth) {\n\t\t\tif (!width$1 && width$1 !== 0) {\n\t\t\t\treturn width(editorContainer);\n\t\t\t}\n\n\t\t\tbase.dimensions(width$1, null, saveWidth);\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Returns an object with the properties width and height\n\t\t * which are the width and height of the editor in px.\n\t\t *\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name dimensions\n\t\t * @return {object}\n\t\t */\n\t\t/**\n\t\t * <p>Sets the width and/or height of the editor.</p>\n\t\t *\n\t\t * <p>If width or height is not numeric it is ignored.</p>\n\t\t *\n\t\t * @param {number}\twidth\tWidth in px\n\t\t * @param {number}\theight\tHeight in px\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name dimensions^2\n\t\t * @return {this}\n\t\t */\n\t\t/**\n\t\t * <p>Sets the width and/or height of the editor.</p>\n\t\t *\n\t\t * <p>If width or height is not numeric it is ignored.</p>\n\t\t *\n\t\t * <p>The save argument specifies if to save the new sizes.\n\t\t * The saved sizes can be used for things like restoring from\n\t\t * maximized state. This should normally be left as true.</p>\n\t\t *\n\t\t * @param {number}\t\twidth\t\tWidth in px\n\t\t * @param {number}\t\theight\t\tHeight in px\n\t\t * @param {boolean}\t[save=true]\tIf to store the new sizes\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name dimensions^3\n\t\t * @return {this}\n\t\t */\n\t\tbase.dimensions = function (width$1, height$1, save) {\n\t\t\t// set undefined width/height to boolean false\n\t\t\twidth$1  = (!width$1 && width$1 !== 0) ? false : width$1;\n\t\t\theight$1 = (!height$1 && height$1 !== 0) ? false : height$1;\n\n\t\t\tif (width$1 === false && height$1 === false) {\n\t\t\t\treturn { width: base.width(), height: base.height() };\n\t\t\t}\n\n\t\t\tif (width$1 !== false) {\n\t\t\t\tif (save !== false) {\n\t\t\t\t\toptions.width = width$1;\n\t\t\t\t}\n\n\t\t\t\twidth(editorContainer, width$1);\n\t\t\t}\n\n\t\t\tif (height$1 !== false) {\n\t\t\t\tif (save !== false) {\n\t\t\t\t\toptions.height = height$1;\n\t\t\t\t}\n\n\t\t\t\theight(editorContainer, height$1);\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Gets the height of the editor in px\n\t\t *\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name height\n\t\t * @return {number}\n\t\t */\n\t\t/**\n\t\t * Sets the height of the editor\n\t\t *\n\t\t * @param {number} height Height in px\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name height^2\n\t\t * @return {this}\n\t\t */\n\t\t/**\n\t\t * Sets the height of the editor\n\t\t *\n\t\t * The saveHeight specifies if to save the height.\n\t\t *\n\t\t * The stored height can be used for things like\n\t\t * restoring from maximized state.\n\t\t *\n\t\t * @param {number} height Height in px\n\t\t * @param {boolean} [saveHeight=true] If to store the height\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name height^3\n\t\t * @return {this}\n\t\t */\n\t\tbase.height = function (height$1, saveHeight) {\n\t\t\tif (!height$1 && height$1 !== 0) {\n\t\t\t\treturn height(editorContainer);\n\t\t\t}\n\n\t\t\tbase.dimensions(null, height$1, saveHeight);\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Gets if the editor is maximised or not\n\t\t *\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name maximize\n\t\t * @return {boolean}\n\t\t */\n\t\t/**\n\t\t * Sets if the editor is maximised or not\n\t\t *\n\t\t * @param {boolean} maximize If to maximise the editor\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name maximize^2\n\t\t * @return {this}\n\t\t */\n\t\tbase.maximize = function (maximize) {\n\t\t\tconst maximizeSize = 'sceditor-maximize';\n\n\t\t\tif (isUndefined(maximize)) {\n\t\t\t\treturn hasClass(editorContainer, maximizeSize);\n\t\t\t}\n\n\t\t\tmaximize = !!maximize;\n\n\t\t\tif (maximize) {\n\t\t\t\tmaximizeScrollPosition = globalWin.scrollY;\n\t\t\t}\n\n\t\t\ttoggleClass(globalDoc.documentElement, maximizeSize, maximize);\n\t\t\ttoggleClass(globalDoc.body, maximizeSize, maximize);\n\t\t\ttoggleClass(editorContainer, maximizeSize, maximize);\n\t\t\tbase.width(maximize ? '100%' : options.width, false);\n\t\t\tbase.height(maximize ? '100%' : options.height, false);\n\n\t\t\tif (!maximize) {\n\t\t\t\tglobalWin.scrollTo(0, maximizeScrollPosition);\n\t\t\t}\n\n\t\t\tautoExpand();\n\n\t\t\treturn base;\n\t\t};\n\n\t\tautoExpand = function () {\n\t\t\tif (options.autoExpand && !autoExpandThrottle) {\n\t\t\t\tautoExpandThrottle = setTimeout(base.expandToContent, 200);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Expands or shrinks the editors height to the height of it's content\n\t\t *\n\t\t * Unless ignoreMaxHeight is set to true it will not expand\n\t\t * higher than the maxHeight option.\n\t\t *\n\t\t * @since 1.3.5\n\t\t * @param {boolean} [ignoreMaxHeight=false]\n\t\t * @function\n\t\t * @name expandToContent\n\t\t * @memberOf SCEditor.prototype\n\t\t * @see #resizeToContent\n\t\t */\n\t\tbase.expandToContent = function (ignoreMaxHeight) {\n\t\t\tif (base.maximize()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tclearTimeout(autoExpandThrottle);\n\t\t\tautoExpandThrottle = false;\n\n\t\t\tif (!autoExpandBounds) {\n\t\t\t\tconst height$1 = options.resizeMinHeight || options.height ||\n\t                height(original);\n\n\t\t\t\tautoExpandBounds = {\n\t\t\t\t\tmin: height$1,\n\t\t\t\t\tmax: options.resizeMaxHeight || (height$1 * 2)\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst range = globalDoc.createRange();\n\t\t\trange.selectNodeContents(wysiwygBody);\n\n\t\t\tconst rect = range.getBoundingClientRect();\n\t\t\tconst current = wysiwygDocument.documentElement.clientHeight - 1;\n\t\t\tconst spaceNeeded = rect.bottom - rect.top;\n\t\t\tvar newHeight = base.height() + 1 + (spaceNeeded - current);\n\n\t\t\tif (!ignoreMaxHeight && autoExpandBounds.max !== -1) {\n\t\t\t\tnewHeight = Math.min(newHeight, autoExpandBounds.max);\n\t\t\t}\n\n\t\t\tbase.height(Math.ceil(Math.max(newHeight, autoExpandBounds.min)));\n\t\t};\n\n\t\t/**\n\t\t * Destroys the editor, removing all elements and\n\t\t * event handlers.\n\t\t *\n\t\t * Leaves only the original textarea.\n\t\t *\n\t\t * @function\n\t\t * @name destroy\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.destroy = function () {\n\t\t\t// Don't destroy if the editor has already been destroyed\n\t\t\tif (!pluginManager) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpluginManager.destroy();\n\n\t\t\trangeHelper   = null;\n\t\t\tpluginManager = null;\n\n\t\t\tif (dropdown) {\n\t\t\t\tremove(dropdown);\n\t\t\t}\n\n\t\t\toff(globalDoc, 'click', handleDocumentClick);\n\n\t\t\tconst form = original.form;\n\t\t\tif (form) {\n\t\t\t\toff(form, 'reset', handleFormReset);\n\t\t\t\toff(form, 'submit', base.updateOriginal, EVENT_CAPTURE);\n\t\t\t}\n\n\t\t\toff(window, 'pagehide', base.updateOriginal);\n\t\t\toff(window, 'pageshow', handleFormReset);\n\t\t\tremove(sourceEditor);\n\t\t\tremove(toolbar);\n\t\t\tremove(editorContainer);\n\n\t\t\tdelete original._sceditor;\n\t\t\tshow(original);\n\n\t\t\toriginal.required = isRequired;\n\t\t};\n\n\n\t\t/**\n\t\t * Creates a menu item drop down\n\t\t *\n\t\t * @param  {HTMLElement} menuItem The button to align the dropdown with\n\t\t * @param  {string} name          Used for styling the dropdown, will be\n\t\t *                                a class sceditor-name\n\t\t * @param  {HTMLElement} content  The HTML content of the dropdown\n\t\t * @function\n\t\t * @name createDropDown\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.createDropDown = function (menuItem, name, content) {\n\t\t\t// first click for create second click for close\n\t\t\tvar\tdropDownCss;\n\t\t\tconst dropDownClass = 'sceditor-' + name;\n\n\t\t\tbase.closeDropDown();\n\n\t\t\t// Only close the dropdown if it was already open\n\t\t\tif (dropdown && hasClass(dropdown, dropDownClass)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdropDownCss = extend({\n\t\t\t\ttop: menuItem.offsetTop,\n\t\t\t\tleft: menuItem.parentElement.offsetLeft + menuItem.offsetLeft,\n\t\t\t\tmarginTop: menuItem.clientHeight\n\t\t\t},\n\t\t\toptions.dropDownCss);\n\n\t\t\tdropdown = createElement('div', {\n\t\t\t\tclassName: 'dropdown-menu show sceditor-dropdown ' + dropDownClass\n\t\t\t});\n\n\t\t\tcss(dropdown, dropDownCss);\n\t\t\tappendChild(dropdown, content);\n\t\t\tappendChild(editorContainer, dropdown);\n\t\t\ton(dropdown, 'click focusin', function (e) {\n\t\t\t\t// stop clicks within the dropdown from being handled\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\n\t\t\tif (dropdown) {\n\t\t\t\tconst first = find(dropdown, 'input,textarea')[0];\n\t\t\t\tif (first) {\n\t\t\t\t\tfirst.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Handles any document click and closes the dropdown if open\n\t\t * @private\n\t\t */\n\t\thandleDocumentClick = function (e) {\n\t\t\t// ignore right clicks\n\t\t\tif (e.which !== 3 && dropdown && !e.defaultPrevented) {\n\t\t\t\tautoUpdate();\n\n\t\t\t\tbase.closeDropDown();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Handles the WYSIWYG editors cut & copy events\n\t\t *\n\t\t * By default browsers also copy inherited styling from the stylesheet and\n\t\t * browser default styling which is unnecessary.\n\t\t *\n\t\t * This will ignore inherited styles and only copy inline styling.\n\t\t * @private\n\t\t */\n\t\thandleCutCopyEvt = function (e) {\n\t\t\tconst range = rangeHelper.selectedRange();\n\t\t\tif (range) {\n\t\t\t\tconst container = createElement('div', {}, wysiwygDocument);\n\t\t\t\tlet firstParent;\n\n\t\t\t\t// Copy all inline parent nodes up to the first block parent so can\n\t\t\t\t// copy inline styles\n\t\t\t\tlet parent = range.commonAncestorContainer;\n\t\t\t\twhile (parent && isInline(parent, true)) {\n\t\t\t\t\tif (parent.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\tconst clone = parent.cloneNode();\n\t\t\t\t\t\tif (container.firstChild) {\n\t\t\t\t\t\t\tappendChild(clone, container.firstChild);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tappendChild(container, clone);\n\t\t\t\t\t\tfirstParent = firstParent || clone;\n\t\t\t\t\t}\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\tappendChild(firstParent || container, range.cloneContents());\n\t\t\t\tremoveWhiteSpace(container);\n\n\t\t\t\te.clipboardData.setData('text/html', container.innerHTML);\n\n\t\t\t\t// TODO: Refactor into private shared module with plaintext plugin\n\t\t\t\t// innerText adds two newlines after <p> tags so convert them to\n\t\t\t\t// <div> tags\n\t\t\t\teach(find(container, 'p'), function (_, elm) {\n\t\t\t\t\tconvertElement(elm, 'div');\n\t\t\t\t});\n\t\t\t\t// Remove collapsed <br> tags as innerText converts them to newlines\n\t\t\t\teach(find(container, 'br'), function (_, elm) {\n\t\t\t\t\tif (!elm.nextSibling || !isInline(elm.nextSibling, true)) {\n\t\t\t\t\t\tremove(elm);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// range.toString() doesn't include newlines so can't use that.\n\t\t\t\t// selection.toString() seems to use the same method as innerText\n\t\t\t\t// but needs to be normalised first so using container.innerText\n\t\t\t\tappendChild(wysiwygBody, container);\n\t\t\t\te.clipboardData.setData('text/plain', container.innerText);\n\t\t\t\tremove(container);\n\n\t\t\t\tif (e.type === 'cut') {\n\t\t\t\t\trange.deleteContents();\n\t\t\t\t}\n\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Handles the WYSIWYG editors paste event\n\t\t * @private\n\t\t */\n\t\thandlePasteEvt = function (e) {\n\t\t\tvar editable = wysiwygBody;\n\t\t\tconst clipboard = e.clipboardData;\n\n\t\t\t// Modern browsers with clipboard API - everything other than _very_\n\t\t\t// old android web views and UC browser which doesn't support the\n\t\t\t// paste event at all.\n\t\t\tif (clipboard) {\n\t\t\t\tconst data = {};\n\t\t\t\tconst types = clipboard.types;\n\t\t\t\tconst items = clipboard.items;\n\n\t\t\t\tfor (let i = 0; i < types.length; i++) {\n\t\t\t\t\t// Word sometimes adds copied text as an image so if HTML\n\t\t\t\t\t// exists prefer that over images\n\t\t\t\t\tif (types.indexOf('text/html') < 0) {\n\t\t\t\t\t\t// Normalise image pasting to paste as a data-uri\n\t\t\t\t\t\tif (globalWin.FileReader && items &&\n\t\t\t\t\t\t\tIMAGE_MIME_REGEX.test(items[i].type)) {\n\t\t\t\t\t\t\tpluginManager.call('pasteHtml', items[i].getAsFile());\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tdata[types[i]] = clipboard.getData(types[i]);\n\t\t\t\t}\n\t\t\t\t// Call plugins here with file?\n\t\t\t\tdata.text = data['text/plain'];\n\t\t\t\tif (!options.enablePasteFiltering) {\n\t\t\t\t\tdata.html = sanitize(data['text/html']);\n\t\t\t\t}\n\n\t\t\t\thandlePasteData(data);\n\t\t\t// If contentsFragment exists then we are already waiting for a\n\t\t\t// previous paste so let the handler for that handle this one too\n\t\t\t} else if (!pasteContentFragment) {\n\t\t\t\t// Save the scroll position so can be restored\n\t\t\t\t// when contents is restored\n\t\t\t\tvar scrollTop = editable.scrollTop;\n\n\t\t\t\trangeHelper.saveRange();\n\n\t\t\t\tpasteContentFragment = globalDoc.createDocumentFragment();\n\t\t\t\twhile (editable.firstChild) {\n\t\t\t\t\tappendChild(pasteContentFragment, editable.firstChild);\n\t\t\t\t}\n\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tconst html = editable.innerHTML;\n\n\t\t\t\t\teditable.innerHTML = '';\n\t\t\t\t\tappendChild(editable, pasteContentFragment);\n\t\t\t\t\teditable.scrollTop = scrollTop;\n\t\t\t\t\tpasteContentFragment = false;\n\n\t\t\t\t\trangeHelper.restoreRange();\n\n\t\t\t\t\thandlePasteData({ html: sanitize(html) });\n\t\t\t\t}, 0);\n\t\t\t}\n\n\t\t\te.preventDefault();\n\t\t};\n\n\t\t/**\n\t\t * Gets the pasted data, filters it and then inserts it.\n\t\t * @param {Object} data\n\t\t * @private\n\t\t */\n\t\thandlePasteData = function (data) {\n\t\t\tconst pasteArea = createElement('div', {}, wysiwygDocument);\n\n\t\t\tpluginManager.call('pasteRaw', data);\n\t\t\ttrigger(editorContainer, 'pasteraw', data);\n\n\t\t\tif (data.html) {\n\t\t\t\t// Sanitize again in case plugins modified the HTML\n\t\t\t\tpasteArea.innerHTML = sanitize(data.html);\n\n\t\t\t\t// fix any invalid nesting\n\t\t\t\tfixNesting(pasteArea);\n\t\t\t} else {\n\t\t\t\tpasteArea.innerHTML = entities(data.text || '');\n\t\t\t}\n\n\t\t\tconst paste = {\n\t\t\t\tval: pasteArea.innerHTML\n\t\t\t};\n\n\t\t\tif ('fragmentToSource' in format) {\n\t\t\t\tpaste.val = format\n\t\t\t\t\t.fragmentToSource(paste.val, wysiwygDocument, currentNode);\n\t\t\t}\n\n\t\t\tpluginManager.call('paste', paste);\n\t\t\ttrigger(editorContainer, 'paste', paste);\n\n\t\t\tif ('fragmentToHtml' in format) {\n\t\t\t\tpaste.val = format\n\t\t\t\t\t.fragmentToHtml(paste.val, currentNode);\n\t\t\t}\n\n\t\t\tpluginManager.call('pasteHtml', paste);\n\n\t\t\tconst parent = rangeHelper.getFirstBlockParent();\n\t\t\tbase.wysiwygEditorInsertHtml(paste.val, null, true);\n\n\t\t\tmerge(parent);\n\t\t};\n\n\t\t/**\n\t\t * Closes any currently open drop down\n\t\t *\n\t\t * @param {boolean} [focus=false] If to focus the editor\n\t\t *                             after closing the drop down\n\t\t * @function\n\t\t * @name closeDropDown\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.closeDropDown = function (focus) {\n\t\t\tif (dropdown) {\n\t\t\t\tremove(dropdown);\n\t\t\t\tdropdown = null;\n\t\t\t}\n\n\t\t\tif (focus === true) {\n\t\t\t\tbase.focus();\n\t\t\t}\n\t\t};\n\n\n\t\t/**\n\t\t * Inserts HTML into WYSIWYG editor.\n\t\t *\n\t\t * If endHtml is specified, any selected text will be placed\n\t\t * between html and endHtml. If there is no selected text html\n\t\t * and endHtml will just be concatenate together.\n\t\t *\n\t\t * @param {string} html\n\t\t * @param {string} [endHtml=null]\n\t\t * @param {boolean} [overrideCodeBlocking=false] If to insert the html\n\t\t *                                               into code tags, by\n\t\t *                                               default code tags only\n\t\t *                                               support text.\n\t\t * @function\n\t\t * @name wysiwygEditorInsertHtml\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.wysiwygEditorInsertHtml = function (\n\t\t\thtml, endHtml, overrideCodeBlocking\n\t\t) {\n\t\t\tvar\tmarker, scrollTop, scrollTo;\n\t\t\tconst editorHeight = height(wysiwygEditor);\n\n\t\t\tbase.focus();\n\n\t\t\t// TODO: This code tag should be configurable and\n\t\t\t// should maybe convert the HTML into text instead\n\t\t\t// Don't apply to code elements\n\t\t\tif (!overrideCodeBlocking && closest(currentBlockNode, 'code')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Insert the HTML and save the range so the editor can be scrolled\n\t\t\t// to the end of the selection. Also allows emoticons to be replaced\n\t\t\t// without affecting the cursor position\n\t\t\trangeHelper.insertHTML(html, endHtml);\n\t\t\trangeHelper.saveRange();\n\n\t\t\t// Fix any invalid nesting, e.g. if a quote or other block is inserted\n\t\t\t// into a paragraph\n\t\t\tfixNesting(wysiwygBody);\n\n\t\t\twrapInlines(wysiwygBody, wysiwygDocument);\n\n\t\t\t// Scroll the editor after the end of the selection\n\t\t\tmarker   = find(wysiwygBody, '#sceditor-end-marker')[0];\n\t\t\tshow(marker);\n\t\t\tscrollTop = wysiwygBody.scrollTop;\n\t\t\tscrollTo  = (getOffset(marker).top +\n\t\t\t\t(marker.offsetHeight * 1.5)) - editorHeight;\n\t\t\thide(marker);\n\n\t\t\t// Only scroll if marker isn't already visible\n\t\t\tif (scrollTo > scrollTop || scrollTo + editorHeight < scrollTop) {\n\t\t\t\twysiwygBody.scrollTop = scrollTo;\n\t\t\t}\n\n\t\t\ttriggerValueChanged(false);\n\t\t\trangeHelper.restoreRange();\n\n\t\t\t// Add a new line after the last block element\n\t\t\t// so can always add text after it\n\t\t\tappendNewLine();\n\t\t};\n\n\t\t/**\n\t\t * Like wysiwygEditorInsertHtml except it will convert any HTML\n\t\t * into text before inserting it.\n\t\t *\n\t\t * @param {string} text\n\t\t * @param {string} [endText=null]\n\t\t * @function\n\t\t * @name wysiwygEditorInsertText\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.wysiwygEditorInsertText = function (text, endText) {\n\t\t\tbase.wysiwygEditorInsertHtml(\n\t\t\t\tentities(text), entities(endText)\n\t\t\t);\n\t\t};\n\n\t\t/**\n\t\t * Inserts text into the WYSIWYG or source editor depending on which\n\t\t * mode the editor is in.\n\t\t *\n\t\t * If endText is specified any selected text will be placed between\n\t\t * text and endText. If no text is selected text and endText will\n\t\t * just be concatenate together.\n\t\t *\n\t\t * @param {string} text\n\t\t * @param {string} [endText=null]\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @name insertText\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.insertText = function (text, endText) {\n\t\t\tif (base.inSourceMode()) {\n\t\t\t\tbase.sourceEditorInsertText(text, endText);\n\t\t\t} else {\n\t\t\t\tbase.wysiwygEditorInsertText(text, endText);\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Like wysiwygEditorInsertHtml but inserts text into the\n\t\t * source mode editor instead.\n\t\t *\n\t\t * If endText is specified any selected text will be placed between\n\t\t * text and endText. If no text is selected text and endText will\n\t\t * just be concatenate together.\n\t\t *\n\t\t * The cursor will be placed after the text param. If endText is\n\t\t * specified the cursor will be placed before endText, so passing:<br />\n\t\t *\n\t\t * '[b]', '[/b]'\n\t\t *\n\t\t * Would cause the cursor to be placed:<br />\n\t\t *\n\t\t * [b]Selected text|[/b]\n\t\t *\n\t\t * @param {string} text\n\t\t * @param {string} [endText=null]\n\t\t * @since 1.4.0\n\t\t * @function\n\t\t * @name sourceEditorInsertText\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.sourceEditorInsertText = function (text, endText) {\n\t\t\tvar scrollTop, currentValue;\n\t\t\tconst startPos = sourceEditor.selectionStart;\n\t\t\tconst endPos = sourceEditor.selectionEnd;\n\n\t\t\tscrollTop = sourceEditor.scrollTop;\n\t\t\tsourceEditor.focus();\n\t\t\tcurrentValue = sourceEditor.value;\n\n\t\t\tif (endText) {\n\t\t\t\ttext += currentValue.substring(startPos, endPos) + endText;\n\t\t\t}\n\n\t\t\tsourceEditor.value = currentValue.substring(0, startPos) +\n\t\t\t\ttext +\n\t\t\t\tcurrentValue.substring(endPos, currentValue.length);\n\n\t\t\tsourceEditor.selectionStart = (startPos + text.length) -\n\t\t\t\t(endText ? endText.length : 0);\n\t\t\tsourceEditor.selectionEnd = sourceEditor.selectionStart;\n\n\t\t\tsourceEditor.scrollTop = scrollTop;\n\t\t\tsourceEditor.focus();\n\n\t\t\ttriggerValueChanged();\n\t\t};\n\n\t\t/**\n\t\t * Gets the current instance of the rangeHelper class\n\t\t * for the editor.\n\t\t *\n\t\t * @return {RangeHelper}\n\t\t * @function\n\t\t * @name getRangeHelper\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.getRangeHelper = function () {\n\t\t\treturn rangeHelper;\n\t\t};\n\n\t\t/**\n\t\t * Gets or sets the source editor caret position.\n\t\t *\n\t\t * @param {Object} [position]\n\t\t * @return {this}\n\t\t * @function\n\t\t * @since 1.4.5\n\t\t * @name sourceEditorCaret\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.sourceEditorCaret = function (position) {\n\t\t\tsourceEditor.focus();\n\n\t\t\tif (position) {\n\t\t\t\tsourceEditor.selectionStart = position.start;\n\t\t\t\tsourceEditor.selectionEnd = position.end;\n\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstart: sourceEditor.selectionStart,\n\t\t\t\tend: sourceEditor.selectionEnd\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * Gets the value of the editor.\n\t\t *\n\t\t * If the editor is in WYSIWYG mode it will return the filtered\n\t\t * HTML from it (converted to BBCode if using the BBCode plugin).\n\t\t * It it's in Source Mode it will return the unfiltered contents\n\t\t * of the source editor (if using the BBCode plugin this will be\n\t\t * BBCode again).\n\t\t *\n\t\t * @since 1.3.5\n\t\t * @return {string}\n\t\t * @function\n\t\t * @name val\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\t/**\n\t\t * Sets the value of the editor.\n\t\t *\n\t\t * If filter set true the val will be passed through the filter\n\t\t * function. If using the BBCode plugin it will pass the val to\n\t\t * the BBCode filter to convert any BBCode into HTML.\n\t\t *\n\t\t * @param {string} val\n\t\t * @param {boolean} [filter=true]\n\t\t * @return {this}\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @name val^2\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.val = function (val, filter) {\n\t\t\tif (!isString(val)) {\n\t\t\t\treturn base.inSourceMode() ?\n\t\t\t\t\tbase.getSourceEditorValue(false) :\n\t\t\t\t\tbase.getWysiwygEditorValue(filter);\n\t\t\t}\n\n\t\t\tif (!base.inSourceMode()) {\n\t\t\t\tif (filter !== false && 'toHtml' in format) {\n\t\t\t\t\tval = format.toHtml(val);\n\t\t\t\t}\n\n\t\t\t\tbase.setWysiwygEditorValue(val);\n\t\t\t} else {\n\t\t\t\tbase.setSourceEditorValue(val);\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Inserts HTML/BBCode into the editor\n\t\t *\n\t\t * If end is supplied any selected text will be placed between\n\t\t * start and end. If there is no selected text start and end\n\t\t * will be concatenate together.\n\t\t *\n\t\t * If the filter param is set to true, the HTML/BBCode will be\n\t\t * passed through any plugin filters. If using the BBCode plugin\n\t\t * this will convert any BBCode into HTML.\n\t\t *\n\t\t * @param {string} start\n\t\t * @param {string} [end=null]\n\t\t * @param {boolean} [filter=true]\n\t\t * @param {boolean} [convertEmoticons=true] If to convert emoticons\n\t\t * @return {this}\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @name insert\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\t/**\n\t\t * Inserts HTML/BBCode into the editor\n\t\t *\n\t\t * If end is supplied any selected text will be placed between\n\t\t * start and end. If there is no selected text start and end\n\t\t * will be concatenate together.\n\t\t *\n\t\t * If the filter param is set to true, the HTML/BBCode will be\n\t\t * passed through any plugin filters. If using the BBCode plugin\n\t\t * this will convert any BBCode into HTML.\n\t\t *\n\t\t * If the allowMixed param is set to true, HTML any will not be\n\t\t * escaped\n\t\t *\n\t\t * @param {string} start\n\t\t * @param {string} [end=null]\n\t\t * @param {boolean} [filter=true]\n\t\t * @param {boolean} [convertEmoticons=true] If to convert emoticons\n\t\t * @param {boolean} [allowMixed=false]\n\t\t * @return {this}\n\t\t * @since 1.4.3\n\t\t * @function\n\t\t * @name insert^2\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\t// eslint-disable-next-line max-params\n\t\tbase.insert = function (\n\t\t\tstart, end, filter, convertEmoticons, allowMixed\n\t\t) {\n\t\t\tif (base.inSourceMode()) {\n\t\t\t\tbase.sourceEditorInsertText(start, end);\n\t\t\t\treturn base;\n\t\t\t}\n\n\t\t\t// Add the selection between start and end\n\t\t\tif (end) {\n\t\t\t\tlet html = rangeHelper.selectedHtml();\n\n\t\t\t\tif (filter !== false && 'fragmentToSource' in format) {\n\t\t\t\t\thtml = format\n\t\t\t\t\t\t.fragmentToSource(html, wysiwygDocument, currentNode);\n\t\t\t\t}\n\n\t\t\t\tstart += html + end;\n\t\t\t}\n\t\t\t// TODO: This filter should allow empty tags as it's inserting.\n\t\t\tif (filter !== false && 'fragmentToHtml' in format) {\n\t\t\t\tstart = format.fragmentToHtml(start, currentNode);\n\t\t\t}\n\n\t\t\t// Convert any escaped HTML back into HTML if mixed is allowed\n\t\t\tif (filter !== false && allowMixed === true) {\n\t\t\t\tstart = start.replace(/&lt;/g, '<')\n\t\t\t\t\t.replace(/&gt;/g, '>')\n\t\t\t\t\t.replace(/&amp;/g, '&');\n\t\t\t}\n\n\t\t\tbase.wysiwygEditorInsertHtml(start);\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Gets the WYSIWYG editors HTML value.\n\t\t *\n\t\t * If using a plugin that filters the Ht Ml like the BBCode plugin\n\t\t * it will return the result of the filtering (BBCode) unless the\n\t\t * filter param is set to false.\n\t\t *\n\t\t * @param {boolean} [filter=true]\n\t\t * @return {string}\n\t\t * @function\n\t\t * @name getWysiwygEditorValue\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.getWysiwygEditorValue = function (filter) {\n\t\t\tvar\thtml;\n\t\t\t// Create a tmp node to store contents so it can be modified\n\t\t\t// without affecting anything else.\n\t\t\tconst tmp = createElement('div', {}, wysiwygDocument);\n\t\t\tconst childNodes = wysiwygBody.childNodes;\n\n\t\t\tfor (let i = 0; i < childNodes.length; i++) {\n\t\t\t\tappendChild(tmp, childNodes[i].cloneNode(true));\n\t\t\t}\n\n\t\t\tappendChild(wysiwygBody, tmp);\n\t\t\tfixNesting(tmp);\n\t\t\tremove(tmp);\n\n\t\t\thtml = tmp.innerHTML;\n\n\t\t\t// filter the HTML and DOM through any plugins\n\t\t\tif (filter !== false && format.hasOwnProperty('toSource')) {\n\t\t\t\thtml = format.toSource(html, wysiwygDocument);\n\t\t\t}\n\n\t\t\treturn html;\n\t\t};\n\n\t\t/**\n\t\t * Gets the WYSIWYG editor's iFrame Body.\n\t\t *\n\t\t * @return {HTMLElement}\n\t\t * @function\n\t\t * @since 1.4.3\n\t\t * @name getBody\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.getBody = function () {\n\t\t\treturn wysiwygBody;\n\t\t};\n\n\t\t/**\n\t\t * Gets the WYSIWYG editors container area (whole iFrame).\n\t\t *\n\t\t * @return {HTMLElement}\n\t\t * @function\n\t\t * @since 1.4.3\n\t\t * @name getContentAreaContainer\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.getContentAreaContainer = function () {\n\t\t\treturn wysiwygEditor;\n\t\t};\n\n\t\t/**\n\t\t * Gets the text editor value\n\t\t *\n\t\t * If using a plugin that filters the text like the BBCode plugin\n\t\t * it will return the result of the filtering which is BBCode to\n\t\t * HTML so it will return HTML. If filter is set to false it will\n\t\t * just return the contents of the source editor (BBCode).\n\t\t *\n\t\t * @param {boolean} [filter=true]\n\t\t * @return {string}\n\t\t * @function\n\t\t * @since 1.4.0\n\t\t * @name getSourceEditorValue\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.getSourceEditorValue = function (filter) {\n\t\t\tvar val = sourceEditor.value;\n\n\t\t\tif (filter !== false && 'toHtml' in format) {\n\t\t\t\tval = format.toHtml(val);\n\t\t\t}\n\n\t\t\treturn val;\n\t\t};\n\n\t\tbase.getSourceEditor = function () {\n\t\t\treturn sourceEditor;\n\t\t};\n\n\t\t/**\n\t\t * Sets the WYSIWYG HTML editor value. Should only be the HTML\n\t\t * contained within the body tags\n\t\t *\n\t\t * @param {string} value\n\t\t * @function\n\t\t * @name setWysiwygEditorValue\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.setWysiwygEditorValue = function (value) {\n\t\t\tif (!value) {\n\t\t\t\tvalue = '<p><br /></p>';\n\t\t\t}\n\n\t\t\twysiwygBody.innerHTML = sanitize(value);\n\n\t\t\tappendNewLine();\n\t\t\ttriggerValueChanged();\n\t\t\tautoExpand();\n\t\t};\n\n\t\t/**\n\t\t * Sets the text editor value\n\t\t *\n\t\t * @param {string} value\n\t\t * @function\n\t\t * @name setSourceEditorValue\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.setSourceEditorValue = function (value) {\n\t\t\tsourceEditor.value = value;\n\n\t\t\ttriggerValueChanged();\n\t\t};\n\n\t\t/**\n\t\t * Updates the textarea that the editor is replacing\n\t\t * with the value currently inside the editor.\n\t\t *\n\t\t * @function\n\t\t * @name updateOriginal\n\t\t * @since 1.4.0\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.updateOriginal = function () {\n\t\t\toriginal.value = base.val();\n\t\t};\n\n\t\t/**\n\t\t * If the editor is in source code mode\n\t\t *\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name inSourceMode\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.inSourceMode = function () {\n\t\t\treturn hasClass(editorContainer, 'sourceMode');\n\t\t};\n\n\t\t/**\n\t\t * Gets if the editor is in sourceMode\n\t\t *\n\t\t * @return boolean\n\t\t * @function\n\t\t * @name sourceMode\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\t/**\n\t\t * Sets if the editor is in sourceMode\n\t\t *\n\t\t * @param {boolean} enable\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name sourceMode^2\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.sourceMode = function (enable) {\n\t\t\tconst inSourceMode = base.inSourceMode();\n\n\t\t\tif (typeof enable !== 'boolean') {\n\t\t\t\treturn inSourceMode;\n\t\t\t}\n\n\t\t\tif ((inSourceMode && !enable) || (!inSourceMode && enable)) {\n\t\t\t\tbase.toggleSourceMode();\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Switches between the WYSIWYG and source modes\n\t\t *\n\t\t * @function\n\t\t * @name toggleSourceMode\n\t\t * @since 1.4.0\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.toggleSourceMode = function () {\n\t\t\tconst isInSourceMode = base.inSourceMode();\n\n\t\t\t// don't allow switching to WYSIWYG if doesn't support it\n\t\t\tif (!isWysiwygSupported && isInSourceMode) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!isInSourceMode) {\n\t\t\t\trangeHelper.saveRange();\n\t\t\t\trangeHelper.clear();\n\t\t\t}\n\n\t\t\tcurrentSelection = null;\n\t\t\tbase.blur();\n\n\t\t\tif (isInSourceMode) {\n\t\t\t\tbase.setWysiwygEditorValue(base.getSourceEditorValue());\n\t\t\t} else {\n\t\t\t\tbase.setSourceEditorValue(base.getWysiwygEditorValue());\n\t\t\t}\n\n\t\t\ttoggle(sourceEditor);\n\t\t\ttoggle(wysiwygEditor);\n\n\t\t\ttoggleClass(editorContainer, 'wysiwygMode', isInSourceMode);\n\t\t\ttoggleClass(editorContainer, 'sourceMode', !isInSourceMode);\n\n\t\t\tupdateToolBar();\n\t\t\tupdateActiveButtons();\n\n\t\t\tif (base.opts.onToggleMode !== undefined) {\n\t\t\t\tbase.opts.onToggleMode(base);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Gets the selected text of the source editor\n\t\t * @return {string}\n\t\t * @private\n\t\t */\n\t\tsourceEditorSelectedText = function () {\n\t\t\tsourceEditor.focus();\n\n\t\t\treturn sourceEditor.value.substring(\n\t\t\t\tsourceEditor.selectionStart,\n\t\t\t\tsourceEditor.selectionEnd\n\t\t\t);\n\t\t};\n\n\t\t/**\n\t\t * Handles the passed command\n\t\t * @private\n\t\t */\n\t\thandleCommand = function (caller, cmd) {\n\t\t\t// check if in text mode and handle text commands\n\t\t\tif (base.inSourceMode()) {\n\t\t\t\tif (cmd.txtExec) {\n\t\t\t\t\tif (Array.isArray(cmd.txtExec)) {\n\t\t\t\t\t\tbase.sourceEditorInsertText.apply(base, cmd.txtExec);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcmd.txtExec.call(base, caller, sourceEditorSelectedText());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (cmd.exec) {\n\t\t\t\tif (isFunction(cmd.exec)) {\n\t\t\t\t\tcmd.exec.call(base, caller);\n\t\t\t\t} else {\n\t\t\t\t\tbase.execCommand(\n\t\t\t\t\t\tcmd.exec,\n\t\t\t\t\t\tcmd.hasOwnProperty('execParam') ? cmd.execParam : null\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t};\n\n\t\t/**\n\t\t * Executes a command on the WYSIWYG editor\n\t\t *\n\t\t * @param {string} command\n\t\t * @param {String|Boolean} [param]\n\t\t * @function\n\t\t * @name execCommand\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.execCommand = function (command, param) {\n\t\t\tvar\texecuted    = false;\n\t\t\tconst commandObj = base.commands[command];\n\n\t\t\tbase.focus();\n\n\t\t\t// TODO: make configurable\n\t\t\t// don't apply any commands to code elements\n\t\t\tif (closest(rangeHelper.parentNode(), 'code')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\texecuted = wysiwygDocument.execCommand(command, false, param);\n\t\t\t} catch (_) { }\n\n\t\t\t// show error if execution failed and an error message exists\n\t\t\tif (!executed && commandObj && commandObj.errorMessage) {\n\t\t\t\t/*global alert:false*/\n\t\t\t\talert(base._(commandObj.errorMessage));\n\t\t\t}\n\n\t\t\tupdateActiveButtons();\n\t\t};\n\n\t\t/**\n\t\t * Checks if the current selection has changed and triggers\n\t\t * the selectionchanged event if it has.\n\t\t *\n\t\t * In browsers other that don't support selectionchange event it will check\n\t\t * at most once every 100ms.\n\t\t * @private\n\t\t */\n\t\tcheckSelectionChanged = function () {\n\t\t\tfunction check() {\n\t\t\t\t// Don't create new selection if there isn't one (like after\n\t\t\t\t// blur event in iOS)\n\t\t\t\tif (wysiwygWindow.getSelection() &&\n\t\t\t\t\twysiwygWindow.getSelection().rangeCount <= 0) {\n\t\t\t\t\tcurrentSelection = null;\n\t\t\t\t// rangeHelper could be null if editor was destroyed\n\t\t\t\t// before the timeout had finished\n\t\t\t\t} else if (rangeHelper && !rangeHelper.compare(currentSelection)) {\n\t\t\t\t\tcurrentSelection = rangeHelper.cloneSelected();\n\n\t\t\t\t\t// If the selection is in an inline wrap it in a block.\n\t\t\t\t\t// Fixes #331\n\t\t\t\t\tif (currentSelection && currentSelection.collapsed) {\n\t\t\t\t\t\tlet parent = currentSelection.startContainer;\n\t\t\t\t\t\tconst offset = currentSelection.startOffset;\n\n\t\t\t\t\t\t// Handle if selection is placed before/after an element\n\t\t\t\t\t\tif (offset && parent.nodeType !== TEXT_NODE) {\n\t\t\t\t\t\t\tparent = parent.childNodes[offset];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\twhile (parent && parent.parentNode !== wysiwygBody) {\n\t\t\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (parent && isInline(parent, true)) {\n\t\t\t\t\t\t\trangeHelper.saveRange();\n\t\t\t\t\t\t\twrapInlines(wysiwygBody, wysiwygDocument);\n\t\t\t\t\t\t\trangeHelper.restoreRange();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ttrigger(editorContainer, 'selectionchanged');\n\t\t\t\t}\n\n\t\t\t\tisSelectionCheckPending = false;\n\t\t\t}\n\n\t\t\tif (isSelectionCheckPending) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tisSelectionCheckPending = true;\n\n\t\t\t// Don't need to limit checking if browser supports the Selection API\n\t\t\tif ('onselectionchange' in wysiwygDocument) {\n\t\t\t\tcheck();\n\t\t\t} else {\n\t\t\t\tsetTimeout(check, 100);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Checks if the current node has changed and triggers\n\t\t * the nodechanged event if it has\n\t\t * @private\n\t\t */\n\t\tcheckNodeChanged = function () {\n\t\t\t// check if node has changed\n\t\t\tvar\toldNode;\n\t\t\tconst node = rangeHelper.parentNode();\n\n\t\t\tif (currentNode !== node) {\n\t\t\t\toldNode          = currentNode;\n\t\t\t\tcurrentNode      = node;\n\t\t\t\tcurrentBlockNode = rangeHelper.getFirstBlockParent(node);\n\n\t\t\t\ttrigger(editorContainer, 'nodechanged', {\n\t\t\t\t\toldNode: oldNode,\n\t\t\t\t\tnewNode: currentNode\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (backSpaceHandled) {\n\t\t\t\tcurrentBlockNode.querySelectorAll('span[style]').forEach(span => {\n\t\t\t\t\tif (span) {\n\t\t\t\t\t\tspan.outerHTML = span.innerHTML;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tbackSpaceHandled = false;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Gets the current node that contains the selection/caret in\n\t\t * WYSIWYG mode.\n\t\t *\n\t\t * Will be null in sourceMode or if there is no selection.\n\t\t *\n\t\t * @return {?Node}\n\t\t * @function\n\t\t * @name currentNode\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.currentNode = function () {\n\t\t\treturn currentNode;\n\t\t};\n\n\t\t/**\n\t\t * Gets the first block level node that contains the\n\t\t * selection/caret in WYSIWYG mode.\n\t\t *\n\t\t * Will be null in sourceMode or if there is no selection.\n\t\t *\n\t\t * @return {?Node}\n\t\t * @function\n\t\t * @name currentBlockNode\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.4\n\t\t */\n\t\tbase.currentBlockNode = function () {\n\t\t\treturn currentBlockNode;\n\t\t};\n\n\t\t/**\n\t\t * Updates if buttons are active or not\n\t\t * @private\n\t\t */\n\t\tupdateActiveButtons = function () {\n\t\t\tvar firstBlock, parent;\n\t\t\tvar activeClass = 'active';\n\t\t\tconst doc = wysiwygDocument;\n\t\t\tconst isSource = base.sourceMode();\n\n\t\t\tif (base.readOnly()) {\n\t\t\t\teach(find(toolbar, activeClass), function (_, menuItem) {\n\t\t\t\t\tremoveClass(menuItem, activeClass);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!isSource) {\n\t\t\t\tparent     = rangeHelper.parentNode();\n\t\t\t\tfirstBlock = rangeHelper.getFirstBlockParent(parent);\n\t\t\t}\n\n\t\t\tfor (let j = 0; j < btnStateHandlers.length; j++) {\n\t\t\t\tlet state = 0;\n\t\t\t\tconst btn = toolbarButtons[btnStateHandlers[j].name];\n\t\t\t\tconst stateFn = btnStateHandlers[j].state;\n\t\t\t\tconst isDisabled = (isSource && !btn._sceTxtMode) ||\n\t                (!isSource && !btn._sceWysiwygMode);\n\n\t\t\t\tif (isString(stateFn)) {\n\t\t\t\t\tif (!isSource) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tstate = doc.queryCommandEnabled(stateFn) ? 0 : -1;\n\n\t\t\t\t\t\t\t// eslint-disable-next-line max-depth\n\t\t\t\t\t\t\tif (state > -1) {\n\t\t\t\t\t\t\t\tstate = doc.queryCommandState(stateFn) ? 1 : 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (_) {}\n\t\t\t\t\t}\n\t\t\t\t} else if (!isDisabled) {\n\t\t\t\t\tstate = stateFn.call(base, parent, firstBlock);\n\t\t\t\t}\n\n\t\t\t\ttoggleClass(btn, 'disabled', isDisabled || state < 0);\n\t\t\t\ttoggleClass(btn, activeClass, state > 0);\n\t\t\t}\n\n\t\t\tif (icons && icons.update) {\n\t\t\t\ticons.update(isSource, parent, firstBlock);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Handles any key press in the WYSIWYG editor\n\t\t *\n\t\t * @private\n\t\t */\n\t\thandleKeyPress = function (e) {\n\t\t\t// FF bug: https://bugzilla.mozilla.org/show_bug.cgi?id=501496\n\t\t\tif (e.defaultPrevented) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbase.closeDropDown();\n\n\t\t\t// 13 = enter key\n\t\t\tif (e.which === 13) {\n\t\t\t\tconst LIST_TAGS = 'li,ul,ol';\n\n\t\t\t\t// \"Fix\" (cludge) for blocklevel elements being duplicated in some\n\t\t\t\t// browsers when enter is pressed instead of inserting a newline\n\t\t\t\tif (!is(currentBlockNode, LIST_TAGS) &&\n\t\t\t\t\thasStyling(currentBlockNode)) {\n\n\t\t\t\t\tconst br = createElement('br', {}, wysiwygDocument);\n\t\t\t\t\trangeHelper.insertNode(br);\n\n\t\t\t\t\t// Last <br> of a block will be collapsed  so need to make sure\n\t\t\t\t\t// the <br> that was inserted isn't the last node of a block.\n\t\t\t\t\tconst parent = br.parentNode;\n\t\t\t\t\tlet lastChild = parent.lastChild;\n\n\t\t\t\t\t// Sometimes an empty next node is created after the <br>\n\t\t\t\t\tif (lastChild && lastChild.nodeType === TEXT_NODE &&\n\t\t\t\t\t\tlastChild.nodeValue === '') {\n\t\t\t\t\t\tremove(lastChild);\n\t\t\t\t\t\tlastChild = parent.lastChild;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If this is the last BR of a block and the previous\n\t\t\t\t\t// sibling is inline then will need an extra BR. This\n\t\t\t\t\t// is needed because the last BR of a block will be\n\t\t\t\t\t// collapsed. Fixes issue #248\n\t\t\t\t\tif (!isInline(parent, true) && lastChild === br &&\n\t\t\t\t\t\tisInline(br.previousSibling)) {\n\t\t\t\t\t\trangeHelper.insertHTML('<br>');\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Makes sure that if there is a code or quote tag at the\n\t\t * end of the editor, that there is a new line after it.\n\t\t *\n\t\t * If there wasn't a new line at the end you wouldn't be able\n\t\t * to enter any text after a code/quote tag\n\t\t * @return {void}\n\t\t * @private\n\t\t */\n\t\tappendNewLine = function () {\n\t\t\t// Check all nodes in reverse until either add a new line\n\t\t\t// or reach a non-empty textnode or BR at which point can\n\t\t\t// stop checking.\n\t\t\trTraverse(wysiwygBody, function (node) {\n\t\t\t\t// Last block, add new line after if has styling\n\t\t\t\tif (node.nodeType === ELEMENT_NODE &&\n\t\t\t\t\t!/inline/.test(css(node, 'display'))) {\n\n\t\t\t\t\t// Add line break after if has styling\n\t\t\t\t\tif (!is(node, '.sceditor-nlf') && hasStyling(node)) {\n\t\t\t\t\t\tconst paragraph = createElement('p', {}, wysiwygDocument);\n\t\t\t\t\t\tparagraph.className = 'sceditor-nlf';\n\t\t\t\t\t\tparagraph.innerHTML = '<br />';\n\t\t\t\t\t\tappendChild(wysiwygBody, paragraph);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Last non-empty text node or line break.\n\t\t\t\t// No need to add line-break after them\n\t\t\t\tif ((node.nodeType === 3 && !/^\\s*$/.test(node.nodeValue)) ||\n\t\t\t\t\tis(node, 'br')) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Handles form reset event\n\t\t * @private\n\t\t */\n\t\thandleFormReset = function () {\n\t\t\tbase.val(original.value);\n\t\t};\n\n\t\t/**\n\t\t * Handles any mousedown press in the WYSIWYG editor\n\t\t * @private\n\t\t */\n\t\thandleMouseDown = function () {\n\t\t\tbase.closeDropDown();\n\t\t};\n\n\t\t/**\n\t\t * Translates the string into the locale language.\n\t\t *\n\t\t * Replaces any {0}, {1}, {2}, ect. with the params provided.\n\t\t *\n\t\t * @param {string} str\n\t\t * @param {...String} args\n\t\t * @return {string}\n\t\t * @function\n\t\t * @name _\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase._ = function () {\n\t\t\tvar\tundef,\n\t\t\t\targs = arguments;\n\n\t\t\tif (locale && locale[args[0]]) {\n\t\t\t\targs[0] = locale[args[0]];\n\t\t\t} else {\n\t\t\t\tif (options.locale !== 'en') {\n\t\t\t\t\t/*(async () => {\n\t\t\t\t\t//var translatedText = await translateText(args[0], 'zh-tw');\n\t\t\t\t\t//console.log(`'${args[0]}': '${translatedText}',`);\n\t\t\t\t    })();*/\n\n\t\t\t\t\tconsole.info(`translation for '${args[0]}' is missing for locale '${options.locale}'`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn args[0].replace(/\\{(\\d+)\\}/g, function (str, p1) {\n\t\t\t\treturn args[p1 - 0 + 1] !== undef ?\n\t\t\t\t\targs[p1 - 0 + 1] :\n\t\t\t\t\t`{${p1}}`;\n\t\t\t});\n\t\t};\n\n\t\t/*async function translateText(text, targetLang) {\n\t\t\ttry {\n\t\t\t\tconst url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`;\n\n\t\t\t\tconst res = await fetch(url);\n\t\t\t\tif (!res.ok) {\n\t\t\t\t\tthrow new Error(`HTTP error! Status: ${res.status}`);\n\t\t\t\t}\n\n\t\t\t\tconst data = await res.json();\n\n\t\t\t\t// Extract translated text\n\t\t\t\tif (Array.isArray(data) && data[0] && Array.isArray(data[0][0])) {\n\t\t\t\t\treturn data[0].map(sentence => sentence[0]).join(' ');\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('Unexpected response format');\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Translation failed:', error.message);\n\t\t\t\treturn 'Error during translation.';\n\t\t\t}\n\t\t}*/\n\n\n\t\t/**\n\t\t * Passes events on to any handlers\n\t\t * @private\n\t\t * @return void\n\t\t */\n\t\thandleEvent = function (e) {\n\t\t\tif (pluginManager) {\n\t\t\t\t// Send event to all plugins\n\t\t\t\tpluginManager.call(e.type + 'Event', e, base);\n\t\t\t}\n\n\t\t\t// convert the event into a custom event to send\n\t\t\tconst name = (e.target === sourceEditor ? 'scesrc' : 'scewys') + e.type;\n\n\t\t\tif (eventHandlers[name]) {\n\t\t\t\teventHandlers[name].forEach(function (fn) {\n\t\t\t\t\tfn.call(base, e);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Binds a handler to the specified events\n\t\t *\n\t\t * This function only binds to a limited list of\n\t\t * supported events.\n\t\t *\n\t\t * The supported events are:\n\t\t *\n\t\t * * keyup\n\t\t * * keydown\n\t\t * * Keypress\n\t\t * * blur\n\t\t * * focus\n\t\t * * input\n\t\t * * nodechanged - When the current node containing\n\t\t * \t\tthe selection changes in WYSIWYG mode\n\t\t * * contextmenu\n\t\t * * selectionchanged\n\t\t * * valuechanged\n\t\t *\n\t\t *\n\t\t * The events param should be a string containing the event(s)\n\t\t * to bind this handler to. If multiple, they should be separated\n\t\t * by spaces.\n\t\t *\n\t\t * @param  {string} events\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  if to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name bind\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.bind = function (events, handler, excludeWysiwyg, excludeSource) {\n\t\t\tevents = events.split(' ');\n\n\t\t\tvar i  = events.length;\n\t\t\twhile (i--) {\n\t\t\t\tif (isFunction(handler)) {\n\t\t\t\t\tconst wysEvent = 'scewys' + events[i];\n\t\t\t\t\tconst srcEvent = 'scesrc' + events[i];\n\t\t\t\t\t// Use custom events to allow passing the instance as the\n\t\t\t\t\t// 2nd argument.\n\t\t\t\t\t// Also allows unbinding without unbinding the editors own\n\t\t\t\t\t// event handlers.\n\t\t\t\t\tif (!excludeWysiwyg) {\n\t\t\t\t\t\teventHandlers[wysEvent] = eventHandlers[wysEvent] || [];\n\t\t\t\t\t\teventHandlers[wysEvent].push(handler);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!excludeSource) {\n\t\t\t\t\t\teventHandlers[srcEvent] = eventHandlers[srcEvent] || [];\n\t\t\t\t\t\teventHandlers[srcEvent].push(handler);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Start sending value changed events\n\t\t\t\t\tif (events[i] === 'valuechanged') {\n\t\t\t\t\t\ttriggerValueChanged.hasHandler = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Unbinds an event that was bound using bind().\n\t\t *\n\t\t * @param  {string} events\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude unbinding this\n\t\t *                                  handler from the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  if to exclude unbinding this\n\t\t *                                  handler from the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name unbind\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t * @see bind\n\t\t */\n\t\tbase.unbind = function (events, handler, excludeWysiwyg, excludeSource) {\n\t\t\tevents = events.split(' ');\n\n\t\t\tvar i  = events.length;\n\t\t\twhile (i--) {\n\t\t\t\tif (isFunction(handler)) {\n\t\t\t\t\tif (!excludeWysiwyg) {\n\t\t\t\t\t\tarrayRemove(\n\t\t\t\t\t\t\teventHandlers['scewys' + events[i]] || [], handler);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!excludeSource) {\n\t\t\t\t\t\tarrayRemove(\n\t\t\t\t\t\t\teventHandlers['scesrc' + events[i]] || [], handler);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Blurs the editors input area\n\t\t *\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name blur\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.3.6\n\t\t */\n\t\t/**\n\t\t * Adds a handler to the editors blur event\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  if to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name blur^2\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.blur = function (handler, excludeWysiwyg, excludeSource) {\n\t\t\tif (isFunction(handler)) {\n\t\t\t\tbase.bind('blur', handler, excludeWysiwyg, excludeSource);\n\t\t\t} else if (!base.sourceMode()) {\n\t\t\t\twysiwygBody.blur();\n\t\t\t} else {\n\t\t\t\tsourceEditor.blur();\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Focuses the editors input area\n\t\t *\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name focus\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\t/**\n\t\t * Adds an event handler to the focus event\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  if to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name focus^2\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.focus = function (handler, excludeWysiwyg, excludeSource) {\n\t\t\tif (isFunction(handler)) {\n\t\t\t\tbase.bind('focus', handler, excludeWysiwyg, excludeSource);\n\t\t\t} else if (!base.inSourceMode()) {\n\t\t\t\t// Already has focus so do nothing\n\t\t\t\tif (find(wysiwygDocument, ':focus').length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst rng = rangeHelper.selectedRange();\n\n\t\t\t\t// Fix FF bug where it shows the cursor in the wrong place\n\t\t\t\t// if the editor hasn't had focus before. See issue #393\n\t\t\t\tif (!currentSelection) {\n\t\t\t\t\tautofocus(true);\n\t\t\t\t}\n\n\t\t\t\t// Check if cursor is set after a BR when the BR is the only\n\t\t\t\t// child of the parent. In Firefox this causes a line break\n\t\t\t\t// to occur when something is typed. See issue #321\n\t\t\t\tif (rng && rng.endOffset === 1 && rng.collapsed) {\n\t\t\t\t\tlet container;\n\t\t\t\t\tcontainer = rng.endContainer;\n\n\t\t\t\t\tif (container && container.childNodes.length === 1 &&\n\t\t\t\t\t\tis(container.firstChild, 'br')) {\n\t\t\t\t\t\trng.setStartBefore(container.firstChild);\n\t\t\t\t\t\trng.collapse(true);\n\t\t\t\t\t\trangeHelper.selectRange(rng);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twysiwygWindow.focus();\n\t\t\t\twysiwygBody.focus();\n\t\t\t} else {\n\t\t\t\tsourceEditor.focus();\n\t\t\t}\n\n\t\t\tupdateActiveButtons();\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Adds a handler to the key down event\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  If to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name keyDown\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.keyDown = function (handler, excludeWysiwyg, excludeSource) {\n\t\t\treturn base.bind('keydown', handler, excludeWysiwyg, excludeSource);\n\t\t};\n\n\t\t/**\n\t\t * Adds a handler to the key press event\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  If to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name keyPress\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.keyPress = function (handler, excludeWysiwyg, excludeSource) {\n\t\t\treturn base\n\t\t\t\t.bind('keypress', handler, excludeWysiwyg, excludeSource);\n\t\t};\n\n\t\t/**\n\t\t * Adds a handler to the key up event\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  If to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name keyUp\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.keyUp = function (handler, excludeWysiwyg, excludeSource) {\n\t\t\treturn base.bind('keyup', handler, excludeWysiwyg, excludeSource);\n\t\t};\n\n\t\t/**\n\t\t * Adds a handler to the node changed event.\n\t\t *\n\t\t * Happens whenever the node containing the selection/caret\n\t\t * changes in WYSIWYG mode.\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name nodeChanged\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.nodeChanged = function (handler) {\n\t\t\treturn base.bind('nodechanged', handler, false, true);\n\t\t};\n\n\t\t/**\n\t\t * Adds a handler to the selection changed event\n\t\t *\n\t\t * Happens whenever the selection changes in WYSIWYG mode.\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name selectionChanged\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.selectionChanged = function (handler) {\n\t\t\treturn base.bind('selectionchanged', handler, false, true);\n\t\t};\n\n\t\t/**\n\t\t * Adds a handler to the value changed event\n\t\t *\n\t\t * Happens whenever the current editor value changes.\n\t\t *\n\t\t * Whenever anything is inserted, the value changed or\n\t\t * 1.5 secs after text is typed. If a space is typed it will\n\t\t * cause the event to be triggered immediately instead of\n\t\t * after 1.5 seconds\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  If to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name valueChanged\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.5\n\t\t */\n\t\tbase.valueChanged = function (handler, excludeWysiwyg, excludeSource) {\n\t\t\treturn base\n\t\t\t\t.bind('valuechanged', handler, excludeWysiwyg, excludeSource);\n\t\t};\n\n\t\t/**\n\t\t * Gets the current WYSIWYG editors inline CSS\n\t\t *\n\t\t * @return {string}\n\t\t * @function\n\t\t * @name css\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.3\n\t\t */\n\t\t/**\n\t\t * Sets inline CSS for the WYSIWYG editor\n\t\t *\n\t\t * @param {string} css\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name css^2\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.3\n\t\t */\n\t\tbase.css = function (css) {\n\t\t\tif (!inlineCss) {\n\t\t\t\tinlineCss = createElement('style', {\n\t\t\t\t\tid: 'inline'\n\t\t\t\t}, wysiwygDocument);\n\n\t\t\t\tappendChild(wysiwygDocument.head, inlineCss);\n\t\t\t}\n\n\t\t\tif (!isString(css)) {\n\t\t\t\treturn inlineCss.styleSheet ?\n\t\t\t\t\tinlineCss.styleSheet.cssText : inlineCss.innerHTML;\n\t\t\t}\n\n\t\t\tif (inlineCss.styleSheet) {\n\t\t\t\tinlineCss.styleSheet.cssText = css;\n\t\t\t} else {\n\t\t\t\tinlineCss.innerHTML = css;\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Handles the keydown event, used for shortcuts\n\t\t * @private\n\t\t */\n\t\thandleKeyDown = function (e) {\n\t\t\tvar autoClosingTags = [\n\t\t\t\t'b', 'i', 'u', 'h', 'code', 'img', 'quote', 'left', 'center', 'right',\n\t\t\t\t'list', 'color',\n\t\t\t\t'size', 'albumimg', 'attach', 'youtube', 'vimeo',\n\t\t\t\t'instagram', 'twitter', 'facebook', 'googlewidget', 'spoiler', 'userlink', 'googlemaps',\n\t\t\t\t'hide', 'group-hide', 'hide-thanks', 'hide-reply-thanks', 'hide-reply', 'hide-posts', 'dailymotion',\n\t\t\t\t'audio', 'media','note'\n\t\t\t];\n\n\t\t\tvar\tshortcut   = [],\n\t\t\t\tSHIFT_KEYS = {\n\t\t\t\t\t'`': '~',\n\t\t\t\t\t'1': '!',\n\t\t\t\t\t'2': '@',\n\t\t\t\t\t'3': '#',\n\t\t\t\t\t'4': '$',\n\t\t\t\t\t'5': '%',\n\t\t\t\t\t'6': '^',\n\t\t\t\t\t'7': '&',\n\t\t\t\t\t'8': '*',\n\t\t\t\t\t'9': '(',\n\t\t\t\t\t'0': ')',\n\t\t\t\t\t'-': '_',\n\t\t\t\t\t'=': '+',\n\t\t\t\t\t';': ': ',\n\t\t\t\t\t'\\'': '\"',\n\t\t\t\t\t',': '<',\n\t\t\t\t\t'.': '>',\n\t\t\t\t\t'/': '?',\n\t\t\t\t\t'\\\\': '|',\n\t\t\t\t\t'[': '{',\n\t\t\t\t\t']': '}'\n\t\t\t\t},\n\t\t\t\tSPECIAL_KEYS = {\n\t\t\t\t\t8: 'backspace',\n\t\t\t\t\t9: 'tab',\n\t\t\t\t\t13: 'enter',\n\t\t\t\t\t19: 'pause',\n\t\t\t\t\t20: 'capslock',\n\t\t\t\t\t27: 'esc',\n\t\t\t\t\t32: 'space',\n\t\t\t\t\t33: 'pageup',\n\t\t\t\t\t34: 'pagedown',\n\t\t\t\t\t35: 'end',\n\t\t\t\t\t36: 'home',\n\t\t\t\t\t37: 'left',\n\t\t\t\t\t38: 'up',\n\t\t\t\t\t39: 'right',\n\t\t\t\t\t40: 'down',\n\t\t\t\t\t45: 'insert',\n\t\t\t\t\t46: 'del',\n\t\t\t\t\t91: 'win',\n\t\t\t\t\t92: 'win',\n\t\t\t\t\t93: 'select',\n\t\t\t\t\t96: '0',\n\t\t\t\t\t97: '1',\n\t\t\t\t\t98: '2',\n\t\t\t\t\t99: '3',\n\t\t\t\t\t100: '4',\n\t\t\t\t\t101: '5',\n\t\t\t\t\t102: '6',\n\t\t\t\t\t103: '7',\n\t\t\t\t\t104: '8',\n\t\t\t\t\t105: '9',\n\t\t\t\t\t106: '*',\n\t\t\t\t\t107: '+',\n\t\t\t\t\t109: '-',\n\t\t\t\t\t110: '.',\n\t\t\t\t\t111: '/',\n\t\t\t\t\t112: 'f1',\n\t\t\t\t\t113: 'f2',\n\t\t\t\t\t114: 'f3',\n\t\t\t\t\t115: 'f4',\n\t\t\t\t\t116: 'f5',\n\t\t\t\t\t117: 'f6',\n\t\t\t\t\t118: 'f7',\n\t\t\t\t\t119: 'f8',\n\t\t\t\t\t120: 'f9',\n\t\t\t\t\t121: 'f10',\n\t\t\t\t\t122: 'f11',\n\t\t\t\t\t123: 'f12',\n\t\t\t\t\t144: 'numlock',\n\t\t\t\t\t145: 'scrolllock',\n\t\t\t\t\t186: ';',\n\t\t\t\t\t187: '=',\n\t\t\t\t\t188: ',',\n\t\t\t\t\t189: '-',\n\t\t\t\t\t190: '.',\n\t\t\t\t\t191: '/',\n\t\t\t\t\t192: '`',\n\t\t\t\t\t219: '[',\n\t\t\t\t\t220: '\\\\',\n\t\t\t\t\t221: ']',\n\t\t\t\t\t222: '\\''\n\t\t\t\t},\n\t\t\t\tNUMPAD_SHIFT_KEYS = {\n\t\t\t\t\t109: '-',\n\t\t\t\t\t110: 'del',\n\t\t\t\t\t111: '/',\n\t\t\t\t\t96: '0',\n\t\t\t\t\t97: '1',\n\t\t\t\t\t98: '2',\n\t\t\t\t\t99: '3',\n\t\t\t\t\t100: '4',\n\t\t\t\t\t101: '5',\n\t\t\t\t\t102: '6',\n\t\t\t\t\t103: '7',\n\t\t\t\t\t104: '8',\n\t\t\t\t\t105: '9'\n\t\t\t\t},\n\t\t\t\twhich     = e.which,\n\t\t\t\tcharacter = SPECIAL_KEYS[which] ||\n\t\t\t\t\tString.fromCharCode(which).toLowerCase();\n\n\t\t\tif (e.ctrlKey || e.metaKey) {\n\t\t\t\tshortcut.push('ctrl');\n\t\t\t}\n\n\t\t\tif (e.altKey) {\n\t\t\t\tshortcut.push('alt');\n\t\t\t}\n\n\t\t\tif (e.shiftKey) {\n\t\t\t\tshortcut.push('shift');\n\n\t\t\t\tif (NUMPAD_SHIFT_KEYS[which]) {\n\t\t\t\t\tcharacter = NUMPAD_SHIFT_KEYS[which];\n\t\t\t\t} else if (SHIFT_KEYS[character]) {\n\t\t\t\t\tcharacter = SHIFT_KEYS[character];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Shift is 16, ctrl is 17 and alt is 18\n\t\t\tif (character && (which < 16 || which > 18)) {\n\t\t\t\tshortcut.push(character);\n\t\t\t}\n\n\t\t\tshortcut = shortcut.join('+');\n\t\t\tif (shortcutHandlers[shortcut] &&\n\t\t\t\tshortcutHandlers[shortcut].call(base) === false) {\n\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\t// Close tag ']'\n\t\t\tif (e.key === ']' && base.inSourceMode()) {\n\t\t\t\tvar input = sourceEditor;\n\n\t\t\t\tconst position = input.selectionStart;\n\t\t\t\tconst before = input.value.slice(0, position);\n\t\t\t\tconst after = input.value.slice(input.selectionEnd, input.value.length);\n\t\t\t\tlet tagName;\n\n\t\t\t\ttry {\n\t\t\t\t\ttagName = before.match(/\\[([^\\]]+)$/)[1].match(/^([a-z1-6]+)/)[1];\n\t\t\t\t} catch (_) {\n\t\t\t\t\t// ignore\n\t\t\t\t}\n\n\t\t\t\tif (autoClosingTags.indexOf(tagName) > -1) {\n\t\t\t\t\tconst closeTag = `[/${tagName}]`;\n\n\t\t\t\t\tinput.value = before + closeTag + after;\n\t\t\t\t\tinput.selectionStart =\n\t\t\t\t\t\tinput.selectionEnd = position;\n\t\t\t\t\tinput.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Adds a shortcut handler to the editor\n\t\t * @param  {string}          shortcut\n\t\t * @param  {String|Function} cmd\n\t\t * @return {sceditor}\n\t\t */\n\t\tbase.addShortcut = function (shortcut, cmd) {\n\t\t\tshortcut = shortcut.toLowerCase();\n\n\t\t\tif (isString(cmd)) {\n\t\t\t\tshortcutHandlers[shortcut] = function () {\n\t\t\t\t\thandleCommand(toolbarButtons[cmd], base.commands[cmd]);\n\n\t\t\t\t\treturn false;\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tshortcutHandlers[shortcut] = cmd;\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Removes a shortcut handler\n\t\t * @param  {string} shortcut\n\t\t * @return {sceditor}\n\t\t */\n\t\tbase.removeShortcut = function (shortcut) {\n\t\t\tdelete shortcutHandlers[shortcut.toLowerCase()];\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Handles the backspace key press\n\t\t *\n\t\t * Will remove block styling like quotes/code ect if at the start.\n\t\t * @private\n\t\t */\n\t\thandleBackSpace = function (e) {\n\t\t\tvar node, offset, range, parent;\n\n\t\t\t// 8 is the backspace key\n\t\t\tif (e.which !== 8) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbackSpaceHandled = true;\n\n\t\t\tif (options.disableBlockRemove ||\n\t\t\t\t!(range = rangeHelper.selectedRange())) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnode   = range.startContainer;\n\t\t\toffset = range.startOffset;\n\n\t\t\tif (offset !== 0 || !(parent = currentStyledBlockNode()) ||\n\t\t\t\tis(parent, 'body')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twhile (node !== parent) {\n\t\t\t\twhile (node.previousSibling) {\n\t\t\t\t\tnode = node.previousSibling;\n\n\t\t\t\t\t// Everything but empty text nodes before the cursor\n\t\t\t\t\t// should prevent the style from being removed\n\t\t\t\t\tif (node.nodeType !== TEXT_NODE || node.nodeValue) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!(node = node.parentNode)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// The backspace was pressed at the start of\n\t\t\t// the container so clear the style\n\t\t\tbase.clearBlockFormatting(parent);\n\t\t\te.preventDefault();\n\t\t};\n\n\t\t/**\n\t\t * Gets the first styled block node that contains the cursor\n\t\t * @return {HTMLElement}\n\t\t */\n\t\tcurrentStyledBlockNode = function () {\n\t\t\tvar block = currentBlockNode;\n\n\t\t\twhile (!hasStyling(block) || isInline(block, true)) {\n\t\t\t\tif (!(block = block.parentNode) || is(block, 'body')) {\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn block;\n\t\t};\n\n\t\t/**\n\t\t * Clears the formatting of the passed block element.\n\t\t *\n\t\t * If block is false, if will clear the styling of the first\n\t\t * block level element that contains the cursor.\n\t\t * @param  {HTMLElement} block\n\t\t * @since 1.4.4\n\t\t */\n\t\tbase.clearBlockFormatting = function (block) {\n\t\t\tblock = block || currentStyledBlockNode();\n\n\t\t\tif (!block || is(block, 'body')) {\n\t\t\t\treturn base;\n\t\t\t}\n\n\t\t\trangeHelper.saveRange();\n\n\t\t\tblock.className = '';\n\n\t\t\tattr(block, 'style', '');\n\n\t\t\tif (!is(block, 'p,div,td')) {\n\t\t\t\tconvertElement(block, 'p');\n\t\t\t}\n\n\t\t\trangeHelper.restoreRange();\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Triggers the valueChanged signal if there is\n\t\t * a plugin that handles it.\n\t\t *\n\t\t * If rangeHelper.saveRange() has already been\n\t\t * called, then saveRange should be set to false\n\t\t * to prevent the range being saved twice.\n\t\t *\n\t\t * @since 1.4.5\n\t\t * @param {boolean} saveRange If to call rangeHelper.saveRange().\n\t\t * @private\n\t\t */\n\t\ttriggerValueChanged = function (saveRange) {\n\t\t\tif (!pluginManager ||\n\t\t\t\t(!pluginManager.hasHandler('valuechangedEvent') &&\n\t\t\t\t\t!triggerValueChanged.hasHandler)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar\tcurrentHtml;\n\t\t\tconst sourceMode = base.sourceMode();\n\t\t\tconst hasSelection = !sourceMode && rangeHelper.hasSelection();\n\n\t\t\t// Composition end isn't guaranteed to fire but must have\n\t\t\t// ended when triggerValueChanged() is called so reset it\n\t\t\tisComposing = false;\n\n\t\t\t// Don't need to save the range if sceditor-start-marker\n\t\t\t// is present as the range is already saved\n\t\t\tsaveRange = saveRange !== false &&\n\t\t\t\t!wysiwygDocument.getElementById('sceditor-start-marker');\n\n\t\t\t// Clear any current timeout as it's now been triggered\n\t\t\tif (valueChangedKeyUpTimer) {\n\t\t\t\tclearTimeout(valueChangedKeyUpTimer);\n\t\t\t\tvalueChangedKeyUpTimer = false;\n\t\t\t}\n\n\t\t\tif (hasSelection && saveRange) {\n\t\t\t\trangeHelper.saveRange();\n\t\t\t}\n\n\t\t\tcurrentHtml = sourceMode ? sourceEditor.value : wysiwygBody.innerHTML;\n\n\t\t\t// Only trigger if something has actually changed.\n\t\t\tif (currentHtml !== triggerValueChanged.lastVal) {\n\t\t\t\ttriggerValueChanged.lastVal = currentHtml;\n\n\t\t\t\ttrigger(editorContainer, 'valuechanged', {\n\t\t\t\t\trawValue: sourceMode ? base.val() : currentHtml\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (hasSelection && saveRange) {\n\t\t\t\trangeHelper.removeMarkers();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Should be called whenever there is a blur event\n\t\t * @private\n\t\t */\n\t\tvalueChangedBlur = function () {\n\t\t\tif (valueChangedKeyUpTimer) {\n\t\t\t\ttriggerValueChanged();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Should be called whenever there is a keypress event\n\t\t * @param  {Event} e The keypress event\n\t\t * @private\n\t\t */\n\t\tvalueChangedKeyUp = function (e) {\n\t\t\tconst which = e.which;\n\t\t\tconst lastChar = valueChangedKeyUp.lastChar;\n\t\t\tconst lastWasSpace = (lastChar === 13 || lastChar === 32);\n\t\t\tconst lastWasDelete = (lastChar === 8 || lastChar === 46);\n\n\t\t\tvalueChangedKeyUp.lastChar = which;\n\n\t\t\tif (isComposing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 13 = return & 32 = space\n\t\t\tif (which === 13 || which === 32) {\n\t\t\t\tif (!lastWasSpace) {\n\t\t\t\t\ttriggerValueChanged();\n\t\t\t\t} else {\n\t\t\t\t\tvalueChangedKeyUp.triggerNext = true;\n\t\t\t\t}\n\t\t\t// 8 = backspace & 46 = del\n\t\t\t} else if (which === 8 || which === 46) {\n\t\t\t\tif (!lastWasDelete) {\n\t\t\t\t\ttriggerValueChanged();\n\t\t\t\t} else {\n\t\t\t\t\tvalueChangedKeyUp.triggerNext = true;\n\t\t\t\t}\n\t\t\t} else if (valueChangedKeyUp.triggerNext) {\n\t\t\t\ttriggerValueChanged();\n\t\t\t\tvalueChangedKeyUp.triggerNext = false;\n\t\t\t}\n\n\t\t\t// Clear the previous timeout and set a new one.\n\t\t\tclearTimeout(valueChangedKeyUpTimer);\n\n\t\t\t// Trigger the event 1.5s after the last keypress if space\n\t\t\t// isn't pressed. This might need to be lowered, will need\n\t\t\t// to look into what the slowest average Chars Per Min is.\n\t\t\tvalueChangedKeyUpTimer = setTimeout(function () {\n\t\t\t\tif (!isComposing) {\n\t\t\t\t\ttriggerValueChanged();\n\t\t\t\t}\n\t\t\t}, 1500);\n\t\t};\n\n\t\thandleComposition = function (e) {\n\t\t\tisComposing = /start/i.test(e.type);\n\n\t\t\tif (!isComposing) {\n\t\t\t\ttriggerValueChanged();\n\t\t\t}\n\t\t};\n\n\t\tautoUpdate = function () {\n\t\t\tbase.updateOriginal();\n\t\t};\n\n\t\t// run the initializer\n\t\tloadScripts();\n\t}\n\n\t/**\n\t * Map containing the loaded SCEditor locales\n\t * @type {Object}\n\t * @name locale\n\t * @memberOf sceditor\n\t */\n\tSCEditor.locale = {};\n\n\tSCEditor.formats = {};\n\tSCEditor.icons = {};\n\n\n\t/**\n\t * Static command helper class\n\t * @class command\n\t * @name sceditor.command\n\t */\n\tSCEditor.command =\n\t/** @lends sceditor.command */\n\t{\n\t\t/**\n\t\t * Gets a command\n\t\t *\n\t\t * @param {string} name\n\t\t * @return {Object|null}\n\t\t * @since v1.3.5\n\t\t */\n\t\tget: function (name) {\n\t\t\treturn defaultCmds[name] || null;\n\t\t},\n\n\t\t/**\n\t\t * <p>Adds a command to the editor or updates an existing\n\t\t * command if a command with the specified name already exists.</p>\n\t\t *\n\t\t * <p>Once a command is add it can be included in the toolbar by\n\t\t * adding it's name to the toolbar option in the constructor. It\n\t\t * can also be executed manually by calling\n\t\t * {@link sceditor.execCommand}</p>\n\t\t *\n\t\t * @example\n\t\t * SCEditor.command.set(\"hello\",\n\t\t * {\n\t\t *     exec: function () {\n\t\t *         alert(\"Hello World!\");\n\t\t *     }\n\t\t * });\n\t\t *\n\t\t * @param {string} name\n\t\t * @param {Object} cmd\n\t\t * @return {this|false} Returns false if name or cmd is false\n\t\t * @since v1.3.5\n\t\t */\n\t\tset: function (name, cmd) {\n\t\t\tif (!name || !cmd) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// merge any existing command properties\n\t\t\tcmd = extend(defaultCmds[name] || {}, cmd);\n\n\t\t\tcmd.remove = function () {\n\t\t\t\tSCEditor.command.remove(name);\n\t\t\t};\n\n\t\t\tdefaultCmds[name] = cmd;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes a command\n\t\t *\n\t\t * @param {string} name\n\t\t * @return {this}\n\t\t * @since v1.3.5\n\t\t */\n\t\tremove: function (name) {\n\t\t\tif (defaultCmds[name]) {\n\t\t\t\tdelete defaultCmds[name];\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t};\n\n\t/**\n\t * SCEditor\n\t * http://www.sceditor.com/\n\t *\n\t * Copyright (C) 2011-2026, Sam Clarke (samclarke.com)\n\t *\n\t * SCEditor is licensed under the MIT license:\n\t *\thttp://www.opensource.org/licenses/mit-license.php\n\t *\n\t * @fileoverview SCEditor - A lightweight WYSIWYG BBCode and HTML editor\n\t * @author Sam Clarke\n\t */\n\n\n\twindow.sceditor = {\n\t\tcommand: SCEditor.command,\n\t\tcommands: defaultCmds,\n\t\tdefaultOptions: defaultOptions,\n\n\t\tios: ios,\n\t\tisWysiwygSupported: isWysiwygSupported,\n\n\t\tregexEscape: regex,\n\t\tescapeEntities: entities,\n\t\tescapeUriScheme: uriScheme,\n\n\t\tdom: {\n\t\t\tcss: css,\n\t\t\tattr: attr,\n\t\t\tremoveAttr: removeAttr,\n\t\t\tis: is,\n\t\t\tclosest: closest,\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\ttraverse: traverse,\n\t\t\trTraverse: rTraverse,\n\t\t\tparseHTML: parseHTML,\n\t\t\thasStyling: hasStyling,\n\t\t\tconvertElement: convertElement,\n\t\t\tblockLevelList: blockLevelList,\n\t\t\tcanHaveChildren: canHaveChildren,\n\t\t\tisInline: isInline,\n\t\t\tcopyCSS: copyCSS,\n\t\t\tfixNesting: fixNesting,\n\t\t\tfindCommonAncestor: findCommonAncestor,\n\t\t\tgetSibling: getSibling,\n\t\t\tremoveWhiteSpace: removeWhiteSpace,\n\t\t\textractContents: extractContents,\n\t\t\tgetOffset: getOffset,\n\t\t\tgetStyle: getStyle,\n\t\t\thasStyle: hasStyle\n\t\t},\n\t\tlocale: SCEditor.locale,\n\t\ticons: SCEditor.icons,\n\t\tutils: {\n\t\t\teach: each,\n\t\t\tisEmptyObject: isEmptyObject,\n\t\t\textend: extend\n\t\t},\n\t\tplugins: PluginManager.plugins,\n\t\tformats: SCEditor.formats,\n\t\tcreate: function (textarea, options) {\n\t\t\toptions = options || {};\n\n\t\t\t// Don't allow the editor to be initialised\n\t\t\t// on it's own source editor\n\t\t\tif (parent(textarea, '.sceditor-container')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (options.runWithoutWysiwygSupport || isWysiwygSupported) {\n\t\t\t\t/*eslint no-new: off*/\n\t\t\t\t(new SCEditor(textarea, options));\n\t\t\t}\n\t\t},\n\t\tinstance: function (textarea) {\n\t\t\treturn textarea._sceditor;\n\t\t}\n\t};\n\n})();\n","/**\n * SCEditor BBCode Plugin\n * http://www.sceditor.com/\n *\n * Copyright (C) 2011-2026, Sam Clarke (samclarke.com)\n *\n * SCEditor is licensed under the MIT license:\n *\thttp://www.opensource.org/licenses/mit-license.php\n *\n * @fileoverview SCEditor BBCode Format\n * @author Sam Clarke\n */\n(function (sceditor) {\n\t/*eslint max-depth: off*/\n\t'use strict';\n\n\tvar escapeEntities = sceditor.escapeEntities;\n\tvar escapeUriScheme = sceditor.escapeUriScheme;\n\tvar dom = sceditor.dom;\n\tvar utils = sceditor.utils;\n\n\tvar css = dom.css;\n\tvar attr = dom.attr;\n\tvar is = dom.is;\n\tvar extend = utils.extend;\n\tvar each = utils.each;\n\n\tvar editorOptions;\n\n\tvar getEditorCommand = sceditor.command.get;\n\n\tvar QuoteType = {\n\t\t/** @lends BBCodeParser.QuoteType */\n\t\t/**\n\t\t * Always quote the attribute value\n\t\t * @type {Number}\n\t\t */\n\t\talways: 1,\n\n\t\t/**\n\t\t * Never quote the attributes value\n\t\t * @type {Number}\n\t\t */\n\t\tnever: 2,\n\n\t\t/**\n\t\t * Only quote the attributes value when it contains spaces to equals\n\t\t * @type {Number}\n\t\t */\n\t\tauto: 3\n\t};\n\n\tvar defaultCommandsOverrides = {\n\t\tbold: {\n\t\t\ttxtExec: ['[b]', '[/b]']\n\t\t},\n\t\titalic: {\n\t\t\ttxtExec: ['[i]', '[/i]']\n\t\t},\n\t\tunderline: {\n\t\t\ttxtExec: ['[u]', '[/u]']\n\t\t},\n\t\tstrike: {\n\t\t\ttxtExec: ['[s]', '[/s]']\n\t\t},\n\t\tmark: {\n\t\t\ttxtExec: ['[h]', '[/h]']\n\t\t},\n\t\tleft: {\n\t\t\ttxtExec: ['[left]', '[/left]']\n\t\t},\n\t\tcenter: {\n\t\t\ttxtExec: ['[center]', '[/center]']\n\t\t},\n\t\tright: {\n\t\t\ttxtExec: ['[right]', '[/right]']\n\t\t},\n\t\tjustify: {\n\t\t\ttxtExec: ['[justify]', '[/justify]']\n\t\t},\n\t\tfont: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('font')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (fontName) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[font=${fontName}]`,\n\t\t\t\t\t\t\t'[/font]'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tsize: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('size')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (fontSize) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[size=${fontSize}]`,\n\t\t\t\t\t\t\t'[/size]'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tcolor: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('color')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (color) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[color=${color}]`,\n\t\t\t\t\t\t\t'[/color]'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tbulletlist: {\n\t\t\ttxtExec: function (caller, selected) {\n\t\t\t\tthis.insertText(\n\t\t\t\t\t`[list]\\n[list]${selected.split(/\\r?\\n/).join('[/li]\\n[li]')}[/li]\\n[/ul]`\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\torderedlist: {\n\t\t\ttxtExec: function (caller, selected) {\n\t\t\t\tthis.insertText(\n\t\t\t\t\t`[list=I]\\n[li]${selected.split(/\\r?\\n/).join('[/li]\\n[li]')}[/li]\\n[/list]`\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\ttable: {\n\t\t\ttxtExec: ['[table][tr][td]', '[/td][/tr][/table]']\n\t\t},\n\t\tcode: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('code')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (language) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[code=${language}]`,\n\t\t\t\t\t\t\t'[/code]'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tnote: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('note')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (type) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[note=${type}]`,\n\t\t\t\t\t\t\t'[/note]'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\textensions: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('extensions')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (extension) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[${extension}]`,\n\t\t\t\t\t\t\t`[/${extension}]`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\timage: {\n\t\t\ttxtExec: function (caller, selected) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('image')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url, text) {\n\t\t\t\t\t\tif (text || selected) {\n\t\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t\t`[img=${url}]${text || selected || url}[/img]`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.insertText(`[img]${url}[/img]`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\temail: {\n\t\t\ttxtExec: function (caller, selected) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('email')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url, text) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[email=${url}]${text || selected || url}[/email]`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tlink: {\n\t\t\ttxtExec: function (caller, selected) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('link')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url, text) {\n\t\t\t\t\t\tif (selected || text) {\n\t\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t\t`[url=${url}]${text || selected || url}[/url]`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.insertText(`[url]${url}[/url]`);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tquote: {\n\t\t\ttxtExec: ['[quote]', '[/quote]']\n\t\t},\n\n\t\tuserlink: {\n\t\t\ttxtExec: ['[userlink]', '[/userlink]']\n\t\t},\n\t\talbums: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('albums')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[albumid]${url}[/albumid]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tattachments: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('attachments')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[attach]${url}[/attach]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tmedia: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('media')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[media]${url}[/media]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tvimeo: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('vimeo')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[vimeo]${url}[/vimeo]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tinstagram: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('instagram')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[instagram]${url}[/instagram]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tfacebook: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('facebook')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[facebook]${url}[/facebook]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tyoutube: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('youtube')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[youtube]${url}[/youtube]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\tvar bbcodeHandlers = {\n\t\t// START_COMMAND: Bold\n\t\tb: {\n\t\t\ttags: {\n\t\t\t\tb: null,\n\t\t\t\tstrong: null\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\t// 401 is for FF 3.5\n\t\t\t\t'font-weight': ['bold', 'bolder', '401', '700', '800', '900']\n\t\t\t},\n\t\t\tformat: '[b]{0}[/b]',\n\t\t\thtml: '<strong>{0}</strong>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Italic\n\t\ti: {\n\t\t\ttags: {\n\t\t\t\ti: null,\n\t\t\t\tem: null\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\t'font-style': ['italic', 'oblique']\n\t\t\t},\n\t\t\tformat: '[i]{0}[/i]',\n\t\t\thtml: '<em>{0}</em>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Underline\n\t\tu: {\n\t\t\ttags: {\n\t\t\t\tu: null\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\t'text-decoration': ['underline']\n\t\t\t},\n\t\t\tformat: '[u]{0}[/u]',\n\t\t\thtml: '<u>{0}</u>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Strikethrough\n\t\ts: {\n\t\t\ttags: {\n\t\t\t\ts: null,\n\t\t\t\tstrike: null\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\t'text-decoration': ['line-through']\n\t\t\t},\n\t\t\tformat: '[s]{0}[/s]',\n\t\t\thtml: '<s>{0}</s>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Subscript\n\t\tsub: {\n\t\t\ttags: {\n\t\t\t\tsub: null\n\t\t\t},\n\t\t\tformat: '[sub]{0}[/sub]',\n\t\t\thtml: '<sub>{0}</sub>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Superscript\n\t\tsup: {\n\t\t\ttags: {\n\t\t\t\tsup: null\n\t\t\t},\n\t\t\tformat: '[sup]{0}[/sup]',\n\t\t\thtml: '<sup>{0}</sup>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: mark\n\t\th: {\n\t\t\ttags: {\n\t\t\t\th: null,\n\t\t\t\tmark: null\n\t\t\t},\n\t\t\tformat: '[h]{0}[/h]',\n\t\t\thtml: '<mark>{0}</mark>'\n\t\t},\n\t\t// END_COMMAND\n\n\n\t\t// START_COMMAND: Font\n\t\tfont: {\n\t\t\ttags: {\n\t\t\t\tfont: {\n\t\t\t\t\tface: null\n\t\t\t\t}\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\t'font-family': null\n\t\t\t},\n\t\t\tquoteType: QuoteType.never,\n\t\t\tformat: function (element, content) {\n\t\t\t\tvar font;\n\n\t\t\t\tif (!is(element, 'font') || !(font = attr(element, 'face'))) {\n\t\t\t\t\tfont = css(element, 'font-family');\n\t\t\t\t}\n\n\t\t\t\treturn `[font=${_stripQuotes(font)}]${content}[/font]`;\n\t\t\t},\n\t\t\thtml: '<font face=\"{defaultattr}\">{0}</font>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Size\n\t\tsize: {\n\t\t\ttags: {\n\t\t\t\tfont: {\n\t\t\t\t\tsize: null\n\t\t\t\t}\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\t'font-size': null\n\t\t\t},\n\t\t\tformat: function (element, content) {\n\t\t\t\tvar fontSize = attr(element, 'size'),\n\t\t\t\t\tsize = 2;\n\n\t\t\t\tif (!fontSize) {\n\t\t\t\t\tfontSize = css(element, 'fontSize');\n\t\t\t\t}\n\n\t\t\t\t// Most browsers return px value but IE returns 1-7\n\t\t\t\tif (fontSize.indexOf('px') > -1) {\n\t\t\t\t\t// convert size to an int\n\t\t\t\t\tfontSize = fontSize.replace('px', '') - 0;\n\n\t\t\t\t\tif (fontSize < 12) {\n\t\t\t\t\t\tsize = 1;\n\t\t\t\t\t}\n\t\t\t\t\tif (fontSize > 15) {\n\t\t\t\t\t\tsize = 3;\n\t\t\t\t\t}\n\t\t\t\t\tif (fontSize > 17) {\n\t\t\t\t\t\tsize = 4;\n\t\t\t\t\t}\n\t\t\t\t\tif (fontSize > 23) {\n\t\t\t\t\t\tsize = 5;\n\t\t\t\t\t}\n\t\t\t\t\tif (fontSize > 31) {\n\t\t\t\t\t\tsize = 6;\n\t\t\t\t\t}\n\t\t\t\t\tif (fontSize > 47) {\n\t\t\t\t\t\tsize = 7;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tsize = fontSize;\n\t\t\t\t}\n\n\t\t\t\treturn `[size=${size}]${content}[/size]`;\n\t\t\t},\n\t\t\thtml: '<font size=\"{defaultattr}\">{!0}</font>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Color\n\t\tcolor: {\n\t\t\ttags: {\n\t\t\t\tfont: {\n\t\t\t\t\tcolor: null\n\t\t\t\t}\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\tcolor: null\n\t\t\t},\n\t\t\tquoteType: QuoteType.never,\n\t\t\tformat: function (elm, content) {\n\t\t\t\tvar color;\n\n\t\t\t\tif (!is(elm, 'font') || !(color = attr(elm, 'color'))) {\n\t\t\t\t\tcolor = elm.style.color || css(elm, 'color');\n\t\t\t\t}\n\n\t\t\t\treturn `[color=${_normaliseColour(color)}]${content}[/color]`;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\treturn `<font color=\"${escapeEntities(_normaliseColour(attrs.defaultattr), true)}\">${content}</font>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Lists\n\t\tul: {\n\t\t\ttags: {\n\t\t\t\tul: null\n\t\t\t},\n\t\t\tbreakStart: true,\n\t\t\tisInline: false,\n\t\t\tskipLastLineBreak: true,\n\t\t\tformat: '[list]{0}[/list]',\n\t\t\thtml: '<ul>{0}</ul>'\n\t\t},\n\t\tlist: {\n\t\t\tbreakStart: true,\n\t\t\tisInline: false,\n\t\t\tskipLastLineBreak: true,\n\t\t\tformat: '[list]{0}[/list]',\n\t\t\thtml: '<ul>{0}</ul>'\n\t\t},\n\t\tol: {\n\t\t\ttags: {\n\t\t\t\tol: null\n\t\t\t},\n\t\t\tbreakStart: true,\n\t\t\tisInline: false,\n\t\t\tskipLastLineBreak: true,\n\t\t\tformat: '[list=I]{0}[/list]',\n\t\t\thtml: '<ol>{0}</ol>'\n\t\t},\n\t\tli: {\n\t\t\ttags: {\n\t\t\t\tli: null\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tclosedBy: ['/ul', '/ol', '/list', '*', 'li'],\n\t\t\tformat: '[li]{0}[/li]',\n\t\t\thtml: '<li>{0}</li>'\n\t\t},\n\t\t'*': {\n\t\t\tisInline: false,\n\t\t\tclosedBy: ['/ul', '/ol', '/list', '*', 'li'],\n\t\t\thtml: '<li>{0}</li>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Table\n\t\ttable: {\n\t\t\ttags: {\n\t\t\t\ttable: null\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tisHtmlInline: true,\n\t\t\tskipLastLineBreak: true,\n\t\t\tformat: '[table]{0}[/table]',\n\t\t\thtml: '<table class=\"table\">{0}</table>'\n\t\t},\n\t\ttr: {\n\t\t\ttags: {\n\t\t\t\ttr: null\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tskipLastLineBreak: true,\n\t\t\tformat: '[tr]{0}[/tr]',\n\t\t\thtml: '<tr>{0}</tr>'\n\t\t},\n\t\tth: {\n\t\t\ttags: {\n\t\t\t\tth: null\n\t\t\t},\n\t\t\tallowsEmpty: true,\n\t\t\tisInline: false,\n\t\t\tformat: '[th]{0}[/th]',\n\t\t\thtml: '<th>{0}</th>'\n\t\t},\n\t\ttd: {\n\t\t\ttags: {\n\t\t\t\ttd: null\n\t\t\t},\n\t\t\tallowsEmpty: true,\n\t\t\tisInline: false,\n\t\t\tformat: '[td]{0}[/td]',\n\t\t\thtml: '<td class=\"border\">{0}</td>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Horizontal Rule\n\t\thr: {\n\t\t\ttags: {\n\t\t\t\thr: null\n\t\t\t},\n\t\t\tallowsEmpty: true,\n\t\t\tisSelfClosing: true,\n\t\t\tisInline: false,\n\t\t\tformat: '[hr]{0}',\n\t\t\thtml: '<hr />'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Image\n\t\timg: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\timg: {\n\t\t\t\t\tsrc: null,\n\t\t\t\t\tclass: 'img-user-posted img-thumbnail'\n\t\t\t\t}\n\t\t\t},\n\t\t\tallowedChildren: ['#'],\n\t\t\tquoteType: QuoteType.never,\n\t\t\tformat: function (element) {\n\t\t\t\tvar desc;\n\n\t\t\t\tdesc = attr(element, 'alt');\n\n\t\t\t\tif (desc) {\n\t\t\t\t\treturn `[img=${attr(element, 'src')}]${desc}[/img]`;\n\t\t\t\t}\n\n\t\t\t\treturn `[img]${attr(element, 'src')}[/img]`;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tattrs.defaultattr =\n\t\t\t\t\tescapeEntities(attrs.defaultattr, true) || content;\n\n\t\t\t\treturn `<img src=\"${escapeUriScheme(attrs.defaultattr)}\" alt=\"${content\n\t\t\t\t}\" class=\"img-user-posted img-thumbnail\" />`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: userlink\n\t\tuserlink: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\tspan: {\n\t\t\t\t\tclass: 'badge rounded-pill text-bg-secondary fs-6'\n\t\t\t\t}\n\t\t\t},\n\t\t\tformat: function (element) {\n\t\t\t\treturn `[userlink]${attr(element, 'data-user')}[/userlink]`;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\n\t\t\t\treturn `<span class=\"badge rounded-pill text-bg-secondary fs-6\" data-user=\"${escapeEntities(content)\n\t\t\t\t}\">${escapeEntities(content)}</span>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: albumimg\n\t\talbumimg: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\tsrc: null,\n\t\t\t\t\tclass: 'card text-bg-dark'\n\t\t\t\t}\n\t\t\t},\n\t\t\tallowedChildren: ['#'],\n\t\t\tquoteType: QuoteType.never,\n\t\t\tformat: function (element) {\n\t\t\t\treturn `[albumimg]${attr(element, 'alt')}[/albumimg]`;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tattrs.defaultattr =\n\t\t\t\t\tescapeEntities(attrs.defaultattr, true) || content;\n\n\t\t\t\treturn `<div class=\"card text-bg-dark\" style=\"max-width:200px\" alt=\"${content}\"><img src=\"${\n\t\t\t\t\teditorOptions.albumsPreviewUrl}${escapeUriScheme(attrs.defaultattr)\n\t\t\t\t}\" class=\"img-user-posted card-img-top\" style=\"max-height:200px;max-width:200px;object-fit:contain\"\"></div>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: URL\n\t\turl: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\ta: {\n\t\t\t\t\thref: null\n\t\t\t\t}\n\t\t\t},\n\t\t\tquoteType: QuoteType.never,\n\t\t\tformat: function (element, content) {\n\t\t\t\tconst url = attr(element, 'href');\n\n\t\t\t\t// make sure this link is not an e-mail,\n\t\t\t\t// if it is return e-mail BBCode\n\t\t\t\tif (url.substr(0, 7) === 'mailto:') {\n\t\t\t\t\treturn `[email=\"${url.substr(7)}\"]${content}[/email]`;\n\t\t\t\t}\n\n\t\t\t\treturn `[url=${url}]${content}[/url]`;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tattrs.defaultattr =\n\t\t\t\t\tescapeEntities(attrs.defaultattr, true) || content;\n\n\t\t\t\treturn `<a href=\"${escapeUriScheme(attrs.defaultattr)}\" class=\"link\">${content}</a>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: E-mail\n\t\temail: {\n\t\t\tquoteType: QuoteType.never,\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\treturn `<a href=\"mailto:${escapeEntities(attrs.defaultattr, true) || content}\">${content}</a>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Quote\n\t\tquote: {\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\tclass: 'border rounded mx-3 mb-3 p-3 border-secondary shadow-sm'\n\t\t\t\t}\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tquoteType: QuoteType.never,\n\t\t\tformat: function (element, content) {\n\t\t\t\tvar author = '';\n\t\t\t\tvar cite;\n\t\t\t\tconst children = element.children;\n\n\t\t\t\tfor (let i = 0; !cite && i < children.length; i++) {\n\t\t\t\t\tif (is(children[i], 'cite')) {\n\t\t\t\t\t\tcite = children[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (cite) {\n\t\t\t\t\tauthor = cite && cite.textContent;\n\n\t\t\t\t\tif (cite) {\n\t\t\t\t\t\telement.removeChild(cite);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontent = this.elementToBbcode(element);\n\n\t\t\t\t\tauthor = `=${author.replace(/(^\\s+|\\s+$)/g, '')}`;\n\n\t\t\t\t\tif (cite) {\n\t\t\t\t\t\telement.insertBefore(cite, element.firstChild);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn `[quote${author}]${content}[/quote]`;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tif (attrs.defaultattr) {\n\t\t\t\t\tcontent = content +\n\t\t\t\t\t\t'<cite class=\"card-text text-end d-block text-body-secondary small\">' +\n\t\t\t\t\t\tescapeEntities(attrs.defaultattr) +\n\t\t\t\t\t\t'</cite>';\n\t\t\t\t}\n\n\t\t\t\treturn `<div class=\"border rounded mx-3 mb-3 p-3 border-secondary shadow-sm\"><span contenteditable=\"false\"><i class=\"fa fa-quote-left text-primary fs-4 me-2\"></i></span>${\n\t\t\t\t\tcontent}</div>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Code\n\t\tcode: {\n\t\t\ttags: {\n\t\t\t\tcode: {\n\t\t\t\t\tclass: null\n\t\t\t\t}\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tallowedChildren: ['#', '#newline'],\n\t\t\tformat: function (element, content) {\n\t\t\t\tvar codeLanguage;\n\n\t\t\t\tif (!is(element, 'code') || !(codeLanguage = attr(element, 'class'))) {\n\t\t\t\t\tcodeLanguage = element.className.replace('lang-', '');\n\t\t\t\t}\n\n\t\t\t\treturn `[code=${codeLanguage.replace('lang-', '')}]${content}[/code]`;\n\t\t\t},\n\t\t\thtml:\n\t\t\t\t'<pre class=\"border border-danger rounded m-2 p-2\"><code class=\"lang-{defaultattr}\">{0}</code></pre>'\n\t\t},\n\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Note\n\t\tnote: {\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\trole: 'alert'\n\t\t\t\t}\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tallowedChildren: ['#', '#newline'],\n\t\t\tformat: function (element, content) {\n\t\t\t\tvar type;\n\n\t\t\t\tif (!(type = attr(element, 'class'))) {\n\t\t\t\t\ttype = element.className.replace('alert alert-', '');\n\t\t\t\t}\n\n\t\t\t\treturn `[note=${type.replace('alert alert-', '')}]${content}[/note]`;\n\t\t\t},\n\t\t\thtml:\n\t\t\t\t'<div class=\"alert alert-{defaultattr}\" role=\"alert\">{0}</div>'\n\t\t},\n\n\t\t// END_COMMAND\n\n\n\t\t// START_COMMAND: Left\n\t\tleft: {\n\t\t\tstyles: {\n\t\t\t\t'text-align': [\n\t\t\t\t\t'left',\n\t\t\t\t\t'-webkit-left',\n\t\t\t\t\t'-moz-left',\n\t\t\t\t\t'-khtml-left'\n\t\t\t\t]\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tallowsEmpty: true,\n\t\t\tformat: '[left]{0}[/left]',\n\t\t\thtml: '<div align=\"left\">{0}</div>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Centre\n\t\tcenter: {\n\t\t\tstyles: {\n\t\t\t\t'text-align': [\n\t\t\t\t\t'center',\n\t\t\t\t\t'-webkit-center',\n\t\t\t\t\t'-moz-center',\n\t\t\t\t\t'-khtml-center'\n\t\t\t\t]\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tallowsEmpty: true,\n\t\t\tformat: '[center]{0}[/center]',\n\t\t\thtml: '<div align=\"center\">{0}</div>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Right\n\t\tright: {\n\t\t\tstyles: {\n\t\t\t\t'text-align': [\n\t\t\t\t\t'right',\n\t\t\t\t\t'-webkit-right',\n\t\t\t\t\t'-moz-right',\n\t\t\t\t\t'-khtml-right'\n\t\t\t\t]\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tallowsEmpty: true,\n\t\t\tformat: '[right]{0}[/right]',\n\t\t\thtml: '<div align=\"right\">{0}</div>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Justify\n\t\tjustify: {\n\t\t\tstyles: {\n\t\t\t\t'text-align': [\n\t\t\t\t\t'justify',\n\t\t\t\t\t'-webkit-justify',\n\t\t\t\t\t'-moz-justify',\n\t\t\t\t\t'-khtml-justify'\n\t\t\t\t]\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tallowsEmpty: true,\n\t\t\tformat: '[justify]{0}[/justify]',\n\t\t\thtml: '<div align=\"justify\">{0}</div>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Facebook\n\t\tfacebook: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\t'data-facebook-url': null\n\t\t\t\t}\n\t\t\t},\n\t\t\tformat: function (element, content) {\n\t\t\t\telement = attr(element, 'data-facebook-url');\n\n\t\t\t\treturn element ? `[facebook]${element}[/facebook]` : content;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tconst url = content;\n\n\t\t\t\treturn `<div class=\"ratio ratio-1x1\" data-oembed-url=\"${url}\" data-facebook-url=\"${url\n\t\t\t\t}\"><iframe src=\"https://www.facebook.com/plugins/post.php?href=${url}\"></iframe></div>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Instagram\n\t\tinstagram: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\t'data-instagram-url': null\n\t\t\t\t}\n\t\t\t},\n\t\t\tformat: function (element, content) {\n\t\t\t\telement = attr(element, 'data-instagram-url');\n\n\t\t\t\treturn element ? `[instagram]${element}[/instagram]` : content;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tvar id = content;\n\n\t\t\t\tconst url = content;\n\n\t\t\t\tvar id = url.match(/\\/(p|tv|reel)\\/(.*?)\\//)[2];\n\n\t\t\t\treturn `<div class=\"ratio ratio-1x1\" data-oembed-url=\"https://www.instagram.com/p/${id\n\t\t\t\t}\" data-instagram-url=\"${url}\"><iframe src=\"https://www.instagram.com/p/${id\n\t\t\t\t}/embed/captioned/\"></iframe></div>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Vimeo\n\t\tvimeo: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\t'data-vimeo-url': null\n\t\t\t\t}\n\t\t\t},\n\t\t\tformat: function (element, content) {\n\t\t\t\telement = attr(element, 'data-vimeo-url');\n\n\t\t\t\treturn element ? `[vimeo]${element}[/vimeo]` : content;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tconst url = content;\n\n\t\t\t\tconst id = url.match(/vimeo\\..*\\/(\\d+)(?:$|\\/)/)[1];\n\n\t\t\t\treturn `<div data-oembed-url=\"https://vimeo.com/${id}\" data-vimeo-url=\"${url\n\t\t\t\t}\" class=\"ratio ratio-16x9 border\"><iframe src=\"https://player.vimeo.com/video/${id\n\t\t\t\t}?show_title=1&show_byline=1&show_portrait=1&fullscreen=1\"></iframe></div>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\n\t\t// START_COMMAND: YouTube\n\t\tyoutube: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\t'data-youtube-url': null\n\t\t\t\t}\n\t\t\t},\n\t\t\tformat: function (element, content) {\n\t\t\t\telement = attr(element, 'data-youtube-url');\n\n\t\t\t\treturn element ? `[youtube]${element}[/youtube]` : content;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tconst url = content;\n\n\t\t\t\tconst id = content.match(/(?:v=|v\\/|embed\\/|youtu.be\\/)?([a-zA-Z0-9_-]{11})/)[1];\n\n\t\t\t\treturn `<div data-oembed-url=\"https://youtube.com/embed/${id}\" data-youtube-url=\"${url\n\t\t\t\t}\" class=\"ratio ratio-16x9 border\"><iframe src=\"https://youtube.com/embed/${id\n\t\t\t\t}?hd=1\"></iframe></div>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\n\t\t// START_COMMAND: Rtl\n\t\trtl: {\n\t\t\tstyles: {\n\t\t\t\tdirection: ['rtl']\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tformat: '[rtl]{0}[/rtl]',\n\t\t\thtml: '<div style=\"direction: rtl\">{0}</div>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Ltr\n\t\tltr: {\n\t\t\tstyles: {\n\t\t\t\tdirection: ['ltr']\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tformat: '[ltr]{0}[/ltr]',\n\t\t\thtml: '<div style=\"direction: ltr\">{0}</div>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// this is here so that commands above can be removed\n\t\t// without having to remove the , after the last one.\n\t\t// Needed for IE.\n\t\tignore: {}\n\t};\n\n\t/**\n\t * Formats a string replacing {name} with the values of\n\t * obj.name properties.\n\t *\n\t * If there is no property for the specified {name} then\n\t * it will be left intact.\n\t *\n\t * @param  {string} str\n\t * @param  {Object} obj\n\t * @return {string}\n\t * @since 2.0.0\n\t */\n\tfunction formatBBCodeString(str, obj) {\n\t\treturn str.replace(/\\{([^}]+)\\}/g,\n\t\t\tfunction (match, group) {\n\t\t\t\tvar undef,\n\t\t\t\t\tescape = true;\n\n\t\t\t\tif (group.charAt(0) === '!') {\n\t\t\t\t\tescape = false;\n\t\t\t\t\tgroup = group.substring(1);\n\t\t\t\t}\n\n\t\t\t\tif (group === '0') {\n\t\t\t\t\tescape = false;\n\t\t\t\t}\n\n\t\t\t\tif (obj[group] === undef) {\n\t\t\t\t\treturn match;\n\t\t\t\t}\n\n\t\t\t\treturn escape ? escapeEntities(obj[group], true) : obj[group];\n\t\t\t});\n\t}\n\n\tfunction isFunction(fn) {\n\t\treturn typeof fn === 'function';\n\t}\n\n\t/**\n\t * Removes any leading or trailing quotes ('\")\n\t *\n\t * @return string\n\t * @since v1.4.0\n\t */\n\tfunction _stripQuotes(str) {\n\t\treturn str ? str.replace(/\\\\(.)/g, '$1').replace(/^([\"'])(.*?)\\1$/, '$2') : str;\n\t}\n\n\t/**\n\t * Formats a string replacing {0}, {1}, {2}, ect. with\n\t * the params provided\n\t *\n\t * @param {string} str The string to format\n\t * @param {...string} arg The strings to replace\n\t * @return {string}\n\t * @since v1.4.0\n\t */\n\tfunction _formatString(str) {\n\t\tvar undef;\n\t\tvar args = arguments;\n\n\t\treturn str.replace(/\\{(\\d+)\\}/g,\n\t\t\tfunction (_, matchNum) {\n\t\t\t\treturn args[matchNum - 0 + 1] !== undef ? args[matchNum - 0 + 1] : `{${matchNum}}`;\n\t\t\t});\n\t}\n\n\tvar TOKEN_OPEN = 'open';\n\tvar TOKEN_CONTENT = 'content';\n\tvar TOKEN_NEWLINE = 'newline';\n\tvar TOKEN_CLOSE = 'close';\n\n\n\t/*\n\t * @typedef {Object} TokenizeToken\n\t * @property {string} type\n\t * @property {string} name\n\t * @property {string} val\n\t * @property {Object.<string, string>} attrs\n\t * @property {array} children\n\t * @property {TokenizeToken} closing\n\t */\n\n\t/**\n\t * Tokenize token object\n\t *\n\t * @param  {string} type The type of token this is,\n\t *                       should be one of tokenType\n\t * @param  {string} name The name of this token\n\t * @param  {string} val The originally matched string\n\t * @param  {array} attrs Any attributes. Only set on\n\t *                       TOKEN_TYPE_OPEN tokens\n\t * @param  {array} children Any children of this token\n\t * @param  {TokenizeToken} closing This tokens closing tag.\n\t *                                 Only set on TOKEN_TYPE_OPEN tokens\n\t * @class {TokenizeToken}\n\t * @name {TokenizeToken}\n\t * @memberOf BBCodeParser.prototype\n\t */\n\tfunction TokenizeToken(type, name, val, attrs, children, closing) {\n\t\tconst base = this;\n\n\t\tbase.type = type;\n\t\tbase.name = name;\n\t\tbase.val = val;\n\t\tbase.attrs = attrs || {};\n\t\tbase.children = children || [];\n\t\tbase.closing = closing || null;\n\t};\n\n\tTokenizeToken.prototype = {\n\t\t/** @lends BBCodeParser.prototype.TokenizeToken */\n\t\t/**\n\t\t * Clones this token\n\t\t *\n\t\t * @return {TokenizeToken}\n\t\t */\n\t\tclone: function () {\n\t\t\tconst base = this;\n\n\t\t\treturn new TokenizeToken(\n\t\t\t\tbase.type,\n\t\t\t\tbase.name,\n\t\t\t\tbase.val,\n\t\t\t\textend({}, base.attrs),\n\t\t\t\t[],\n\t\t\t\tbase.closing ? base.closing.clone() : null\n\t\t\t);\n\t\t},\n\t\t/**\n\t\t * Splits this token at the specified child\n\t\t *\n\t\t * @param  {TokenizeToken} splitAt The child to split at\n\t\t * @return {TokenizeToken} The right half of the split token or\n\t\t *                         empty clone if invalid splitAt lcoation\n\t\t */\n\t\tsplitAt: function (splitAt) {\n\t\t\tvar offsetLength;\n\t\t\tconst base = this;\n\t\t\tconst clone = base.clone();\n\t\t\tconst offset = base.children.indexOf(splitAt);\n\n\t\t\tif (offset > -1) {\n\t\t\t\t// Work out how many items are on the right side of the split\n\t\t\t\t// to pass to splice()\n\t\t\t\toffsetLength = base.children.length - offset;\n\t\t\t\tclone.children = base.children.splice(offset, offsetLength);\n\t\t\t}\n\n\t\t\treturn clone;\n\t\t}\n\t};\n\n\n\t/**\n\t * SCEditor BBCode parser class\n\t *\n\t * @param {Object} options\n\t * @class BBCodeParser\n\t * @name BBCodeParser\n\t * @since v1.4.0\n\t */\n\tfunction BBCodeParser(options) {\n\t\tvar base = this;\n\n\t\tbase.opts = extend({}, BBCodeParser.defaults, options);\n\n\t\t/**\n\t\t * Takes a BBCode string and splits it into open,\n\t\t * content and close tags.\n\t\t *\n\t\t * It does no checking to verify a tag has a matching open\n\t\t * or closing tag or if the tag is valid child of any tag\n\t\t * before it. For that the tokens should be passed to the\n\t\t * parse function.\n\t\t *\n\t\t * @param {string} str\n\t\t * @return {array}\n\t\t * @memberOf BBCodeParser.prototype\n\t\t */\n\t\tbase.tokenize = function (str) {\n\t\t\tvar matches, type, i;\n\t\t\tconst tokens = [];\n\t\t\t// The token types in reverse order of precedence\n\t\t\t// (they're looped in reverse)\n\t\t\tconst tokenTypes = [\n\t\t\t\t{\n\t\t\t\t\ttype: TOKEN_CONTENT,\n\t\t\t\t\tregex: /^([^\\[\\r\\n]+|\\[)/\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: TOKEN_NEWLINE,\n\t\t\t\t\tregex: /^(\\r\\n|\\r|\\n)/\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: TOKEN_OPEN,\n\t\t\t\t\tregex: /^\\[[^\\[\\]]+\\]/\n\t\t\t\t},\n\t\t\t\t// Close must come before open as they are\n\t\t\t\t// the same except close has a / at the start.\n\t\t\t\t{\n\t\t\t\t\ttype: TOKEN_CLOSE,\n\t\t\t\t\tregex: /^\\[\\/[^\\[\\]]+\\]/\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tstrloop:\n\t\t\twhile (str.length) {\n\t\t\t\ti = tokenTypes.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\ttype = tokenTypes[i].type;\n\n\t\t\t\t\t// Check if the string matches any of the tokens\n\t\t\t\t\tif (!(matches = str.match(tokenTypes[i].regex)) ||\n\t\t\t\t\t\t\t!matches[0]) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add the match to the tokens list\n\t\t\t\t\ttokens.push(tokenizeTag(type, matches[0]));\n\n\t\t\t\t\t// Remove the match from the string\n\t\t\t\t\tstr = str.substr(matches[0].length);\n\n\t\t\t\t\t// The token has been added so start again\n\t\t\t\t\tcontinue strloop;\n\t\t\t\t}\n\n\t\t\t\t// If there is anything left in the string which doesn't match\n\t\t\t\t// any of the tokens then just assume it's content and add it.\n\t\t\t\tif (str.length) {\n\t\t\t\t\ttokens.push(tokenizeTag(TOKEN_CONTENT, str));\n\t\t\t\t}\n\n\t\t\t\tstr = '';\n\t\t\t}\n\n\t\t\treturn tokens;\n\t\t};\n\n\t\t/**\n\t\t * Extracts the name an params from a tag\n\t\t *\n\t\t * @param {string} type\n\t\t * @param {string} val\n\t\t * @return {Object}\n\t\t * @private\n\t\t */\n\t\tfunction tokenizeTag(type, val) {\n\t\t\tvar matches, attrs, name;\n\t\t\tconst openRegex = /\\[([^\\]\\s=]+)(?:([^\\]]+))?\\]/;\n\t\t\tconst closeRegex = /\\[\\/([^\\[\\]]+)\\]/;\n\n\t\t\t// Extract the name and attributes from opening tags and\n\t\t\t// just the name from closing tags.\n\t\t\tif (type === TOKEN_OPEN && (matches = val.match(openRegex))) {\n\t\t\t\tname = lower(matches[1]);\n\n\t\t\t\tif (matches[2] && (matches[2] = matches[2].trim())) {\n\t\t\t\t\tattrs = tokenizeAttrs(matches[2]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (type === TOKEN_CLOSE &&\n\t\t\t\t(matches = val.match(closeRegex))) {\n\t\t\t\tname = lower(matches[1]);\n\t\t\t}\n\n\t\t\tif (type === TOKEN_NEWLINE) {\n\t\t\t\tname = '#newline';\n\t\t\t}\n\n\t\t\t// Treat all tokens without a name and\n\t\t\t// all unknown BBCodes as content\n\t\t\tif (!name ||\n\t\t\t((type === TOKEN_OPEN || type === TOKEN_CLOSE) &&\n\t\t\t\t!bbcodeHandlers[name])) {\n\n\t\t\t\ttype = TOKEN_CONTENT;\n\t\t\t\tname = '#';\n\t\t\t}\n\n\t\t\treturn new TokenizeToken(type, name, val, attrs);\n\t\t}\n\n\t\t/**\n\t\t * Extracts the individual attributes from a string containing\n\t\t * all the attributes.\n\t\t *\n\t\t * @param {string} attrs\n\t\t * @return {Object} Assoc array of attributes\n\t\t * @private\n\t\t */\n\t\tfunction tokenizeAttrs(attrs) {\n\t\t\tvar matches\n\t\t\t\t/*\n\t\t\t\t([^\\s=]+)\t\t\t\tAnything that's not a space or equals\n\t\t\t\t=\t\t\t\t\t\tEquals sign =\n\t\t\t\t(?:\n\t\t\t\t\t(?:\n\t\t\t\t\t\t([\"'])\t\t\t\t\tThe opening quote\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\t(?:\\\\\\2|[^\\2])*?\tAnything that isn't the\n\t\t\t\t\t\t\t\t\t\t\t\tunescaped opening quote\n\t\t\t\t\t\t)\n\t\t\t\t\t\t\\2\t\t\t\t\t\tThe opening quote again which\n\t\t\t\t\t\t\t\t\t\t\t\twill close the string\n\t\t\t\t\t)\n\t\t\t\t\t\t|\t\t\t\tIf not a quoted string then match\n\t\t\t\t\t(\n\t\t\t\t\t\t(?:.(?!\\s\\S+=))*.?\t\tAnything that isn't part of\n\t\t\t\t\t\t\t\t\t\t\t\t[space][non-space][=] which\n\t\t\t\t\t\t\t\t\t\t\t\twould be a new attribute\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t*/;\n\t\t\tconst attrRegex = /([^\\s=]+)=(?:(?:([\"'])((?:\\\\\\2|[^\\2])*?)\\2)|((?:.(?!\\s\\S+=))*.))/g;\n\t\t\tconst ret = {};\n\n\t\t\t// if only one attribute then remove the = from the start and\n\t\t\t// strip any quotes\n\t\t\tif (attrs.charAt(0) === '=' && attrs.indexOf('=', 1) < 0) {\n\t\t\t\tret.defaultattr = _stripQuotes(attrs.substr(1));\n\t\t\t} else {\n\t\t\t\tif (attrs.charAt(0) === '=') {\n\t\t\t\t\tattrs = `defaultattr${attrs}`;\n\t\t\t\t}\n\n\t\t\t\t// No need to strip quotes here, the regex will do that.\n\t\t\t\twhile ((matches = attrRegex.exec(attrs))) {\n\t\t\t\t\tret[lower(matches[1])] =\n\t\t\t\t\t\t_stripQuotes(matches[3]) || matches[4];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\t/**\n\t\t * Parses a string into an array of BBCodes\n\t\t *\n\t\t * @param  {string}  str\n\t\t * @param  {boolean} preserveNewLines If to preserve all new lines, not\n\t\t *                                    strip any based on the passed\n\t\t *                                    formatting options\n\t\t * @return {array}                    Array of BBCode objects\n\t\t * @memberOf BBCodeParser.prototype\n\t\t */\n\t\tbase.parse = function (str, preserveNewLines) {\n\t\t\tconst ret = parseTokens(base.tokenize(str));\n\t\t\tconst opts = base.opts;\n\n\t\t\tif (opts.fixInvalidNesting) {\n\t\t\t\tfixNesting(ret);\n\t\t\t}\n\n\t\t\tnormaliseNewLines(ret, null, preserveNewLines);\n\n\t\t\tif (opts.removeEmptyTags) {\n\t\t\t\tremoveEmpty(ret);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t};\n\n\t\t/**\n\t\t * Checks if an array of TokenizeToken's contains the\n\t\t * specified token.\n\t\t *\n\t\t * Checks the tokens name and type match another tokens\n\t\t * name and type in the array.\n\t\t *\n\t\t * @param  {string}    name\n\t\t * @param  {string} type\n\t\t * @param  {array}     arr\n\t\t * @return {Boolean}\n\t\t * @private\n\t\t */\n\t\tfunction hasTag(name, type, arr) {\n\t\t\tvar i = arr.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tif (arr[i].type === type && arr[i].name === name) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Checks if the child tag is allowed as one\n\t\t * of the parent tags children.\n\t\t *\n\t\t * @param  {TokenizeToken}  parent\n\t\t * @param  {TokenizeToken}  child\n\t\t * @return {Boolean}\n\t\t * @private\n\t\t */\n\t\tfunction isChildAllowed(parent, child) {\n\t\t\tconst parentBBCode = parent ? bbcodeHandlers[parent.name] : {};\n\t\t\tconst allowedChildren = parentBBCode.allowedChildren;\n\n\t\t\tif (base.opts.fixInvalidChildren && allowedChildren) {\n\t\t\t\treturn allowedChildren.indexOf(child.name || '#') > -1;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\t// TODO: Tidy this parseTokens() function up a bit.\n\t\t/**\n\t\t * Parses an array of tokens created by tokenize()\n\t\t *\n\t\t * @param  {array} toks\n\t\t * @return {array} Parsed tokens\n\t\t * @see tokenize()\n\t\t * @private\n\t\t */\n\t\tfunction parseTokens(toks) {\n\t\t\tvar token,\n\t\t\t\tbbcode,\n\t\t\t\tcurTok,\n\t\t\t\tclone,\n\t\t\t\ti,\n\t\t\t\tnext,\n\t\t\t\tcloned = [],\n\t\t\t\toutput = [],\n\t\t\t\topenTags = [],\n\t\t\t\t/**\n\t\t\t\t * Returns the currently open tag or undefined\n\t\t\t\t * @return {TokenizeToken}\n\t\t\t\t */\n\t\t\t\tcurrentTag = function () {\n\t\t\t\t\treturn last(openTags);\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Adds a tag to either the current tags children\n\t\t\t\t * or to the output array.\n\t\t\t\t * @param {TokenizeToken} token\n\t\t\t\t * @private\n\t\t\t\t */\n\t\t\t\taddTag = function (token) {\n\t\t\t\t\tif (currentTag()) {\n\t\t\t\t\t\tcurrentTag().children.push(token);\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput.push(token);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Checks if this tag closes the current tag\n\t\t\t\t * @param  {string} name\n\t\t\t\t * @return {Void}\n\t\t\t\t */\n\t\t\t\tclosesCurrentTag = function (name) {\n\t\t\t\t\treturn currentTag() &&\n\t\t\t\t\t\t(bbcode = bbcodeHandlers[currentTag().name]) &&\n\t\t\t\t\t\tbbcode.closedBy &&\n\t\t\t\t\t\tbbcode.closedBy.indexOf(name) > -1;\n\t\t\t\t};\n\n\t\t\twhile ((token = toks.shift())) {\n\t\t\t\tnext = toks[0];\n\n\t\t\t\t/*\n\t\t\t\t * Fixes any invalid children.\n\t\t\t\t *\n\t\t\t\t * If it is an element which isn't allowed as a child of it's\n\t\t\t\t * parent then it will be converted to content of the parent\n\t\t\t\t * element. i.e.\n\t\t\t\t *     [code]Code [b]only[/b] allows text.[/code]\n\t\t\t\t * Will become:\n\t\t\t\t *     <code>Code [b]only[/b] allows text.</code>\n\t\t\t\t * Instead of:\n\t\t\t\t *     <code>Code <b>only</b> allows text.</code>\n\t\t\t\t */\n\t\t\t\t// Ignore tags that can't be children\n\t\t\t\tif (!isChildAllowed(currentTag(), token)) {\n\n\t\t\t\t\t// exclude closing tags of current tag\n\t\t\t\t\tif (token.type !== TOKEN_CLOSE ||\n\t\t\t\t\t\t!currentTag() ||\n\t\t\t\t\t\ttoken.name !== currentTag().name) {\n\t\t\t\t\t\ttoken.name = '#';\n\t\t\t\t\t\ttoken.type = TOKEN_CONTENT;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tswitch (token.type) {\n\t\t\t\t\tcase TOKEN_OPEN:\n\t\t\t\t\t// Check it this closes a parent,\n\t\t\t\t\t// e.g. for lists [*]one [*]two\n\t\t\t\t\t\tif (closesCurrentTag(token.name)) {\n\t\t\t\t\t\t\topenTags.pop();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taddTag(token);\n\t\t\t\t\t\tbbcode = bbcodeHandlers[token.name];\n\n\t\t\t\t\t\t// If this tag is not self closing and it has a closing\n\t\t\t\t\t\t// tag then it is open and has children so add it to the\n\t\t\t\t\t\t// list of open tags. If has the closedBy property then\n\t\t\t\t\t\t// it is closed by other tags so include everything as\n\t\t\t\t\t\t// it's children until one of those tags is reached.\n\t\t\t\t\t\tif (bbcode &&\n\t\t\t\t\t\t!bbcode.isSelfClosing &&\n\t\t\t\t\t\t(bbcode.closedBy ||\n\t\t\t\t\t\t\thasTag(token.name, TOKEN_CLOSE, toks))) {\n\t\t\t\t\t\t\topenTags.push(token);\n\t\t\t\t\t\t} else if (!bbcode || !bbcode.isSelfClosing) {\n\t\t\t\t\t\t\ttoken.type = TOKEN_CONTENT;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase TOKEN_CLOSE:\n\t\t\t\t\t// check if this closes the current tag,\n\t\t\t\t\t// e.g. [/list] would close an open [*]\n\t\t\t\t\t\tif (currentTag() &&\n\t\t\t\t\t\ttoken.name !== currentTag().name &&\n\t\t\t\t\t\tclosesCurrentTag(`/${token.name}`)) {\n\n\t\t\t\t\t\t\topenTags.pop();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If this is closing the currently open tag just pop\n\t\t\t\t\t\t// the close tag off the open tags array\n\t\t\t\t\t\tif (currentTag() && token.name === currentTag().name) {\n\t\t\t\t\t\t\tcurrentTag().closing = token;\n\t\t\t\t\t\t\topenTags.pop();\n\n\t\t\t\t\t\t// If this is closing an open tag that is the parent of\n\t\t\t\t\t\t// the current tag then clone all the tags including the\n\t\t\t\t\t\t// current one until reaching the parent that is being\n\t\t\t\t\t\t// closed. Close the parent and then add the clones back\n\t\t\t\t\t\t// in.\n\t\t\t\t\t\t} else if (hasTag(token.name, TOKEN_OPEN, openTags)) {\n\n\t\t\t\t\t\t\t// Remove the tag from the open tags\n\t\t\t\t\t\t\twhile ((curTok = openTags.pop())) {\n\n\t\t\t\t\t\t\t\t// If it's the tag that is being closed then\n\t\t\t\t\t\t\t\t// discard it and break the loop.\n\t\t\t\t\t\t\t\tif (curTok.name === token.name) {\n\t\t\t\t\t\t\t\t\tcurTok.closing = token;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Otherwise clone this tag and then add any\n\t\t\t\t\t\t\t\t// previously cloned tags as it's children\n\t\t\t\t\t\t\t\tclone = curTok.clone();\n\n\t\t\t\t\t\t\t\tif (cloned.length) {\n\t\t\t\t\t\t\t\t\tclone.children.push(last(cloned));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tcloned.push(clone);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Place block linebreak before cloned tags\n\t\t\t\t\t\t\tif (next && next.type === TOKEN_NEWLINE) {\n\t\t\t\t\t\t\t\tbbcode = bbcodeHandlers[token.name];\n\t\t\t\t\t\t\t\tif (bbcode && bbcode.isInline === false) {\n\t\t\t\t\t\t\t\t\taddTag(next);\n\t\t\t\t\t\t\t\t\ttoks.shift();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Add the last cloned child to the now current tag\n\t\t\t\t\t\t\t// (the parent of the tag which was being closed)\n\t\t\t\t\t\t\taddTag(last(cloned));\n\n\t\t\t\t\t\t\t// Add all the cloned tags to the open tags list\n\t\t\t\t\t\t\ti = cloned.length;\n\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\topenTags.push(cloned[i]);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcloned.length = 0;\n\n\t\t\t\t\t\t// This tag is closing nothing so treat it as content\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttoken.type = TOKEN_CONTENT;\n\t\t\t\t\t\t\taddTag(token);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase TOKEN_NEWLINE:\n\t\t\t\t\t// handle things like\n\t\t\t\t\t//     [*]list\\nitem\\n[*]list1\n\t\t\t\t\t// where it should come out as\n\t\t\t\t\t//     [*]list\\nitem[/*]\\n[*]list1[/*]\n\t\t\t\t\t// instead of\n\t\t\t\t\t//     [*]list\\nitem\\n[/*][*]list1[/*]\n\t\t\t\t\t\tif (currentTag() &&\n\t\t\t\t\t\tnext &&\n\t\t\t\t\t\tclosesCurrentTag(\n\t\t\t\t\t\t\t(next.type === TOKEN_CLOSE ? '/' : '') +\n\t\t\t\t\t\t\tnext.name\n\t\t\t\t\t\t)) {\n\t\t\t\t\t\t// skip if the next tag is the closing tag for\n\t\t\t\t\t\t// the option tag, i.e. [/*]\n\t\t\t\t\t\t\tif (!(next.type === TOKEN_CLOSE &&\n\t\t\t\t\t\t\tnext.name === currentTag().name)) {\n\t\t\t\t\t\t\t\tbbcode = bbcodeHandlers[currentTag().name];\n\n\t\t\t\t\t\t\t\tif (bbcode && bbcode.breakAfter) {\n\t\t\t\t\t\t\t\t\topenTags.pop();\n\t\t\t\t\t\t\t\t} else if (bbcode &&\n\t\t\t\t\t\t\t\tbbcode.isInline === false &&\n\t\t\t\t\t\t\t\tbase.opts.breakAfterBlock &&\n\t\t\t\t\t\t\t\tbbcode.breakAfter !== false) {\n\t\t\t\t\t\t\t\t\topenTags.pop();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taddTag(token);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault: // content\n\t\t\t\t\t\taddTag(token);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn output;\n\t\t}\n\n\t\t/**\n\t\t * Normalise all new lines\n\t\t *\n\t\t * Removes any formatting new lines from the BBCode\n\t\t * leaving only content ones. I.e. for a list:\n\t\t *\n\t\t * [list]\n\t\t * [*] list item one\n\t\t * with a line break\n\t\t * [*] list item two\n\t\t * [/list]\n\t\t *\n\t\t * would become\n\t\t *\n\t\t * [list] [*] list item one\n\t\t * with a line break [*] list item two [/list]\n\t\t *\n\t\t * Which makes it easier to convert to HTML or add\n\t\t * the formatting new lines back in when converting\n\t\t * back to BBCode\n\t\t *\n\t\t * @param  {array} children\n\t\t * @param  {TokenizeToken} parent\n\t\t * @param  {boolean} onlyRemoveBreakAfter\n\t\t * @return {void}\n\t\t */\n\t\tfunction normaliseNewLines(children, parent, onlyRemoveBreakAfter) {\n\t\t\tvar token,\n\t\t\t\tleft,\n\t\t\t\tright,\n\t\t\t\tparentBBCode,\n\t\t\t\tbbcode,\n\t\t\t\tremovedBreakEnd,\n\t\t\t\tremovedBreakBefore,\n\t\t\t\tremove;\n\t\t\tvar childrenLength = children.length;\n\t\t\t// TODO: this function really needs tidying up\n\t\t\tif (parent) {\n\t\t\t\tparentBBCode = bbcodeHandlers[parent.name];\n\t\t\t}\n\n\t\t\tvar i = childrenLength;\n\t\t\twhile (i--) {\n\t\t\t\tif (!(token = children[i])) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (token.type === TOKEN_NEWLINE) {\n\t\t\t\t\tleft = i > 0 ? children[i - 1] : null;\n\t\t\t\t\tright = i < childrenLength - 1 ? children[i + 1] : null;\n\t\t\t\t\tremove = false;\n\n\t\t\t\t\t// Handle the start and end new lines\n\t\t\t\t\t// e.g. [tag]\\n and \\n[/tag]\n\t\t\t\t\tif (!onlyRemoveBreakAfter &&\n\t\t\t\t\t\tparentBBCode &&\n\t\t\t\t\t\tparentBBCode.isSelfClosing !== true) {\n\t\t\t\t\t\t// First child of parent so must be opening line break\n\t\t\t\t\t\t// (breakStartBlock, breakStart) e.g. [tag]\\n\n\t\t\t\t\t\tif (!left) {\n\t\t\t\t\t\t\tif (parentBBCode.isInline === false &&\n\t\t\t\t\t\t\t\tbase.opts.breakStartBlock &&\n\t\t\t\t\t\t\t\tparentBBCode.breakStart !== false) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (parentBBCode.breakStart) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Last child of parent so must be end line break\n\t\t\t\t\t\t\t// (breakEndBlock, breakEnd)\n\t\t\t\t\t\t\t// e.g. \\n[/tag]\n\t\t\t\t\t\t\t// remove last line break (breakEndBlock, breakEnd)\n\t\t\t\t\t\t} else if (!removedBreakEnd && !right) {\n\t\t\t\t\t\t\tif (parentBBCode.isInline === false &&\n\t\t\t\t\t\t\t\tbase.opts.breakEndBlock &&\n\t\t\t\t\t\t\t\tparentBBCode.breakEnd !== false) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (parentBBCode.breakEnd) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tremovedBreakEnd = remove;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (left && left.type === TOKEN_OPEN) {\n\t\t\t\t\t\tif ((bbcode = bbcodeHandlers[left.name])) {\n\t\t\t\t\t\t\tif (!onlyRemoveBreakAfter) {\n\t\t\t\t\t\t\t\tif (bbcode.isInline === false &&\n\t\t\t\t\t\t\t\t\tbase.opts.breakAfterBlock &&\n\t\t\t\t\t\t\t\t\tbbcode.breakAfter !== false) {\n\t\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (bbcode.breakAfter) {\n\t\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (bbcode.isInline === false) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!onlyRemoveBreakAfter &&\n\t\t\t\t\t\t!removedBreakBefore &&\n\t\t\t\t\t\tright &&\n\t\t\t\t\t\tright.type === TOKEN_OPEN) {\n\n\t\t\t\t\t\tif ((bbcode = bbcodeHandlers[right.name])) {\n\t\t\t\t\t\t\tif (bbcode.isInline === false &&\n\t\t\t\t\t\t\t\tbase.opts.breakBeforeBlock &&\n\t\t\t\t\t\t\t\tbbcode.breakBefore !== false) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (bbcode.breakBefore) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tremovedBreakBefore = remove;\n\n\t\t\t\t\t\t\tif (remove) {\n\t\t\t\t\t\t\t\tchildren.splice(i, 1);\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (remove) {\n\t\t\t\t\t\tchildren.splice(i, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\t// reset double removedBreakBefore removal protection.\n\t\t\t\t\t// This is needed for cases like \\n\\n[\\tag] where\n\t\t\t\t\t// only 1 \\n should be removed but without this they both\n\t\t\t\t\t// would be.\n\t\t\t\t\tremovedBreakBefore = false;\n\t\t\t\t} else if (token.type === TOKEN_OPEN) {\n\t\t\t\t\tnormaliseNewLines(token.children,\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t\tonlyRemoveBreakAfter);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Fixes any invalid nesting.\n\t\t *\n\t\t * If it is a block level element inside 1 or more inline elements\n\t\t * then those inline elements will be split at the point where the\n\t\t * block level is and the block level element placed between the split\n\t\t * parts. i.e.\n\t\t *     [inline]A[blocklevel]B[/blocklevel]C[/inline]\n\t\t * Will become:\n\t\t *     [inline]A[/inline][blocklevel]B[/blocklevel][inline]C[/inline]\n\t\t *\n\t\t * @param {array} children\n\t\t * @param {array} [parents] Null if there is no parents\n\t\t * @param {boolea} [insideInline] If inside an inline element\n\t\t * @param {array} [rootArr] Root array if there is one\n\t\t * @return {array}\n\t\t * @private\n\t\t */\n\t\tfunction fixNesting(children, parents, insideInline, rootArr) {\n\t\t\tvar token, i, parent, parentIndex, parentParentChildren, right;\n\n\t\t\tconst isInline = function (token) {\n\t\t\t\tconst bbcode = bbcodeHandlers[token.name];\n\n\t\t\t\treturn !bbcode || bbcode.isInline !== false;\n\t\t\t};\n\n\t\t\tparents = parents || [];\n\t\t\trootArr = rootArr || children;\n\n\t\t\t// This must check the length each time as it can change when\n\t\t\t// tokens are moved to fix the nesting.\n\t\t\tfor (i = 0; i < children.length; i++) {\n\t\t\t\tif (!(token = children[i]) || token.type !== TOKEN_OPEN) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (insideInline && !isInline(token)) {\n\t\t\t\t\t// if this is a blocklevel element inside an inline one then\n\t\t\t\t\t// split the parent at the block level element\n\t\t\t\t\tparent = last(parents);\n\t\t\t\t\tright = parent.splitAt(token);\n\n\t\t\t\t\tparentParentChildren = parents.length > 1 ? parents[parents.length - 2].children : rootArr;\n\n\t\t\t\t\t// If parent inline is allowed inside this tag, clone it and\n\t\t\t\t\t// wrap this tags children in it.\n\t\t\t\t\tif (isChildAllowed(token, parent)) {\n\t\t\t\t\t\tconst clone = parent.clone();\n\t\t\t\t\t\tclone.children = token.children;\n\t\t\t\t\t\ttoken.children = [clone];\n\t\t\t\t\t}\n\n\t\t\t\t\tparentIndex = parentParentChildren.indexOf(parent);\n\t\t\t\t\tif (parentIndex > -1) {\n\t\t\t\t\t\t// remove the block level token from the right side of\n\t\t\t\t\t\t// the split inline element\n\t\t\t\t\t\tright.children.splice(0, 1);\n\n\t\t\t\t\t\t// insert the block level token and the right side after\n\t\t\t\t\t\t// the left side of the inline token\n\t\t\t\t\t\tparentParentChildren.splice(\n\t\t\t\t\t\t\tparentIndex + 1,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\tright\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// If token is a block and is followed by a newline,\n\t\t\t\t\t\t// then move the newline along with it to the new parent\n\t\t\t\t\t\tconst next = right.children[0];\n\t\t\t\t\t\tif (next && next.type === TOKEN_NEWLINE) {\n\t\t\t\t\t\t\tif (!isInline(token)) {\n\t\t\t\t\t\t\t\tright.children.splice(0, 1);\n\t\t\t\t\t\t\t\tparentParentChildren.splice(\n\t\t\t\t\t\t\t\t\tparentIndex + 2,\n\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\tnext\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// return to parents loop as the\n\t\t\t\t\t\t// children have now increased\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tparents.push(token);\n\n\t\t\t\tfixNesting(\n\t\t\t\t\ttoken.children,\n\t\t\t\t\tparents,\n\t\t\t\t\tinsideInline || isInline(token),\n\t\t\t\t\trootArr\n\t\t\t\t);\n\n\t\t\t\tparents.pop();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Removes any empty BBCodes which are not allowed to be empty.\n\t\t *\n\t\t * @param {array} tokens\n\t\t * @private\n\t\t */\n\t\tfunction removeEmpty(tokens) {\n\t\t\tvar token, bbcode;\n\n\t\t\t/**\n\t\t\t * Checks if all children are whitespace or not\n\t\t\t * @private\n\t\t\t */\n\t\t\tconst isTokenWhiteSpace = function (children) {\n\t\t\t\tvar j = children.length;\n\n\t\t\t\twhile (j--) {\n\t\t\t\t\tconst type = children[j].type;\n\n\t\t\t\t\tif (type === TOKEN_OPEN || type === TOKEN_CLOSE) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type === TOKEN_CONTENT &&\n\t\t\t\t\t\t/\\S|\\u00A0/.test(children[j].val)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\tvar i = tokens.length;\n\t\t\twhile (i--) {\n\t\t\t\t// So skip anything that isn't a tag since only tags can be\n\t\t\t\t// empty, content can't\n\t\t\t\tif (!(token = tokens[i]) || token.type !== TOKEN_OPEN) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tbbcode = bbcodeHandlers[token.name];\n\n\t\t\t\t// Remove any empty children of this tag first so that if they\n\t\t\t\t// are all removed this one doesn't think it's not empty.\n\t\t\t\tremoveEmpty(token.children);\n\n\t\t\t\tif (isTokenWhiteSpace(token.children) &&\n\t\t\t\t\tbbcode &&\n\t\t\t\t\t!bbcode.isSelfClosing &&\n\t\t\t\t\t!bbcode.allowsEmpty) {\n\t\t\t\t\ttokens.splice.apply(tokens, [i, 1].concat(token.children));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Converts a BBCode string to HTML\n\t\t *\n\t\t * @param {string} str\n\t\t * @param {boolean}   preserveNewLines If to preserve all new lines, not\n\t\t *                                  strip any based on the passed\n\t\t *                                  formatting options\n\t\t * @return {string}\n\t\t * @memberOf BBCodeParser.prototype\n\t\t */\n\t\tbase.toHTML = function (str, preserveNewLines) {\n\t\t\treturn convertToHTML(base.parse(str, preserveNewLines), true);\n\t\t};\n\n\t\tbase.toHTMLFragment = function (str, preserveNewLines) {\n\t\t\treturn convertToHTML(base.parse(str, preserveNewLines), false);\n\t\t};\n\n\t\t/**\n\t\t * @private\n\t\t */\n\t\tfunction convertToHTML(tokens, isRoot) {\n\t\t\tvar undef,\n\t\t\t\ttoken,\n\t\t\t\tbbcode,\n\t\t\t\tcontent,\n\t\t\t\thtml,\n\t\t\t\tneedsBlockWrap,\n\t\t\t\tblockWrapOpen,\n\t\t\t\tisInline,\n\t\t\t\tlastChild,\n\t\t\t\tret = '';\n\n\t\t\tisInline = function (bbcode) {\n\t\t\t\treturn (!bbcode || (bbcode.isHtmlInline !== undef ? bbcode.isHtmlInline : bbcode.isInline)) !== false;\n\t\t\t};\n\n\t\t\twhile (tokens.length > 0) {\n\t\t\t\tif (!(token = tokens.shift())) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (token.type === TOKEN_OPEN) {\n\t\t\t\t\tlastChild = token.children[token.children.length - 1] || {};\n\t\t\t\t\tbbcode = bbcodeHandlers[token.name];\n\t\t\t\t\tneedsBlockWrap = isRoot && isInline(bbcode);\n\t\t\t\t\tcontent = convertToHTML(token.children, false);\n\n\t\t\t\t\tif (bbcode && bbcode.html) {\n\t\t\t\t\t\t// Only add a line break to the end if this is\n\t\t\t\t\t\t// blocklevel and the last child wasn't block-level\n\t\t\t\t\t\tif (!isInline(bbcode) &&\n\t\t\t\t\t\t\tisInline(bbcodeHandlers[lastChild.name]) &&\n\t\t\t\t\t\t\t!bbcode.isPreFormatted &&\n\t\t\t\t\t\t\t!bbcode.skipLastLineBreak) {\n\t\t\t\t\t\t\t// Add placeholder br to end of block level\n\t\t\t\t\t\t\t// elements\n\t\t\t\t\t\t\t//content += '<br />';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!isFunction(bbcode.html)) {\n\t\t\t\t\t\t\ttoken.attrs['0'] = content;\n\t\t\t\t\t\t\thtml = formatBBCodeString(\n\t\t\t\t\t\t\t\tbbcode.html,\n\t\t\t\t\t\t\t\ttoken.attrs\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thtml = bbcode.html.call(\n\t\t\t\t\t\t\t\tbase,\n\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t\ttoken.attrs,\n\t\t\t\t\t\t\t\tcontent\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\thtml = token.val +\n\t\t\t\t\t\t\tcontent +\n\t\t\t\t\t\t\t(token.closing ? token.closing.val : '');\n\t\t\t\t\t}\n\t\t\t\t} else if (token.type === TOKEN_NEWLINE) {\n\t\t\t\t\tif (!isRoot) {\n\t\t\t\t\t\tret += '<br />';\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If not already in a block wrap then start a new block\n\t\t\t\t\tif (!blockWrapOpen) {\n\t\t\t\t\t\tret += '<div>';\n\t\t\t\t\t}\n\n\t\t\t\t\tret += '<br />';\n\n\t\t\t\t\t// Normally the div acts as a line-break with by moving\n\t\t\t\t\t// whatever comes after onto a new line.\n\t\t\t\t\t// If this is the last token, add an extra line-break so it\n\t\t\t\t\t// shows as there will be nothing after it.\n\t\t\t\t\tif (!tokens.length) {\n\t\t\t\t\t\tret += '<br />';\n\t\t\t\t\t}\n\n\t\t\t\t\tret += '</div>\\n';\n\t\t\t\t\tblockWrapOpen = false;\n\t\t\t\t\tcontinue;\n\t\t\t\t\t// content\n\t\t\t\t} else {\n\t\t\t\t\tneedsBlockWrap = isRoot;\n\t\t\t\t\thtml = escapeEntities(token.val, true);\n\t\t\t\t}\n\n\t\t\t\tif (needsBlockWrap && !blockWrapOpen) {\n\t\t\t\t\tret += '<div>';\n\t\t\t\t\tblockWrapOpen = true;\n\t\t\t\t} else if (!needsBlockWrap && blockWrapOpen) {\n\t\t\t\t\tret += '</div>\\n';\n\t\t\t\t\tblockWrapOpen = false;\n\t\t\t\t}\n\n\t\t\t\tret += html;\n\t\t\t}\n\n\t\t\tif (blockWrapOpen) {\n\t\t\t\tret += '</div>\\n';\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\t/**\n\t\t * Takes a BBCode string, parses it then converts it back to BBCode.\n\t\t *\n\t\t * This will auto fix the BBCode and format it with the specified\n\t\t * options.\n\t\t *\n\t\t * @param {string} str\n\t\t * @param {boolean} preserveNewLines If to preserve all new lines, not\n\t\t *                                strip any based on the passed\n\t\t *                                formatting options\n\t\t * @return {string}\n\t\t * @memberOf BBCodeParser.prototype\n\t\t */\n\t\tbase.toBBCode = function (str, preserveNewLines) {\n\t\t\treturn convertToBBCode(base.parse(str, preserveNewLines));\n\t\t};\n\n\t\t/**\n\t\t * Converts parsed tokens back into BBCode with the\n\t\t * formatting specified in the options and with any\n\t\t * fixes specified.\n\t\t *\n\t\t * @param  {array} toks Array of parsed tokens from base.parse()\n\t\t * @return {string}\n\t\t * @private\n\t\t */\n\t\tfunction convertToBBCode(toks) {\n\t\t\tvar token,\n\t\t\t\tattr,\n\t\t\t\tbbcode,\n\t\t\t\tisBlock,\n\t\t\t\tisSelfClosing,\n\t\t\t\tquoteType,\n\t\t\t\tbreakBefore,\n\t\t\t\tbreakStart,\n\t\t\t\tbreakEnd,\n\t\t\t\tbreakAfter,\n\t\t\t\tret = '';\n\n\t\t\twhile (toks.length > 0) {\n\t\t\t\tif (!(token = toks.shift())) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t// TODO: tidy this\n\t\t\t\tbbcode = bbcodeHandlers[token.name];\n\t\t\t\tisBlock = !(!bbcode || bbcode.isInline !== false);\n\t\t\t\tisSelfClosing = bbcode && bbcode.isSelfClosing;\n\n\t\t\t\tbreakBefore = (isBlock &&\n\t\t\t\t\t\tbase.opts.breakBeforeBlock &&\n\t\t\t\t\t\tbbcode.breakBefore !== false) ||\n\t\t\t\t\t(bbcode && bbcode.breakBefore);\n\n\t\t\t\tbreakStart = (isBlock &&\n\t\t\t\t\t\t!isSelfClosing &&\n\t\t\t\t\t\tbase.opts.breakStartBlock &&\n\t\t\t\t\t\tbbcode.breakStart !== false) ||\n\t\t\t\t\t(bbcode && bbcode.breakStart);\n\n\t\t\t\tbreakEnd = (isBlock &&\n\t\t\t\t\t\tbase.opts.breakEndBlock &&\n\t\t\t\t\t\tbbcode.breakEnd !== false) ||\n\t\t\t\t\t(bbcode && bbcode.breakEnd);\n\n\t\t\t\tbreakAfter = (isBlock &&\n\t\t\t\t\t\tbase.opts.breakAfterBlock &&\n\t\t\t\t\t\tbbcode.breakAfter !== false) ||\n\t\t\t\t\t(bbcode && bbcode.breakAfter);\n\n\t\t\t\tquoteType = (bbcode ? bbcode.quoteType : null) ||\n\t\t\t\t\tbase.opts.quoteType ||\n\t\t\t\t\tQuoteType.auto;\n\n\t\t\t\tif (!bbcode && token.type === TOKEN_OPEN) {\n\t\t\t\t\tret += token.val;\n\n\t\t\t\t\tif (token.children) {\n\t\t\t\t\t\tret += convertToBBCode(token.children);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (token.closing) {\n\t\t\t\t\t\tret += token.closing.val;\n\t\t\t\t\t}\n\t\t\t\t} else if (token.type === TOKEN_OPEN) {\n\t\t\t\t\tif (breakBefore) {\n\t\t\t\t\t\tret += '\\n';\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert the tag and it's attributes to BBCode\n\t\t\t\t\tret += `[${token.name}`;\n\t\t\t\t\tif (token.attrs) {\n\t\t\t\t\t\tif (token.attrs.defaultattr) {\n\t\t\t\t\t\t\tret += `=${quote(\n\t\t\t\t\t\t\t\ttoken.attrs.defaultattr,\n\t\t\t\t\t\t\t\tquoteType,\n\t\t\t\t\t\t\t\t'defaultattr'\n\t\t\t\t\t\t\t)}`;\n\n\t\t\t\t\t\t\tdelete token.attrs.defaultattr;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (attr in token.attrs) {\n\t\t\t\t\t\t\tif (token.attrs.hasOwnProperty(attr)) {\n\t\t\t\t\t\t\t\tret += ` ${attr}=${quote(token.attrs[attr], quoteType, attr)}`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tret += ']';\n\n\t\t\t\t\tif (breakStart) {\n\t\t\t\t\t\tret += '\\n';\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert the tags children to BBCode\n\t\t\t\t\tif (token.children) {\n\t\t\t\t\t\tret += convertToBBCode(token.children);\n\t\t\t\t\t}\n\n\t\t\t\t\t// add closing tag if not self closing\n\t\t\t\t\tif (!isSelfClosing && !bbcode.excludeClosing) {\n\t\t\t\t\t\tif (breakEnd) {\n\t\t\t\t\t\t\tret += '\\n';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tret += `[/${token.name}]`;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (breakAfter) {\n\t\t\t\t\t\tret += '\\n';\n\t\t\t\t\t}\n\n\t\t\t\t\t// preserve whatever was recognized as the\n\t\t\t\t\t// closing tag if it is a self closing tag\n\t\t\t\t\tif (token.closing && isSelfClosing) {\n\t\t\t\t\t\tret += token.closing.val;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tret += token.val;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\t/**\n\t\t * Quotes an attribute\n\t\t *\n\t\t * @param {string} str\n\t\t * @param {BBCodeParser.QuoteType} quoteType\n\t\t * @param {string} name\n\t\t * @return {string}\n\t\t * @private\n\t\t */\n\t\tfunction quote(str, quoteType, name) {\n\t\t\tconst needsQuotes = /\\s|=/.test(str);\n\n\t\t\tif (isFunction(quoteType)) {\n\t\t\t\treturn quoteType(str, name);\n\t\t\t}\n\n\t\t\tif (quoteType === QuoteType.never ||\n\t\t\t\t(quoteType === QuoteType.auto && !needsQuotes)) {\n\t\t\t\treturn str;\n\t\t\t}\n\n\t\t\treturn `\"${str.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"')}\"`;\n\t\t}\n\n\t\t/**\n\t\t * Returns the last element of an array or null\n\t\t *\n\t\t * @param {array} arr\n\t\t * @return {Object} Last element\n\t\t * @private\n\t\t */\n\t\tfunction last(arr) {\n\t\t\tif (arr.length) {\n\t\t\t\treturn arr[arr.length - 1];\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\t/**\n\t\t * Converts a string to lowercase.\n\t\t *\n\t\t * @param {string} str\n\t\t * @return {string} Lowercase version of str\n\t\t * @private\n\t\t */\n\t\tfunction lower(str) {\n\t\t\treturn str.toLowerCase();\n\t\t}\n\t};\n\n\t/**\n\t * Quote type\n\t * @type {Object}\n\t * @class QuoteType\n\t * @name BBCodeParser.QuoteType\n\t * @since 1.4.0\n\t */\n\tBBCodeParser.QuoteType = QuoteType;\n\n\t/**\n\t * Default BBCode parser options\n\t * @type {Object}\n\t */\n\tBBCodeParser.defaults = {\n\t\t/**\n\t\t * If to add a new line before block level elements\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tbreakBeforeBlock: false,\n\n\t\t/**\n\t\t * If to add a new line after the start of block level elements\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tbreakStartBlock: false,\n\n\t\t/**\n\t\t * If to add a new line before the end of block level elements\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tbreakEndBlock: false,\n\n\t\t/**\n\t\t * If to add a new line after block level elements\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tbreakAfterBlock: true,\n\n\t\t/**\n\t\t * If to remove empty tags\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tremoveEmptyTags: true,\n\n\t\t/**\n\t\t * If to fix invalid nesting,\n\t\t * i.e. block level elements inside inline elements.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tfixInvalidNesting: true,\n\n\t\t/**\n\t\t * If to fix invalid children.\n\t\t * i.e. A tag which is inside a parent that doesn't\n\t\t * allow that type of tag.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tfixInvalidChildren: true,\n\n\t\t/**\n\t\t * Attribute quote type\n\t\t *\n\t\t * @type {BBCodeParser.QuoteType}\n\t\t * @since 1.4.1\n\t\t */\n\t\tquoteType: QuoteType.auto,\n\n\t\t/**\n\t\t * Whether to use strict matching on attributes and styles.\n\t\t *\n\t\t * When true this will perform AND matching requiring all tag\n\t\t * attributes and styles to match.\n\t\t *\n\t\t * When false will perform OR matching and will match if any of\n\t\t * a tags attributes or styles match.\n\t\t *\n\t\t * @type {Boolean}\n\t\t * @since 3.1.0\n\t\t */\n\t\tstrictMatch: false\n\t};\n\n\t/**\n\t * Converts a number 0-255 to hex.\n\t *\n\t * Will return 00 if number is not a valid number.\n\t *\n\t * @param  {any} number\n\t * @return {string}\n\t * @private\n\t */\n\tfunction toHex(number) {\n\t\tnumber = parseInt(number, 10);\n\n\t\tif (isNaN(number)) {\n\t\t\treturn '00';\n\t\t}\n\n\t\tnumber = Math.max(0, Math.min(number, 255)).toString(16);\n\n\t\treturn number.length < 2 ? `0${number}` : number;\n\t}\n\n\t/**\n\t * Normalises a CSS colour to hex #xxxxxx format\n\t *\n\t * @param  {string} colorStr\n\t * @return {string}\n\t * @private\n\t */\n\tfunction _normaliseColour(colorStr) {\n\t\tvar match;\n\n\t\tcolorStr = colorStr || '#000';\n\n\t\t// rgb(n,n,n);\n\t\tif ((match =\n\t\t\tcolorStr.match(/rgb\\((\\d{1,3}),\\s*?(\\d{1,3}),\\s*?(\\d{1,3})\\)/i))) {\n\t\t\treturn '#' +\n\t\t\t\ttoHex(match[1]) +\n\t\t\t\ttoHex(match[2]) +\n\t\t\t\ttoHex(match[3]);\n\t\t}\n\n\t\t// expand shorthand\n\t\tif ((match = colorStr.match(/#([0-9a-f])([0-9a-f])([0-9a-f])\\s*?$/i))) {\n\t\t\treturn '#' +\n\t\t\t\tmatch[1] +\n\t\t\t\tmatch[1] +\n\t\t\t\tmatch[2] +\n\t\t\t\tmatch[2] +\n\t\t\t\tmatch[3] +\n\t\t\t\tmatch[3];\n\t\t}\n\n\t\treturn colorStr;\n\t}\n\n\t/**\n\t * SCEditor BBCode format\n\t * @since 2.0.0\n\t */\n\tfunction bbcodeFormat() {\n\t\tvar base = this;\n\n\t\tbase.stripQuotes = _stripQuotes;\n\n\t\t/**\n\t\t * cache of all the tags pointing to their bbcodes to enable\n\t\t * faster lookup of which bbcode a tag should have\n\t\t * @private\n\t\t */\n\t\tvar tagsToBBCodes = {};\n\n\t\t/**\n\t\t * Allowed children of specific HTML tags. Empty array if no\n\t\t * children other than text nodes are allowed\n\t\t * @private\n\t\t */\n\t\tvar validChildren = {\n\t\t\tul: ['li', 'ol', 'ul'],\n\t\t\tol: ['li', 'ol', 'ul'],\n\t\t\ttable: ['tr'],\n\t\t\ttr: ['td', 'th'],\n\t\t\tcode: ['br', 'p', 'div']\n\t\t};\n\n\t\t/**\n\t\t * Populates tagsToBBCodes and stylesToBBCodes for easier lookups\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction buildBbcodeCache() {\n\t\t\teach(bbcodeHandlers,\n\t\t\t\tfunction (bbcode, handler) {\n\t\t\t\t\tvar\n\t\t\t\t\t\tisBlock = handler.isInline === false;\n\t\t\t\t\tconst tags = bbcodeHandlers[bbcode].tags;\n\t\t\t\t\tconst styles = bbcodeHandlers[bbcode].styles;\n\n\t\t\t\t\tif (styles) {\n\t\t\t\t\t\ttagsToBBCodes['*'] = tagsToBBCodes['*'] || {};\n\t\t\t\t\t\ttagsToBBCodes['*'][isBlock] =\n\t\t\t\t\t\t\ttagsToBBCodes['*'][isBlock] || {};\n\t\t\t\t\t\ttagsToBBCodes['*'][isBlock][bbcode] = [\n\t\t\t\t\t\t\t['style', Object.entries(styles)]\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (tags) {\n\t\t\t\t\t\teach(tags,\n\t\t\t\t\t\t\tfunction (tag, values) {\n\t\t\t\t\t\t\t\tif (values && values.style) {\n\t\t\t\t\t\t\t\t\tvalues.style = Object.entries(values.style);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\ttagsToBBCodes[tag] = tagsToBBCodes[tag] || {};\n\t\t\t\t\t\t\t\ttagsToBBCodes[tag][isBlock] =\n\t\t\t\t\t\t\t\t\ttagsToBBCodes[tag][isBlock] || {};\n\t\t\t\t\t\t\t\ttagsToBBCodes[tag][isBlock][bbcode] =\n\t\t\t\t\t\t\t\t\tvalues && Object.entries(values);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Handles adding newlines after block level elements\n\t\t *\n\t\t * @param {HTMLElement} element The element to convert\n\t\t * @param {string} content  The tags text content\n\t\t * @return {string}\n\t\t * @private\n\t\t */\n\t\tfunction handleBlockNewlines(element, content) {\n\t\t\tconst tag = element.nodeName.toLowerCase();\n\t\t\tconst isInline = dom.isInline;\n\t\t\tif (!isInline(element, true) || tag === 'br') {\n\t\t\t\tlet isLastBlockChild;\n\t\t\t\tlet parent;\n\t\t\t\tlet parentLastChild;\n\t\t\t\tlet previousSibling = element.previousSibling;\n\n\t\t\t\t// Skips selection makers and ignored elements\n\t\t\t\t// Skip empty inline elements\n\t\t\t\twhile (previousSibling &&\n\t\t\t\t\tpreviousSibling.nodeType === 1 &&\n\t\t\t\t\t!is(previousSibling, 'br') &&\n\t\t\t\t\tisInline(previousSibling, true) &&\n\t\t\t\t\t!previousSibling.firstChild) {\n\t\t\t\t\tpreviousSibling = previousSibling.previousSibling;\n\t\t\t\t}\n\n\t\t\t\t// If it's the last block of an inline that is the last\n\t\t\t\t// child of a block then it shouldn't cause a line break\n\t\t\t\t// <block><inline><br></inline></block>\n\t\t\t\tdo {\n\t\t\t\t\tparent = element.parentNode;\n\t\t\t\t\tparentLastChild = parent && parent.lastChild;\n\n\t\t\t\t\tisLastBlockChild = parentLastChild === element;\n\t\t\t\t\telement = parent;\n\t\t\t\t} while (parent && isLastBlockChild && isInline(parent, true));\n\n\t\t\t\t// If this block is:\n\t\t\t\t//\t* Not the last child of a block level element\n\t\t\t\t//\t* Is a <li> tag (lists are blocks)\n\t\t\t\tif (!isLastBlockChild || tag === 'li') {\n\t\t\t\t\tcontent += '\\n';\n\t\t\t\t}\n\n\t\t\t\t// Check for:\n\t\t\t\t// <block>text<block>text</block></block>\n\t\t\t\t//\n\t\t\t\t// The second opening <block> opening tag should cause a\n\t\t\t\t// line break because the previous sibing is inline.\n\t\t\t\tif (tag !== 'br' &&\n\t\t\t\t\tpreviousSibling &&\n\t\t\t\t\t!is(previousSibling, 'br') &&\n\t\t\t\t\tisInline(previousSibling, true)) {\n\t\t\t\t\tcontent = `\\n${content}`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn content;\n\t\t}\n\n\t\t/**\n\t\t * Handles a HTML tag and finds any matching BBCodes\n\t\t *\n\t\t * @param {HTMLElement} element The element to convert\n\t\t * @param {string} content  The Tags text content\n\t\t * @param {boolean} blockLevel\n\t\t * @return {string} Content with any matching BBCode tags\n\t\t *                  wrapped around it.\n\t\t * @private\n\t\t */\n\t\tfunction handleTags(element, content, blockLevel) {\n\t\t\tfunction isStyleMatch(style) {\n\t\t\t\tconst property = style[0];\n\t\t\t\tconst values = style[1];\n\t\t\t\tconst val = dom.getStyle(element, property);\n\t\t\t\tconst parent = element.parentNode;\n\n\t\t\t\t// if the parent has the same style use that instead of this one\n\t\t\t\t// so you don't end up with [i]parent[i]child[/i][/i]\n\t\t\t\tif (!val || parent && dom.hasStyle(parent, property, val)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn !values || values.includes(val);\n\t\t\t}\n\n\t\t\tfunction createAttributeMatch(isStrict) {\n\t\t\t\treturn function (attribute) {\n\t\t\t\t\tconst name = attribute[0];\n\t\t\t\t\tconst value = attribute[1];\n\n\t\t\t\t\t// code tags should skip most styles\n\t\t\t\t\tif (name === 'style' && element.nodeName === 'CODE') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (name === 'style' && value) {\n\t\t\t\t\t\treturn value[isStrict ? 'every' : 'some'](isStyleMatch);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst val = attr(element, name);\n\n\t\t\t\t\t\treturn val && (!value || value.includes(val));\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction handleTag(tag) {\n\t\t\t\tif (!tagsToBBCodes[tag] || !tagsToBBCodes[tag][blockLevel]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// loop all bbcodes for this tag\n\t\t\t\teach(tagsToBBCodes[tag][blockLevel],\n\t\t\t\t\tfunction (bbcode, attrs) {\n\t\t\t\t\t\tvar fn,\n\t\t\t\t\t\t\tformat,\n\t\t\t\t\t\t\tisStrict = bbcodeHandlers[bbcode].strictMatch;\n\n\t\t\t\t\t\tif (typeof isStrict === 'undefined') {\n\t\t\t\t\t\t\tisStrict = base.opts.strictMatch;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Skip if the element doesn't have the attribute or the\n\t\t\t\t\t\t// attribute doesn't match one of the required values\n\t\t\t\t\t\tfn = isStrict ? 'every' : 'some';\n\t\t\t\t\t\tif (attrs && !attrs[fn](createAttributeMatch(isStrict))) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tformat = bbcodeHandlers[bbcode].format;\n\t\t\t\t\t\tif (isFunction(format)) {\n\t\t\t\t\t\t\tcontent = format.call(base, element, content);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontent = _formatString(format, content);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\thandleTag('*');\n\t\t\thandleTag(element.nodeName.toLowerCase());\n\t\t\treturn content;\n\t\t}\n\n\t\t/**\n\t\t * Converts a HTML dom element to BBCode starting from\n\t\t * the innermost element and working backwards\n\t\t *\n\t\t * @private\n\t\t * @param {HTMLElement}\telement\n\t\t * @param {boolean}\thasCodeParent\n\t\t * @return {string} BBCode\n\t\t * @memberOf SCEditor.plugins.bbcode.prototype\n\t\t */\n\t\tfunction elementToBbcode(element, hasCodeParent) {\n\t\t\tvar toBBCode = function (node, hasCodeParent, vChildren) {\n\t\t\t\tvar ret = '';\n\n\t\t\t\tdom.traverse(node,\n\t\t\t\t\tfunction (node) {\n\t\t\t\t\t\tvar content = '';\n\t\t\t\t\t\tconst nodeType = node.nodeType;\n\t\t\t\t\t\tconst tag = node.nodeName.toLowerCase();\n\t\t\t\t\t\tconst isCodeTag = tag === 'code';\n\t\t\t\t\t\tvar vChild = validChildren[tag];\n\t\t\t\t\t\tconst firstChild = node.firstChild;\n\t\t\t\t\t\tvar isValidChild = true;\n\n\t\t\t\t\t\tif (vChildren) {\n\t\t\t\t\t\t\tisValidChild = vChildren.indexOf(tag) > -1;\n\n\t\t\t\t\t\t\t// if this tag is one of the parents allowed children\n\t\t\t\t\t\t\t// then set this tags allowed children to whatever it\n\t\t\t\t\t\t\t// allows, otherwise set to what the parent allows\n\t\t\t\t\t\t\tif (!isValidChild) {\n\t\t\t\t\t\t\t\tvChild = vChildren;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// 1 = element\n\t\t\t\t\t\tif (nodeType === 1) {\n\t\t\t\t\t\t\t// skip empty nlf elements (new lines automatically\n\t\t\t\t\t\t\t// added after block level elements like quotes)\n\t\t\t\t\t\t\tif (is(node, '.sceditor-nlf') && !firstChild) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// don't convert iframe contents\n\t\t\t\t\t\t\tif (tag !== 'iframe') {\n\t\t\t\t\t\t\t\tcontent = toBBCode(node,\n\t\t\t\t\t\t\t\t\thasCodeParent || isCodeTag,\n\t\t\t\t\t\t\t\t\tvChild);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// TODO: isValidChild is no longer needed. Should use\n\t\t\t\t\t\t\t// valid children bbcodes instead by creating BBCode\n\t\t\t\t\t\t\t// tokens like the parser.\n\t\t\t\t\t\t\tif (isValidChild) {\n\t\t\t\t\t\t\t\t// Emoticons should be converted if they have found\n\t\t\t\t\t\t\t\t// their way into a code tag\n\t\t\t\t\t\t\t\tif (!hasCodeParent) {\n\t\t\t\t\t\t\t\t\tif (!isCodeTag) {\n\t\t\t\t\t\t\t\t\t\t// Parse inline codes first so they don't\n\t\t\t\t\t\t\t\t\t\t// contain block level codes\n\t\t\t\t\t\t\t\t\t\tcontent = handleTags(node, content, false);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tcontent = handleTags(node, content, true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tret += handleBlockNewlines(node, content);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tret += content;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// 3 = text\n\t\t\t\t\t\t} else if (nodeType === 3) {\n\t\t\t\t\t\t\tret += node.nodeValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfalse,\n\t\t\t\t\ttrue);\n\n\t\t\t\treturn ret;\n\t\t\t};\n\n\t\t\treturn toBBCode(element, hasCodeParent);\n\t\t};\n\n\t\t/**\n\t\t * Initializer\n\t\t * @private\n\t\t */\n\t\tbase.init = function () {\n\t\t\tbase.opts = this.opts;\n\t\t\tbase.elementToBbcode = elementToBbcode;\n\n\t\t\t// build the BBCode cache\n\t\t\tbuildBbcodeCache();\n\n\t\t\tthis.commands = extend(\n\t\t\t\ttrue,\n\t\t\t\t{},\n\t\t\t\tdefaultCommandsOverrides,\n\t\t\t\tthis.commands\n\t\t\t);\n\n\t\t\t// Add BBCode helper methods\n\t\t\tthis.toBBCode = base.toSource;\n\t\t\tthis.fromBBCode = base.toHtml;\n\t\t};\n\n\t\t/**\n\t\t * Converts BBCode into HTML\n\t\t *\n\t\t * @param {boolean} asFragment\n\t\t * @param {string} source\n\t\t * @param {boolean} [legacyAsFragment] Used by fromBBCode() method\n\t\t */\n\t\tfunction toHtml(asFragment, source, legacyAsFragment) {\n\t\t\tconst parser = new BBCodeParser(base.opts.parserOptions);\n\t\t\tconst toHTML = (asFragment || legacyAsFragment) ? parser.toHTMLFragment : parser.toHTML;\n\n\t\t\teditorOptions = base.opts;\n\n\t\t\treturn toHTML(base.opts.bbcodeTrim ? source.trim() : source);\n\t\t}\n\n\t\t/**\n\t\t * Converts HTML into BBCode\n\t\t *\n\t\t * @param {boolean} asFragment\n\t\t * @param {string}\thtml\n\t\t * @param {!Document} [context]\n\t\t * @param {!HTMLElement} [parent]\n\t\t * @return {string}\n\t\t * @private\n\t\t */\n\t\tfunction toSource(asFragment, html, context, parent) {\n\t\t\tcontext = context || document;\n\n\t\t\tvar bbcode, elements;\n\t\t\tconst hasCodeParent = !!dom.closest(parent, 'code');\n\t\t\tconst containerParent = context.createElement('div');\n\t\t\tconst container = context.createElement('div');\n\t\t\tconst parser = new BBCodeParser(base.opts.parserOptions);\n\n\t\t\tcontainer.innerHTML = html;\n\t\t\tcss(containerParent, 'visibility', 'hidden');\n\t\t\tcontainerParent.appendChild(container);\n\t\t\tcontext.body.appendChild(containerParent);\n\n\t\t\tif (asFragment) {\n\t\t\t\t// Add text before and after so removeWhiteSpace doesn't remove\n\t\t\t\t// leading and trailing whitespace\n\t\t\t\tcontainerParent.insertBefore(\n\t\t\t\t\tcontext.createTextNode('#'),\n\t\t\t\t\tcontainerParent.firstChild\n\t\t\t\t);\n\t\t\t\tcontainerParent.appendChild(context.createTextNode('#'));\n\t\t\t}\n\n\t\t\t// Match parents white-space handling\n\t\t\tif (parent) {\n\t\t\t\tcss(container, 'whiteSpace', css(parent, 'whiteSpace'));\n\t\t\t}\n\n\t\t\t// Remove all nodes with sceditor-ignore class\n\t\t\telements = container.getElementsByClassName('sceditor-ignore');\n\t\t\twhile (elements.length) {\n\t\t\t\telements[0].parentNode.removeChild(elements[0]);\n\t\t\t}\n\n\t\t\tdom.removeWhiteSpace(containerParent);\n\n\t\t\tbbcode = elementToBbcode(container, hasCodeParent);\n\n\t\t\tcontext.body.removeChild(containerParent);\n\n\t\t\tbbcode = parser.toBBCode(bbcode, true);\n\n\t\t\tif (base.opts.bbcodeTrim) {\n\t\t\t\tbbcode = bbcode.trim();\n\t\t\t}\n\n\t\t\treturn bbcode;\n\t\t};\n\n\t\tbase.toHtml = toHtml.bind(null, false);\n\t\tbase.fragmentToHtml = toHtml.bind(null, true);\n\t\tbase.toSource = toSource.bind(null, false);\n\t\tbase.fragmentToSource = toSource.bind(null, true);\n\t};\n\n\t/**\n\t * Gets a BBCode\n\t *\n\t * @param {string} name\n\t * @return {Object|null}\n\t * @since 2.0.0\n\t */\n\tbbcodeFormat.get = function (name) {\n\t\treturn bbcodeHandlers[name] || null;\n\t};\n\n\t/**\n\t * Adds a BBCode to the parser or updates an existing\n\t * BBCode if a BBCode with the specified name already exists.\n\t *\n\t * @param {string} name\n\t * @param {Object} bbcode\n\t * @return {this}\n\t * @since 2.0.0\n\t */\n\tbbcodeFormat.set = function (name, bbcode) {\n\t\tif (name && bbcode) {\n\t\t\t// merge any existing command properties\n\t\t\tbbcode = extend(bbcodeHandlers[name] || {}, bbcode);\n\n\t\t\tbbcode.remove = function () {\n\t\t\t\tdelete bbcodeHandlers[name];\n\t\t\t};\n\n\t\t\tbbcodeHandlers[name] = bbcode;\n\t\t}\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Renames a BBCode\n\t *\n\t * This does not change the format or HTML handling, those must be\n\t * changed manually.\n\t *\n\t * @param  {string} name    [description]\n\t * @param  {string} newName [description]\n\t * @return {this|false}\n\t * @since 2.0.0\n\t */\n\tbbcodeFormat.rename = function (name, newName) {\n\t\tif (name in bbcodeHandlers) {\n\t\t\tbbcodeHandlers[newName] = bbcodeHandlers[name];\n\n\t\t\tdelete bbcodeHandlers[name];\n\t\t}\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Removes a BBCode\n\t *\n\t * @param {string} name\n\t * @return {this}\n\t * @since 2.0.0\n\t */\n\tbbcodeFormat.remove = function (name) {\n\t\tif (name in bbcodeHandlers) {\n\t\t\tdelete bbcodeHandlers[name];\n\t\t}\n\n\t\treturn this;\n\t};\n\n\tbbcodeFormat.formatBBCodeString = formatBBCodeString;\n\n\tsceditor.formats.bbcode = bbcodeFormat;\n\tsceditor.BBCodeParser = BBCodeParser;\n}(sceditor));\n","/**\n * SCEditor SVG fontawesome plugin\n * http://www.sceditor.com/\n *\n * Copyright (C) 2011-2026, Sam Clarke (samclarke.com)\n *\n * SCEditor is licensed under the MIT license:\n *\thttp://www.opensource.org/licenses/mit-license.php\n *\n * @author Sam Clarke\n */\n(function (document, sceditor) {\n\t'use strict';\n\n\tvar dom = sceditor.dom;\n\n\t/* eslint max-len: off*/\n\tvar icons = {\n\t\t'albums': '<i class=\"fa-solid fa-images\"></i',\n\t\t'attachments': '<i class=\"fa-solid fa-paperclip\"></i',\n\t\t'bold': '<i class=\"fa-solid fa-bold\"></i>',\n\t\t'bulletlist': '<i class=\"fa-solid fa-list-ul\"></i>',\n\t\t'center': '<i class=\"fa-solid fa-align-center\"></i>',\n\t\t'code': '<i class=\"fa-solid fa-code\"></i>',\n\t\t'color':\n\t\t\t'<span class=\"fa-stack me-2 pe-2\"><i class=\"fas fa-font fa-stack-1x\"></i><i class=\"fa fa-xs fa-palette sce-color fa-sceditor-badge\"></i></span>',\n\t\t'copy': '<i class=\"fa-solid fa-copy\"></i>',\n\t\t'cut': '<i class=\"fa-solid fa-scissors\"></i>',\n\t\t'email': '<i class=\"fa-solid fa-envelope\"></i>',\n\t\t'emojis': '<i class=\"fa-solid fa-face-smile\"></i>',\n\t\t'extensions': '<i class=\"fa-solid fa-plug\"></i>',\n\t\t'font':\n\t\t\t'<span class=\"fa-stack me-2 pe-2\"><i class=\"fas fa-font fa-stack-1x\"></i><i class=\"fa fa-xs fa-font fa-sceditor-badge\"></i></span>',\n\t\t'format': '<i class=\"fa-solid fa-font\"></i>',\n\t\t'grip':\n\t\t\t'<svg xmlns=\"http://www.w3.org/2000/svg\"viewbox=\"0 0 16 16\" unselectable=\"on\"><path d=\"M14.656 5.156l-10 10 .688.688 10-10-.688-.688zm0 3l-7 7 .688.688 7-7-.688-.688zm0 3l-4 4 .688.688 4-4-.688-.688z\"/></svg>',\n\t\t'mark': '<i class=\"fa-solid fa-highlighter\"></i>',\n\t\t'horizontalrule': '<i class=\"fa-solid fa-grip-lines\"></i>',\n\t\t'image': '<i class=\"fa-solid fa-image\"></i>',\n\t\t'italic': '<i class=\"fa-solid fa-italic\"></i>',\n\t\t'justify': '<i class=\"fa-solid fa-align-justify\"></i>',\n\t\t'left': '<i class=\"fa-solid fa-align-left\"></i>',\n\t\t'link': '<i class=\"fa-solid fa-link\"></i>',\n\t\t'maximize': '<i class=\"fa-solid fa-maximize\"></i>',\n\t\t'media': '<i class=\"fa-solid fa-photo-film\"></i>',\n\t\t'note': '<i class=\"fa-solid fa-note-sticky\"></i>',\n\t\t'orderedlist': '<i class=\"fa-solid fa-list-ol\"></i>',\n\t\t'paste': '<i class=\"fa-solid fa-paste\"></i>',\n\t\t'pastetext': '<i class=\"fa-solid fa-paste\"></i>',\n\t\t'quote': '<i class=\"fa-solid fa-quote-left\"></i>',\n\t\t'redo': '<i class=\"fa-solid fa-redo\"></i>',\n\t\t'removeformat': '<i class=\"fa-solid fa-remove-format\"></i>',\n\t\t'reply': '<i class=\"fa-solid fa-reply\"></i>',\n\t\t'right': '<i class=\"fa-solid fa-align-right\"></i>',\n\t\t'size':\n\t\t\t'<span class=\"fa-stack me-2 pe-2\"><i class=\"fas fa-font fa-stack-1x\"></i><i class=\"fa fa-xs fa-up-down fa-sceditor-badge\"></i></span>',\n\t\t'source': '<i class=\"fa-solid fa-file-code\"></i>',\n\t\t'strike': '<i class=\"fa-solid fa-strikethrough\"></i>',\n\t\t'table': '<i class=\"fa-solid fa-table\"></i>',\n\t\t'underline': '<i class=\"fa-solid fa-underline\"></i>',\n\t\t'undo': '<i class=\"fa-solid fa-undo\"></i>',\n\t\t'unlink': '<i class=\"fa-solid fa-link-slash\"></i>',\n\t\t'vimeo': '<i class=\"fa-brands fa-vimeo\"></i>',\n\t\t'instagram': '<i class=\"fa-brands fa-instagram\"></i>',\n\t\t'facebook': '<i class=\"fa-brands fa-facebook\"></i>',\n\t\t'youtube': '<i class=\"fa-brands fa-youtube\"></i>'\n\t};\n\n\tsceditor.icons.fontawesome = function () {\n\t\tvar nodes = {};\n\t\tvar colorPath;\n\n\t\treturn {\n\t\t\tcreate: function (command) {\n\t\t\t\tif (command in icons) {\n\t\t\t\t\tnodes[command] = sceditor.dom.parseHTML(\n\t\t\t\t\t\ticons[command]\n\t\t\t\t\t).firstChild;\n\n\t\t\t\t\tif (command === 'color') {\n\t\t\t\t\t\tcolorPath = nodes[command].querySelector('.sce-color');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn nodes[command];\n\t\t\t},\n\t\t\tupdate: function (isSourceMode, currentNode) {\n\t\t\t\tif (colorPath) {\n\t\t\t\t\tlet color = 'inherit';\n\n\t\t\t\t\tif (!isSourceMode && currentNode) {\n\t\t\t\t\t\tcolor = currentNode.ownerDocument\n\t\t\t\t\t\t\t.queryCommandValue('forecolor');\n\t\t\t\t\t}\n\n\t\t\t\t\tdom.css(colorPath, 'color', color);\n\t\t\t\t}\n\t\t\t},\n\t\t\trtl: function (isRtl) {\n\t\t\t\tconst gripNode = nodes.grip;\n\n\t\t\t\tif (gripNode) {\n\t\t\t\t\tconst transform = isRtl ? 'scaleX(-1)' : '';\n\n\t\t\t\t\tdom.css(gripNode, 'transform', transform);\n\t\t\t\t\tdom.css(gripNode, 'msTransform', transform);\n\t\t\t\t\tdom.css(gripNode, 'webkitTransform', transform);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n\n\tsceditor.icons.fontawesome.icons = icons;\n})(document, sceditor);\n","/**\n * SCEditor Drag and Drop Plugin\n * http://www.sceditor.com/\n *\n * Copyright (C) 2011-2026, Sam Clarke (samclarke.com)\n *\n * SCEditor is licensed under the MIT license:\n *\thttp://www.opensource.org/licenses/mit-license.php\n *\n * @author Sam Clarke\n */\n(function (sceditor) {\n\t'use strict';\n\n\t/**\n\t * Place holder GIF shown while image is loading.\n\t * @type {string}\n\t * @private\n\t */\n\tvar loadingGif = 'data:image/gif;base64,R0lGODlhlgBkAPABAH19ffb29iH5BAAK' +\n\t\t'AAAAIf4aQ3JlYXRlZCB3aXRoIGFqYXhsb2FkLmluZm8AIf8LTkVUU0NBUEUyLjADAQA' +\n\t\t'AACwAAAAAlgBkAAAC1YyPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3n+s' +\n\t\t'73/g8MCofEovGITCqXzKbzCY1Kp9Sq9YrNarfcrvcLDovH5LL5jE6r1+y2+w2Py+f0u' +\n\t\t'v2OvwD2fP6iD/gH6Pc2GIhg2JeQSNjGuLf4GMlYKIloefAIUEl52ZmJyaY5mUhqyFnq' +\n\t\t'mQr6KRoaMKp66hbLumpQ69oK+5qrOyg4a6qYV2x8jJysvMzc7PwMHS09TV1tfY2drb3' +\n\t\t'N3e39DR4uPk5ebn6Onq6+zt7u/g4fL99UAAAh+QQACgAAACwAAAAAlgBkAIEAAAB9fX' +\n\t\t'329vYAAAAC3JSPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3n+s73/g8MC' +\n\t\t'ofEovGITCqXzKbzCY1Kp9Sq9YrNarfcrvcLDovH5LL5jE6r1+y2+w2Py+f0uv2OvwD2' +\n\t\t'fP4iABgY+CcoCNeHuJdQyLjIaOiWiOj4CEhZ+SbZd/nI2RipqYhQOThKGpAZCuBZyAr' +\n\t\t'ZprpqSupaCqtaazmLCRqai7rb2av5W5wqSShcm8fc7PwMHS09TV1tfY2drb3N3e39DR' +\n\t\t'4uPk5ebn6Onq6+zt7u/g4fLz9PX29/j5/vVAAAIfkEAAoAAAAsAAAAAJYAZACBAAAAf' +\n\t\t'X199vb2AAAAAuCUj6nL7Q+jnLTai7PevPsPhuJIluaJpurKtu4Lx/JM1/aN5/rO9/4P' +\n\t\t'DAqHxKLxiEwql8ym8wmNSqfUqvWKzWq33K73Cw6Lx+Sy+YxOq9fstvsNj8vn9Lr9jr8' +\n\t\t'E9nz+AgAYGLjQVwhXiJgguAiYgGjo9tinyCjoKLn3hpmJUGmJsBmguUnpCXCJOZraaX' +\n\t\t'oKShoJe9DqehCqKlnqiZobuzrbyvuIO8xqKpxIPKlwrPCbBx0tPU1dbX2Nna29zd3t/' +\n\t\t'Q0eLj5OXm5+jp6uvs7e7v4OHy8/T19vf4+fr7/P379UAAAh+QQACgAAACwAAAAAlgBk' +\n\t\t'AIEAAAB9fX329vYAAAAC4JSPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3' +\n\t\t'n+s73/g8MCofEovGITCqXzKbzCY1Kp9Sq9YrNarfcrvcLDovH5LL5jE6r1+y2+w2Py+' +\n\t\t'f0uv2OvwT2fP6iD7gAMEhICAeImIAYiFDoOPi22KcouZfw6BhZGUBZeYlp6LbJiTD6C' +\n\t\t'Qqg6Vm6eQqqKtkZ24iaKtrKunpQa9tmmju7Wwu7KFtMi3oYDMzompkHHS09TV1tfY2d' +\n\t\t'rb3N3e39DR4uPk5ebn6Onq6+zt7u/g4fLz9PX29/j5+vv8/f31QAADs=';\n\n\t/**\n\t * Basic check for browser support\n\t * @type {boolean}\n\t * @private\n\t */\n\tvar isSupported = typeof window.FileReader !== 'undefined';\n\n\tsceditor.plugins.dragdrop = function () {\n\t\tif (!isSupported) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst base = this;\n\t\tvar opts;\n\t\tvar editor;\n\t\tvar handleFile;\n\t\tvar container;\n\t\tvar cover;\n\t\tvar placeholderId = 0;\n\n\n\t\tfunction hideCover() {\n\t\t\tcover.style.display = 'none';\n\t\t\tcontainer.className = container.className.replace(/(^| )dnd( |$)/g, '');\n\t\t}\n\n\t\tfunction showCover() {\n\t\t\tif (cover.style.display === 'none') {\n\t\t\t\tcover.style.display = 'block';\n\t\t\t\tcontainer.className += ' dnd';\n\t\t\t}\n\t\t}\n\n\t\tfunction isAllowed() {\n\t\t\t// FF sets type to application/x-moz-file until it has been dropped\n\t\t\t/*if (file.type !== 'application/x-moz-file' && opts.allowedTypes &&\n\t\t\t\topts.allowedTypes.indexOf(file.type) < 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn opts.isAllowed ? opts.isAllowed(file) : true;*/\n\n\t\t\treturn true;\n\t\t};\n\n\t\tfunction createHolder(toReplace) {\n\t\t\tvar placeholder = document.createElement('img');\n\t\t\tplaceholder.src = loadingGif;\n\t\t\tplaceholder.className = 'sceditor-ignore';\n\t\t\tplaceholder.id = `sce-dragdrop-${placeholderId++}`;\n\n\t\t\tfunction replace(html) {\n\t\t\t\tconst node = editor\n\t\t\t\t\t.getBody()\n\t\t\t\t\t.ownerDocument\n\t\t\t\t\t.getElementById(placeholder.id);\n\n\t\t\t\tif (node) {\n\t\t\t\t\tif (typeof html === 'string') {\n\t\t\t\t\t\tnode.insertAdjacentHTML('afterend', html);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn function () {\n\t\t\t\tif (toReplace) {\n\t\t\t\t\ttoReplace.parentNode.replaceChild(placeholder, toReplace);\n\t\t\t\t} else {\n\t\t\t\t\teditor.wysiwygEditorInsertHtml(placeholder.outerHTML);\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tinsert: function (html) {\n\t\t\t\t\t\treplace(html);\n\t\t\t\t\t},\n\t\t\t\t\tcancel: replace\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\n\t\tfunction handleDragOver(e) {\n\t\t\tconst dt = e.dataTransfer;\n\t\t\tconst files = dt.files.length || !dt.items ? dt.files : dt.items;\n\n\t\t\tfor (let i = 0; i < files.length; i++) {\n\t\t\t\t// Dragging a string should be left to default\n\t\t\t\tif (files[i].kind === 'string') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tshowCover();\n\t\t\te.preventDefault();\n\t\t}\n\n\t\tfunction handleDrop(e) {\n\t\t\tconst dt = e.dataTransfer;\n\t\t\tconst files = dt.files.length || !dt.items ? dt.files : dt.items;\n\n\t\t\thideCover();\n\n\t\t\tfor (let i = 0; i < files.length; i++) {\n\t\t\t\t// Dragging a string should be left to default\n\t\t\t\tif (files[i].kind === 'string') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (isAllowed(files[i])) {\n\t\t\t\t\thandleFile(files[i], createHolder());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\te.preventDefault();\n\t\t}\n\n\t\tbase.signalReady = function () {\n\t\t\teditor = this;\n\t\t\topts = editor.opts.dragdrop || {};\n\t\t\thandleFile = opts.handleFile;\n\t\t\t\n\t\t\tif (!handleFile)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcontainer = editor.getContentAreaContainer().parentNode;\n\n\t\t\tcover = container.appendChild(sceditor.dom.parseHTML(\n\t\t\t\t`<div class=\"sceditor-dnd-cover\" style=\"display: none\"></div>`\n\t\t\t).firstChild);\n\n\t\t\tcontainer.addEventListener('dragover', handleDragOver);\n\t\t\tcontainer.addEventListener('dragleave', hideCover);\n\t\t\tcontainer.addEventListener('dragend', hideCover);\n\t\t\tcontainer.addEventListener('drop', handleDrop);\n\n\t\t\teditor.getBody().addEventListener('dragover', handleDragOver);\n\t\t\teditor.getBody().addEventListener('drop', hideCover);\n\t\t};\n\n\t\tbase.signalPasteHtml = function (file) {\n\n\t\t\tif (!file)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif (!opts.handleFile)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file.val) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\thideCover();\n\t\t\t\n\t\t\tif (!('handlePaste' in opts) || opts.handlePaste) {\n\t\t\t\tif (isAllowed(file)) {\n\t\t\t\t\thandleFile(file, createHolder());\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n})(sceditor);\n","(function (sceditor) {\n\t'use strict';\n\n\tsceditor.plugins.undo = function () {\n\t\tvar base = this;\n\t\tvar sourceEditor;\n\t\tvar editor;\n\t\tvar body;\n\t\tvar lastInputType = '';\n\t\tvar charChangedCount = 0;\n\t\tvar isInPatchedFn = false;\n\t\t/**\n\t\t * If currently restoring a state\n\t\t * Should ignore events while it's happening\n\t\t */\n\t\tvar isApplying = false;\n\t\t/**\n\t\t * If current selection change event has already been stored\n\t\t */\n\t\tvar isSelectionChangeHandled = false;\n\n\t\tvar undoLimit  = 50;\n\t\tvar undoStates = [];\n\t\tvar redoPosition = 0;\n\t\tvar lastState;\n\n\t\t/**\n\t\t * Sets the editor to the specified state.\n\t\t * @param  {Object} state\n\t\t * @private\n\t\t */\n\t\tfunction applyState(state) {\n\t\t\tisApplying = true;\n\t\t\teditor.sourceMode(state.sourceMode);\n\n\t\t\tif (state.sourceMode) {\n\t\t\t\teditor.val(state.value, false);\n\t\t\t\teditor.sourceEditorCaret(state.caret);\n\t\t\t} else {\n\t\t\t\teditor.getBody().innerHTML = state.value;\n\n\t\t\t\t// Caret may not exist for the first state in Firefox\n\t\t\t\tif (state.caret) {\n\t\t\t\t\tconst range = editor.getRangeHelper().selectedRange();\n\t\t\t\t\tsetRangePositions(range, state.caret);\n\t\t\t\t\teditor.getRangeHelper().selectRange(range);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\teditor.focus();\n\t\t\tisApplying = false;\n\t\t};\n\n\t\t/**\n\t\t * Patches a function on the object to call store() after invocation\n\t\t * @param {Object} obj\n\t\t * @param {string} fn\n\t\t */\n\t\tfunction patch(obj, fn) {\n\t\t\tvar origFn = obj[fn];\n\t\t\tobj[fn] = function () {\n\t\t\t\t// sourceMode calls other patched methods so need to ignore them\n\t\t\t\tconst ignore = isInPatchedFn;\n\n\t\t\t\t// Store caret position before any change is made\n\t\t\t\tif (!ignore && !isApplying && lastState &&\n\t\t\t\t\t\teditor.getRangeHelper().hasSelection()) {\n\t\t\t\t\tupdateLastState();\n\t\t\t\t}\n\n\t\t\t\tisInPatchedFn = true;\n\t\t\t\torigFn.apply(this, arguments);\n\n\t\t\t\tif (!ignore) {\n\t\t\t\t\tisInPatchedFn = false;\n\n\t\t\t\t\tif (!isApplying) {\n\t\t\t\t\t\tstoreState();\n\t\t\t\t\t\tlastInputType = '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Stores the editors current state\n\t\t */\n\t\tfunction storeState() {\n\t\t\tif (redoPosition) {\n\t\t\t\tundoStates.length -= redoPosition;\n\t\t\t\tredoPosition = 0;\n\t\t\t}\n\n\t\t\tif (undoLimit > 0 && undoStates.length > undoLimit) {\n\t\t\t\tundoStates.shift();\n\t\t\t}\n\n\t\t\tlastState = {};\n\t\t\tupdateLastState();\n\t\t\tundoStates.push(lastState);\n\t\t}\n\n\t\t/**\n\t\t * Updates the last saved state with the editors current state\n\t\t */\n\t\tfunction updateLastState() {\n\t\t\tconst sourceMode = editor.sourceMode();\n\t\t\tlastState.caret = sourceMode ? editor.sourceEditorCaret() :\n\t\t\t\tgetRangePositions(editor.getRangeHelper().selectedRange());\n\t\t\tlastState.sourceMode = sourceMode;\n\n\t\t\tconst value = sourceMode ?\n\t\t\t\teditor.getSourceEditorValue(false) :\n\t\t\t\teditor.getBody().innerHTML;\n\n\t\t\tconst countField = document.getElementById('editor-Counter'),\n\t\t\t\tmaxLimit = editor.opts.maxLength;\n\n\t\t\t// Update counter\n\t\t\tif (editor.val().length > maxLimit) {\n\t\t\t\tbase.undo();\n\t\t\t} else {\n\t\t\t\tcountField.textContent = maxLimit - editor.val().length;\n\t\t\t}\n\n\t\t\tlastState.value = value;\n\t\t}\n\n\t\tbase.init = function () {\n\t\t\t// this variable will be set to the instance of the editor\n\t\t\t// calling it, hence why the plugins \"this\" is saved to the base\n\t\t\t// variable.\n\t\t\teditor = this;\n\n\t\t\tundoLimit = editor.undoLimit || undoLimit;\n\n\t\t\teditor.addShortcut('ctrl+z', base.undo);\n\t\t\teditor.addShortcut('ctrl+shift+z', base.redo);\n\t\t\teditor.addShortcut('ctrl+y', base.redo);\n\t\t};\n\n\t\tfunction documentSelectionChangeHandler() {\n\t\t\tif (sourceEditor === document.activeElement) {\n\t\t\t\tbase.signalSelectionchangedEvent();\n\t\t\t}\n\t\t}\n\n\t\tbase.signalReady = function () {\n\t\t\tsourceEditor = editor.getContentAreaContainer().nextSibling;\n\t\t\tbody = editor.getBody();\n\n\t\t\t// Store initial state\n\t\t\tstoreState();\n\n\t\t\t// Patch methods that allow inserting content into the editor\n\t\t\t// programmatically\n\t\t\t// TODO: remove this when there is a built in event to handle it\n\t\t\tpatch(editor, 'setWysiwygEditorValue');\n\t\t\tpatch(editor, 'setSourceEditorValue');\n\t\t\tpatch(editor, 'sourceEditorInsertText');\n\t\t\tpatch(editor.getRangeHelper(), 'insertNode');\n\t\t\tpatch(editor, 'toggleSourceMode');\n\n\t\t\t/**\n\t\t\t * Handles the before input event so can override built in\n\t\t\t * undo / redo\n\t\t\t * @param {InputEvent} e\n\t\t\t */\n\t\t\tfunction beforeInputHandler(e) {\n\t\t\t\tif (e.inputType === 'historyUndo') {\n\t\t\t\t\tbase.undo();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} else if (e.inputType === 'historyRedo') {\n\t\t\t\t\tbase.redo();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbody.addEventListener('beforeinput', beforeInputHandler);\n\t\t\tsourceEditor.addEventListener('beforeinput', beforeInputHandler);\n\n\t\t\t/**\n\t\t\t * Should always store state at the end of composing\n\t\t\t */\n\t\t\tfunction compositionHandler() {\n\t\t\t\tlastInputType = '';\n\t\t\t\tstoreState();\n\t\t\t}\n\t\t\tbody.addEventListener('compositionend', compositionHandler);\n\t\t\tsourceEditor.addEventListener('compositionend', compositionHandler);\n\n\t\t\t// Chrome doesn't trigger selectionchange on textarea so need to\n\t\t\t// listen to global event\n\t\t\tdocument.addEventListener('selectionchange',\n\t\t\t\tdocumentSelectionChangeHandler);\n\t\t};\n\n\t\tbase.destroy = function () {\n\t\t\tdocument.removeEventListener('selectionchange',\n\t\t\t\tdocumentSelectionChangeHandler);\n\t\t};\n\n\t\tbase.undo = function () {\n\t\t\tlastState = null;\n\n\t\t\tif (redoPosition < undoStates.length - 1) {\n\t\t\t\tredoPosition++;\n\t\t\t\tapplyState(undoStates[undoStates.length - 1 - redoPosition]);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\tbase.redo = function () {\n\t\t\tif (redoPosition > 0) {\n\t\t\t\tredoPosition--;\n\t\t\t\tapplyState(undoStates[undoStates.length - 1 - redoPosition]);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Handle the selectionchanged event so can store the last caret\n\t\t * position before the input so undoing places it in the right place\n\t\t */\n\t\tbase.signalSelectionchangedEvent = function () {\n\t\t\tif (isApplying || isSelectionChangeHandled) {\n\t\t\t\tisSelectionChangeHandled = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (lastState) {\n\t\t\t\tupdateLastState();\n\t\t\t}\n\t\t\tlastInputType = '';\n\t\t};\n\n\t\t/**\n\t\t * Handles the input event\n\t\t * @param {InputEvent} e\n\t\t */\n\t\tbase.signalInputEvent = function (e) {\n\t\t\t// InputType is one of\n\t\t\t// https://rawgit.com/w3c/input-events/v1/index.html#interface-InputEvent-Attributes\n\t\t\t// Most should cause a full undo item to be added so only need to\n\t\t\t// handle a few of them\n\t\t\tconst inputType = e.inputType;\n\n\t\t\t// Should ignore selection changes that occur because of input\n\t\t\t// events as already handling them\n\t\t\tisSelectionChangeHandled = true;\n\n\t\t\t// inputType should be supported by all supported browsers\n\t\t\t// except IE 11 in runWithoutWysiwygSupport. Shouldn't be an issue\n\t\t\t// as native handling will mostly work there.\n\t\t\t// Ignore if composing as will handle composition end instead\n\t\t\tif (!inputType || e.isComposing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (e.inputType) {\n\t\t\t\tcase 'deleteContentBackward':\n\t\t\t\t\tif (lastState && lastInputType === inputType &&\n\t\t\t\t\t\tcharChangedCount < 20) {\n\t\t\t\t\t\tupdateLastState();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstoreState();\n\t\t\t\t\t\tcharChangedCount = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tlastInputType = inputType;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'insertText':\n\t\t\t\t\tcharChangedCount += e.data ? e.data.length : 1;\n\n\t\t\t\t\tif (lastState && lastInputType === inputType &&\n\t\t\t\t\t\t\tcharChangedCount < 20 && !/\\s$/.test(e.data)) {\n\t\t\t\t\t\tupdateLastState();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstoreState();\n\t\t\t\t\t\tcharChangedCount = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tlastInputType = inputType;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tlastInputType = 'sce-misc';\n\t\t\t\t\tcharChangedCount = 0;\n\t\t\t\t\tstoreState();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Creates a positions object form passed range\n\t\t * @param {Range} range\n\t\t * @return {Object<string, Array<number>}\n\t\t */\n\t\tfunction getRangePositions(range) {\n\t\t\t// In Firefox, range may not exist when the editor is first created\n\t\t\t// due to Firefox returning null from getSelection() when the\n\t\t\t// editors iframe is first created. See issue #910\n\t\t\tif (!range) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Merge any adjacent text nodes as it will be done by innerHTML\n\t\t\t// which would cause positions to be off if not done\n\t\t\tbody.normalize();\n\n\t\t\treturn {\n\t\t\t\tstartPositions:\n\t\t\t\t\tnodeToPositions(range.startContainer, range.startOffset),\n\t\t\t\tendPositions:\n\t\t\t\t\tnodeToPositions(range.endContainer, range.endOffset)\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Sets the range start/end based on the positions object\n\t\t * @param {Range} range\n\t\t * @param {Object<string, Array<number>>} positions\n\t\t */\n\t\tfunction setRangePositions(range, positions) {\n\t\t\ttry {\n\t\t\t\tconst startPositions = positions.startPositions;\n\t\t\t\tconst endPositions = positions.endPositions;\n\n\t\t\t\trange.setStart(positionsToNode(body, startPositions),\n\t\t\t\t\tstartPositions[0]);\n\t\t\t\trange.setEnd(positionsToNode(body, endPositions),\n\t\t\t\t\tendPositions[0]);\n\t\t\t} catch (e) {\n\t\t\t\tif (console && console.warn) {\n\t\t\t\t\tconsole.warn('[SCEditor] Undo plugin lost caret', e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Converts the passed container and offset into positions array\n\t\t * @param {Node} container\n\t\t * @param {number} offset\n\t\t * @returns {Array<number>}\n\t\t */\n\t\tfunction nodeToPositions(container, offset) {\n\t\t\tconst positions = [offset];\n\t\t\tvar node = container;\n\n\t\t\twhile (node && node.tagName !== 'BODY') {\n\t\t\t\tpositions.push(nodeIndex(node));\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn positions;\n\t\t}\n\n\t\t/**\n\t\t * Returns index of passed node\n\t\t * @param {Node} node\n\t\t * @returns {number}\n\t\t */\n\t\tfunction nodeIndex(node) {\n\t\t\tvar i = 0;\n\t\t\twhile ((node = node.previousSibling)) {\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn i;\n\t\t}\n\n\t\t/**\n\t\t * Gets the container node from the positions array\n\t\t * @param {Node} node\n\t\t * @param {Array<number>} positions\n\t\t * @returns {Node}\n\t\t */\n\t\tfunction positionsToNode(node, positions) {\n\t\t\tfor (let i = positions.length - 1; node && i > 0; i--) {\n\t\t\t\tnode = node.childNodes[positions[i]];\n\t\t\t}\n\t\t\treturn node;\n\t\t}\n\t};\n}(sceditor));\n","/**\n * SCEditor Plain Text Plugin\n * http://www.sceditor.com/\n *\n * Copyright (C) 2011-2026, Sam Clarke (samclarke.com)\n *\n * SCEditor is licensed under the MIT license:\n *\thttp://www.opensource.org/licenses/mit-license.php\n *\n * @author Sam Clarke\n */\n(function (sceditor) {\n\t'use strict';\n\n\tvar utils = sceditor.utils;\n\tvar dom = sceditor.dom;\n\n\t/**\n\t * Options:\n\t *\n\t * pastetext.addButton - If to replace the plaintext button with a toggle\n\t *                       button that enables and disables plain text mode.\n\t *\n\t * pastetext.enabled - If the plain text button should be enabled at start\n\t *                     up. Only applies if addButton is enabled.\n\t */\n\tsceditor.plugins.plaintext = function () {\n\t\tvar plainTextEnabled = true;\n\n\t\tthis.init = function () {\n\t\t\tconst commands = this.commands;\n\t\t\tconst opts = this.opts;\n\n\t\t\tif (opts && opts.plaintext && opts.plaintext.addButton) {\n\t\t\t\tplainTextEnabled = opts.plaintext.enabled;\n\n\t\t\t\tcommands.pastetext = utils.extend(commands.pastetext || {}, {\n\t\t\t\t\tstate: function () {\n\t\t\t\t\t\treturn plainTextEnabled ? 1 : 0;\n\t\t\t\t\t},\n\t\t\t\t\texec: function () {\n\t\t\t\t\t\tplainTextEnabled = !plainTextEnabled;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tthis.signalPasteRaw = function (data) {\n\t\t\tif (plainTextEnabled) {\n\t\t\t\tif (data.html && !data.text) {\n\t\t\t\t\tconst div = document.createElement('div');\n\t\t\t\t\tdiv.innerHTML = data.html;\n\n\t\t\t\t\t// TODO: Refactor into private shared module with editor\n\t\t\t\t\t// innerText adds two newlines after <p> tags so convert\n\t\t\t\t\t// them to <div> tags\n\t\t\t\t\tutils.each(div.querySelectorAll('p'), function (_, elm) {\n\t\t\t\t\t\tdom.convertElement(elm, 'div');\n\t\t\t\t\t});\n\t\t\t\t\t// Remove collapsed <br> tags as innerText converts them to\n\t\t\t\t\t// newlines\n\t\t\t\t\tutils.each(div.querySelectorAll('br'), function (_, elm) {\n\t\t\t\t\t\tif (!elm.nextSibling ||\n\t\t\t\t\t\t!dom.isInline(elm.nextSibling, true)) {\n\t\t\t\t\t\t\telm.parentNode.removeChild(elm);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tdocument.body.appendChild(div);\n\t\t\t\t\tdata.text = div.innerText;\n\t\t\t\t\tdocument.body.removeChild(div);\n\t\t\t\t}\n\n\t\t\t\tdata.html = null;\n\t\t\t}\n\t\t};\n\t};\n}(sceditor));\n","/**\n * SCEditor Mentions Plugin\n * http://www.sceditor.com/\n *\n * Copyright (C) 2011-2026, Sam Clarke (samclarke.com)\n *\n * SCEditor is licensed under the MIT license:\n *\thttp://www.opensource.org/licenses/mit-license.php\n *\n * @author Sam Clarke\n */\n(function (sceditor) {\n\t'use strict';\n\n\tsceditor.plugins.mentions = function () {\n\t\tvar editor;\n\n\t\tthis.init = function () {\n\t\t\teditor = this;\n\t\t\teditor.opts.onToggleMode = initMentions;\n\t\t};\n\n\t\tthis.signalReady = function () {\n\t\t\tinitMentions();\n\t\t};\n\n\t\tfunction initMentions() {\n\t\t\tmentions({\n\t\t\t\telement: editor,\n\t\t\t\tlookup: 'user',\n\t\t\t\turl: editor.opts.mentionsUrl,\n\t\t\t\tonclick: function (data) { editor.insert(`[userlink]${data.name}[/userlink]`); }\n\t\t\t});\n\t\t}\n\n\t\tfunction mentions(opts = {}) {\n\t\t\topts = Object.assign({},\n\t\t\t\t{\n\t\t\t\t\tlookup: 'lookup',\n\t\t\t\t\tid: '',\n\t\t\t\t\tselector: '',\n\t\t\t\t\telement: null,\n\t\t\t\t\tsymbol: '@',\n\t\t\t\t\titems: [],\n\t\t\t\t\titem_template:\n\t\t\t\t\t\t'<a class=\"dropdown-item\" href=\"#\" style=\"font-family: var(--bs-body-font-family);\"><img src=\"${item.avatar}\" alt=\"avatar\" class=\"me-2 img-thumbnail\" style=\"max-width:20px;max-height:20px\" /> ${item.name}</a>',\n\t\t\t\t\tonclick: undefined,\n\t\t\t\t\turl: ''\n\t\t\t\t},\n\t\t\t\topts);\n\n\t\t\tconst $e = opts.element.inSourceMode()\n\t\t\t\t? opts.element.getSourceEditor()\n\t\t\t\t: opts.element.getContentAreaContainer().contentWindow.document.body;\n\n\t\t\tif (!$e)\n\t\t\t\treturn console.error('Invalid element selector', opts);\n\n\t\t\tvar $lookup = document.createElement('div');\n\t\t\t$lookup.classList = `fixed-top autohide ${opts.lookup}`;\n\t\t\t$e.parentNode.insertBefore($lookup, $e.nextSibling);\n\n\t\t\t$e.addEventListener('keydown', processKey);\n\t\t\t$e.addEventListener('keyup', showLookup);\n\t\t\t$e.addEventListener('click', hideLookup);\n\n\t\t\tvar start, end, prevWord;\n\n\t\t\tvar isFixed = false;\n\t\t\tvar $el = $lookup.parentNode;\n\t\t\twhile ($el && $el.nodeName.toLowerCase() !== 'body' && !isFixed) {\n\t\t\t\tisFixed = window.getComputedStyle($el).getPropertyValue('position').toLowerCase() === 'fixed';\n\t\t\t\t$el = $el.parentElement;\n\t\t\t}\n\n\t\t\tfunction showLookup(event) {\n\t\t\t\tif (event.code === 'Escape') {\n\t\t\t\t\treturn hideLookup();\n\t\t\t\t}\n\n\t\t\t\tvar sel, text, curr;\n\n\t\t\t\tif (opts.element.inSourceMode()) {\n\t\t\t\t\tsel = document.getSelection();\n\t\t\t\t\tvar $parent = opts.element.getSourceEditor();\n\t\t\t\t\ttext = $parent.value || \"\";\n\t\t\t\t\tcurr = sel.baseOffset;\n\n\t\t\t\t} else {\n\t\t\t\t\tsel = opts.element.getContentAreaContainer().contentWindow.document.getSelection();\n\n\t\t\t\t\ttext = opts.element.val() || \"\";\n\t\t\t\t\tcurr = sel.baseOffset;\n\t\t\t\t}\n\n\t\t\t\tvar getLength = arr => arr instanceof Array && arr.length > 0 ? arr[0].length : 0;\n\n\t\t\t\tstart = curr - getLength(text.slice(0, curr).match(/[\\S]+$/g));\n\t\t\t\tend = curr + getLength(text.slice(curr).match(/^[\\S]+/g));\n\n\t\t\t\tvar word = text.substring(start, end);\n\n\t\t\t\tif (!word || word[0] !== opts.symbol) {\n\t\t\t\t\tprevWord = '';\n\t\t\t\t\treturn hideLookup();\n\t\t\t\t}\n\n\t\t\t\tif (word === prevWord)\n\t\t\t\t\treturn;\n\n\t\t\t\tprevWord = word;\n\n\t\t\t\tvar pos = { x: 0, y: 0 };\n\n\t\t\t\tvar parentRect = opts.element.inSourceMode()\n\t\t\t\t\t? opts.element.getSourceEditor().getBoundingClientRect()\n\t\t\t\t\t: opts.element.getContentAreaContainer().contentWindow.document.body.getBoundingClientRect();\n\n\t\t\t\tpos.y = parentRect.top + 30;\n\t\t\t\tpos.x = parentRect.left + 20;\n\n\t\t\t\t$lookup.style.left = pos.x + 'px';\n\t\t\t\t$lookup.style.top = pos.y + 'px';\n\n\t\t\t\t// query\n\t\t\t\tvar query = word.slice(1);\n\n\t\t\t\tvar token = '';\n\t\t\t\tvar tokenInput = document.querySelector('input[name=\"__RequestVerificationToken\"]');\n\n\t\t\t\tif (tokenInput != null) {\n\t\t\t\t\ttoken = tokenInput.value;\n\t\t\t\t}\n\n\t\t\t\tif (query.length >= 3) {\n\t\t\t\t\tfetch(opts.url.replace('{q}', query),\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\t\"Accept\": 'application/json',\n\t\t\t\t\t\t\t\t\t\"Content-Type\": 'application/json;charset=utf-8',\n\t\t\t\t\t\t\t\t\t\"RequestVerificationToken\": token\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(response => response.json())\n\t\t\t\t\t\t.then(data => opts.items = data);\n\t\t\t\t}\n\n\t\t\t\tvar items = opts.items\n\t\t\t\t\t.filter(e => e.name.toLowerCase().includes(word.slice(1).toLowerCase()))\n\t\t\t\t\t.map(item => eval(\n\t\t\t\t\t\t'`<li class=\"mention-li-nt ${opts.lookup}\" data-name = \"${item.name}\" data-id = \"${item.id}\">' +\n\t\t\t\t\t\topts.item_template +\n\t\t\t\t\t\t'</li>`'));\n\n\t\t\t\tif (!items.length)\n\t\t\t\t\treturn hideLookup();\n\n\t\t\t\t$lookup.innerHTML = `<ul class=\"dropdown-menu dropdown-mentions show\">${items.join('')}</ul>`;\n\t\t\t\t[...$lookup.firstElementChild.children]\n\t\t\t\t\t.forEach($el => $el.addEventListener('click', onClick) ||\n\t\t\t\t\t\t$el.addEventListener('mouseenter', onHover));\n\t\t\t\t$lookup.firstElementChild.children[0].classList.add('active');\n\n\n\t\t\t\tif ($lookup.hasAttribute('hidden'))\n\t\t\t\t\t$lookup.removeAttribute('hidden');\n\n\t\t\t\tvar bounding = $lookup.getBoundingClientRect();\n\t\t\t\tif (!(bounding.top >= 0 &&\n\t\t\t\t\tbounding.left >= 0 &&\n\t\t\t\t\tbounding.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n\t\t\t\t\tbounding.right <= (window.innerWidth || document.documentElement.clientWidth)))\n\t\t\t\t\t$lookup.style.top = parseInt($lookup.style.top) - 10 - $lookup.clientHeight + 'px';\n\t\t\t}\n\n\t\t\tfunction hideLookup() {\n\t\t\t\tif (!$lookup.hasAttribute('hidden'))\n\t\t\t\t\t$lookup.setAttribute('hidden', true);\n\t\t\t}\n\n\t\t\tfunction onClick(event) {\n\t\t\t\tconst deleteItem = event.target.classList.contains('mention-li-nt')\n\t\t\t\t\t? event.target\n\t\t\t\t\t: event.target.parentElement;\n\n\t\t\t\topts.onclick(deleteItem.dataset);\n\n\t\t\t\tconst value = opts.element.val();\n\n\t\t\t\topts.element.val(value.replace(value.substring(start + 1, end), ''));\n\n\t\t\t\thideLookup();\n\t\t\t}\n\n\t\t\tfunction onHover(event) {\n\t\t\t\tconst $el = event.target.closest('.mention-li-nt');\n\t\t\t\tif ($el.classList.contains('active'))\n\t\t\t\t\treturn;\n\n\t\t\t\t[...$lookup.firstElementChild.children]\n\t\t\t\t\t.filter($el => $el.classList.contains('active'))\n\t\t\t\t\t.forEach($el => $el.classList.remove('active'));\n\t\t\t\t$el.classList.add('active');\n\t\t\t}\n\n\t\t\tfunction processKey(event) {\n\t\t\t\tconst code = event.key;\n\t\t\t\tif (['ArrowUp', 'ArrowDown', 'Enter'].indexOf(code) == -1 || $lookup.hasAttribute('hidden'))\n\t\t\t\t\treturn;\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (code == 'Enter')\n\t\t\t\t\treturn $lookup.querySelector('.active').click();\n\n\t\t\t\tconst $children = [...$lookup.firstElementChild.children];\n\t\t\t\tconst curr = $children.findIndex($el => $el.classList.contains('active'));\n\t\t\t\t$children[curr].classList.remove('active');\n\n\t\t\t\tconst $next = $children[($children.length + curr + (code == 'ArrowUp' ? -1 : 1)) % $children.length];\n\t\t\t\t$next.classList.add('active');\n\t\t\t\t$next.scrollIntoView(false);\n\t\t\t}\n\t\t}\n\t};\n}(sceditor));\n"],"names":["isTypeof","type","arg","isString","bind","isUndefined","isFunction","isNumber","isEmptyObject","obj","Object","keys","length","extend","targetArg","sourceArg","isTargetBoolean","i","target","isDeep","isObject","value","getPrototypeOf","prototype","arguments","key","source","isValueArray","isSameType","targetValue","isValueObject","Array","isArray","arrayRemove","arr","item","indexOf","splice","each","fn","let","forEach","cssPropertyNameCache","ELEMENT_NODE","TEXT_NODE","COMMENT_NODE","toFloat","parseFloat","isFinite","createElement","tag","attributes","context","node","document","style","cssText","setAttribute","parent","selector","parentNode","test","nodeType","is","closest","remove","removeChild","appendChild","child","find","querySelectorAll","on","events","capture","split","event","handler","e","call","addEventListener","off","removeEventListener","attr","getAttribute","removeAttr","removeAttribute","hide","css","show","toggle","isVisible","rule","getComputedStyle","isNumeric","isNaN","data","argsLength","_","name","substr","String","result","matches","msMatchesSelector","webkitMatchesSelector","insertBefore","refNode","classes","className","trim","hasClass","addClass","classList","push","join","removeClass","toggleClass","state","width","padding","border","cs","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth","offsetWidth","height","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth","offsetHeight","trigger","eventName","window","CustomEvent","bubbles","cancelable","detail","ownerDocument","createEvent","initCustomEvent","dispatchEvent","getClientRects","traverse","func","innermostFirst","siblingsOnly","reverse","lastChild","firstChild","next","previousSibling","nextSibling","rTraverse","parseHTML","html","ret","createDocumentFragment","tmp","innerHTML","hasStyling","convertElement","element","toTagName","newElement","attribute","replaceChild","blockLevelList","canHaveChildren","nodeName","toLowerCase","isInline","elm","includeCodeAsBlock","tagName","isEmpty","nodeValue","childNodes","fixNesting","isBlock","lastInlineParent","before","extractContents","middle","clone","cloneNode","prev","previousElementSibling","li","getSibling","previous","removeWhiteSpace","root","nextNode","trimStart","cssWhiteSpace","preserveNewLines","replace","startNode","endNode","range","createRange","setStartBefore","setEndAfter","getOffset","left","top","offsetLeft","offsetTop","offsetParent","getStyle","property","elmStyle","match","char","toUpperCase","styleValue","attributesMatch","nodeA","nodeB","prop","removeKeepChildren","Func","defaultOptions","toolbar","toolbarExclude","maxLength","styles","themeMode","documentElement","fonts","format","icons","codeLanguages","Value","Text","noteTypes","colors","locale","charset","resizeEnabled","resizeMinWidth","resizeMinHeight","resizeMaxHeight","resizeMaxWidth","resizeHeight","resizeWidth","dateFormat","toolbarContainer","enablePasteFiltering","disablePasting","readOnly","rtl","autofocus","autofocusEnd","autoExpand","autoUpdate","spellcheck","runWithoutWysiwygSupport","startInSourceMode","id","plugins","zIndex","bbcodeTrim","disableBlockRemove","allowedIframeUrls","parserOptions","dropDownCss","allowedTags","allowedAttributes","extensionsUrl","attachmentsPreviewUrl","albumsPreviewUrl","mentionsUrl","onToggleMode","undefined","basePath","VALID_URI_REGEX","VALID_DATA_REGEX","WHITESPACE_REGEX","regex","str","entities","noQuotes","replacements","&","<",">","  ","\r\n","\r","\n","entries","setPrototypeOf","isFrozen","getOwnPropertyDescriptor","freeze","seal","create","apply","construct","Reflect","arrayForEach","x","thisArg","_len","args","_key","_len2","_key2","unapply","arrayLastIndexOf","lastIndexOf","arrayPop","pop","arrayPush","arraySplice","stringToLowerCase","stringToString","toString","stringMatch","stringReplace","stringIndexOf","stringTrim","objectHasOwnProperty","hasOwnProperty","regExpTest","RegExp","typeErrorCreate","TypeError","_len4","_key4","lastIndex","_len3","_key3","addToSet","set","array","lcElement","transformCaseFunc","l","object","newObject","index","constructor","lookupGetter","desc","get","html$1","svg$1","svgFilters","svgDisallowed","mathMl$1","mathMlDisallowed","text","svg","mathMl","xml","MUSTACHE_EXPR","ERB_EXPR","TMPLIT_EXPR","DATA_ATTR","ARIA_ATTR","IS_ALLOWED_URI","IS_SCRIPT_OR_DATA","ATTR_WHITESPACE","DOCTYPE_NAME","CUSTOM_ELEMENT","EXPRESSIONS","__proto__","_createHooksMap","afterSanitizeAttributes","afterSanitizeElements","afterSanitizeShadowDOM","beforeSanitizeAttributes","beforeSanitizeElements","beforeSanitizeShadowDOM","uponSanitizeAttribute","uponSanitizeElement","uponSanitizeShadowNode","NODE_TYPE","cdataSection","entityReference","entityNode","progressingInstruction","comment","documentType","documentFragment","notation","purify","createDOMPurify","DOMPurify","version","removed","Element","isSupported","originalDocument","currentScript","DocumentFragment","HTMLTemplateElement","Node","NodeFilter","NamedNodeMap","MozNamedAttrMap","HTMLFormElement","DOMParser","trustedTypes","ElementPrototype","getNextSibling","getChildNodes","getParentNode","template","content","isRegexOrFunction","testValue","Function","_parseConfig","cfg","CONFIG","PARSER_MEDIA_TYPE","SUPPORTED_PARSER_MEDIA_TYPES","ALLOWED_TAGS","DEFAULT_ALLOWED_TAGS","ALLOWED_ATTR","DEFAULT_ALLOWED_ATTR","ALLOWED_NAMESPACES","DEFAULT_ALLOWED_NAMESPACES","URI_SAFE_ATTRIBUTES","DEFAULT_URI_SAFE_ATTRIBUTES","ADD_URI_SAFE_ATTR","DATA_URI_TAGS","DEFAULT_DATA_URI_TAGS","ADD_DATA_URI_TAGS","FORBID_CONTENTS","DEFAULT_FORBID_CONTENTS","FORBID_TAGS","FORBID_ATTR","USE_PROFILES","ALLOW_ARIA_ATTR","ALLOW_DATA_ATTR","ALLOW_UNKNOWN_PROTOCOLS","ALLOW_SELF_CLOSE_IN_ATTR","SAFE_FOR_TEMPLATES","SAFE_FOR_XML","WHOLE_DOCUMENT","RETURN_DOM","RETURN_DOM_FRAGMENT","RETURN_TRUSTED_TYPE","FORCE_BODY","SANITIZE_DOM","SANITIZE_NAMED_PROPS","KEEP_CONTENT","IN_PLACE","IS_ALLOWED_URI$1","ALLOWED_URI_REGEXP","NAMESPACE","HTML_NAMESPACE","MATHML_TEXT_INTEGRATION_POINTS","HTML_INTEGRATION_POINTS","CUSTOM_ELEMENT_HANDLING","tagNameCheck","attributeNameCheck","allowCustomizedBuiltInElements","ADD_TAGS","EXTRA_ELEMENT_HANDLING","tagCheck","ADD_ATTR","attributeCheck","ADD_FORBID_CONTENTS","table","tbody","TRUSTED_TYPES_POLICY","createHTML","createScriptURL","trustedTypesPolicy","emptyHTML","purifyHostElement","createPolicy","suffix","ATTR_NAME","policyName","hasAttribute","scriptUrl","console","warn","_removeAttribute","getAttributeNode","from","_forceRemove","_initDocument","dirty","doc","leadingWhitespace","dirtyPayload","parseFromString","implementation","createDocument","IS_EMPTY_INPUT","body","createTextNode","getElementsByTagName","_createNodeIterator","createNodeIterator","SHOW_ELEMENT","SHOW_COMMENT","SHOW_TEXT","SHOW_PROCESSING_INSTRUCTION","SHOW_CDATA_SECTION","_isClobbered","textContent","namespaceURI","hasChildNodes","_isNode","importNode","hooks","createHTMLDocument","writable","configurable","enumerable","SET_CONFIG","MATHML_NAMESPACE","SVG_NAMESPACE","COMMON_SVG_AND_HTML_ELEMENTS","formElement","ALL_SVG_TAGS","ALL_MATHML_TAGS","_executeHooks","currentNode","hook","_sanitizeElements","firstElementChild","_checkValidNamespace","parentTagName","Boolean","expr","_isBasicCustomElement","childClone","__removalCount","_isValidAttribute","lcTag","lcName","_sanitizeAttributes","hookEvent","attrName","attrValue","keepAttr","forceKeepAttr","initValue","getAttributeType","setAttributeNS","_sanitizeShadowDOM","fragment","shadowNode","shadowIterator","sanitize","returnNode","importedNode","nodeIterator","shadowroot","shadowrootmode","serializedHTML","outerHTML","doctype","setConfig","clearConfig","isValidAttribute","addHook","entryPoint","hookFunction","removeHook","removeHooks","removeAllHooks","_templates","toolbarButton","codeOpt","noteOpt","extensionOpt","fontOpt","sizeOpt","albums","note","pastetext","image","email","link","mediaMenu","youtubeMenu","instagramMenu","facebookMenu","facebook","instagram","youtube","vimeo","_tmpl","params","createHtml","fixFirefoxListBug","editor","getBody","defaultCmds","exec","caller","this","opts","createDropDown","getAlbumImagesData","tooltip","attachments","modal","bootstrap","Modal","_element","getPaginationData","bold","shortcut","italic","underline","strike","mark","wysiwygEditorInsertHtml","isLtr","align","center","right","justify","font","_dropDown","callback","closeDropDown","preventDefault","fontName","execCommand","size","fontSize","color","cmd","_htmlCache","column","removeformat","cut","errorMessage","copy","paste","val","label","insert","wysiwygEditorInsertText","bulletlist","orderedlist","rows","cols","Number","code","language","languageName","codeLanguageName","options","noteType","labelType","labelText","values","extensions","fetch","method","then","res","json","extension","useToolbar","cb","linkInput","url","insertUrl","which","attrs","getRangeHelper","selectedHtml","ins","unlink","anchor","quote","author","end","media","startsWith","alert","btn","vimeoId","idMatch","date","_date","now","Date","year","getYear","month","getMonth","day","getDate","insertText","txtExec","time","_time","hours","getHours","mins","getMinutes","secs","getSeconds","undo","redo","maximize","focus","sourceMode","toggleSourceMode","reply","getElementById","querySelector","click","location","href","ignore","PluginManager","thisObj","formatSignalName","signal","charAt","slice","callHandlers","returnAtFirst","shift","idx","registeredPlugins","base","callOnlyFirst","hasHandler","exists","plugin","isRegistered","register","init","deregister","removedPlugin","pluginIdx","destroy","outerText","isLeft","remaining","start","startContainer","offset","startOffset","Math","max","min","RangeHelper","win","d","_createMarker","_prepareInput","contentDocument","startMarker","endMarker","insertHTML","endHTML","selectedRange","div","insertNode","returnHtml","frag","removeMarkers","first","last","input","commonAncestorContainer","emptyNodes","removeIfEmpty","endContainer","deleteContents","restoreRange","cloneSelected","cloneRange","sel","getSelection","rangeCount","addRange","getRangeAt","hasSelection","cloneContents","getFirstBlockParent","insertNodeAt","currentRange","collapse","selectRange","removeMarker","marker","insertMarkers","collapsed","getMarker","saveRange","container","rng","compare","clear","isCollapsed","selectOuterText","setStart","setEnd","getOuterText","replaceKeyword","keywords","includeAfter","keywordsSorted","longestKeyword","requireWhitespace","keypressChar","sort","a","b","matchPos","startIndex","leftLen","charsLeft","keyword","keywordLen","whitespaceRegex","keywordIdx","whitespaceLen","maxKeyLen","rngA","rngB","compareBoundaryPoints","Range","END_TO_END","START_TO_START","removeAllRanges","empty","USER_AGENT","navigator","userAgent","ios","isWysiwygSupported","ie","documentMode","legacyEdge","contentEditable","isUnsupported","vendor","globalWin","globalDoc","IMAGE_MIME_REGEX","wrapInlines","wrapper","SCEditor","original","userOptions","editorContainer","wysiwygEditor","wysiwygWindow","wysiwygBody","wysiwygDocument","sourceEditor","footer","dropdown","isComposing","valueChangedKeyUpTimer","rangeHelper","pluginManager","currentBlockNode","backSpaceHandled","currentSelection","isSelectionCheckPending","isRequired","inlineCss","autoExpandBounds","autoExpandThrottle","maximizeScrollPosition","pasteContentFragment","handleCommand","initEditor","initLocale","initToolBar","initOptions","initEvents","initResize","handlePasteEvt","handleCutCopyEvt","handlePasteData","handleKeyDown","handleBackSpace","handleKeyPress","handleFormReset","handleMouseDown","handleComposition","handleEvent","handleDocumentClick","updateToolBar","updateActiveButtons","sourceEditorSelectedText","appendNewLine","checkSelectionChanged","checkNodeChanged","currentStyledBlockNode","triggerValueChanged","valueChangedBlur","valueChangedKeyUp","eventHandlers","btnStateHandlers","shortcutHandlers","toolbarButtons","commands","domPurify","concat","allowedAttrs","allowedUrls","src","loadScript","Promise","resolve","reject","script","onload","onerror","head","append","loadScripts","promises","all","catch","error","_sceditor","required","loaded","onReady","FormatCtor","formats","readyState","lang","frameborder","allowfullscreen","protocol","dimensions","open","tabIndex","write","close","contentWindow","placeholder","form","compositionEvents","eventsToForward","checkSelectionEvents","updateOriginal","group","exclude","groups","unselectable","menuItems","commandName","button","command","add","_sceTxtMode","_sceWysiwygMode","addShortcut","grip","moveEvents","endEvents","startX","startY","newX","newY","startWidth","startHeight","origWidth","origHeight","isDragging","minHeight","maxHeight","minWidth","maxWidth","mouseMoveFunc","changedTouches","pageX","pageY","newHeight","newWidth","mouseUpFunc","icon","touches","focusEnd","txtPos","setSelectionRange","selectNodeContents","setStartAfter","scrollTop","scrollHeight","readonly","dir","disable","mode","inSourceMode","width$1","saveWidth","height$1","save","saveHeight","maximizeSize","scrollY","scrollTo","setTimeout","expandToContent","ignoreMaxHeight","current","clearTimeout","rect","getBoundingClientRect","clientHeight","spaceNeeded","bottom","ceil","menuItem","dropDownClass","parentElement","marginTop","stopPropagation","defaultPrevented","firstParent","clipboardData","setData","innerText","editable","clipboard","types","items","FileReader","getAsFile","getData","pasteArea","fragmentToSource","fragmentToHtml","merge","removeProperty","isBold","isItalic","endHtml","overrideCodeBlocking","editorHeight","endText","sourceEditorInsertText","currentValue","startPos","selectionStart","endPos","selectionEnd","substring","sourceEditorCaret","position","filter","setSourceEditorValue","toHtml","setWysiwygEditorValue","getSourceEditorValue","getWysiwygEditorValue","convertEmoticons","allowMixed","toSource","getContentAreaContainer","getSourceEditor","enable","isInSourceMode","blur","execParam","param","executed","commandObj","check","oldNode","newNode","span","firstBlock","activeClass","isSource","j","stateFn","isDisabled","queryCommandEnabled","queryCommandState","update","br","paragraph","info","p1","undef","excludeWysiwyg","excludeSource","wysEvent","srcEvent","unbind","endOffset","keyDown","keyPress","keyUp","nodeChanged","selectionChanged","valueChanged","styleSheet","SHIFT_KEYS","`","1","2","3","4","5","6","7","8","9","0","-","=",";","'",",",".","/","\\","[","]","NUMPAD_SHIFT_KEYS","109","110","111","96","97","98","99","100","101","102","103","104","105","character","13","19","20","27","32","33","34","35","36","37","38","39","40","45","46","91","92","93","106","107","112","113","114","115","116","117","118","119","120","121","122","123","144","145","186","187","188","189","190","191","192","219","220","221","222","fromCharCode","ctrlKey","metaKey","altKey","shiftKey","after","closeTag","removeShortcut","clearBlockFormatting","block","currentHtml","lastVal","rawValue","lastChar","lastWasSpace","lastWasDelete","triggerNext","sceditor","regexEscape","escapeEntities","escapeUriScheme","path","pathname","host","dom","copyCSS","to","findCommonAncestor","node1","node2","contains","hasStyle","utils","textarea","instance","editorOptions","getEditorCommand","QuoteType","always","never","auto","defaultCommandsOverrides","selected","userlink","bbcodeHandlers","tags","strong","font-weight","em","font-style","u","text-decoration","s","sub","sup","h","face","font-family","quoteType","_stripQuotes","font-size","_normaliseColour","token","defaultattr","ul","breakStart","skipLastLineBreak","list","ol","closedBy","*","isHtmlInline","tr","th","allowsEmpty","td","hr","isSelfClosing","img","class","allowedChildren","albumimg","cite","children","elementToBbcode","codeLanguage","role","text-align","data-facebook-url","data-instagram-url","data-vimeo-url","data-youtube-url","direction","ltr","formatBBCodeString","escape","TOKEN_OPEN","TOKEN_CONTENT","TOKEN_NEWLINE","TOKEN_CLOSE","TokenizeToken","closing","BBCodeParser","tokenizeTag","lower","attrRegex","hasTag","isChildAllowed","fixInvalidChildren","convertToHTML","tokens","isRoot","bbcode","needsBlockWrap","blockWrapOpen","isPreFormatted","needsQuotes","defaults","tokenize","tokenTypes","strloop","parse","toks","currentTag","openTags","addTag","output","closesCurrentTag","cloned","curTok","breakAfter","breakAfterBlock","fixInvalidNesting","parents","insideInline","rootArr","parentIndex","parentParentChildren","splitAt","normaliseNewLines","onlyRemoveBreakAfter","parentBBCode","removedBreakEnd","removedBreakBefore","childrenLength","breakEndBlock","breakEnd","breakStartBlock","breakBeforeBlock","breakBefore","removeEmptyTags","removeEmpty","isTokenWhiteSpace","toHTML","toHTMLFragment","toBBCode","convertToBBCode","excludeClosing","toHex","number","parseInt","colorStr","bbcodeFormat","tagsToBBCodes","stripQuotes","validChildren","handleTags","blockLevel","isStyleMatch","includes","handleTag","isStrict","strictMatch","matchNum","hasCodeParent","vChildren","isCodeTag","vChild","isValidChild","parentLastChild","isLastBlockChild","asFragment","legacyAsFragment","parser","elements","containerParent","getElementsByClassName","fromBBCode","offsetLength","rename","newName","emojis","horizontalrule","fontawesome","colorPath","nodes","isSourceMode","queryCommandValue","isRtl","gripNode","transform","dragdrop","handleFile","cover","placeholderId","hideCover","display","isAllowed","createHolder","toReplace","insertAdjacentHTML","cancel","handleDragOver","dt","dataTransfer","files","kind","handleDrop","signalReady","signalPasteHtml","file","handlePaste","lastState","lastInputType","charChangedCount","isInPatchedFn","isApplying","isSelectionChangeHandled","undoLimit","undoStates","redoPosition","applyState","caret","positions","startPositions","endPositions","positionsToNode","patch","origFn","updateLastState","storeState","normalize","nodeToPositions","countField","maxLimit","documentSelectionChangeHandler","activeElement","signalSelectionchangedEvent","beforeInputHandler","inputType","compositionHandler","signalInputEvent","plaintext","plainTextEnabled","addButton","enabled","signalPasteRaw","mentions","initMentions","lookup","onclick","assign","symbol","item_template","$e","$lookup","prevWord","isFixed","processKey","showLookup","hideLookup","$el","getPropertyValue","curr","$parent","getLength","baseOffset","word","pos","y","parentRect","query","tokenInput","headers","Accept","Content-Type","RequestVerificationToken","response","map","eval","onClick","onHover","bounding","innerHeight","innerWidth","clientWidth","deleteItem","dataset","$children","findIndex","$next","scrollIntoView"],"mappings":"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"}